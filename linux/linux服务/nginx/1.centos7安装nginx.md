# centos7安装nginx

[nginx官网](https://nginx.org/)

[nginx github地址](https://github.com/nginx/nginx)

# 一、源码编译安装

[nginx官网总下载地址](https://nginx.org/en/download.html)

[nginx官方源码下载地址](https://nginx.org/download/)

[nginx github下载地址](https://github.com/nginx/nginx/releases)

[nginx官方源码安装文档](https://nginx.org/en/docs/configure.html)

## 1.1 下载nginx源码包

```python
wget https://nginx.org/download/nginx-1.17.9.tar.gz
```



## 1.2 编译安装nginx

```python
//创建nginx用户
useradd nginx -s /sbin/nologin -M

//安装依赖包
yum -y install gcc gcc-c++ zlib zlib-devel openssl openssl-devel pcre-devel

//解压缩源码包
tar xf nginx-1.17.9.tar.gz && cd nginx-1.17.9

//编译安装
./configure \
--prefix=/etc/nginx \
--user=nginx \
--group=nginx \
--sbin-path=/usr/sbin/nginx \
--conf-path=/etc/nginx/nginx.conf \
--pid-path=/var/run/nginx.pid \
--lock-path=/var/run/nginx.lock \
--error-log-path=/var/log/nginx/error.log \
--http-log-path=/var/log/nginx/access.log \
--with-http_gzip_static_module \
--with-http_stub_status_module \
--with-http_ssl_module \
--with-pcre \
--with-file-aio \
--with-http_realip_module \
--without-http_scgi_module \
--without-http_uwsgi_module \
--without-http_fastcgi_module


make && make install
```



**编译参数说明**

更多参数请使用`./configure --help`查看或者[查看官方编译安装说明文档](https://nginx.org/en/docs/configure.html)

| 参数                               | 说明                                         |
| ---------------------------------- | -------------------------------------------- |
| **--prefix**                       | nginx安装路径                                |
| **--user**                         | nginx运行用户                                |
| **--group**                        | nginx运行用户组                              |
| **--sbin-path**                    | nginx可执行文件路径                          |
| **--conf-path**                    | nginx配置文件路径                            |
| **--pid-path**                     | nginx pid文件路径                            |
| **--lock-path**                    | nginx锁文件路径                              |
| **--error-log-path**               | nginx错误日志路径                            |
| **--http-log-path**                | nginx访问日志路径                            |
| **--with-http_gzip_static_module** | 支持.gz压缩文件                              |
| **--with-http_stub_status_module** | 支持nginx基本状态信息访问                    |
| **--with-http_ssl_module**         | 支持nginx https                              |
| **--with-pcre**                    | 强制使用pcre库                               |
| **--with-file-aio**                | 支持异步IO                                   |
| **--with-http_realip_module**      | 将客户端地址更改为在指定的头字段中发送的地址 |
| **--without-http_scgi_module**     | 禁止将请求传递到SCGI服务器                   |
| **--without-http_uwsgi_module**    | 禁止将请求传递到uwsgi服务器                  |
| **--without-http_fastcgi_module**  | 禁止将请求传递到FastCGI服务器                |





# 二、通过yum源安装

[nginx yum源官方地址](https://nginx.org/en/linux_packages.html)

[nginx centos yum源官方地址](https://nginx.org/en/linux_packages.html#RHEL-CentOS)



## 2.1 添加nginx官方yum源

```python
cat > /etc/yum.repos.d/nginx.repo <<'EOF'
[nginx-stable]
name=nginx stable repo
baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true

[nginx-mainline]
name=nginx mainline repo
baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/
gpgcheck=1
enabled=0
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true
EOF
```



## 2.2 安装nginx

### 2.3.1 安装最新版

```python
yum -y install nginx
```



### 2.3.2 安装指定版本

**查看可用版本**

```python
yum list nginx --showduplicates|sort -r
```

**安装指定版本**

```python
yum -y install nginx-1.12.2
```



# 三、rpm包安装

## 3.1 下载rpm包

[nginx rpm包官方下载地址](https://nginx.org/packages/)

[nginx centos rpm包官方下载地址](https://nginx.org/packages/rhel/7/x86_64/RPMS/)

```python
wget https://nginx.org/packages/rhel/7/x86_64/RPMS/nginx-1.18.0-1.el7.ngx.x86_64.rpm
```



## 3.2 安装

```python
yum -y localinstall nginx-1.18.0-1.el7.ngx.x86_64.rpm
```



# 四、nginx配置文件主要模块

nginx主配置文件`/etc/nginx/nginx.conf`是一个纯文本类型的文件，整个配置文件是以区块的形式组织的。一般，每个区块以一对大括号{}来表示开始与结束。

模块分类

- 1.CoreModule 核心模块

- 2.EventModule 事件驱动模块

- 3.HttpCoreModule http内核模块



CoreModule层下可以有Event、HTTP

HTTP模块层允许有多个Server层, Server主要用于配置多个网站

Server层又允许有多个Location, Location主要用于定义网站访问路径

---



**CoreModule核心模块**

```nginx
user www;                       #Nginx进程所使用的用户
worker_processes 1;             #启动的work进程数(CPU数量一致或auto)
error_log /log/nginx/error.log  #错误日志
pid /var/run/nginx.pid          #Nginx服务启动后产生的pid进程号
```



**events事件模块**

```nginx
events {            
    worker_connections  #每个worker进程支持的最大连接数
    use                 #事件驱动模型, epoll默认
}
```



**http内核模块**

```nginx
#公共的配置定义在http{}
http {  
    #使用Server配置网站, 每个Server{}代表一个网站(简称虚拟主机)
    server {
        listen       80;        		#监听端口, 默认80
        server_name  localhost; 		#提供服务的域名或主机名
        access_log host.access.log;  #访问日志
        
        #控制网站访问路径
        location / {
            root   /usr/share/nginx/html;   #存放网站代码路径
            index  index.html index.htm;    #服务器返回的默认页面文件
        }
    
        #指定错误代码, 统一定义错误页面, 错误代码重定向到新的Locaiton
        error_page   500 502 503 504  /50x.html;
    }
    
    #第二个虚拟主机配置
    server {
    
    }
    
    include /etc/nginx/conf.d/*.conf;  #包含/etc/nginx/conf.d/目录下所有以.conf结尾的文件

}
```

