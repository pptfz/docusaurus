"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[1865],{2708:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>c,metadata:()=>o,toc:()=>a});var n=s(74848),t=s(28453);const c={},i="metrics server",o={id:"\u4e91\u539f\u751f/k8s/\u76d1\u63a7/metrics-server/metrics server",title:"metrics server",description:"metrics server github\u5730\u5740",source:"@site/docs/\u4e91\u539f\u751f/k8s/\u76d1\u63a7/metrics-server/metrics server.md",sourceDirName:"\u4e91\u539f\u751f/k8s/\u76d1\u63a7/metrics-server",slug:"/\u4e91\u539f\u751f/k8s/\u76d1\u63a7/metrics-server/metrics server",permalink:"/docs/\u4e91\u539f\u751f/k8s/\u76d1\u63a7/metrics-server/metrics server",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"kind\u9ed8\u8ba4sc",permalink:"/docs/\u4e91\u539f\u751f/k8s/\u5b66\u4e60\u5de5\u5177/kind/kind\u9ed8\u8ba4sc"},next:{title:"harbor\u5b89\u88c5",permalink:"/docs/\u4e91\u539f\u751f/\u4e91\u539f\u751f\u5de5\u5177/harbor/harbor\u5b89\u88c5"}},l={},a=[{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:2},{value:"\u4f7f\u7528",id:"\u4f7f\u7528",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h1,{id:"metrics-server",children:"metrics server"}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.a,{href:"https://github.com/kubernetes-sigs/metrics-server",children:"metrics server github\u5730\u5740"})}),"\n",(0,n.jsx)(r.h2,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,n.jsx)(r.p,{children:"\u6dfb\u52a0helm\u4ed3\u5e93"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-shell",children:"helm repo add metrics-server https://kubernetes-sigs.github.io/metrics-server\nhelm repo update\n"})}),"\n",(0,n.jsx)(r.p,{children:"\u4e0b\u8f7d\u5b89\u88c5\u5305"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-sh",children:"helm pull metrics-server/metrics-server\n"})}),"\n",(0,n.jsx)(r.p,{children:"\u89e3\u538b\u7f29"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-sh",children:"tar xf metrics-server-3.11.0.tgz && cd metrics-server\n"})}),"\n",(0,n.jsxs)(r.p,{children:["\u4fee\u6539 ",(0,n.jsx)(r.code,{children:"values.yaml"})," \u6587\u4ef6\u4e2d\u7684\u955c\u50cf"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-sh",children:"\u4fee\u6539\n\tregistry.k8s.io/metrics-server/metrics-server:v0.6.4\n\u4fee\u6539\u4e3a\n\tuhub.service.ucloud.cn/996.icu/metrics-server:v0.6.4\t\n"})}),"\n",(0,n.jsx)(r.p,{children:"\u5b89\u88c5"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-sh",children:"helm upgrade --install metircs-server -n monitor --create-namespace .\n"})}),"\n",(0,n.jsxs)(r.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c ",(0,n.jsx)(r.code,{children:"metircs-server"})," pod\u4f1a\u6709\u5982\u4e0b\u62a5\u9519\uff0c\u539f\u56e0\u662f\u9ed8\u8ba4\u60c5\u51b5\u4e0bkubeadm \u90e8\u7f72\u7684 kubelet \u670d\u52a1\u8bc1\u4e66\u662f\u81ea\u7b7e\u540d\u7684,\u8fd9\u610f\u5473\u7740\u4ece\u5916\u90e8\u670d\u52a1\uff08\u4f8b\u5982metrics-server\uff09\u5230 kubelet \u7684\u8fde\u63a5\u65e0\u6cd5\u4f7f\u7528 TLS \u8fdb\u884c\u4fdd\u62a4"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-sh",children:'E1227 06:51:11.516526       1 scraper.go:140] "Failed to scrape node" err="Get \\"https://172.18.0.5:10250/metrics/resource\\": x509: cannot validate certificate for 172.18.0.5 because it doesn\'t contain any IP SANs" node="ops-ingress-worker3"\n'})}),"\n",(0,n.jsxs)(r.p,{children:["\u5728 ",(0,n.jsx)(r.a,{href:"https://github.com/kubernetes-sigs/metrics-server/issues/196",children:"github"})," \u4e2d\u6709\u8fd9\u4e2a\u95ee\u9898\u7684\u76f8\u5173\u8ba8\u8bba"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.a,{href:"https://particule.io/en/blog/kubeadm-metrics-server/",children:"\u4f7f\u7528kubeadm\u90e8\u7f72\u96c6\u7fa4\u7684\u89e3\u51b3\u65b9\u6cd5"})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.a,{href:"https://www.zeng.dev/post/2023-kubeadm-enable-kubelet-serving-certs/",children:"\u4f7f\u7528kind\u90e8\u7f72\u96c6\u7fa4\u7684\u89e3\u51b3\u65b9\u6cd5"})}),"\n",(0,n.jsxs)(r.p,{children:["\u4e34\u65f6\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\u5728 ",(0,n.jsx)(r.code,{children:"metrics-server"})," \u542f\u52a8\u7684\u65f6\u5019\u6dfb\u52a0 ",(0,n.jsx)(r.code,{children:"--kubelet-insecure-tls"})," \u53c2\u6570\u8df3\u8fc7\u8bc1\u4e66\u9a8c\u8bc1"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yaml",children:"defaultArgs:\n  - --cert-dir=/tmp\n  - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname\n  - --kubelet-use-node-status-port\n  - --metric-resolution=15s\n  - --kubelet-insecure-tls\n"})}),"\n",(0,n.jsx)(r.h2,{id:"\u4f7f\u7528",children:"\u4f7f\u7528"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-sh",children:"$ kubectl top no\nNAME                        CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%   \nops-ingress-control-plane   958m         23%    1029Mi          20%       \nops-ingress-worker          438m         10%    516Mi           10%       \nops-ingress-worker2         345m         8%     592Mi           12%       \nops-ingress-worker3         358m         8%     632Mi           12%  \n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-sh",children:"$ kubectl top po\nNAME                                                 CPU(cores)   MEMORY(bytes)   \nmetircs-server-metrics-server-85467c4898-v79w5       24m          17Mi            \nprometheus-alertmanager-0                            8m           15Mi            \nprometheus-kube-state-metrics-85596bfdb6-fs62r       14m          35Mi            \nprometheus-prometheus-node-exporter-jkfs2            1m           6Mi             \nprometheus-prometheus-node-exporter-jnhpb            1m           8Mi             \nprometheus-prometheus-node-exporter-kxpzw            1m           7Mi             \nprometheus-prometheus-node-exporter-z428z            1m           6Mi             \nprometheus-prometheus-pushgateway-79745d4495-gdn2m   13m          6Mi             \nprometheus-server-64f955868b-mkq8t                   0m           129Mi        \n"})})]})}function m(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},28453:(e,r,s)=>{s.d(r,{R:()=>i,x:()=>o});var n=s(96540);const t={},c=n.createContext(t);function i(e){const r=n.useContext(c);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),n.createElement(c.Provider,{value:r},e.children)}}}]);