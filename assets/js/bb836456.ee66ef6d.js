"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[2239],{44089:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>i,contentTitle:()=>s,default:()=>g,frontMatter:()=>l,metadata:()=>a,toc:()=>d});var o=t(74848),r=t(28453);const l={},s="Linux \u65e5\u5fd7\u5207\u5272\u795e\u5668 Logrotate \u539f\u7406\u548c\u914d\u7f6e\u8be6\u89e3",a={id:"linux/\u65e5\u5fd7/Linux \u65e5\u5fd7\u5207\u5272\u795e\u5668 Logrotate \u539f\u7406\u548c\u914d\u7f6e\u8be6\u89e3",title:"Linux \u65e5\u5fd7\u5207\u5272\u795e\u5668 Logrotate \u539f\u7406\u548c\u914d\u7f6e\u8be6\u89e3",description:"[toc]",source:"@site/docs/linux/\u65e5\u5fd7/Linux \u65e5\u5fd7\u5207\u5272\u795e\u5668 Logrotate \u539f\u7406\u548c\u914d\u7f6e\u8be6\u89e3.md",sourceDirName:"linux/\u65e5\u5fd7",slug:"/linux/\u65e5\u5fd7/Linux \u65e5\u5fd7\u5207\u5272\u795e\u5668 Logrotate \u539f\u7406\u548c\u914d\u7f6e\u8be6\u89e3",permalink:"/docs/linux/\u65e5\u5fd7/Linux \u65e5\u5fd7\u5207\u5272\u795e\u5668 Logrotate \u539f\u7406\u548c\u914d\u7f6e\u8be6\u89e3",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u6d4b\u8bd5Linux\u4e0b\u5220\u9664\u5927\u91cf\u6587\u4ef6\u7684\u6548\u7387",permalink:"/docs/linux/\u6027\u80fd\u6d4b\u8bd5/\u6587\u4ef6\u5220\u9664\u6548\u7387\u6d4b\u8bd5/\u6d4b\u8bd5Linux\u4e0b\u5220\u9664\u5927\u91cf\u6587\u4ef6\u7684\u6548\u7387"},next:{title:"\u65e5\u5fd7\u67e5\u8be2",permalink:"/docs/linux/\u65e5\u5fd7/\u65e5\u5fd7\u67e5\u8be2"}},i={},d=[{value:"1.logrotate\u4ecb\u7ecd",id:"1logrotate\u4ecb\u7ecd",level:2},{value:"1.1 logrotate\u914d\u7f6e\u6587\u4ef6",id:"11-logrotate\u914d\u7f6e\u6587\u4ef6",level:3},{value:"1.2 logrotate \u547d\u4ee4\u683c\u5f0f",id:"12-logrotate-\u547d\u4ee4\u683c\u5f0f",level:3},{value:"1.3 logrotate\u624b\u52a8\u64cd\u4f5c\u793a\u4f8b",id:"13-logrotate\u624b\u52a8\u64cd\u4f5c\u793a\u4f8b",level:3},{value:"2.\u5207\u5272\u4ecb\u7ecd",id:"2\u5207\u5272\u4ecb\u7ecd",level:2},{value:"2.1 \u5207\u5272\u8bf4\u660e",id:"21-\u5207\u5272\u8bf4\u660e",level:3},{value:"2.2 \u5207\u5272\u793a\u4f8b",id:"22-\u5207\u5272\u793a\u4f8b",level:3},{value:"2.2.1 \u5c0f\u793a\u4f8b\uff1a\u4e0b\u9762\u4e00\u4e2a\u5207\u5272nginx\u65e5\u5fd7\u7684\u914d\u7f6e",id:"221-\u5c0f\u793a\u4f8b\u4e0b\u9762\u4e00\u4e2a\u5207\u5272nginx\u65e5\u5fd7\u7684\u914d\u7f6e",level:4},{value:"2.2.2 \u5206\u4eab\u4e00\u4f8b\u66fe\u7ecf\u4f7f\u7528\u8fc7\u7684nginx\u65e5\u5fd7\u5207\u5272\u5904\u7406\u811a\u672c",id:"222-\u5206\u4eab\u4e00\u4f8b\u66fe\u7ecf\u4f7f\u7528\u8fc7\u7684nginx\u65e5\u5fd7\u5207\u5272\u5904\u7406\u811a\u672c",level:4},{value:"2.2.3 php\u811a\u672c\u5207\u5272\u4e00\u4f8b",id:"223-php\u811a\u672c\u5207\u5272\u4e00\u4f8b",level:4},{value:"2.2.4 nginx\u65e5\u5fd7\u5207\u5272\u4e00\u4f8b",id:"224-nginx\u65e5\u5fd7\u5207\u5272\u4e00\u4f8b",level:4},{value:"2.2.5 \u7cfb\u7edf\u65e5\u5fd7\u5207\u5272\u4e00\u4f8b",id:"225-\u7cfb\u7edf\u65e5\u5fd7\u5207\u5272\u4e00\u4f8b",level:4},{value:"2.2.6 tomcat\u65e5\u5fd7\u5207\u5272\u4e00\u4f8b",id:"226-tomcat\u65e5\u5fd7\u5207\u5272\u4e00\u4f8b",level:4},{value:"2.2.7 \u65e9\u671f\u7528\u8fc7\u7684nginx\u65e5\u5fd7\u5904\u7406\u4e00\u4f8b",id:"227-\u65e9\u671f\u7528\u8fc7\u7684nginx\u65e5\u5fd7\u5904\u7406\u4e00\u4f8b",level:4},{value:"3.logrotate\u9ed8\u8ba4\u81ea\u52a8\u5207\u5272\u751f\u6548\u65f6\u95f4",id:"3logrotate\u9ed8\u8ba4\u81ea\u52a8\u5207\u5272\u751f\u6548\u65f6\u95f4",level:2},{value:"3.1 logrotate\u5207\u5272\u65f6\u95f4\u8bf4\u660e",id:"31-logrotate\u5207\u5272\u65f6\u95f4\u8bf4\u660e",level:3},{value:"3.2 \u4fee\u6539logrotate\u5207\u5272\u65f6\u95f4",id:"32-\u4fee\u6539logrotate\u5207\u5272\u65f6\u95f4",level:3},{value:"3.3 \u811a\u672c\u5b9e\u73b0\u65e5\u5fd7\u5207\u5272",id:"33-\u811a\u672c\u5b9e\u73b0\u65e5\u5fd7\u5207\u5272",level:3},{value:"3.3.1 Python\u811a\u672c\u5b9e\u73b0\u65e5\u5fd7\u5207\u5272",id:"331-python\u811a\u672c\u5b9e\u73b0\u65e5\u5fd7\u5207\u5272",level:4},{value:"3.3.2 shell\u811a\u672c\u5b9e\u73b0\u65e5\u5fd7\u5207\u5272",id:"332-shell\u811a\u672c\u5b9e\u73b0\u65e5\u5fd7\u5207\u5272",level:4},{value:"3.3.3 \u65e5\u5fd7\u538b\u7f29\u811a\u672c",id:"333-\u65e5\u5fd7\u538b\u7f29\u811a\u672c",level:4},{value:"4.\u5c1d\u8bd5\u89e3\u51b3 logrotate \u65e0\u6cd5\u81ea\u52a8\u8f6e\u8be2\u65e5\u5fd7\u7684\u529e\u6cd5",id:"4\u5c1d\u8bd5\u89e3\u51b3-logrotate-\u65e0\u6cd5\u81ea\u52a8\u8f6e\u8be2\u65e5\u5fd7\u7684\u529e\u6cd5",level:2}];function c(n){const e={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.p,{children:"[toc]"}),"\n",(0,o.jsx)(e.h1,{id:"linux-\u65e5\u5fd7\u5207\u5272\u795e\u5668-logrotate-\u539f\u7406\u548c\u914d\u7f6e\u8be6\u89e3",children:"Linux \u65e5\u5fd7\u5207\u5272\u795e\u5668 Logrotate \u539f\u7406\u548c\u914d\u7f6e\u8be6\u89e3"}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.a,{href:"https://www.cnblogs.com/kevingrace/p/6307298.html",children:"\u672c\u6587\u4e25\u91cd\u6284\u88ad\u81f3\u4e92\u8054\u7f51\u5e76\u7a0d\u4f5c\u4fee\u6539"})}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"\u5199\u5728\u5f00\u5934"})}),"\n",(0,o.jsxs)(e.admonition,{type:"tip",children:[(0,o.jsx)(e.p,{children:"\u5bf9\u4e8e Linux \u7cfb\u7edf\u5b89\u5168\u6765\u8bf4\uff0c\u65e5\u5fd7\u6587\u4ef6\u662f\u6781\u5176\u91cd\u8981\u7684\u5de5\u5177\u3002\u4e0d\u77e5\u4e3a\u4f55\uff0c\u6211\u53d1\u73b0\u5f88\u591a\u8fd0\u7ef4\u540c\u5b66\u7684\u670d\u52a1\u5668\u4e0a\u90fd\u8fd0\u884c\u7740\u4e00\u4e9b\u8bf8\u5982\u6bcf\u5929\u5207\u5206 Nginx\u65e5\u5fd7\u4e4b\u7c7b\u7684 CRON \u811a\u672c\uff0c\u5927\u5bb6\u4f3c\u4e4e\u9057\u5fd8\u4e86 Logrotate\uff0c\u4e89\u76f8\u53d1\u660e\u81ea\u5df1\u7684\u8f6e\u5b50\uff0c\u8fd9\u771f\u662f\u8ba9\u4eba\u6cae\u4e27\u554a\uff01\u5c31\u597d\u6bd4\u660e\u660e\u8eab\u8fb9\u8eba\u7740\u73b0\u6210\u7684\u6027\u611f\u7f8e\u5973\uff0c\u5927\u5bb6\u5374\u5fd9\u7740\u81ea\u5a31\u81ea\u4e50\uff0c\u7f6a\u8fc7\uff01"}),(0,o.jsx)(e.p,{children:"logrotate \u7a0b\u5e8f\u662f\u4e00\u4e2a\u65e5\u5fd7\u6587\u4ef6\u7ba1\u7406\u5de5\u5177\u3002\u7528\u4e8e\u5206\u5272\u65e5\u5fd7\u6587\u4ef6\uff0c\u5220\u9664\u65e7\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u5e76\u521b\u5efa\u65b0\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u8d77\u5230\u201c\u8f6c\u50a8\u201d\u4f5c\u7528\u3002\u53ef\u4ee5\u8282\u7701\u78c1\u76d8\u7a7a\u95f4\u3002\u4e0b\u9762\u5c31\u5bf9 logrotate \u65e5\u5fd7\u8f6e\u8f6c\u64cd\u4f5c\u505a\u4e00\u68b3\u7406\u8bb0\u5f55\u3002"})]}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"\u672c\u6587\u4ee5centos7.6\u4e3a\u4f8b"})}),"\n",(0,o.jsx)(e.h2,{id:"1logrotate\u4ecb\u7ecd",children:"1.logrotate\u4ecb\u7ecd"}),"\n",(0,o.jsx)(e.h3,{id:"11-logrotate\u914d\u7f6e\u6587\u4ef6",children:"1.1 logrotate\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,o.jsxs)(e.p,{children:["Linux\u7cfb\u7edf\u9ed8\u8ba4\u5b89\u88c5 ",(0,o.jsx)(e.code,{children:"logrotate"})," \u5de5\u5177\uff0c\u5b83\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6\u5728\uff1a"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:"/etc/logrotate.conf\n/etc/logrotate.d/\n"})}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.code,{children:"logrotate.conf"})," \u624d\u662f\u4e3b\u8981\u7684\u914d\u7f6e\u6587\u4ef6\uff0c",(0,o.jsx)(e.code,{children:"logrotate.d"})," \u662f\u4e00\u4e2a\u76ee\u5f55\uff0c\u8be5\u76ee\u5f55\u91cc\u7684\u6240\u6709\u6587\u4ef6\u90fd\u4f1a\u88ab\u4e3b\u52a8\u7684\u8bfb\u5165 ",(0,o.jsx)(e.code,{children:"/etc/logrotate.conf"})," \u4e2d\u6267\u884c\u3002"]}),"\n",(0,o.jsxs)(e.p,{children:["\u53e6\u5916\uff0c\u5982\u679c ",(0,o.jsx)(e.code,{children:"/etc/logrotate.d/"})," \u91cc\u9762\u7684\u6587\u4ef6\u4e2d\u6ca1\u6709\u8bbe\u5b9a\u4e00\u4e9b\u7ec6\u8282\uff0c\u5219\u4f1a\u4ee5 ",(0,o.jsx)(e.code,{children:"/etc/logrotate.conf"})," \u8fd9\u4e2a\u6587\u4ef6\u7684\u8bbe\u5b9a\u6765\u4f5c\u4e3a\u9ed8\u8ba4\u503c\u3002"]}),"\n",(0,o.jsxs)(e.p,{children:["Logrotate\u662f\u57fa\u4e8eCRON\u6765\u8fd0\u884c\u7684\uff0c\u5176\u811a\u672c\u662f ",(0,o.jsx)(e.code,{children:"/etc/cron.daily/logrotate"}),"\uff0c\u65e5\u5fd7\u8f6e\u8f6c\u662f\u7cfb\u7edf\u81ea\u52a8\u5b8c\u6210\u7684\u3002\u5b9e\u9645\u8fd0\u884c\u65f6\uff0cLogrotate\u4f1a\u8c03\u7528\u914d\u7f6e\u6587\u4ef6 ",(0,o.jsx)(e.code,{children:"/etc/logrotate.conf"}),"\u3002\u53ef\u4ee5\u5728 ",(0,o.jsx)(e.code,{children:"/etc/logrotate.d"})," \u76ee\u5f55\u91cc\u653e\u7f6e\u81ea\u5b9a\u4e49\u597d\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u7528\u6765\u8986\u76d6Logrotate\u7684\u7f3a\u7701\u503c\u3002"]}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.code,{children:"/etc/cron.daily/logrotate"})," \u6587\u4ef6\u5185\u5bb9\u5982\u4e0b"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:'$ cat /etc/cron.daily/logrotate\n#!/bin/sh\n\n/usr/sbin/logrotate -s /var/lib/logrotate/logrotate.status /etc/logrotate.conf\nEXITVALUE=$?\nif [ $EXITVALUE != 0 ]; then\n    /usr/bin/logger -t logrotate "ALERT exited abnormally with [$EXITVALUE]"\nfi\nexit 0\n'})}),"\n",(0,o.jsx)(e.p,{children:"\u5982\u679c\u7b49\u4e0d\u53cacron\u81ea\u52a8\u6267\u884c\u65e5\u5fd7\u8f6e\u8f6c\uff0c\u60f3\u624b\u52a8\u5f3a\u5236\u5207\u5272\u65e5\u5fd7\uff0c\u9700\u8981\u52a0-f\u53c2\u6570\uff1b\u4e0d\u8fc7\u6b63\u5f0f\u6267\u884c\u524d\u6700\u597d\u901a\u8fc7Debug\u9009\u9879\u6765\u9a8c\u8bc1\u4e00\u4e0b\uff08-d\u53c2\u6570\uff09\uff0c\u8fd9\u5bf9\u8c03\u8bd5\u4e5f\u5f88\u91cd\u8981\uff1a"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:"/usr/sbin/logrotate -f /etc/logrotate.d/nginx\n\n/usr/sbin/logrotate -d -f /etc/logrotate.d/nginx\n"})}),"\n",(0,o.jsx)(e.h3,{id:"12-logrotate-\u547d\u4ee4\u683c\u5f0f",children:"1.2 logrotate \u547d\u4ee4\u683c\u5f0f"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-shell",children:"logrotate [OPTION...] <configfile>\n-d\uff0c --debug \uff1adebug\u6a21\u5f0f\uff0c\u6d4b\u8bd5\u914d\u7f6e\u6587\u4ef6\u662f\u5426\u6709\u9519\u8bef\u3002\n-f\uff0c --force \uff1a\u5f3a\u5236\u8f6c\u50a8\u6587\u4ef6\u3002\n-m\uff0c --mail=command \uff1a\u538b\u7f29\u65e5\u5fd7\u540e\uff0c\u53d1\u9001\u65e5\u5fd7\u5230\u6307\u5b9a\u90ae\u7bb1\u3002\n-s\uff0c --state=statefile \uff1a\u4f7f\u7528\u6307\u5b9a\u7684\u72b6\u6001\u6587\u4ef6\u3002\n-v\uff0c --verbose \uff1a\u663e\u793a\u8f6c\u50a8\u8fc7\u7a0b\u3002\n"})}),"\n",(0,o.jsx)(e.h3,{id:"13-logrotate\u624b\u52a8\u64cd\u4f5c\u793a\u4f8b",children:"1.3 logrotate\u624b\u52a8\u64cd\u4f5c\u793a\u4f8b"}),"\n",(0,o.jsx)(e.p,{children:"\u6839\u636e\u65e5\u5fd7\u5207\u5272\u8bbe\u7f6e\u8fdb\u884c\u64cd\u4f5c\uff0c\u5e76\u663e\u793a\u8be6\u7ec6\u4fe1\u606f\uff1a"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:"/usr/sbin/logrotate -v /etc/logrotate.conf\n\n/usr/sbin/logrotate -v /etc/logrotate.d/php\n"})}),"\n",(0,o.jsx)(e.p,{children:"\u6839\u636e\u65e5\u5fd7\u5207\u5272\u8bbe\u7f6e\u8fdb\u884c\u6267\u884c\uff0c\u5e76\u663e\u793a\u8be6\u7ec6\u4fe1\u606f\uff0c\u4f46\u662f\u4e0d\u8fdb\u884c\u5177\u4f53\u64cd\u4f5c\uff0cdebug\u6a21\u5f0f"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:"/usr/sbin/logrotate -d /etc/logrotate.conf\n\n/usr/sbin/logrotate -d /etc/logrotate.d/nginx\n"})}),"\n",(0,o.jsxs)(e.p,{children:["\u53ef\u5728 ",(0,o.jsx)(e.code,{children:"/var/lib/logrotate/logrotate.status"})," \u67e5\u770b\u5404log\u6587\u4ef6\u7684\u5177\u4f53\u6267\u884c\u60c5\u51b5"]}),"\n",(0,o.jsx)(e.h2,{id:"2\u5207\u5272\u4ecb\u7ecd",children:"2.\u5207\u5272\u4ecb\u7ecd"}),"\n",(0,o.jsx)(e.h3,{id:"21-\u5207\u5272\u8bf4\u660e",children:"2.1 \u5207\u5272\u8bf4\u660e"}),"\n",(0,o.jsxs)(e.p,{children:["\u6bd4\u5982\u4ee5\u7cfb\u7edf\u65e5\u5fd7 ",(0,o.jsx)(e.code,{children:"/var/log/message"})," \u505a\u5207\u5272\u6765\u7b80\u5355\u8bf4\u660e\u4e0b\uff1a"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"\u7b2c\u4e00\u6b21\u6267\u884c\u5b8crotate(\u8f6e\u8f6c)\u4e4b\u540e\uff0c\u539f\u672c\u7684messages\u4f1a\u53d8\u6210messages.1\uff0c\u800c\u4e14\u4f1a\u5236\u9020\u4e00\u4e2a\u7a7a\u7684messages\u7ed9\u7cfb\u7edf\u6765\u50a8\u5b58\u65e5\u5fd7\uff1b"}),"\n",(0,o.jsx)(e.li,{children:"\u7b2c\u4e8c\u6b21\u6267\u884c\u4e4b\u540e\uff0cmessages.1\u4f1a\u53d8\u6210messages.2\uff0c\u800cmessages\u4f1a\u53d8\u6210messages.1\uff0c\u53c8\u9020\u6210\u4e00\u4e2a\u7a7a\u7684messages\u6765\u50a8\u5b58\u65e5\u5fd7\uff01"}),"\n"]}),"\n",(0,o.jsx)(e.p,{children:"\u5982\u679c\u4ec5\u8bbe\u5b9a\u4fdd\u7559\u4e09\u4e2a\u65e5\u5fd7\uff08\u5373\u8f6e\u8f6c3\u6b21\uff09\u7684\u8bdd\uff0c\u90a3\u4e48\u6267\u884c\u7b2c\u4e09\u6b21\u65f6\uff0c\u5219 messages.3\u8fd9\u4e2a\u6863\u6848\u5c31\u4f1a\u88ab\u5220\u9664\uff0c\u5e76\u7531\u540e\u9762\u7684\u8f83\u65b0\u7684\u4fdd\u5b58\u65e5\u5fd7\u6240\u53d6\u4ee3\uff01\u4e5f\u5c31\u662f\u4f1a\u4fdd\u5b58\u6700\u65b0\u7684\u51e0\u4e2a\u65e5\u5fd7\u3002"}),"\n",(0,o.jsxs)(e.p,{children:["\u65e5\u5fd7\u7a76\u7adf\u8f6e\u6362\u51e0\u6b21\uff0c\u8fd9\u4e2a\u662f\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 ",(0,o.jsx)(e.code,{children:"rotate"})," \u53c2\u6570\u6765\u5224\u5b9a\u7684\u3002"]}),"\n",(0,o.jsxs)(e.p,{children:["\u770b\u4e0b ",(0,o.jsx)(e.code,{children:"logrotate.conf"})," \u914d\u7f6e\uff1a"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-shell",children:'# see "man logrotate" for details\n# rotate log files weekly(\u9ed8\u8ba4\u6bcf\u4e00\u5468\u6267\u884c\u4e00\u6b21rotate\u8f6e\u8f6c\u5de5\u4f5c)\nweekly\n\n# keep 4 weeks worth of backlogs(\u4fdd\u7559\u591a\u5c11\u4e2a\u65e5\u5fd7\u6587\u4ef6(\u8f6e\u8f6c\u51e0\u6b21).\u9ed8\u8ba4\u4fdd\u7559\u56db\u4e2a.\u5c31\u662f\u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\u5220\u9664\u4e4b\u524d\u8f6e\u8f6c\u7684\u6b21\u6570\uff0c0 \u6307\u6ca1\u6709\u5907\u4efd)\nrotate 4\n\n# create new (empty) log files after rotating old ones(\u81ea\u52a8\u521b\u5efa\u65b0\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u65b0\u7684\u65e5\u5fd7\u6587\u4ef6\u5177\u6709\u548c\u539f\u6765\u7684\u6587\u4ef6\u76f8\u540c\u7684\u6743\u9650\uff1b\u56e0\u4e3a\u65e5\u5fd7\u88ab\u6539\u540d\uff0c\u56e0\u6b64\u8981\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6765\u7ee7\u7eed\u5b58\u50a8\u4e4b\u524d\u7684\u65e5\u5fd7)\ncreate\n\n# use date as a suffix of the rotated file(\u8fd9\u4e2a\u53c2\u6570\u5f88\u91cd\u8981\uff01\u5c31\u662f\u5207\u5272\u540e\u7684\u65e5\u5fd7\u6587\u4ef6\u4ee5\u5f53\u524d\u65e5\u671f\u4e3a\u683c\u5f0f\u7ed3\u5c3e\uff0c\u5982xxx.log-20131216\u8fd9\u6837\uff0c\u5982\u679c\u6ce8\u91ca\u6389\uff0c\u5207\u5272\u51fa\u6765\u662f\u6309\u6570\u5b57\u9012\u589e\uff0c\u5373\u524d\u9762\u8bf4\u7684 xxx.log-1\u8fd9\u79cd\u683c\u5f0f)\ndateext\n\n# uncomment this if you want your log files compressed(\u662f\u5426\u901a\u8fc7gzip\u538b\u7f29\u8f6c\u50a8\u4ee5\u540e\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u5982xxx.log-20131216.gz \uff1b\u5982\u679c\u4e0d\u9700\u8981\u538b\u7f29\uff0c\u6ce8\u91ca\u6389\u5c31\u884c)\n#compress\n\n# RPM packages drop log rotation information into this directory(\u5c06 /etc/logrotate.d/ \u76ee\u5f55\u4e2d\u7684\u6240\u6709\u6587\u4ef6\u90fd\u52a0\u8f7d\u8fdb\u6765)\ninclude /etc/logrotate.d\n\n# no packages own wtmp and btmp -- we\'ll rotate them here()\n/var/log/wtmp {\t\t\t# \u4ec5\u9488\u5bf9 /var/log/wtmp \u6240\u8bbe\u5b9a\u7684\u53c2\u6570\n    monthly\t\t\t# \u6bcf\u6708\u4e00\u6b21\u5207\u5272\uff0c\u53d6\u4ee3\u9ed8\u8ba4\u7684\u4e00\u5468\n    create 0664 root utmp\t\t\t# \u6587\u4ef6\u5927\u5c0f\u8d85\u8fc7 1M \u540e\u624d\u4f1a\u5207\u5272\n\t\t\tminsize 1M\t\t\t# \u6587\u4ef6\u5927\u5c0f\u8d85\u8fc7 1M \u540e\u624d\u4f1a\u5207\u5272\n    rotate 1\t\t\t# \u53ea\u4fdd\u7559\u4e00\u4e2a\u65e5\u5fd7\n}\n# \u8fd9\u4e2a wtmp \u53ef\u8bb0\u5f55\u7528\u6237\u767b\u5f55\u7cfb\u7edf\u53ca\u7cfb\u7edf\u91cd\u542f\u7684\u65f6\u95f4\uff0c\u56e0\u4e3a\u6709 minsize \u7684\u53c2\u6570\uff0c\u56e0\u6b64\u4e0d\u89c1\u5f97\u6bcf\u4e2a\u6708\u4e00\u5b9a\u4f1a\u6267\u884c\u4e00\u6b21\u5594.\u8981\u770b\u6587\u4ef6\u5927\u5c0f\u3002\n\n\n/var/log/btmp {\n    missingok\n    monthly\n    create 0600 root utmp\n    rotate 1\n}\n\n# system-specific logs may be also be configured here.\n'})}),"\n",(0,o.jsxs)(e.p,{children:["\u7531\u8fd9\u4e2a\u6587\u4ef6\u7684\u8bbe\u5b9a\u53ef\u4ee5\u77e5\u9053 ",(0,o.jsx)(e.code,{children:"/etc/logrotate.d"})," \u5176\u5b9e\u5c31\u662f\u7531 ",(0,o.jsx)(e.code,{children:"/etc/logrotate.conf"})," \u6240\u89c4\u5212\u51fa\u6765\u7684\u76ee\u5f55\uff0c\u867d\u7136\u53ef\u4ee5\u5c06\u6240\u6709\u7684\u914d\u7f6e\u90fd\u5199\u5165 ",(0,o.jsx)(e.code,{children:"/etc/logrotate.conf"})," \uff0c\u4f46\u662f\u8fd9\u6837\u4e00\u6765\u8fd9\u4e2a\u6587\u4ef6\u5c31\u5b9e\u5728\u662f\u592a\u590d\u6742\u4e86\uff0c\u5c24\u5176\u662f\u5f53\u4f7f\u7528\u5f88\u591a\u7684\u670d\u52a1\u5728\u7cfb\u7edf\u4e0a\u9762\u65f6\uff0c \u6bcf\u4e2a\u670d\u52a1\u90fd\u8981\u53bb\u4fee\u6539 ",(0,o.jsx)(e.code,{children:"/etc/logrotate.conf"})," \u7684\u8bbe\u5b9a\u4e5f\u4f3c\u4e4e\u4e0d\u592a\u5408\u7406\u4e86\u3002"]}),"\n",(0,o.jsxs)(e.p,{children:["\u6240\u4ee5\uff0c\u5982\u679c\u72ec\u7acb\u51fa\u6765\u4e00\u4e2a\u76ee\u5f55\uff0c\u90a3\u4e48\u6bcf\u4e2a\u8981\u5207\u5272\u65e5\u5fd7\u7684\u670d\u52a1\uff0c \u5c31\u53ef\u4ee5\u72ec\u81ea\u6210\u4e3a\u4e00\u4e2a\u6587\u4ef6\uff0c\u5e76\u4e14\u653e\u7f6e\u5230 ",(0,o.jsx)(e.code,{children:"/etc/logrotate.d/"})," \u5f53\u4e2d\u3002"]}),"\n",(0,o.jsx)(e.p,{children:"\u5176\u4ed6\u91cd\u8981\u53c2\u6570\u8bf4\u660e\uff1a"}),"\n",(0,o.jsxs)(e.table,{children:[(0,o.jsx)(e.thead,{children:(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.th,{children:"\u53c2\u6570"}),(0,o.jsx)(e.th,{children:"\u542b\u4e49"})]})}),(0,o.jsxs)(e.tbody,{children:[(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"compress"}),(0,o.jsx)(e.td,{children:"\u901a\u8fc7gzip \u538b\u7f29\u8f6c\u50a8\u4ee5\u540e\u7684\u65e5\u5fd7"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"nocompress"}),(0,o.jsx)(e.td,{children:"\u4e0d\u505agzip\u538b\u7f29\u5904\u7406"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"copytruncate"}),(0,o.jsx)(e.td,{children:"\u7528\u4e8e\u8fd8\u5728\u6253\u5f00\u4e2d\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u628a\u5f53\u524d\u65e5\u5fd7\u5907\u4efd\u5e76\u622a\u65ad\uff1b\u662f\u5148\u62f7\u8d1d\u518d\u6e05\u7a7a\u7684\u65b9\u5f0f\uff0c\u62f7\u8d1d\u548c\u6e05\u7a7a\u4e4b\u95f4\u6709\u4e00\u4e2a\u65f6\u95f4\u5dee\uff0c\u53ef\u80fd\u4f1a\u4e22\u5931\u90e8\u5206\u65e5\u5fd7\u6570\u636e\u3002"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"nocopytruncate"}),(0,o.jsx)(e.td,{children:"\u5907\u4efd\u65e5\u5fd7\u6587\u4ef6\u4e0d\u8fc7\u4e0d\u622a\u65ad"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"create mode owner group"}),(0,o.jsx)(e.td,{children:"\u8f6e\u8f6c\u65f6\u6307\u5b9a\u521b\u5efa\u65b0\u6587\u4ef6\u7684\u5c5e\u6027\uff0c\u5982create 0777 nobody nobody"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"nocreate"}),(0,o.jsx)(e.td,{children:"\u4e0d\u5efa\u7acb\u65b0\u7684\u65e5\u5fd7\u6587\u4ef6"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"delaycompress"}),(0,o.jsx)(e.td,{children:"\u548ccompress \u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u8f6c\u50a8\u7684\u65e5\u5fd7\u6587\u4ef6\u5230\u4e0b\u4e00\u6b21\u8f6c\u50a8\u65f6\u624d\u538b\u7f29"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"nodelaycompress"}),(0,o.jsx)(e.td,{children:"\u8986\u76d6 delaycompress \u9009\u9879\uff0c\u8f6c\u50a8\u540c\u65f6\u538b\u7f29\u3002"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"missingok"}),(0,o.jsx)(e.td,{children:"\u5982\u679c\u65e5\u5fd7\u4e22\u5931\uff0c\u4e0d\u62a5\u9519\u7ee7\u7eed\u6eda\u52a8\u4e0b\u4e00\u4e2a\u65e5\u5fd7"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"errors address"}),(0,o.jsx)(e.td,{children:"\u4e13\u50a8\u65f6\u7684\u9519\u8bef\u4fe1\u606f\u53d1\u9001\u5230\u6307\u5b9a\u7684 Email \u5730\u5740"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"ifempty"}),(0,o.jsx)(e.td,{children:"\u5373\u4f7f\u65e5\u5fd7\u6587\u4ef6\u4e3a\u7a7a\u6587\u4ef6\u4e5f\u505a\u8f6e\u8f6c\uff0c\u8fd9\u4e2a\u662flogrotate\u7684\u7f3a\u7701\u9009\u9879\u3002"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"notifempty"}),(0,o.jsx)(e.td,{children:"\u5f53\u65e5\u5fd7\u6587\u4ef6\u4e3a\u7a7a\u65f6\uff0c\u4e0d\u8fdb\u884c\u8f6e\u8f6c"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"mail address"}),(0,o.jsx)(e.td,{children:"\u628a\u8f6c\u50a8\u7684\u65e5\u5fd7\u6587\u4ef6\u53d1\u9001\u5230\u6307\u5b9a\u7684 E-mail \u5730\u5740"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"nomail"}),(0,o.jsx)(e.td,{children:"\u8f6c\u50a8\u65f6\u4e0d\u53d1\u9001\u65e5\u5fd7\u6587\u4ef6"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"olddir directory"}),(0,o.jsx)(e.td,{children:"\u8f6c\u50a8\u540e\u7684\u65e5\u5fd7\u6587\u4ef6\u653e\u5165\u6307\u5b9a\u7684\u76ee\u5f55\uff0c\u5fc5\u987b\u548c\u5f53\u524d\u65e5\u5fd7\u6587\u4ef6\u5728\u540c\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"noolddir"}),(0,o.jsx)(e.td,{children:"\u8f6c\u50a8\u540e\u7684\u65e5\u5fd7\u6587\u4ef6\u548c\u5f53\u524d\u65e5\u5fd7\u6587\u4ef6\u653e\u5728\u540c\u4e00\u4e2a\u76ee\u5f55\u4e0b"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"sharedscripts"}),(0,o.jsx)(e.td,{children:"\u8fd0\u884cpostrotate\u811a\u672c\uff0c\u4f5c\u7528\u662f\u5728\u6240\u6709\u65e5\u5fd7\u90fd\u8f6e\u8f6c\u540e\u7edf\u4e00\u6267\u884c\u4e00\u6b21\u811a\u672c\u3002\u5982\u679c\u6ca1\u6709\u914d\u7f6e\u8fd9\u4e2a\uff0c\u90a3\u4e48\u6bcf\u4e2a\u65e5\u5fd7\u8f6e\u8f6c\u540e\u90fd\u4f1a\u6267\u884c\u4e00\u6b21\u811a\u672c"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"prerotate"}),(0,o.jsx)(e.td,{children:"\u5728logrotate\u8f6c\u50a8\u4e4b\u524d\u9700\u8981\u6267\u884c\u7684\u6307\u4ee4\uff0c\u4f8b\u5982\u4fee\u6539\u6587\u4ef6\u7684\u5c5e\u6027\u7b49\u52a8\u4f5c\uff1b\u5fc5\u987b\u72ec\u7acb\u6210\u884c"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"postrotate"}),(0,o.jsx)(e.td,{children:"\u5728logrotate\u8f6c\u50a8\u4e4b\u540e\u9700\u8981\u6267\u884c\u7684\u6307\u4ee4\uff0c\u4f8b\u5982\u91cd\u65b0\u542f\u52a8 (kill -HUP) \u67d0\u4e2a\u670d\u52a1\uff01\u5fc5\u987b\u72ec\u7acb\u6210\u884c"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"daily"}),(0,o.jsx)(e.td,{children:"\u6307\u5b9a\u8f6c\u50a8\u5468\u671f\u4e3a\u6bcf\u5929"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"weekly"}),(0,o.jsx)(e.td,{children:"\u6307\u5b9a\u8f6c\u50a8\u5468\u671f\u4e3a\u6bcf\u5468"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"monthly"}),(0,o.jsx)(e.td,{children:"\u6307\u5b9a\u8f6c\u50a8\u5468\u671f\u4e3a\u6bcf\u6708"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"rotate count"}),(0,o.jsx)(e.td,{children:"\u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\u5220\u9664\u4e4b\u524d\u8f6c\u50a8\u7684\u6b21\u6570\uff0c0 \u6307\u6ca1\u6709\u5907\u4efd\uff0c5 \u6307\u4fdd\u75595 \u4e2a\u5907\u4efd"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"dateext"}),(0,o.jsx)(e.td,{children:"\u4f7f\u7528\u5f53\u671f\u65e5\u671f\u4f5c\u4e3a\u547d\u540d\u683c\u5f0f"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"dateformat .%s"}),(0,o.jsx)(e.td,{children:"\u914d\u5408dateext\u4f7f\u7528\uff0c\u7d27\u8ddf\u5728\u4e0b\u4e00\u884c\u51fa\u73b0\uff0c\u5b9a\u4e49\u6587\u4ef6\u5207\u5272\u540e\u7684\u6587\u4ef6\u540d\uff0c\u5fc5\u987b\u914d\u5408dateext\u4f7f\u7528\uff0c\u53ea\u652f\u6301 %Y %m %d %s \u8fd9\u56db\u4e2a\u53c2\u6570"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"size(\u6216minsize) log-size"}),(0,o.jsxs)(e.td,{children:["\u5f53\u65e5\u5fd7\u6587\u4ef6\u5230\u8fbe\u6307\u5b9a\u7684\u5927\u5c0f\u65f6\u624d\u8f6c\u50a8\uff0clog-size\u80fd\u6307\u5b9abytes(\u7f3a\u7701)\u53caKB (sizek)\u6216MB(sizem).  ",(0,o.jsx)("br",{}),"\u5f53\u65e5\u5fd7\u6587\u4ef6 >= log-size \u7684\u65f6\u5019\u5c31\u8f6c\u50a8\u3002 \u4ee5\u4e0b\u4e3a\u5408\u6cd5\u683c\u5f0f\uff1a\uff08\u5176\u4ed6\u683c\u5f0f\u7684\u5355\u4f4d\u5927\u5c0f\u5199\u6ca1\u6709\u8bd5\u8fc7\uff09",(0,o.jsx)("br",{}),"size = 5 \u6216 size 5 \uff08>= 5 \u4e2a\u5b57\u8282\u5c31\u8f6c\u50a8\uff09",(0,o.jsx)("br",{}),"size = 100k \u6216 size 100k ",(0,o.jsx)("br",{}),"size = 100M \u6216 size 100M"]})]})]})]}),"\n",(0,o.jsx)(e.h3,{id:"22-\u5207\u5272\u793a\u4f8b",children:"2.2 \u5207\u5272\u793a\u4f8b"}),"\n",(0,o.jsx)(e.h4,{id:"221-\u5c0f\u793a\u4f8b\u4e0b\u9762\u4e00\u4e2a\u5207\u5272nginx\u65e5\u5fd7\u7684\u914d\u7f6e",children:"2.2.1 \u5c0f\u793a\u4f8b\uff1a\u4e0b\u9762\u4e00\u4e2a\u5207\u5272nginx\u65e5\u5fd7\u7684\u914d\u7f6e"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:"$ cat /etc/logrotate.d/nginx\n/usr/local/nginx/logs/*.log {\ndaily\nrotate 7\nmissingok\nnotifempty\ndateext\nsharedscripts\npostrotate\n    if [ -f /usr/local/nginx/logs/nginx.pid ]; then\n        kill -USR1 `cat /usr/local/nginx/logs/nginx.pid`\n    fi\nendscript\n}\n"})}),"\n",(0,o.jsx)(e.h4,{id:"222-\u5206\u4eab\u4e00\u4f8b\u66fe\u7ecf\u4f7f\u7528\u8fc7\u7684nginx\u65e5\u5fd7\u5207\u5272\u5904\u7406\u811a\u672c",children:"2.2.2 \u5206\u4eab\u4e00\u4f8b\u66fe\u7ecf\u4f7f\u7528\u8fc7\u7684nginx\u65e5\u5fd7\u5207\u5272\u5904\u7406\u811a\u672c"}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"1\uff09logrotate\u65e5\u5fd7\u5206\u5272\u914d\u7f6e"})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:"$ cat /etc/logrotate.d/nginx\n/data/nginx_logs/*.access_log        \n{\nnocompress                                   \ndaily                                  \ncopytruncate                                  \ncreate                              \nifempty                                   \nolddir /data/nginx_logs/days           \nrotate 0                                        \n}\n"})}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"2\uff09\u65e5\u5fd7\u5206\u5272\u811a\u672c"})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:'$ cat /usr/local/sbin/logrotate-nginx.sh\n#!/bin/bash\n# \u521b\u5efa\u8f6c\u50a8\u65e5\u5fd7\u538b\u7f29\u5b58\u653e\u76ee\u5f55\nmkdir -p /data/nginx_logs/days\n\n# \u624b\u5de5\u5bf9nginx\u65e5\u5fd7\u8fdb\u884c\u5207\u5272\u8f6c\u6362\n/usr/sbin/logrotate -vf /etc/logrotate.d/nginx\n\n# \u5f53\u524d\u65f6\u95f4\ntime=$(date -d "yesterday" +"%Y-%m-%d")\n\n# \u8fdb\u5165\u8f6c\u50a8\u65e5\u5fd7\u5b58\u653e\u76ee\u5f55\ncd /data/nginx_logs/days\n\n# \u5bf9\u76ee\u5f55\u4e2d\u7684\u8f6c\u50a8\u65e5\u5fd7\u6587\u4ef6\u7684\u6587\u4ef6\u540d\u8fdb\u884c\u7edf\u4e00\u8f6c\u6362\nfor i in $(ls ./ | grep "^\\(.*\\)\\.[[:digit:]]$")\ndo\nmv ${i} ./$(echo ${i}|sed -n \'s/^\\(.*\\)\\.\\([[:digit:]]\\)$/\\1/p\')-$(echo $time)\ndone\n\n# \u5bf9\u8f6c\u50a8\u7684\u65e5\u5fd7\u6587\u4ef6\u8fdb\u884c\u538b\u7f29\u5b58\u653e\uff0c\u5e76\u5220\u9664\u539f\u6709\u8f6c\u50a8\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u53ea\u4fdd\u5b58\u538b\u7f29\u540e\u7684\u65e5\u5fd7\u6587\u4ef6\u3002\u4ee5\u8282\u7ea6\u5b58\u50a8\u7a7a\u95f4\nfor i in $(ls ./ | grep "^\\(.*\\)\\-\\([[:digit:]-]\\+\\)$")\ndo\ntar jcvf ${i}.bz2 ./${i}\nrm -rf ./${i}\ndone\n\n# \u53ea\u4fdd\u7559\u6700\u8fd17\u5929\u7684\u538b\u7f29\u8f6c\u50a8\u65e5\u5fd7\u6587\u4ef6\nfind /data/nginx_logs/days/* -name "*.bz2" -mtime 7 -type f -exec rm -rf {} \\;\n'})}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"3\uff09crontab\u5b9a\u65f6\u6267\u884c"})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-shell",children:"# logrotate\n0 0 * * * /bin/bash -x /usr/local/sbin/logrotate-nginx.sh > /dev/null 2>\n"})}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"\u624b\u52a8\u6267\u884c\u811a\u672c\uff0c\u6d4b\u8bd5\u4e0b\u770b\u770b\uff1a"})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:"$ /bin/bash -x /usr/local/sbin/logrotate-nginx.sh\n$ cd /data/nginx_logs/days\n$ ls\nhuantest.access_log-2017-01-18.bz2\n"})}),"\n",(0,o.jsx)(e.h4,{id:"223-php\u811a\u672c\u5207\u5272\u4e00\u4f8b",children:"2.2.3 php\u811a\u672c\u5207\u5272\u4e00\u4f8b"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:"$ cat /etc/logrotate.d/php\n/Data/logs/php/*log {\n    daily\n    rotate 365\n    missingok\n    notifempty\n    compress\n    dateext\n    sharedscripts\n    postrotate\n        if [ -f /Data/app/php5.6.26/var/run/php-fpm.pid ]; then\n            kill -USR1 `cat /Data/app/php5.6.26/var/run/php-fpm.pid`\n        fi\n    endscript\n    postrotate\n        /bin/chmod 644 /Data/logs/php/*gz\n    endscript\n}\n\n$ ll /Data/app/php5.6.26/var/run/php-fpm.pid\n-rw-r--r-- 1 root root 4 Dec 28 17:03 /Data/app/php5.6.26/var/run/php-fpm.pid\n\n$ cd /Data/logs/php\n$ ll\ntotal 25676\n-rw-r--r-- 1 root   root         0 Jun  1  2016 error.log\n-rw-r--r-- 1 nobody nobody     182 Aug 30  2015 error.log-20150830.gz\n-rw-r--r-- 1 nobody nobody     371 Sep  1  2015 error.log-20150901.gz\n-rw-r--r-- 1 nobody nobody     315 Sep  7  2015 error.log-20150907.gz\n.........\n.........\n"})}),"\n",(0,o.jsx)(e.h4,{id:"224-nginx\u65e5\u5fd7\u5207\u5272\u4e00\u4f8b",children:"2.2.4 nginx\u65e5\u5fd7\u5207\u5272\u4e00\u4f8b"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:"$ cat /etc/logrotate.d/nginx\n/Data/logs/nginx/*log {\n    daily\n    rotate 365\n    missingok\n    notifempty\n    compress\n    dateext\n    sharedscripts\n    postrotate\n    /etc/init.d/nginx reload\n    endscript\n}\n\n$ ll /Data/logs/nginx/www.huanqiu.com/\n..........\n-rw-r--r-- 1 root root      1652 Jan  1 00:00 error.log-20170101.gz\n-rw-r--r-- 1 root root      1289 Jan  2 00:00 error.log-20170102.gz\n-rw-r--r-- 1 root root      1633 Jan  3 00:00 error.log-20170103.gz\n-rw-r--r-- 1 root root      3239 Jan  4 00:00 error.log-20170104.gz\n"})}),"\n",(0,o.jsx)(e.h4,{id:"225-\u7cfb\u7edf\u65e5\u5fd7\u5207\u5272\u4e00\u4f8b",children:"2.2.5 \u7cfb\u7edf\u65e5\u5fd7\u5207\u5272\u4e00\u4f8b"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:"$ cat /etc/logrotate.d/syslog\n/var/log/cron\n/var/log/maillog\n/var/log/messages\n/var/log/secure\n/var/log/spooler\n{\n    sharedscripts\n    postrotate\n    /bin/kill -HUP `cat /var/run/syslogd.pid 2> /dev/null` 2> /dev/null || true\n    endscript\n}\n\n$ ll /var/log/messages*\n-rw------- 1 root root 34248975 Jan 19 18:42 /var/log/messages\n-rw------- 1 root root 51772994 Dec 25 03:11 /var/log/messages-20161225\n-rw------- 1 root root 51800210 Jan  1 03:05 /var/log/messages-20170101\n-rw------- 1 root root 51981366 Jan  8 03:36 /var/log/messages-20170108\n-rw------- 1 root root 51843025 Jan 15 03:40 /var/log/messages-20170115\n\n$ ll /var/log/cron*\n-rw------- 1 root root 2155681 Jan 19 18:43 /var/log/cron\n-rw------- 1 root root 2932618 Dec 25 03:11 /var/log/cron-20161225\n-rw------- 1 root root 2939305 Jan  1 03:06 /var/log/cron-20170101\n-rw------- 1 root root 2951820 Jan  8 03:37 /var/log/cron-20170108\n-rw------- 1 root root 3203992 Jan 15 03:41 /var/log/cron-20170115\n\n$ ll /var/log/secure*\n-rw------- 1 root root  275343 Jan 19 18:36 /var/log/secure\n-rw------- 1 root root 2111936 Dec 25 03:06 /var/log/secure-20161225\n-rw------- 1 root root 2772744 Jan  1 02:57 /var/log/secure-20170101\n-rw------- 1 root root 1115543 Jan  8 03:26 /var/log/secure-20170108\n-rw------- 1 root root  731599 Jan 15 03:40 /var/log/secure-20170115\n\n$ ll /var/log/spooler*\n-rw------- 1 root root 0 Jan 15 03:41 /var/log/spooler\n-rw------- 1 root root 0 Dec 18 03:21 /var/log/spooler-20161225\n-rw------- 1 root root 0 Dec 25 03:11 /var/log/spooler-20170101\n-rw------- 1 root root 0 Jan  1 03:06 /var/log/spooler-20170108\n-rw------- 1 root root 0 Jan  8 03:37 /var/log/spooler-20170115\n"})}),"\n",(0,o.jsx)(e.h4,{id:"226-tomcat\u65e5\u5fd7\u5207\u5272\u4e00\u4f8b",children:"2.2.6 tomcat\u65e5\u5fd7\u5207\u5272\u4e00\u4f8b"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:"$ cat /etc/logrotate.d/tomcat\n/Data/app/tomcat-7-huanqiu/logs/catalina.out {\nrotate 14\ndaily\ncopytruncate\ncompress\nnotifempty\nmissingok\n}\n\n$ ll /Data/app/tomcat-7-huanqiu/logs/catalina.*\n-rw-r--r--. 1 root root     0 Jan 19 19:11 /Data/app/tomcat-7-huanqiu/logs/catalina.out\n-rw-r--r--. 1 root root 95668 Jan 19 19:11 /Data/app/tomcat-7-huanqiu/logs/catalina.out.1.gz\n"})}),"\n",(0,o.jsx)(e.h4,{id:"227-\u65e9\u671f\u7528\u8fc7\u7684nginx\u65e5\u5fd7\u5904\u7406\u4e00\u4f8b",children:"2.2.7 \u65e9\u671f\u7528\u8fc7\u7684nginx\u65e5\u5fd7\u5904\u7406\u4e00\u4f8b"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:'$ cat /letv/sh/cut_nginx_log.sh\n#!/bin/bash\n# \u4f60\u7684\u65e5\u5fd7\u6587\u4ef6\u5b58\u653e\u76ee\u5f55\nlogs_path="/letv/logs/"\n# \u65e5\u5fd7\u6587\u4ef6\u7684\u540d\u5b57\uff0c\u591a\u4e2a\u9700\u8981\u7a7a\u683c\u9694\u5f00\nlogs_names=(error access pv_access)\ndates=`date -d "yesterday" +"%Y%m%d"`\nmkdir -p ${logs_path}$dates/\nnum=${#logs_names[@]}\nfor((i=0;i<num;i++));do\nmv ${logs_path}${logs_names[i]}.log ${logs_path}$dates/${logs_names[i]}.log\ndone\n# nginx\u5e73\u6ed1\u91cd\u542f\nkill -USR1 `cat /letv/logs/nginx/nginx.pid`           \n\n\u7ed3\u5408crontab\u5b9a\u65f6\u6267\u884c\n# nginx\u65e5\u5fd7\u5207\u5272\n00 00 * * * cd /letv/logs;/bin/bash /letv/sh/cut_nginx_log.sh > /dev/null 2>$1\n'})}),"\n",(0,o.jsx)(e.h3,{id:""}),"\n",(0,o.jsx)(e.h2,{id:"3logrotate\u9ed8\u8ba4\u81ea\u52a8\u5207\u5272\u751f\u6548\u65f6\u95f4",children:"3.logrotate\u9ed8\u8ba4\u81ea\u52a8\u5207\u5272\u751f\u6548\u65f6\u95f4"}),"\n",(0,o.jsx)(e.h3,{id:"31-logrotate\u5207\u5272\u65f6\u95f4\u8bf4\u660e",children:"3.1 logrotate\u5207\u5272\u65f6\u95f4\u8bf4\u660e"}),"\n",(0,o.jsxs)(e.p,{children:["logrotate\u662f\u57fa\u4e8eCRON\u6765\u8fd0\u884c\u7684\uff0c\u5176\u811a\u672c\u662f ",(0,o.jsx)(e.code,{children:"/etc/cron.daily/logrotate"}),"\uff0c\u5b9e\u9645\u8fd0\u884c\u65f6\uff0clogrotate\u4f1a\u8c03\u7528\u914d\u7f6e\u6587\u4ef6 ",(0,o.jsx)(e.code,{children:"/etc/logrotate.conf"}),"\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:'$ cat /etc/cron.daily/logrotate\n#!/bin/sh\n\n/usr/sbin/logrotate -s /var/lib/logrotate/logrotate.status /etc/logrotate.conf\nEXITVALUE=$?\nif [ $EXITVALUE != 0 ]; then\n    /usr/bin/logger -t logrotate "ALERT exited abnormally with [$EXITVALUE]"\nfi\nexit 0\n'})}),"\n",(0,o.jsxs)(e.p,{children:["logrotate\u662f\u57fa\u4e8eCRON\u8fd0\u884c\u7684\uff0c\u6240\u4ee5\u8fd9\u4e2a\u65f6\u95f4\u662f\u7531CRON\u63a7\u5236\u7684\uff0c\u5177\u4f53\u53ef\u4ee5\u67e5\u8be2CRON\u7684\u914d\u7f6e\u6587\u4ef6 ",(0,o.jsx)(e.code,{children:"/etc/anacrontab"}),"\uff08\u8001\u7248\u672c\u7684\u6587\u4ef6\u662f ",(0,o.jsx)(e.code,{children:"/etc/crontab"}),"\uff09"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:"$ cat /etc/anacrontab\n# /etc/anacrontab: configuration file for anacron\n\n# See anacron(8) and anacrontab(5) for details.\n\nSHELL=/bin/sh\nPATH=/sbin:/bin:/usr/sbin:/usr/bin\nMAILTO=root\n# the maximal random delay added to the base delay of the jobs(\u968f\u673a\u7684\u5ef6\u8fdf\u65f6\u95f4\uff0c\u8868\u793a\u6700\u592745\u5206\u949f)\nRANDOM_DELAY=45\n# the jobs will be started during the following hours only(\u811a\u672c\u8fd0\u884c\u7684\u65f6\u95f4 \u51cc\u66683\u70b9\u81f3\u665a10\u70b9)\nSTART_HOURS_RANGE=3-22\n\n#period in days   delay in minutes   job-identifier   command\n1\t5\tcron.daily\t\tnice run-parts /etc/cron.daily\n7\t25\tcron.weekly\t\tnice run-parts /etc/cron.weekly\n@monthly 45\tcron.monthly\t\tnice run-parts /etc/cron.monthly\n\n######### \u5b57\u6bb5\u8bf4\u660e #########\nperiod in days\t\t\t# \u6bcf\u5929\u5207\u5272\u7684\u65f6\u95f4\u70b9\ndelay in minutes\t\t\t# \u5ef6\u8fdf\u7684\u5206\u949f\u6570 \njob-identifier\t\t\t# \u6807\u8bc6\u7b26     \ncommand\t\t\t# \u6267\u884c\u7684\u547d\u4ee4\n"})}),"\n",(0,o.jsx)(e.h3,{id:"32-\u4fee\u6539logrotate\u5207\u5272\u65f6\u95f4",children:"3.2 \u4fee\u6539logrotate\u5207\u5272\u65f6\u95f4"}),"\n",(0,o.jsxs)(e.p,{children:["\u901a\u8fc7\u9ed8\u8ba4 ",(0,o.jsx)(e.code,{children:"/etc/anacrontab"})," \u6587\u4ef6\u914d\u7f6e\uff0c\u4f1a\u53d1\u73b0logrotate\u81ea\u52a8\u5207\u5272\u65e5\u5fd7\u6587\u4ef6\u7684\u9ed8\u8ba4\u65f6\u95f4\u662f\u51cc\u66683\u70b9\u591a\u3002\u73b0\u5728\u9700\u8981\u5c06\u5207\u5272\u65f6\u95f4\u8c03\u6574\u5230\u6bcf\u5929\u7684\u665a\u4e0a12\u70b9\uff0c\u5373\u6bcf\u5929\u5207\u5272\u7684\u65e5\u5fd7\u662f\u524d\u4e00\u5929\u76840-24\u70b9\u4e4b\u95f4\u7684\u5185\u5bb9\u3002\u9700\u8981\u8ba1\u5212\u4efb\u52a1\u4e2d\u6307\u5b9a\u6267\u884c\u5207\u5272\u7684\u65f6\u95f4\uff0c\u5e76\u4e14\u52a0\u4e0a ",(0,o.jsx)(e.code,{children:"-f"})," \u9009\u9879\u5f3a\u5236\u5207\u5272\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-shell",children:"# 1.\u5907\u4efd\u539f\u6709\u6587\u4ef6\ncp /etc/anacrontab{\uff0c.bak}\n\n# 2.\u91cd\u65b0\u7f16\u8f91\u6587\u4ef6\n$ cat /etc/logrotate.d/nstc_nohup.out\n/data/nstc/nohup.out {\nrotate 30\ndateext\ndaily\ncopytruncate\ncompress\nnotifempty\nmissingok\n}\n\n$ cat /etc/logrotate.d/syslog\n/var/log/cron\n/var/log/maillog\n/var/log/messages\n/var/log/secure\n/var/log/history\n{\n    sharedscripts\n    compress\n    rotate 30\n    daily\n    dateext\n    postrotate\n    /bin/kill -HUP `cat /var/run/syslogd.pid 2> /dev/null` 2> /dev/null || true\n    endscript\n}\n\n# 3.\u7ed3\u5408crontab\u8fdb\u884c\u81ea\u5b9a\u4e49\u7684\u5b9a\u65f6\u8f6e\u8f6c\u64cd\u4f5c\n$ crontab -l\n# log logrotate\n59 23 * * * /usr/sbin/logrotate -f /etc/logrotate.d/syslog >/dev/null 2>&1\n59 23 * * * /usr/sbin/logrotate -f /etc/logrotate.d/nstc_nohup.out >/dev/null 2>&1\n\n# 4.\u9a8c\u8bc1\n$ ll /data/nstc/nohup.out*\n-rw------- 1 app app 33218 1\u6708  25 09:43 /data/nstc/nohup.out\n-rw------- 1 app app 67678 1\u6708  25 23:59 /data/nstc/nohup.out-20180125.gz\n"})}),"\n",(0,o.jsx)(e.h3,{id:"33-\u811a\u672c\u5b9e\u73b0\u65e5\u5fd7\u5207\u5272",children:"3.3 \u811a\u672c\u5b9e\u73b0\u65e5\u5fd7\u5207\u5272"}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"\u8bf4\u660e"})}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"\u9664\u4e86\u5229\u7528\u81ea\u5e26\u7684logrotate\u5de5\u5177\u5b9e\u73b0\u65e5\u5fd7\u5207\u5272\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u7f16\u5199python\u811a\u672c\u6216shell\u811a\u672c\u4ee5\u5b9e\u73b0\u65e5\u5fd7\u5207\u5272\u3002\u4e0b\u9762\u5c31\u7b80\u5355\u5217\u51fa\u51e0\u4e2a\u5b9e\u4f8b\u8bf4\u660e\u4e0b\uff1a"}),"\n"]}),"\n",(0,o.jsx)(e.h4,{id:"331-python\u811a\u672c\u5b9e\u73b0\u65e5\u5fd7\u5207\u5272",children:"3.3.1 Python\u811a\u672c\u5b9e\u73b0\u65e5\u5fd7\u5207\u5272"}),"\n",(0,o.jsx)(e.p,{children:"\u793a\u4f8b1\uff1a\u5bf9jumpserver\u65e5\u5fd7\u8fdb\u884c\u5207\u5272"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:"# 1.\u7f16\u8f91\u811a\u672c\u5185\u5bb9\n$ cat log_rotate.py\n#!/usr/bin/env python\n\nimport datetime\uff0cos\uff0csys\uff0cshutil\n\nlog_path = '/opt/jumpserver/logs/'\nlog_file = 'jumpserver.log'\n\nyesterday = (datetime.datetime.now() - datetime.timedelta(days = 1))\n\ntry:\n    os.makedirs(log_path + yesterday.strftime('%Y') + os.sep + \\\n                yesterday.strftime('%m'))\n\nexcept OSError\uff0ce:\n    print\n    print e\n    sys.exit()\n\nshutil.move(log_path + log_file\uff0clog_path \\\n            + yesterday.strftime('%Y') + os.sep \\\n            + yesterday.strftime('%m') + os.sep \\\n            + log_file + '_' + yesterday.strftime('%Y%m%d') + '.log')\n\nos.popen(\"sudo /opt/jumpserver/service.sh restart\")\n\n# 2.\u624b\u52a8\u6267\u884c\u8fd9\u4e2a\u811a\u672c\uff1a\n$ python log_rotate.py\n\n# 3.\u67e5\u770b\u65e5\u5fd7\u5207\u5272\u540e\u7684\u6548\u679c\uff1a\n$ ls /opt/jumpserver/logs/\n2017  jumpserver.log \n\n$ ls /opt/jumpserver/logs/2017/\n09\n\n$ ls /opt/jumpserver/logs/2017/09/\njumpserver.log_20170916.log\n\n# 4.\u7136\u540e\u505a\u6bcf\u65e5\u7684\u5b9a\u65f6\u5207\u5272\u4efb\u52a1\uff1a\n$ crontab -l\n30 1 * * * /usr/bin/python /mnt/log_rotate.py > /dev/null 2>&1\n"})}),"\n",(0,o.jsx)(e.p,{children:"\u793a\u4f8b2\uff1a\u5bf9nginx\u65e5\u5fd7\u8fdb\u884c\u5207\u5272"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-shell",children:"$ cat log_rotate.py\n#!/usr/bin/env python\n\nimport datetime\uff0cos\uff0csys\uff0cshutil\n\nlog_path = '/app/nginx/logs/'\nlog_file = 'www_access.log'\n\nyesterday = (datetime.datetime.now() - datetime.timedelta(days = 1))\n\ntry:\n    os.makedirs(log_path + yesterday.strftime('%Y') + os.sep + \\\n                yesterday.strftime('%m'))\n\nexcept OSError\uff0ce:\n    print\n    print e\n    sys.exit()\n\n\nshutil.move(log_path + log_file\uff0clog_path \\\n            + yesterday.strftime('%Y') + os.sep \\\n            + yesterday.strftime('%m') + os.sep \\\n            + log_file + '_' + yesterday.strftime('%Y%m%d') + '.log')\n\n\nos.popen(\"sudo kill -USR1 `cat /app/nginx/logs/nginx.pid`\")\n"})}),"\n",(0,o.jsx)(e.h4,{id:"332-shell\u811a\u672c\u5b9e\u73b0\u65e5\u5fd7\u5207\u5272",children:"3.3.2 shell\u811a\u672c\u5b9e\u73b0\u65e5\u5fd7\u5207\u5272"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:"$ cat /app/script/log_rotate.sh\n#!/bin/sh\n\nfunction rotate() {\nlogs_path=$1\n\necho Rotating Log: $1\ncp ${logs_path} ${logs_path}.$(date -d \"yesterday\" +\"%Y%m%d\")\n> ${logs_path}\n    rm -f ${logs_path}.$(date -d \"7 days ago\" +\"%Y%m%d\")\n}\n\nfor i in $*\ndo\n        rotate $i\ndone\n\n--------------------------------------------------------------------------------------------------------------\n\u6bcf\u5929\u5b9a\u65f6\u5207\u5272\u65e5\u5fd7\u7684\u4efb\u52a1\u5236\u5b9a\uff08\u6bd4\u5982\u5bf9python\u7684\u4e00\u4e2a\u4e1a\u52a1/data/log/xcspam/\u4e0b\u7684\u65e5\u5fd7\u8fdb\u884c\u5207\u5272\uff0c0K\u7684\u65e5\u5fd7\u4e0d\u8fdb\u884c\u5207\u5272\uff09\uff1a\n$ crontab -e\n# xcspam \u65e5\u5fd7\u5207\u5272\n30 0 * * * find /data/log/xcspam/ -size +0 -name '*.log' | xargs /app/script/log_rotate.sh\n\n\u624b\u52a8\u6267\u884c\u5207\u5272\uff1a\n$ find /data/log/xcspam/ -size +0 -name '*.log' | xargs /app/script/log_rotate.sh\n\n\u5207\u5272\u540e\u7684\u65e5\u5fd7\u6548\u679c\uff1a\n$ ls /data/log/xcspam/\nxcspam_error.log  xcspam_error.log-20170926\n\n--------------------------------------------------------------------------------------------------------------\n\u6bd4\u5982\u5bf9maridb\u65e5\u5fd7\u8fdb\u884c\u5207\u5272\n$ crontab -e\n# xcspam \u65e5\u5fd7\u5207\u5272\n30 0 * * * find /var/log/mariadb/ -size +0 -name '*.log' | xargs /app/script/log_rotate.sh\n\n$ find /var/log/mariadb/ -size +0 -name '*.log' | xargs /app/script/log_rotate.sh\n\n$ ll /var/log/mariadb/\n\u603b\u7528\u91cf 8\n-rw-r-----. 1 mysql mysql    0 9\u6708  17 20:31 mariadb.log\n-rw-r-----. 1 root  root  4532 9\u6708  17 20:31 mariadb.log.20170916\n--------------------------------------------------------------------------------------------------------------\n"})}),"\n",(0,o.jsx)(e.h4,{id:"333-\u65e5\u5fd7\u538b\u7f29\u811a\u672c",children:"3.3.3 \u65e5\u5fd7\u538b\u7f29\u811a\u672c"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-shell",children:'$ ls /var/log/fss/nginx/\nnginx.20190506.log  nginx.20190507.log  nginx.20190508.log\n\n$ cat /root/log_clean.sh\n#!/usr/bin/sh\n#\u6839\u636e\u7cfb\u7edf/\u670d\u52a1/\u65e5\u5fd7\u4fdd\u7559\u5929\u6570\u4e09\u4e2a\u53c2\u6570\u538b\u7f29\u65e5\u5fd7\n#usage: sh clearlog.sh sysname appname keepdays\nsysName=$1\nappName=$2\nkeepDay=$3\nlogDir=/var/log/${sysName}/${appName}\nlogFile=${appName}.*[0-9][0-9].log\ncd ${logDir}\nfind ./ -name "${logFile}" -mtime -${keepDay} -exec gzip {} \\;\n\n\n$ sh /root/log_clean.sh fss nginx 3\n\n$ ls /var/log/fss/nginx/\nnginx.20190506.log.gz  nginx.20190507.log.gz  nginx.20190508.log.gz\n\n\u8fd8\u53ef\u4ee5\u9488\u5bf9\u65e5\u5fd7\u4fdd\u7559\u7b56\u7565\uff0c\u8c03\u6574\u6210\u65e5\u5fd7\u6e05\u7406\u811a\u672c\u3002\n'})}),"\n",(0,o.jsx)(e.p,{children:"\u63a8\u8350\u7528\u7684Nginx\u65e5\u5fd7\u8f6e\u8f6c\u65b9\u6cd5  [\u90e8\u7f72\u5728nginx\u7684\u65e5\u5fd7\u76ee\u5f55\u4e0b]"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:'#!/bin/bash\n\nyesterday=`date -d "-1 days" +\'%Y%m%d\'`\ncd `dirname $0`\nbasedir=`pwd`\nlogdir="${basedir}/bak"\nbindir="${basedir%/*}/sbin"\nmkdir -p ${logdir}\n\nfor log in `ls *.log 2>/dev/null`\ndo\n    mv ${log} ${logdir}/${log}.${yesterday}.bak\n    # gzip ${logdir}/${log}.${yesterday}\ndone\n\n${bindir}/nginx -s reload\n\ncd ${logdir}\nfind . -type f -name "*.bak" -mtime +7 | xargs rm -f\n'})}),"\n",(0,o.jsx)(e.h2,{id:"4\u5c1d\u8bd5\u89e3\u51b3-logrotate-\u65e0\u6cd5\u81ea\u52a8\u8f6e\u8be2\u65e5\u5fd7\u7684\u529e\u6cd5",children:"4.\u5c1d\u8bd5\u89e3\u51b3 logrotate \u65e0\u6cd5\u81ea\u52a8\u8f6e\u8be2\u65e5\u5fd7\u7684\u529e\u6cd5"}),"\n",(0,o.jsx)(e.p,{children:"\u73b0\u8c61\u8bf4\u660e\uff1a"}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"\u4f7f\u7528logrotate\u8f6e\u8be2nginx\u65e5\u5fd7\uff0c\u914d\u7f6e\u597d\u4e4b\u540e\uff0c\u53d1\u73b0nginx\u65e5\u5fd7\u8fde\u7eed\u4e24\u5929\u6ca1\u88ab\u5207\u5272\uff0c\u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f\uff1f"}),"\n"]}),"\n",(0,o.jsx)(e.p,{children:"\u7136\u540e\u5f00\u59cb\u68c0\u67e5\u65e5\u5fd7\u5207\u5272\u7684\u914d\u7f6e\u6587\u4ef6\u662f\u5426\u6709\u95ee\u9898\uff0c\u68c0\u67e5\u540e\u786e\u5b9a\u914d\u7f6e\u6587\u4ef6\u4e00\u5207\u6b63\u5e38\u3002"}),"\n",(0,o.jsxs)(e.p,{children:["\u4e8e\u662f\u6000\u7591\u662flogrotate\u9884\u5b9a\u7684cron\u6ca1\u6267\u884c\uff0c\u67e5\u770b\u4e86cron\u7684\u65e5\u5fd7\uff0c\u53d1\u73b0\u6709\u4e00\u6761 ",(0,o.jsx)(e.code,{children:"Dec 7 04:02:01 www crond[18959]: (root) CMD (run-parts /etc/cron.daily)"})," \u8fd9\u6837\u7684\u65e5\u5fd7\uff0c\u8bc1\u660ecron\u572804:02\u5206\u65f6\u5df2\u7ecf\u6267\u884c ",(0,o.jsx)(e.code,{children:"/etc/cron.daily"})," \u76ee\u5f55\u4e0b\u7684\u7a0b\u5e8f\u3002"]}),"\n",(0,o.jsxs)(e.p,{children:["\u63a5\u7740\u67e5\u770b ",(0,o.jsx)(e.code,{children:"/etc/cron.daily/logrotate"}),"\uff08\u8fd9\u662flogrotate\u81ea\u52a8\u8f6e\u8f6c\u7684\u811a\u672c\uff09\u7684\u5185\u5bb9\uff1a"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:'$ cat /etc/cron.daily/logrotate\n#!/bin/sh\n\n/usr/sbin/logrotate -s /var/lib/logrotate/logrotate.status /etc/logrotate.conf\nEXITVALUE=$?\nif [ $EXITVALUE != 0 ]; then\n    /usr/bin/logger -t logrotate "ALERT exited abnormally with [$EXITVALUE]"\nfi\nexit 0\n'})}),"\n",(0,o.jsx)(e.p,{children:"\u6ca1\u6709\u53d1\u73b0\u5f02\u5e38\uff0c\u914d\u7f6e\u597d\u7684\u65e5\u5fd7\u8f6e\u8f6c\u64cd\u4f5c\u90fd\u662f\u7531\u8fd9\u4e2a\u811a\u672c\u5b8c\u6210\u7684\uff0c\u4e00\u5207\u8fd0\u884c\u6b63\u5e38\uff0c\u811a\u672c\u5e94\u8be5\u5c31\u6ca1\u95ee\u9898\u3002"}),"\n",(0,o.jsx)(e.p,{children:"\u76f4\u63a5\u6267\u884c\u547d\u4ee4\uff1a"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:"/usr/sbin/logrotate /etc/logrotate.conf\n"})}),"\n",(0,o.jsx)(e.p,{children:"\u8fd9\u4e9b\u7cfb\u7edf\u65e5\u5fd7\u662f\u6b63\u5e38\u8f6e\u8be2\u4e86\uff0c\u4f46nginx\u65e5\u5fd7\u5374\u8fd8\u662f\u6ca1\u8f6e\u8be2\u3002"}),"\n",(0,o.jsx)(e.p,{children:"\u63a5\u7740\u5f3a\u884c\u542f\u52a8\u8bb0\u5f55\u6587\u4ef6\u7ef4\u62a4\u64cd\u4f5c\uff0c\u7eb5\u4f7flogrotate\u6307\u4ee4\u8ba4\u4e3a\u6ca1\u6709\u9700\u8981\uff0c\u5e94\u8be5\u6709\u53ef\u80fd\u662flogroate\u8ba4\u4e3anginx\u65e5\u5fd7\u592a\u5c0f\uff0c\u4e0d\u8fdb\u884c\u8f6e\u8be2\u3002"}),"\n",(0,o.jsxs)(e.p,{children:["\u6545\u9700\u8981\u5f3a\u5236\u8f6e\u8be2\uff0c\u5373\u5728 ",(0,o.jsx)(e.code,{children:"/etc/cron.daily/logrotate"})," \u811a\u672c\u4e2d\u5c06 ",(0,o.jsx)(e.code,{children:"-t"})," \u53c2\u6570\u66ff\u6362\u6210 ",(0,o.jsx)(e.code,{children:"-f"})," \u53c2\u6570"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:'$ cat /etc/cron.daily/logrotate\n#!/bin/sh\n\n/usr/sbin/logrotate -s /var/lib/logrotate/logrotate.status /etc/logrotate.conf\nEXITVALUE=$?\nif [ $EXITVALUE != 0 ]; then\n\t\t# \u539f\u5148\u914d\u7f6e\u53c2\u6570\u4e3a -t\uff0c\u73b0\u5728\u4fee\u6539\u4e3a -f\n\t\t# /usr/bin/logger -t logrotate "ALERT exited abnormally with\n    /usr/bin/logger -f logrotate "ALERT exited abnormally with [$EXITVALUE]"\nfi\nexit 0\n'})}),"\n",(0,o.jsx)(e.p,{children:"\u6700\u540e\u91cd\u542f\u4e0bcron\u670d\u52a1\uff1a"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-shell",children:"systemctl restart crond.service \n"})})]})}function g(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(c,{...n})}):c(n)}},28453:(n,e,t)=>{t.d(e,{R:()=>s,x:()=>a});var o=t(96540);const r={},l=o.createContext(r);function s(n){const e=o.useContext(l);return o.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:s(n.components),o.createElement(l.Provider,{value:e},n.children)}}}]);