"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[6590],{21051:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>s,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>d,toc:()=>c});var o=r(74848),t=r(28453);const i={},a="Pod\u521b\u5efa\u6d41\u7a0b\u4ee3\u7801\u7248\u672ckubelet\u7bc7",d={id:"\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/pod/pod\u521b\u5efa\u6d41\u7a0b\u4ee3\u7801\u7248\u672ckubelet\u7bc7",title:"pod\u521b\u5efa\u6d41\u7a0b\u4ee3\u7801\u7248\u672ckubelet\u7bc7",description:"[toc]",source:"@site/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/pod/pod\u521b\u5efa\u6d41\u7a0b\u4ee3\u7801\u7248\u672ckubelet\u7bc7.md",sourceDirName:"\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/pod",slug:"/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/pod/pod\u521b\u5efa\u6d41\u7a0b\u4ee3\u7801\u7248\u672ckubelet\u7bc7",permalink:"/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/pod/pod\u521b\u5efa\u6d41\u7a0b\u4ee3\u7801\u7248\u672ckubelet\u7bc7",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"pod\u5065\u5eb7\u68c0\u67e5",permalink:"/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/pod/pod\u5065\u5eb7\u68c0\u67e5"},next:{title:"pod\u751f\u547d\u5468\u671f",permalink:"/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/pod/pod\u751f\u547d\u5468\u671f"}},s={},c=[{value:"1. \u524d\u8a00",id:"1-\u524d\u8a00",level:2},{value:"2. \u51c6\u5907\u9636\u6bb5",id:"2-\u51c6\u5907\u9636\u6bb5",level:2},{value:"2.1 \u52a0\u5165PodManager",id:"21-\u52a0\u5165podmanager",level:3},{value:"2.2 \u51c6\u5165\u63a7\u5236\u68c0\u67e5",id:"22-\u51c6\u5165\u63a7\u5236\u68c0\u67e5",level:3},{value:"2.2.1 eviction\u51c6\u5165\u68c0\u67e5",id:"221-eviction\u51c6\u5165\u68c0\u67e5",level:4},{value:"2.2.2 predicate\u51c6\u5165\u68c0\u67e5",id:"222-predicate\u51c6\u5165\u68c0\u67e5",level:4},{value:"2.3 \u63a2\u9488\u7ba1\u7406",id:"23-\u63a2\u9488\u7ba1\u7406",level:3},{value:"2.4 \u5206\u53d1\u4e8b\u4ef6",id:"24-\u5206\u53d1\u4e8b\u4ef6",level:3},{value:"3.\u914d\u7f6e\u9636\u6bb5",id:"3\u914d\u7f6e\u9636\u6bb5",level:2},{value:"3.1 \u8ba1\u7b97Pod\u7684\u72b6\u6001",id:"31-\u8ba1\u7b97pod\u7684\u72b6\u6001",level:3},{value:"3.2 \u8fd0\u884c\u73af\u5883\u51c6\u5165\u68c0\u67e5",id:"32-\u8fd0\u884c\u73af\u5883\u51c6\u5165\u68c0\u67e5",level:3},{value:"3.3 \u66f4\u65b0\u72b6\u6001",id:"33-\u66f4\u65b0\u72b6\u6001",level:3},{value:"3.4 \u7f51\u7edc\u8fd0\u884c\u65f6\u68c0\u67e5",id:"34-\u7f51\u7edc\u8fd0\u884c\u65f6\u68c0\u67e5",level:3},{value:"3.5 CGroup\u914d\u7f6e",id:"35-cgroup\u914d\u7f6e",level:3},{value:"3.6 \u955c\u50cfPod\u7684\u68c0\u67e5",id:"36-\u955c\u50cfpod\u7684\u68c0\u67e5",level:3},{value:"3.7 \u521b\u5efaPod\u7684\u6570\u636e\u76ee\u5f55",id:"37-\u521b\u5efapod\u7684\u6570\u636e\u76ee\u5f55",level:3},{value:"3.8 \u7b49\u5f85volume\u7684\u6302\u8f7d",id:"38-\u7b49\u5f85volume\u7684\u6302\u8f7d",level:3},{value:"3.9 \u83b7\u53d6\u955c\u50cf\u62c9\u53d6\u7684secrets",id:"39-\u83b7\u53d6\u955c\u50cf\u62c9\u53d6\u7684secrets",level:3},{value:"3.10 \u8c03\u7528\u5bb9\u5668\u7684\u8fd0\u884c\u65f6\u8fdb\u884c\u540c\u6b65",id:"310-\u8c03\u7528\u5bb9\u5668\u7684\u8fd0\u884c\u65f6\u8fdb\u884c\u540c\u6b65",level:3},{value:"4. \u6e05\u7406\u9636\u6bb5",id:"4-\u6e05\u7406\u9636\u6bb5",level:2},{value:"4.1 \u8ba1\u7b97Pod\u72b6\u6001\u53d8\u66f4",id:"41-\u8ba1\u7b97pod\u72b6\u6001\u53d8\u66f4",level:3},{value:"4.2 killPod\u5168\u90e8\u6e05\u7406",id:"42-killpod\u5168\u90e8\u6e05\u7406",level:3},{value:"4.3 \u90e8\u5206\u6e05\u7406",id:"43-\u90e8\u5206\u6e05\u7406",level:3},{value:"5.\u6784\u5efa\u8fd0\u884c\u9636\u6bb5",id:"5\u6784\u5efa\u8fd0\u884c\u9636\u6bb5",level:2},{value:"5.1 \u8fd0\u884csandbox",id:"51-\u8fd0\u884csandbox",level:3},{value:"5.2 \u521b\u5efasandbox\u4e3b\u6d41\u7a0b",id:"52-\u521b\u5efasandbox\u4e3b\u6d41\u7a0b",level:3},{value:"5.3 cri\u4e2d\u7684RunSandbox",id:"53-cri\u4e2d\u7684runsandbox",level:3},{value:"5.4 \u5bb9\u5668\u542f\u52a8\u51fd\u6570",id:"54-\u5bb9\u5668\u542f\u52a8\u51fd\u6570",level:3},{value:"5.5 \u542f\u52a8\u5bb9\u5668",id:"55-\u542f\u52a8\u5bb9\u5668",level:3},{value:"5.6 cri.CreateContainer",id:"56-cricreatecontainer",level:3},{value:"5.7 cri.StartContainer",id:"57-cristartcontainer",level:3},{value:"6. \u603b\u7ed3",id:"6-\u603b\u7ed3",level:2}];function l(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.p,{children:"[toc]"}),"\n",(0,o.jsx)(e.h1,{id:"pod\u521b\u5efa\u6d41\u7a0b\u4ee3\u7801\u7248\u672ckubelet\u7bc7",children:"Pod\u521b\u5efa\u6d41\u7a0b\u4ee3\u7801\u7248\u672ckubelet\u7bc7"}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.a,{href:"https://www.kubernetes.org.cn/7263.html",children:"\u672c\u6587\u4e25\u91cd\u6284\u88ad\u81f3\u4e92\u8054\u7f51"})}),"\n",(0,o.jsx)(e.h2,{id:"1-\u524d\u8a00",children:"1. \u524d\u8a00"}),"\n",(0,o.jsx)(e.p,{children:"\u5728k8s\u7684\u9762\u8bd5\u4e2dPod\u7684\u521b\u5efa\u6d41\u7a0b\u662f\u4e00\u4e2a\u5e38\u95ee\u7684\u95ee\u9898\uff0c\u800ckubelet\u5219\u65e0\u7591\u91cd\u4e2d\u4e4b\u91cd\uff0c\u4e4b\u524d\u4e5f\u5199\u8fc7\u4e00\u7bc7Pod\u7684\u8fd0\u884c\uff0c\u4e0d\u8fc7\u6ca1\u6709\u6d89\u53ca\u5230\u5177\u4f53\u7684\u4ee3\u7801\uff0c\u672c\u6587\u5c1d\u8bd5\u7528\u4ee3\u7801\u7684\u65b9\u5f0f\uff0c\u6765\u590d\u6570\u6574\u4e2a\u6838\u5fc3\u7684\u6d41\u7a0b\uff0c\u540c\u65f6\u4e3a\u4e86\u65b9\u4fbf\u8bb0\u5fc6\uff0c\u53c8\u5c06\u6574\u4e2a\u8fc7\u7a0b\u5206\u4e3a\uff1a\u51c6\u5907\u3001\u914d\u7f6e\u3001\u6e05\u7406\u3001\u6784\u5efa\u8fd0\u884c\u56db\u4e2a\u9636\u6bb5\uff0c\u8ba9\u6211\u4eec\u4e00\u8d77\u6765\u770b\u4e0b\u5427\uff0c \u6587\u672b\u6709\u5927\u56fe\u603b\u7ed3"}),"\n",(0,o.jsx)(e.h2,{id:"2-\u51c6\u5907\u9636\u6bb5",children:"2. \u51c6\u5907\u9636\u6bb5"}),"\n",(0,o.jsx)(e.p,{children:"\u5f53\u83b7\u53d6\u5230Pod\u6dfb\u52a0\u7684\u4e8b\u4ef6\u7684\u65f6\u5019\uff0c\u9996\u5148\u4f1a\u8fdb\u884c\u4e00\u4e9b\u57fa\u7840\u7684\u5de5\u4f5c\uff0c\u6211\u5427\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3a\u51c6\u5907\u9636\u6bb5\uff0c\u51c6\u5907\u9636\u6bb5\u4e3b\u8981\u505a\u7684\u4e8b\u60c5\u6709\u5982\u4e0b\uff1a1\uff09\u52a0\u5165PodManager 2\uff09\u51c6\u5165\u63a7\u5236\u68c0\u67e5 3\uff09\u5206\u53d1\u4e8b\u4ef6 4\uff09\u6839\u636ePod\u6dfb\u52a0\u5bf9\u5e94\u7684\u63a2\u9488\uff0c \u8ba9\u6211\u4eec\u4e00\u8d77\u6765\u770b\u4e0b\u5173\u952e\u5b9e\u73b0"}),"\n",(0,o.jsx)(e.h3,{id:"21-\u52a0\u5165podmanager",children:"2.1 \u52a0\u5165PodManager"}),"\n",(0,o.jsx)(e.p,{children:"PodManager\u4e2d\u7684\u529f\u80fd\u9664\u4e86\u5b58\u50a8Pod\u7684\u4fe1\u606f\uff0c\u8fd8\u4f1a\u8fdb\u884c\u5bf9\u5e94Pod\u7684configMap\u548csecret\u7684\u7ba1\u7406\uff0c\u5f53\u5fc3\u52a0\u5165Pod\u7684\u65f6\u5019\uff0c\u4f1a\u68c0\u67e5\u5bf9\u5e94\u7684Pod\u662f\u5426\u6709\u5bf9\u5e94\u7684configMap\u548csecret\u914d\u7f6e\uff0c\u5982\u679c\u6709\u5219\u5c31\u4f1a\u521b\u5efa\u5bf9\u5e94\u7684\u76d1\u542c\u5668\uff0c\u76d1\u542c\u8d44\u6e90\u7684\u53d8\u5316\uff0c\u8fdb\u884c\u672c\u5730\u7f13\u5b58"}),"\n",(0,o.jsx)(e.p,{children:"\u9664\u6b64\u4e4b\u5916\uff0c\u5982\u679c\u5bf9\u5e94\u7684Pod\u7684BootstrapCheckpointAnnotationKey\u6709\u8bbe\u5b9a\uff0c\u5219\u8fd8\u4f1a\u521b\u5efa\u5bf9\u5e94\u7684checkpoint,\u5373\u5c06pod\u7684\u914d\u7f6e\u6570\u636e\u5199\u5165\u5230\u672c\u5730\u78c1\u76d8"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"kl.podManager.AddPod(pod)\n"})}),"\n",(0,o.jsx)(e.h3,{id:"22-\u51c6\u5165\u63a7\u5236\u68c0\u67e5",children:"2.2 \u51c6\u5165\u63a7\u5236\u68c0\u67e5"}),"\n",(0,o.jsx)(e.p,{children:"\u51c6\u5165\u63a7\u5236\u68c0\u67e5\u4e3b\u8981\u662f\u5728\u8fd0\u884cPod\u4e4b\u524d\u5728kubelet\u4e0a\u8fdb\u884cPod\u8fd0\u884c\u6761\u4ef6\u7684\u68c0\u67e5\uff0c\u68c0\u67e5\u5f53\u524d\u8282\u70b9\u5728scheduler\u51b3\u7b56\u5b8c\u6210\u540e\u5230\u611f\u77e5\u5230Pod\u8fd0\u884c\u8fd9\u6bb5\u65f6\u95f4\u8d44\u6e90\u662f\u5426\u4f9d\u65e7\u6ee1\u8db3\uff0c\u5e76\u4e14\u68c0\u67e5Pod\u7684\u4e00\u4e9b\u7279\u6b8a\u8d44\u6e90\u6bd4\u5982\u6bd4\u5982sysctl\u3001security\u7b49\u68c0\u67e5\uff0c\u8fd9\u91cc\u6211\u611f\u89c9\u6bd4\u8f83\u91cd\u8981\u7684\u4e24\u4e2a\u5206\u522b\u662feviction\u548cpredicate, \u5982\u679c\u4e0d\u6ee1\u8db3\u51c6\u5165\u68c0\u67e5\uff0c\u5219\u4f1a\u76f4\u63a5\u62d2\u7edd"}),"\n",(0,o.jsx)(e.h4,{id:"221-eviction\u51c6\u5165\u68c0\u67e5",children:"2.2.1 eviction\u51c6\u5165\u68c0\u67e5"}),"\n",(0,o.jsx)(e.p,{children:"\u5982\u679c\u5f53\u524d\u8282\u70b9\u53ea\u5b58\u5728\u5185\u5b58\u538b\u529b\uff0c\u5219\u4f1a\u6839\u636e\u5bf9\u5e94\u7684Pod\u7684QOS\u7b49\u7ea7\u6765\u5224\u65ad\uff0c\u5982\u679c\u8bf4\u4e0d\u662fBestEffort\u6216\u8005\u5bb9\u5fcd\u5185\u5b58\u538b\u529b\u7684\u6c61\u70b9\uff0c\u5219\u4f1a\u5141\u8bb8\uff0c\u5426\u5219\u5219\u4f1a\u62d2\u7edd\u8fd0\u884c"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"    nodeOnlyHasMemoryPressureCondition := hasNodeCondition(m.nodeConditions, v1.NodeMemoryPressure) && len(m.nodeConditions) == 1\n    if nodeOnlyHasMemoryPressureCondition {\n        // \u5982\u679c\u4e0d\u662fPodQOSBestEffort, \u5219\u90fd\u4f1a\u5c1d\u8bd5\u8fd0\u884c\n        notBestEffort := v1.PodQOSBestEffort != v1qos.GetPodQOS(attrs.Pod)\n        if notBestEffort {\n            return lifecycle.PodAdmitResult{Admit: true}\n        }\n        // \u5982\u679c\u5bf9\u5e94\u7684Pod\u5bb9\u5fcd\u5185\u5b58\u538b\u529b\u7684\u6c61\u70b9\uff0c\u5219\u5c31\u53ef\u4ee5\u7ee7\u7eed\u8fdb\u884c\u5176\u4ed6\u51c6\u5165\u63a7\u5236\u5668\u7684\u68c0\u67e5\n        if v1helper.TolerationsTolerateTaint(attrs.Pod.Spec.Tolerations, &v1.Taint{\n            Key:    v1.TaintNodeMemoryPressure,\n            Effect: v1.TaintEffectNoSchedule,\n        }) {\n            return lifecycle.PodAdmitResult{Admit: true}\n        }\n    }\n"})}),"\n",(0,o.jsx)(e.h4,{id:"222-predicate\u51c6\u5165\u68c0\u67e5",children:"2.2.2 predicate\u51c6\u5165\u68c0\u67e5"}),"\n",(0,o.jsx)(e.p,{children:"predicate\u51c6\u5165\u63a7\u5236\u5668\u4e2d\u7684\u903b\u8f91\u4e3b\u8981\u662f\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff1a1\uff09\u68c0\u67e5\u5bf9\u5e94\u7684\u8d44\u6e90\u662f\u5426\u6ee1\u8db3\u5206\u914d\u8bf7\u6c42\uff0c\u540c\u65f6\u4f1a\u8bb0\u5f55\u7f3a\u5c11\u7684\u8d44\u6e902\uff09\u5982\u679c\u662fCritical\u7c7b\u578b\u7684Pod\u5219\u4f1a\u6309\u7167QOS\u7b49\u7ea7\u6765\u8fdb\u884c\u8d44\u6e90\u7684\u62a2\u5360\uff0c\u6ee1\u8db3\u8fd9\u4e9b\u9ad8\u4f18\u5148\u7684Pod\u8fd9\u91cc\u7684Critical\u7c7b\u578b\u7684Pod\u4e3b\u8981\u5305\u542b\u5982\u4e0b\u4e09\u7c7b\uff1a\u9759\u6001Pod\u3001\u955c\u50cfPod\u3001\u9ad8\u4f18\u5148Pod(\u4f18\u5148\u7ea7\u9ad8\u4e8e2000000000)"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"func (w *predicateAdmitHandler) Admit(attrs *PodAdmitAttributes) PodAdmitResult {\n    node, err := w.getNodeAnyWayFunc()\n    // \u8e22\u51fa\u6269\u5c55\u8d44\u6e90\uff0c\u53ea\u8fdb\u884c\u5185\u5b58\u548cCPU\u8d44\u6e90\u7684\u68c0\u67e5\n    podWithoutMissingExtendedResources := removeMissingExtendedResources(admitPod, nodeInfo)\n\n    // \u8fdb\u884c\u9884\u9009\u7b97\u6cd5\u7b5b\u9009\uff0c \u7b5b\u9009\u51fa\u90a3\u4e9b\u8d44\u6e90\u4e0d\u8db3\u7684\u8d44\u6e90\n    fit, reasons, err := predicates.GeneralPredicates(podWithoutMissingExtendedResources, nil, nodeInfo)\n\n    if !fit {\n        // \u5982\u679c\u9884\u9009\u5931\u8d25\uff0c\u5219\u5c1d\u8bd5\u8fdb\u884c\u62a2\u5360\n        fit, reasons, err = w.admissionFailureHandler.HandleAdmissionFailure(admitPod, reasons)\n    }\n\n}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"23-\u63a2\u9488\u7ba1\u7406",children:"2.3 \u63a2\u9488\u7ba1\u7406"}),"\n",(0,o.jsx)(e.p,{children:"k8s\u91cc\u9762\u7684\u63a2\u9488\u4e3b\u8981\u5206\u4e3a\u4e09\u7c7b\uff1astartup\u3001readiness\u3001liveness\uff0c\u5728Pod\u901a\u8fc7\u51c6\u5165\u63a7\u5236\u68c0\u67e5\u540e\uff0c\u4f1a\u6839\u636ePod\u7684\u63a2\u9488\u914d\u7f6e\u521b\u5efa\u5bf9\u5e94\u7684\u63a2\u9488\uff0c\u4f46\u662f\u8fd9\u91cc\u7684\u63a2\u9488\u5e76\u4e0d\u4f1a\u771f\u6b63\u7684\u8fdb\u884c\u63a2\u6d4b\uff0c\u56e0\u4e3a\u5f53\u524d\u8fd8\u65e0\u6cd5\u611f\u77e5\u5230\u5bf9\u5e94\u7684pod\u7684\u72b6\u6001"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"kl.probeManager.AddPod(pod)\n"})}),"\n",(0,o.jsx)(e.h3,{id:"24-\u5206\u53d1\u4e8b\u4ef6",children:"2.4 \u5206\u53d1\u4e8b\u4ef6"}),"\n",(0,o.jsx)(e.p,{children:"\u5728kubelet\u4e2d\u4f1a\u4e3a\u6bcf\u4e2aPod\u90fd\u521b\u5efa\u4e00\u4e2a\u5bf9\u5e94\u7684goroutine\u548c\u4e8b\u4ef6\u7ba1\u9053\uff0c\u540e\u7eed\u65b0\u7684\u4e8b\u4ef6\u4e5f\u90fd\u901a\u8fc7\u7ba1\u9053\u53d1\u9001\u7ed9\u5bf9\u5e94\u7684goroutine"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"func (p *podWorkers) UpdatePod(options *UpdatePodOptions) {\n    // \u83b7\u53d6pod\u4fe1\u606f\n    pod := options.Pod\n    uid := pod.UID\n    var podUpdates chan UpdatePodOptions\n    var exists bool\n\n    p.podLock.Lock()\n    defer p.podLock.Unlock()\n    // kubelet\u4f1a\u4e3a\u6bcf\u4e2apod\u521b\u5efa\u4e00\u4e2agoroutine, \u5e76\u4e14\u901a\u8fc7\u7ba1\u9053\u6765\u8fdb\u884c\u901a\u4fe1\n    if podUpdates, exists = p.podUpdates[uid]; !exists {\n        podUpdates = make(chan UpdatePodOptions, 1)\n        p.podUpdates[uid] = podUpdates\n\n        // \u4e3a\u5f53\u524dpod\u542f\u52a8\u4e00\u4e2agoroutine\n        go func() {\n            defer runtime.HandleCrash()\n            p.managePodLoop(podUpdates)\n        }()\n    }\n    if !p.isWorking[pod.UID] {\n        p.isWorking[pod.UID] = true\n        // \u66f4\u65b0Pod\u7684\u4e8b\u4ef6\u53d1\u9001\u5230\u7ba1\u9053\n        podUpdates <- *options\n    } \n}\n"})}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"\u81f3\u6b64\u4e00\u4e2aPod\u7684\u542f\u52a8\u7684\u51c6\u5907\u9636\u6bb5\u5c31\u57fa\u672c\u5b8c\u6210\u4e86\uff0c\u68c0\u67e5\u8fd0\u884c\u73af\u5883\u3001\u62c9\u53d6\u5bf9\u5e94\u7684cofnigMap\u548csecret\u8d44\u6e90\u3001\u521b\u5efa\u63a2\u9488\u3001\u542f\u52a8\u8d1f\u8d23Pod\u72b6\u6001\u7ef4\u62a4\u7684\u7ebf\u7a0b\uff0c\u81f3\u6b64\u51c6\u5907\u9636\u6bb5\u5b8c\u6210"}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"3\u914d\u7f6e\u9636\u6bb5",children:"3.\u914d\u7f6e\u9636\u6bb5"}),"\n",(0,o.jsx)(e.p,{children:"\u5728kubelet\u6700\u7ec8\u7684\u72b6\u6001\u540c\u6b65\u90fd\u662f\u7531syncPod\u6765\u5b8c\u6210\uff0c\u8be5\u51fd\u6570\u4f1a\u6839\u636e\u4f20\u9012\u8fdb\u6765\u7684\u76ee\u6807\u72b6\u6001\u548cPod\u7684\u5f53\u524d\u72b6\u6001\u6765\u8fdb\u884c\u51b3\u7b56\uff0c\u4ece\u800c\u6ee1\u8db3\u76ee\u6807\u72b6\u6001\uff0c\u56e0\u4e3a\u5185\u90e8\u903b\u8f91\u7684\u590d\u6742\uff0c\u4f1a\u5206\u4e3a\uff1a\u914d\u7f6e\u9636\u6bb5\u3001\u6e05\u7406\u9636\u6bb5\u3001\u6784\u5efa\u8fd0\u884c\u9636\u6bb5\uff0c\u8fd9\u91cc\u5148\u770b\u4e0b\u914d\u7f6e\u9636\u6bb5"}),"\n",(0,o.jsx)(e.p,{children:"\u914d\u7f6e\u9636\u6bb5\u4e3b\u8981\u662f\u83b7\u53d6\u5f53\u524d\u7684Pod\u72b6\u6001\u3001\u5e94\u7528CGOUP\u914d\u7f6e\u3001Pod\u6570\u636e\u76ee\u5f55\u6784\u5efa\u3001\u7b49\u5f85VOlume\u6302\u8f7d\u3001\u83b7\u53d6\u955c\u50cf\u62c9\u53d6\u7684secret\u7b49"}),"\n",(0,o.jsx)(e.h3,{id:"31-\u8ba1\u7b97pod\u7684\u72b6\u6001",children:"3.1 \u8ba1\u7b97Pod\u7684\u72b6\u6001"}),"\n",(0,o.jsx)(e.p,{children:"Pod\u7684\u72b6\u6001\u6570\u636e\u4e3b\u8981\u5305\u542b\u5f53\u524d\u9636\u6bb5\u3001Conditions(\u5bb9\u5668Condition\u3001\u521d\u59cb\u5316\u5bb9\u5668Condition\u3001PodReadyCondition),\u800c\u8fd9\u4e9b\u72b6\u6001\u5219\u9700\u8981\u6839\u636e\u5f53\u524d\u7684PodStatus\u91cc\u9762\u7684\u72b6\u6001\u8ba1\u7b97\uff0c\u8fd8\u6709probeManager\u91cc\u9762\u63a2\u6d4b\u7684\u6570\u636e\u4e24\u90e8\u5206\u5171\u540c\u5b8c\u6210"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"func (kl *Kubelet) generateAPIPodStatus(pod *v1.Pod, podStatus *kubecontainer.PodStatus) v1.PodStatus {\n    allStatus := append(append([]v1.ContainerStatus{}, s.ContainerStatuses...), s.InitContainerStatuses...)\n    // \u6839\u636ePod\u7684\u5bb9\u5668\u72b6\u6001\uff0c\u8bbe\u5b9a\u5f53\u524d\u7684\u7684\u9636\u6bb5\n    s.Phase = getPhase(spec, allStatus)\n    kl.probeManager.UpdatePodStatus(pod.UID, s)\n    s.Conditions = append(s.Conditions, status.GeneratePodInitializedCondition(spec, s.InitContainerStatuses, s.Phase))\n    s.Conditions = append(s.Conditions, status.GeneratePodReadyCondition(spec, s.Conditions, s.ContainerStatuses, s.Phase))\n    s.Conditions = append(s.Conditions, status.GenerateContainersReadyCondition(spec, s.ContainerStatuses, s.Phase))\n    return *s\n}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"32-\u8fd0\u884c\u73af\u5883\u51c6\u5165\u68c0\u67e5",children:"3.2 \u8fd0\u884c\u73af\u5883\u51c6\u5165\u68c0\u67e5"}),"\n",(0,o.jsx)(e.p,{children:"\u8be5\u8fd0\u884c\u73af\u5883\u662f\u6307\u7684\u4e00\u4e9b\u8f6f\u4ef6\u72b6\u6001\u7684\uff0c\u8fd9\u91cc\u4e3b\u8981\u6d89\u53ca\u5230Appmor\u3001\u7279\u6743\u6a21\u5f0f\u3001proc\u6302\u8f7d\uff0c\u5b9e\u73b0\u673a\u5236\u5c31\u662f\u68c0\u6d4b\u5bf9\u5e94\u7684Pod\u662f\u5426\u9700\u8981\u5bf9\u5e94\u7684\u64cd\u4f5c\uff0c\u5e76\u4e14SecurityContext\u4e2d\u662f\u5426\u5141\u8bb8\u5bf9\u5e94\u7684\u64cd\u4f5c\uff0c\u4ece\u800c\u786e\u5b9aPod\u662f\u5426\u80fd\u591f\u8fdb\u884c\u8fd0\u884c"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"func (kl *Kubelet) canRunPod(pod *v1.Pod) lifecycle.PodAdmitResult {\n    // \u51c6\u5165\u63a7\u5236\u63d2\u4ef6\n    for _, handler := range kl.softAdmitHandlers {\n        if result := handler.Admit(attrs); !result.Admit {\n            return result\n        }\n    }\n\n    return lifecycle.PodAdmitResult{Admit: true}\n}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"33-\u66f4\u65b0\u72b6\u6001",children:"3.3 \u66f4\u65b0\u72b6\u6001"}),"\n",(0,o.jsx)(e.p,{children:"\u66f4\u65b0\u72b6\u6001\u4e3b\u8981\u662f\u4e3a\u4e86probeManager\u6765\u8fdb\u884c\u72b6\u6001\u68c0\u67e5\u7684\uff0c\u5982\u679cprobeManager\u65e0\u6cd5\u83b7\u53d6\u5230\u5bf9\u5e94\u7684\u72b6\u6001\uff0c\u5c31\u4e0d\u4f1a\u6267\u884c\u5bf9\u5e94\u7684\u5065\u5eb7\u63a2\u9488\u7684\u68c0\u67e5\uff0c\u8fd9\u91cc\u7684\u72b6\u6001\u5c31\u662f\u6839\u636e\u4e4b\u524d\u7684\u5404\u79cd\u8ba1\u7b97\u5728kubelet\u4e0a\u5bf9\u5e94Pod\u7684\u5f53\u524d\u72b6\u6001"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"    kl.statusManager.SetPodStatus(pod, apiPodStatus)\n"})}),"\n",(0,o.jsx)(e.h3,{id:"34-\u7f51\u7edc\u8fd0\u884c\u65f6\u68c0\u67e5",children:"3.4 \u7f51\u7edc\u8fd0\u884c\u65f6\u68c0\u67e5"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:'    if err := kl.runtimeState.networkErrors(); err != nil && !kubecontainer.IsHostNetworkPod(pod) {\n        kl.recorder.Eventf(pod, v1.EventTypeWarning, events.NetworkNotReady, "%s: %v", NetworkNotReadyErrorMsg, err)\n        return fmt.Errorf("%s: %v", NetworkNotReadyErrorMsg, err)\n    }\n'})}),"\n",(0,o.jsx)(e.h3,{id:"35-cgroup\u914d\u7f6e",children:"3.5 CGroup\u914d\u7f6e"}),"\n",(0,o.jsx)(e.p,{children:"Cgroup\u7684\u914d\u7f6e\u4e3b\u8981\u662f\u6309\u7167QOS\u7b49\u7ea7\u6765\u8fdb\u884ccgroup\u76ee\u5f55\u7684\u6784\u5efa\uff0c\u5e76\u4e14\u66f4\u65b0\u5f53\u524dPod\u7684\u914d\u7f6e"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"    pcm := kl.containerManager.NewPodContainerManager()\n    // cgroup\u5e94\u7528cgroup\n    if !kl.podIsTerminated(pod) {\n        podKilled := false\n        if !pcm.Exists(pod) && !firstSync {\n            // \u5982\u679c\u5bf9\u4e8e\u7684cgroup\u4e0d\u5b58\u5728\uff0c\u5e76\u4e14\u4e5f\u4e0d\u662f\u7b2c\u4e00\u6b21\u8fd0\u884c\uff0c\u5c31\u5148\u5c06\u4e4b\u524d\u7684pod\u6c99\u96d5\n            if err := kl.killPod(pod, nil, podStatus, nil); err == nil {\n                podKilled = true\n            }\n        }\n        if !(podKilled && pod.Spec.RestartPolicy == v1.RestartPolicyNever) {\n            if !pcm.Exists(pod) {\n                // \u66f4\u65b0qoscgroup\u8bbe\u7f6e\n                if err := kl.containerManager.UpdateQOSCgroups(); err != nil {\n                }\n                // \u66f4\u65b0podde\u7684cgroup\u914d\u7f6e\n                if err := pcm.EnsureExists(pod); err != nil {\n                }\n            }\n        }\n    }\n"})}),"\n",(0,o.jsx)(e.h3,{id:"36-\u955c\u50cfpod\u7684\u68c0\u67e5",children:"3.6 \u955c\u50cfPod\u7684\u68c0\u67e5"}),"\n",(0,o.jsx)(e.p,{children:"\u56e0\u4e3a\u8981\u901a\u8fc7\u955c\u50cfPod\u6765\u5411apiserver\u4f20\u9012\u9759\u6001Pod\u7684\u72b6\u6001\uff0c\u6240\u4ee5\u8be5\u9636\u6bb5\u4e3b\u8981\u662f\u4e3a\u9759\u6001Pod\u521b\u5efa\u5bf9\u5e94\u7684\u955c\u50cfPod"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"    if kubetypes.IsStaticPod(pod) {\n        // \u9759\u6001pod\n        podFullName := kubecontainer.GetPodFullName(pod)\n        deleted := false\n        if mirrorPod != nil {\n            if mirrorPod.DeletionTimestamp != nil || !kl.podManager.IsMirrorPodOf(mirrorPod, pod) {\n                deleted, err = kl.podManager.DeleteMirrorPod(podFullName, &mirrorPod.ObjectMeta.UID)\n            }\n        }\n        if mirrorPod == nil || deleted {\n                if err := kl.podManager.CreateMirrorPod(pod); err != nil {\n                }\n            }\n        }\n    }\n"})}),"\n",(0,o.jsx)(e.h3,{id:"37-\u521b\u5efapod\u7684\u6570\u636e\u76ee\u5f55",children:"3.7 \u521b\u5efaPod\u7684\u6570\u636e\u76ee\u5f55"}),"\n",(0,o.jsx)(e.p,{children:"Pod\u7684\u6570\u636e\u76ee\u5f55\u4e3b\u8981\u662f\u5305\u542b\u4e09\u4e2a\u90e8\u5206\uff1aPod\u76ee\u5f55\u3001Volume\u76ee\u5f55\u3001Plugin\u76ee\u5f55\u4e09\u4e2a\u76ee\u5f55"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"    if err := kl.makePodDataDirs(pod); err != nil {\n        return err\n    }\n"})}),"\n",(0,o.jsx)(e.h3,{id:"38-\u7b49\u5f85volume\u7684\u6302\u8f7d",children:"3.8 \u7b49\u5f85volume\u7684\u6302\u8f7d"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"    if !kl.podIsTerminated(pod) {\n        if err := kl.volumeManager.WaitForAttachAndMount(pod); err != nil {\n        }\n    }\n"})}),"\n",(0,o.jsx)(e.h3,{id:"39-\u83b7\u53d6\u955c\u50cf\u62c9\u53d6\u7684secrets",children:"3.9 \u83b7\u53d6\u955c\u50cf\u62c9\u53d6\u7684secrets"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"    pullSecrets := kl.getPullSecretsForPod(pod)\n"})}),"\n",(0,o.jsx)(e.h3,{id:"310-\u8c03\u7528\u5bb9\u5668\u7684\u8fd0\u884c\u65f6\u8fdb\u884c\u540c\u6b65",children:"3.10 \u8c03\u7528\u5bb9\u5668\u7684\u8fd0\u884c\u65f6\u8fdb\u884c\u540c\u6b65"}),"\n",(0,o.jsx)(e.p,{children:"\u7740\u53ef\u80fd\u662f\u6700\u590d\u6742\u7684\u4e00\u90e8\u5206\u4e86\uff0c\u63a5\u4e0b\u6765\u5c31\u8fdb\u5165\u5230\u4e0b\u4e00\u4e2a\u9636\u6bb5\uff1a\u6e05\u7406\u9636\u6bb5"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"    result := kl.containerRuntime.SyncPod(pod, podStatus, pullSecrets, kl.backOff)\n    kl.reasonCache.Update(pod.UID, result)\n"})}),"\n",(0,o.jsx)(e.h2,{id:"4-\u6e05\u7406\u9636\u6bb5",children:"4. \u6e05\u7406\u9636\u6bb5"}),"\n",(0,o.jsx)(e.p,{children:"\u5728Pod\u8fd0\u884c\u524d\u53ef\u80fd\u5df2\u7ecf\u6709\u90e8\u5206\u5bb9\u5668\u5df2\u7ecf\u5728\u8fd0\u884c\uff0c\u5219\u6b64\u65f6\u5c31\u9700\u8981\u6839\u636e\u5f53\u524d\u7684\u72b6\u6001\uff0c\u6765\u8fdb\u884c\u4e00\u4e9b\u5bb9\u5668\u7684\u6e05\u7406\u5de5\u4f5c\uff0c\u4e3a\u63a5\u4e0b\u6765\u7684\u6784\u5efa\u8fd0\u884c\u9636\u6bb5\u63d0\u4f9b\u4e00\u4e2a\u76f8\u5bf9\u5e72\u51c0\u7684\u73af\u5883"}),"\n",(0,o.jsx)(e.h3,{id:"41-\u8ba1\u7b97pod\u72b6\u6001\u53d8\u66f4",children:"4.1 \u8ba1\u7b97Pod\u72b6\u6001\u53d8\u66f4"}),"\n",(0,o.jsx)(e.p,{children:"\u5728k8s\u4e2dPod\u7684\u72b6\u6001\u4e3b\u8981\u5305\u542bsandbox\u5bb9\u5668\u72b6\u6001\u3001\u521d\u59cb\u5316\u5bb9\u5668\u72b6\u6001\u3001\u4e34\u65f6\u5bb9\u5668\u72b6\u6001\u3001\u4e1a\u52a1\u5bb9\u5668\u72b6\u6001\u7b49\u51e0\u90e8\u5206\uff0c\u6211\u4eec\u4f9d\u6b21\u6765\u770b\u4e0b\u5173\u952e\u7684\u5b9e\u73b0"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"    podContainerChanges := m.computePodActions(pod, podStatus)\n"})}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"\u6c99\u7bb1\u72b6\u6001\u8ba1\u7b97\uff1a\u5f53\u4e14\u4ec5\u6709\u4e00\u4e2aReady\u7684\u6c99\u7bb1\u5e76\u4e14\u6c99\u7bb1\u7684IP\u4e0d\u4e3a\u7a7a\u7684\u60c5\u51b5\uff0c\u6c99\u7bb1\u7684\u72b6\u6001\u624d\u4e0d\u9700\u8981\u66f4\u6539\uff0c\u5176\u4ed6\u60c5\u51b5\u4e0b\uff0c\u90fd\u9700\u8981\u91cd\u65b0\u8fdb\u884c\u6c99\u7bb1\u7684\u6784\u5efa\uff0c\u5e76\u4e14\u9700\u8981kill\u6389Pod\u5173\u8054\u7684\u6240\u6709\u5bb9\u5668"}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:'func (m *kubeGenericRuntimeManager) podSandboxChanged(pod *v1.Pod, podStatus *kubecontainer.PodStatus) (bool, uint32, string) {\n    if len(podStatus.SandboxStatuses) == 0 {\n        return true, 0, ""\n    }\n    readySandboxCount := 0\n    for _, s := range podStatus.SandboxStatuses {\n        if s.State == runtimeapi.PodSandboxState_SANDBOX_READY {\n            readySandboxCount++\n        }\n    }\n\n    sandboxStatus := podStatus.SandboxStatuses[0]\n    if readySandboxCount > 1 {\n        return true, sandboxStatus.Metadata.Attempt + 1, sandboxStatus.Id\n    }\n    if sandboxStatus.State != runtimeapi.PodSandboxState_SANDBOX_READY {\n        return true, sandboxStatus.Metadata.Attempt + 1, sandboxStatus.Id\n    }\n\n    if sandboxStatus.GetLinux().GetNamespaces().GetOptions().GetNetwork() != networkNamespaceForPod(pod) {\n        return true, sandboxStatus.Metadata.Attempt + 1, ""\n    }\n\n    if !kubecontainer.IsHostNetworkPod(pod) && sandboxStatus.Network.Ip == "" {\n        return true, sandboxStatus.Metadata.Attempt + 1, sandboxStatus.Id\n    }\n\n    return false, sandboxStatus.Metadata.Attempt, sandboxStatus.Id\n}\n'})}),"\n",(0,o.jsx)(e.p,{children:"\u8ba1\u7b97Pod\u7684\u5bb9\u5668\u72b6\u6001\u8ba1\u7b97\u903b\u8f91\u76f8\u5bf9\u957f\u4e00\u4e9b\uff0c\u8fd9\u91cc\u6211\u5c31\u4e0d\u8d34\u4ee3\u7801\u4e86\uff0c\u5176\u5982\u8981\u6d41\u7a0b\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff1a"}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"1.\u9700\u8981\u521b\u5efasandbox:"}),"\n"]}),"\n",(0,o.jsx)(e.p,{children:"\u5728\u8be5\u72b6\u6001\u4e0b\uff0c\u5982\u679c\u5b58\u5728\u521d\u59cb\u5316\u5bb9\u5668\uff0c\u5219\u4f1a\u5148\u8fdb\u884c\u521d\u59cb\u5316\u5bb9\u5668\u7684\u521d\u59cb\u5316\uff0c\u5373\u5f53\u524d\u6b65\u9aa4\u53ea\u521b\u5efa\u7b2c\u4e00\u4e2a\u521d\u59cb\u5316\u5bb9\u5668\uff0c\u5982\u679c\u6ca1\u6709\u521d\u59cb\u5316\u5bb9\u5668\uff0c\u5219\u5c31\u5c06\u6240\u6709\u7684\u4e1a\u52a1\u5bb9\u5668\u52a0\u5165\u5230\u542f\u52a8\u7684\u5217\u8868\u91cc\u9762"}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"2.\u4e0d\u9700\u8981\u521b\u5efasandbox:"}),"\n"]}),"\n",(0,o.jsxs)(e.p,{children:["\u8be5\u72b6\u6001\u4e0b\u4f1a\u68c0\u67e5\u904d\u5386\u6240\u6709\u7684\u4e34\u65f6\u5bb9\u5668\uff0c\u521d\u59cb\u5316\u5bb9\u5668(",(0,o.jsx)(e.strong,{children:"\u5982\u679c\u5b58\u5728\u5931\u8d25\u7684\u521d\u59cb\u5316\u5bb9\u5668\uff0c\u5219\u5c31\u5148\u542f\u52a8\u521d\u59cb\u5316\u5bb9\u5668\uff0c\u4e0d\u4f1a\u8fdb\u884c\u4e1a\u52a1\u5bb9\u5668\u7684\u542f\u52a8"}),")\uff0c\u4e1a\u52a1\u5bb9\u5668\uff0c\u6700\u7ec8\u4f1a\u6784\u5efa\u4e00\u4e2a\u9700\u8981kill\u6389\u7684\u5bb9\u5668\u5217\u8868\uff0c\u8fd8\u6709\u4e24\u4e2a\u542f\u52a8\u7684\u5bb9\u5668\u5217\u8868"]}),"\n",(0,o.jsx)(e.h3,{id:"42-killpod\u5168\u90e8\u6e05\u7406",children:"4.2 killPod\u5168\u90e8\u6e05\u7406"}),"\n",(0,o.jsx)(e.p,{children:"\u9700\u8981\u8fdb\u884cKillPod\u7684\u72b6\u6001\u6709\u4e24\u79cd\uff1a"}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"sanbbox\u72b6\u6001\u53d8\u66f4"}),"\n"]}),"\n",(0,o.jsx)(e.p,{children:"\u5373\u5f53sandbox\u72b6\u6001\u4e0d\u6ee1\u8db3\u8981\u6c42\uff0c\u5219\u6b64\u65f6\u9700\u8981\u5c06Pod\u7684\u6240\u6709\u5bb9\u5668\u90fd\u6740\u6389\uff0c\u7136\u540e\u8fdb\u884c\u91cd\u5efa"}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"\u65e0\u9700\u8fdb\u884c\u4fdd\u7559\u7684\u5bb9\u5668"}),"\n"]}),"\n",(0,o.jsx)(e.p,{children:"\u5982\u679cPod\u5bf9\u5e94\u7684\u5bb9\u5668\u7684hash\u503c\u53d8\u66f4\u3001\u72b6\u6001\u4e3a\u5931\u8d25\uff0c\u5219\u5c31\u9700\u8981\u91cd\u5efa"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"    if podContainerChanges.KillPod {\n        // \u6740\u6b7b\u5f53\u524d\u6240\u6709\u7684pod\n        killResult := m.killPodWithSyncResult(pod, kubecontainer.ConvertPodStatusToRunningPod(m.runtimeName, podStatus), nil)\n        if podContainerChanges.CreateSandbox {\n            // \u7ec8\u6b62\u521d\u59cb\u5316\u8fd0\u884c\n            m.purgeInitContainers(pod, podStatus)\n        }\n    }\n"})}),"\n",(0,o.jsx)(e.h3,{id:"43-\u90e8\u5206\u6e05\u7406",children:"4.3 \u90e8\u5206\u6e05\u7406"}),"\n",(0,o.jsx)(e.p,{children:"\u5982\u679c\u5bb9\u5668\u5f53\u524d\u7684\u72b6\u6001\u662f\u6b63\u5e38\u7684\uff0c\u5e76\u4e14hash\u6ca1\u6709\u53d1\u751f\u53d8\u5316\uff0c\u5219\u5c31\u4e0d\u9700\u8981\u8fdb\u884c\u53d8\u66f4\uff0c\u6b64\u65f6\u5c31\u53ea\u9700\u8981\u5c06\u5f53\u524d\u72b6\u6001\u4e0d\u6b63\u5e38\u7684\u5bb9\u5668\u8fdb\u884c\u6e05\u7406\u91cd\u5efa\u5373\u53ef"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"        for containerID, containerInfo := range podContainerChanges.ContainersToKill {\n\n            if err := m.killContainer(pod, containerID, containerInfo.name, containerInfo.message, nil); err != nil {\n                return\n            }\n        }\n"})}),"\n",(0,o.jsx)(e.h2,{id:""}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"\u6e05\u7406\u521d\u59cb\u5316\u5bb9\u5668"}),"\n"]}),"\n",(0,o.jsx)(e.p,{children:"\u5728\u6b63\u5f0f\u542f\u52a8\u5bb9\u5668\u4e4b\u524d\uff0c\u9664\u4e86\u4e0a\u9762\u4e24\u90e8\u5206\uff0c\u8fd8\u4f1a\u8fdb\u884c\u521d\u59cb\u5316\u5bb9\u5668\u7684\u6e05\u7406\u5de5\u4f5c"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"    m.pruneInitContainersBeforeStart(pod, podStatus)\n"})}),"\n",(0,o.jsx)(e.h2,{id:"5\u6784\u5efa\u8fd0\u884c\u9636\u6bb5",children:"5.\u6784\u5efa\u8fd0\u884c\u9636\u6bb5"}),"\n",(0,o.jsx)(e.p,{children:"\u6784\u5efa\u8fd0\u884c\u9636\u6bb5\uff0c\u4e3b\u8981\u5206\u4e3a\u4e24\u4e2a\u5927\u7684\u90e8\u5206\uff1a\u521b\u5efa\u5e76\u8fd0\u884csandbox\u5bb9\u5668\u3001\u8fd0\u884c\u7528\u6237\u5bb9\u5668"}),"\n",(0,o.jsx)(e.h3,{id:"51-\u8fd0\u884csandbox",children:"5.1 \u8fd0\u884csandbox"}),"\n",(0,o.jsx)(e.p,{children:"\u68c0\u67e5\u9700\u8981\u521b\u5efasandbox,\u5219\u4f1a\u9996\u5148\u521b\u5efasandbox\u5bb9\u5668\uff0c\u5e76\u83b7\u53d6\u72b6\u6001\uff0c\u7136\u540e\u586b\u5145\u5f53\u524d\u7684Pod\u7684IP\u4fe1\u606f"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"    // Step 4: Create a sandbox for the pod if necessary.\n    // \u521b\u5efa\u6c99\u7bb1\u73af\u5883\n    podSandboxID := podContainerChanges.SandboxID\n    if podContainerChanges.CreateSandbox {\n\n        podSandboxID, msg, err = m.createPodSandbox(pod, podContainerChanges.Attempt)\n        \n        podSandboxStatus, err := m.runtimeService.PodSandboxStatus(podSandboxID)\n        \n        if !kubecontainer.IsHostNetworkPod(pod) {\n            podIPs = m.determinePodSandboxIPs(pod.Namespace, pod.Name, podSandboxStatus)\n        }\n    }\n"})}),"\n",(0,o.jsx)(e.h3,{id:"52-\u521b\u5efasandbox\u4e3b\u6d41\u7a0b",children:"5.2 \u521b\u5efasandbox\u4e3b\u6d41\u7a0b"}),"\n",(0,o.jsx)(e.p,{children:"\u521b\u5efasandbox\u7684\u4e3b\u6d41\u7a0b\u4e3b\u8981\u5c31\u4e09\u4e2a\u6b65\u9aa4\uff1a\u521b\u5efa\u914d\u7f6e\u4fe1\u606f\u3001\u521b\u5efa\u65e5\u5fd7\u76ee\u5f55\u3001\u8c03\u7528cri\u8fd0\u884csandbox\u751f\u6210\u914d\u7f6e\u9636\u6bb5\u4e3b\u8981\u5305\u542b\u7aef\u53e3\u6620\u5c04\u3001\u4e3b\u673a\u540d\u3001DNS\u3001Linux\u4e2d\u7684SecurityContext\u706f\u7684\u914d\u7f6e"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:'func (m *kubeGenericRuntimeManager) createPodSandbox(pod *v1.Pod, attempt uint32) (string, string, error) {\n    // \u83b7\u53d6\u6c99\u7bb1\u914d\u7f6e\n    podSandboxConfig, err := m.generatePodSandboxConfig(pod, attempt)\n\n    // \u521b\u5efa\u76ee\u5f55\n    err = m.osInterface.MkdirAll(podSandboxConfig.LogDirectory, 0755)\n\n    runtimeHandler := ""\n    if utilfeature.DefaultFeatureGate.Enabled(features.RuntimeClass) && m.runtimeClassManager != nil {\n        // \u83b7\u53d6\u5f53\u524d\u7684runtimeHandler\n        runtimeHandler, err = m.runtimeClassManager.LookupRuntimeHandler(pod.Spec.RuntimeClassName)\n    }\n    // \u8fd0\u884cSandbox\n    podSandBoxID, err := m.runtimeService.RunPodSandbox(podSandboxConfig, runtimeHandler)\n    return podSandBoxID, "", nil\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"53-cri\u4e2d\u7684runsandbox",children:"5.3 cri\u4e2d\u7684RunSandbox"}),"\n",(0,o.jsx)(e.p,{children:"sandbox\u7684\u542f\u52a8\u4e3b\u8981\u5305\u542b\u4e0b\u9762\u51e0\u90e8\u5206\uff1a1) \u62c9\u53d6sanbox\u5bb9\u5668\u955c\u50cf 2)\u521b\u5efasandbox\u5bb9\u5668 3)\u521b\u5efasandbox\u7684checkpoint 4)\u542f\u52a8sandbox\u5bb9\u5668 5)\u4e3asandbox\u542f\u52a8\u7f51\u7edc(\u5982\u679c\u4e0d\u662f\u4e3b\u673a\u7f51\u7edc)"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:'func (ds *dockerService) RunPodSandbox(ctx context.Context, r *runtimeapi.RunPodSandboxRequest) (*runtimeapi.RunPodSandboxResponse, error) {\n    config := r.GetConfig()\n\n    // Step 1: Pull the image for the sandbox.\n    // \u62c9\u53d6sandbox\u6c99\u7bb1\n    //  defaultPodSandboxImageName    = "k8s.gcr.io/pause"\n    //  defaultPodSandboxImageVersion = "3.1"\n    image := defaultSandboxImage\n    podSandboxImage := ds.podSandboxImage\n    if len(podSandboxImage) != 0 {\n        image = podSandboxImage\n    }\n\n    // \u62c9\u53d6\u955c\u50cf\n    if err := ensureSandboxImageExists(ds.client, image); err != nil {\n        return nil, err\n    }\n    // 2.\u521b\u5efasandbox\u5bb9\u5668\n    if r.GetRuntimeHandler() != "" && r.GetRuntimeHandler() != runtimeName {\n        return nil, fmt.Errorf("RuntimeHandler %q not supported", r.GetRuntimeHandler())\n    }\n    // \u521b\u5efa\u6c99\u7bb1\u914d\u7f6e \n    createConfig, err := ds.makeSandboxDockerConfig(config, image)\n    \n    // \u521b\u5efa\u5bb9\u5668\n    createResp, err := ds.client.CreateContainer(*createConfig)\n\n    resp := &runtimeapi.RunPodSandboxResponse{PodSandboxId: createResp.ID}\n\n    ds.setNetworkReady(createResp.ID, false)\n    defer func(e *error) {\n        // Set networking ready depending on the error return of\n        // the parent function\n        if *e == nil {\n            ds.setNetworkReady(createResp.ID, true)\n        }\n    }(&err)\n\n    // Step 3: \u521b\u5efasandbox checkpoint\n    if err = ds.checkpointManager.CreateCheckpoint(createResp.ID, constructPodSandboxCheckpoint(config)); err != nil {\n        return nil, err\n    }\n\n    // Step 4: Start the sandbox container.\n    // // 4.\u542f\u52a8sandbox\u5bb9\u5668\n    err = ds.client.StartContainer(createResp.ID)\n    if err != nil {\n        return nil, fmt.Errorf("failed to start sandbox container for pod %q: %v", config.Metadata.Name, err)\n    }\n    //\u91cd\u5199docker\u751f\u6210\u7684resolv.conf\u6587\u4ef6\u3002\n    if dnsConfig := config.GetDnsConfig(); dnsConfig != nil {\n        containerInfo, err := ds.client.InspectContainer(createResp.ID)\n        if err != nil {\n            return nil, fmt.Errorf("failed to inspect sandbox container for pod %q: %v", config.Metadata.Name, err)\n        }\n\n        // DNS\u5199\u914d\u7f6e\u6587\u4ef6\n        if err := rewriteResolvFile(containerInfo.ResolvConfPath, dnsConfig.Servers, dnsConfig.Searches, dnsConfig.Options); err != nil {\n            return nil, fmt.Errorf("rewrite resolv.conf failed for pod %q: %v", config.Metadata.Name, err)\n        }\n    }\n\n    // \u5982\u679c\u5904\u4e8e\u4e3b\u673a\u7f51\u7edc\u6a21\u5f0f\uff0c\u8bf7\u4e0d\u8981\u8c03\u7528\u7f51\u7edc\u63d2\u4ef6\u3002\n    if config.GetLinux().GetSecurityContext().GetNamespaceOptions().GetNetwork() == runtimeapi.NamespaceMode_NODE {\n        return resp, nil\n    }\n\n    // Step 5: \u8bbe\u7f6esandbox\u5bb9\u5668\u7684\u7f51\u7edc\n    //\u6240\u6709\u7684pod\u7f51\u7edc\u90fd\u662f\u7531\u542f\u52a8\u65f6\u53d1\u73b0\u7684CNI\u63d2\u4ef6\u8bbe\u7f6e\u7684\u3002\n    //\u8fd9\u4e2a\u63d2\u4ef6\u5206\u914dpod ip\uff0c\u5728\u6c99\u76d2\u5185\u8bbe\u7f6e\u8def\u7531\uff0c\u521b\u5efa\u63a5\u53e3\u7b49\u3002\u7406\u8bba\u4e0a\uff0c\u5b83\u7684\u7ba1\u8f96\u6743\u4ee5pod\u6c99\u76d2\u7f51\u7edc\u7ed3\u675f\uff0c\n    // \u4f46\u5b83\u4e5f\u53ef\u80fd\u5728\u4e3b\u673a\u4e0a\u63d2\u5165iptables\u89c4\u5219\u6216\u6253\u5f00\u7aef\u53e3\uff0c\u4ee5\u6ee1\u8db3CNI\u6807\u51c6\u5c1a\u672a\u8bc6\u522b\u7684pod\u89c4\u8303\u7684\u90e8\u5206\u8981\u6c42\u3002\n    cID := kubecontainer.BuildContainerID(runtimeName, createResp.ID)\n    networkOptions := make(map[string]string)\n    if dnsConfig := config.GetDnsConfig(); dnsConfig != nil {\n        // Build DNS options.\n        dnsOption, err := json.Marshal(dnsConfig)\n        if err != nil {\n            return nil, fmt.Errorf("failed to marshal dns config for pod %q: %v", config.Metadata.Name, err)\n        }\n        // \u8bbe\u7f6e\u7f51\u7edcdns\n        networkOptions["dns"] = string(dnsOption)\n    }\n    // \u7f51\u7edc\u4fe1\u606f\n    err = ds.network.SetUpPod(config.GetMetadata().Namespace, config.GetMetadata().Name, cID, config.Annotations, networkOptions)\n\n    return resp, nil\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"54-\u5bb9\u5668\u542f\u52a8\u51fd\u6570",children:"5.4 \u5bb9\u5668\u542f\u52a8\u51fd\u6570"}),"\n",(0,o.jsx)(e.p,{children:"\u5bb9\u5668\u542f\u52a8\u51fd\u6570\u4e2d\u4f1a\u901a\u8fc7\u95ed\u5305\u6765\u4fdd\u5b58\u4e0a\u9762\u521b\u5efa\u7684sandbox\u7684\u4fe1\u606f\uff0c\u540c\u65f6\u6839\u636e\u5f53\u524d\u5bb9\u5668\u7684\u914d\u7f6e\uff0c\u521b\u5efa\u65b0\u7684\u4e1a\u52a1\u5bb9\u5668"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:'    start := func(typeName string, container *v1.Container) error {\n\n        klog.V(4).Infof("Creating %v %+v in pod %v", typeName, container, format.Pod(pod))\n        if msg, err := m.startContainer(podSandboxID, podSandboxConfig, container, pod, podStatus, pullSecrets, podIP, podIPs); err != nil {\n            startContainerResult.Fail(err, msg)\n        }\n\n        return nil\n    }\n'})}),"\n",(0,o.jsx)(e.h3,{id:"55-\u542f\u52a8\u5bb9\u5668",children:"5.5 \u542f\u52a8\u5bb9\u5668"}),"\n",(0,o.jsx)(e.p,{children:"\u5bb9\u5668\u7684\u542f\u52a8\uff0c\u4e3b\u8981\u5305\u542b\u56db\u4e2a\u6d41\u7a0b\uff1a1.\u62c9\u53d6\u955c\u50cf 2.\u521b\u5efa\u5bb9\u5668&PreStart\u94a9\u5b50\u56de\u8c03 3) \u542f\u52a8\u5bb9\u5668 4\uff09postStart\u542f\u52a8\u5bb9\u5668"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:'func (m *kubeGenericRuntimeManager) startContainer(podSandboxID string, podSandboxConfig *runtimeapi.PodSandboxConfig, container *v1.Container, pod *v1.Pod, podStatus *kubecontainer.PodStatus, pullSecrets []v1.Secret, podIP string, podIPs []string) (string, error) {\n    // \u542f\u52a8\u5bb9\u5668\n    // Step 1: pull the image.\n    imageRef, msg, err := m.imagePuller.EnsureImageExists(pod, container, pullSecrets, podSandboxConfig)\n    \n    // Step 2: create the container.\n    ref, err := kubecontainer.GenerateContainerRef(pod, container)\n\n    // \u83b7\u53d6\u5bb9\u5668\u914d\u7f6e\uff0c \u91cc\u9762\u4f1a\u8fdb\u884c\u5404\u79cd\u6587\u4ef6\u76ee\u5f55\u7684\u6302\u8f7d\n    containerConfig, cleanupAction, err := m.generateContainerConfig(container, pod, restartCount, podIP, imageRef, podIPs)\n    if cleanupAction != nil {\n        defer cleanupAction()\n    }\n    if err != nil {\n        s, _ := grpcstatus.FromError(err)\n        m.recordContainerEvent(pod, container, "", v1.EventTypeWarning, events.FailedToCreateContainer, "Error: %v", s.Message())\n        return s.Message(), ErrCreateContainerConfig\n    }\n\n    // \u521b\u5efa\u5bb9\u5668\n    containerID, err := m.runtimeService.CreateContainer(podSandboxID, containerConfig, podSandboxConfig)\n    // \u542f\u52a8\u5bb9\u5668\u94a9\u5b50\n    err = m.internalLifecycle.PreStartContainer(pod, container, containerID)\n    m.recordContainerEvent(pod, container, containerID, v1.EventTypeNormal, events.CreatedContainer, fmt.Sprintf("Created container %s", container.Name))\n\n    if ref != nil {\n        m.containerRefManager.SetRef(kubecontainer.ContainerID{\n            Type: m.runtimeName,\n            ID:   containerID,\n        }, ref)\n    }\n\n    // Step 3: \u542f\u52a8\u5bb9\u5668\n    err = m.runtimeService.StartContainer(containerID)\n    if err != nil {\n        s, _ := grpcstatus.FromError(err)\n        m.recordContainerEvent(pod, container, containerID, v1.EventTypeWarning, events.FailedToStartContainer, "Error: %v", s.Message())\n        return s.Message(), kubecontainer.ErrRunContainer\n    }\n    containerMeta := containerConfig.GetMetadata()\n    sandboxMeta := podSandboxConfig.GetMetadata()\n    legacySymlink := legacyLogSymlink(containerID, containerMeta.Name, sandboxMeta.Name,\n        sandboxMeta.Namespace)\n    // \u5bb9\u5668\u65e5\u5fd7\n    containerLog := filepath.Join(podSandboxConfig.LogDirectory, containerConfig.LogPath)\n    if _, err := m.osInterface.Stat(containerLog); !os.IsNotExist(err) {\n        if err := m.osInterface.Symlink(containerLog, legacySymlink); err != nil {\n        }\n    }\n\n    // Step 4: \u6267\u884cpostStart\u94a9\u5b50\n    if container.Lifecycle != nil && container.Lifecycle.PostStart != nil {\n        msg, handlerErr := m.runner.Run(kubeContainerID, pod, container, container.Lifecycle.PostStart)\n        if handlerErr != nil {\n            if err := m.killContainer(pod, kubeContainerID, container.Name, "FailedPostStartHook", nil); err != nil {\n            }\n        }\n    }\n\n    return "", nil\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"56-cricreatecontainer",children:"5.6 cri.CreateContainer"}),"\n",(0,o.jsx)(e.p,{children:"CreateContainer\u4e2d\u4f1a\u9996\u5148\u6839\u636ek8s\u91cc\u9762\u4f20\u9012\u7684\u914d\u7f6e\u4fe1\u606f\uff0c\u6839\u636e\u5f53\u524d\u5e73\u53f0\u548c\u5bf9\u5e94\u7684\u53c2\u6570\u6765\u8fdb\u884cdocker\u5bb9\u5668\u8fd0\u884c\u7684\u914d\u7f6e\uff0c\u7136\u540e\u8c03\u7528docker\u63a5\u53e3\u8fdb\u884c\u5bb9\u5668\u7684\u914d\u7f6e"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:'func (ds *dockerService) CreateContainer(_ context.Context, r *runtimeapi.CreateContainerRequest) (*runtimeapi.CreateContainerResponse, error) {\n    podSandboxID := r.PodSandboxId\n    config := r.GetConfig()\n    sandboxConfig := r.GetSandboxConfig()\n    containerName := makeContainerName(sandboxConfig, config)\n    // \u521b\u5efa\u5bb9\u5668\u914d\u7f6e\n    createConfig := dockertypes.ContainerCreateConfig{\n        Name: containerName,\n        Config: &dockercontainer.Config{\n            // TODO: set User.\n            Entrypoint: dockerstrslice.StrSlice(config.Command),\n            Cmd:        dockerstrslice.StrSlice(config.Args),\n            Env:        generateEnvList(config.GetEnvs()),\n            Image:      image,\n            WorkingDir: config.WorkingDir,\n            Labels:     labels,\n            // Interactive containers:\n            OpenStdin: config.Stdin,\n            StdinOnce: config.StdinOnce,\n            Tty:       config.Tty,\n            // Disable Docker\'s health check until we officially support it\n            // (https://github.com/kubernetes/kubernetes/issues/25829).\n            Healthcheck: &dockercontainer.HealthConfig{\n                Test: []string{"NONE"},\n            },\n        },\n        HostConfig: &dockercontainer.HostConfig{\n            Binds: generateMountBindings(config.GetMounts()),\n            RestartPolicy: dockercontainer.RestartPolicy{\n                Name: "no",\n            },\n        },\n    }\n\n    hc := createConfig.HostConfig\n    err = ds.updateCreateConfig(&createConfig, config, sandboxConfig, podSandboxID, securityOptSeparator, apiVersion)\n    if err != nil {\n        return nil, fmt.Errorf("failed to update container create config: %v", err)\n    }\n    // \u8bbe\u7f6e\u5bb9\u5668devices\n    devices := make([]dockercontainer.DeviceMapping, len(config.Devices))\n    for i, device := range config.Devices {\n        devices[i] = dockercontainer.DeviceMapping{\n            PathOnHost:        device.HostPath,\n            PathInContainer:   device.ContainerPath,\n            CgroupPermissions: device.Permissions,\n        }\n    }\n    hc.Resources.Devices = devices\n\n    securityOpts, err := ds.getSecurityOpts(config.GetLinux().GetSecurityContext().GetSeccompProfilePath(), securityOptSeparator)\n    if err != nil {\n        return nil, fmt.Errorf("failed to generate security options for container %q: %v", config.Metadata.Name, err)\n    }\n\n    hc.SecurityOpt = append(hc.SecurityOpt, securityOpts...)\n\n    cleanupInfo, err := ds.applyPlatformSpecificDockerConfig(r, &createConfig)\n    if err != nil {\n        return nil, err\n    }\n\n    createResp, createErr := ds.client.CreateContainer(createConfig)\n    if createErr != nil {\n        createResp, createErr = recoverFromCreationConflictIfNeeded(ds.client, createConfig, createErr)\n    }\n\n    if createResp != nil {\n        containerID := createResp.ID\n\n        if cleanupInfo != nil {\n            // we don\'t perform the clean up just yet at that could destroy information\n            // needed for the container to start (e.g. Windows credentials stored in\n            // registry keys); instead, we\'ll clean up when the container gets removed\n            ds.containerCleanupInfos[containerID] = cleanupInfo\n        }\n        return &runtimeapi.CreateContainerResponse{ContainerId: containerID}, nil\n    }\n\n    return nil, createErr\n}\n'})}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"\u66f4\u65b0\u5bb9\u5668\u914d\u7f6e"}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:'func (ds *dockerService) updateCreateConfig(\n    createConfig *dockertypes.ContainerCreateConfig,\n    config *runtimeapi.ContainerConfig,\n    sandboxConfig *runtimeapi.PodSandboxConfig,\n    podSandboxID string, securityOptSep rune, apiVersion *semver.Version) error {\n    if lc := config.GetLinux(); lc != nil {\n        rOpts := lc.GetResources()\n        if rOpts != nil {\n            // \u66f4\u65b0\u8d44\u6e90\u914d\u7f6e\u4fe1\u606f\n            createConfig.HostConfig.Resources = dockercontainer.Resources{\n                Memory:     rOpts.MemoryLimitInBytes,\n                MemorySwap: rOpts.MemoryLimitInBytes,\n                CPUShares:  rOpts.CpuShares,\n                CPUQuota:   rOpts.CpuQuota,\n                CPUPeriod:  rOpts.CpuPeriod,\n            }\n            createConfig.HostConfig.OomScoreAdj = int(rOpts.OomScoreAdj)\n        }\n        // \u5e94\u7528SecurityContext\n        if err := applyContainerSecurityContext(lc, podSandboxID, createConfig.Config, createConfig.HostConfig, securityOptSep); err != nil {\n            return fmt.Errorf("failed to apply container security context for container %q: %v", config.Metadata.Name, err)\n        }\n    }\n\n    // \u5e94\u7528cgroup\u914d\u7f6e\n    if lc := sandboxConfig.GetLinux(); lc != nil {\n        // Apply Cgroup options.\n        cgroupParent, err := ds.GenerateExpectedCgroupParent(lc.CgroupParent)\n        createConfig.HostConfig.CgroupParent = cgroupParent\n    }\n\n    return nil\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"57-cristartcontainer",children:"5.7 cri.StartContainer"}),"\n",(0,o.jsx)(e.p,{children:"\u5176\u5b9e\u5c31\u76f4\u63a5\u6389Docker\u7684\u63a5\u53e3\u542f\u52a8\u5bb9\u5668\u5373\u53ef"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"func (ds *dockerService) StartContainer(_ context.Context, r *runtimeapi.StartContainerRequest) (*runtimeapi.StartContainerResponse, error) {\n    err := ds.client.StartContainer(r.ContainerId)\n    return &runtimeapi.StartContainerResponse{}, nil\n}\n"})}),"\n",(0,o.jsx)(e.h2,{id:"6-\u603b\u7ed3",children:"6. \u603b\u7ed3"}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-10-15%2016.30.11.png",alt:"iShot2020-10-15 16.30.11"})}),"\n",(0,o.jsx)(e.p,{children:"Pod\u542f\u52a8\u7684\u6838\u5fc3\u6d41\u7a0b\u5927\u6982\u5c31\u8fd9\u4e9b\uff0c\u91cc\u9762\u4f1a\u6709\u4e00\u4e9b\u7b14\u8ba4\u8d2d\u5177\u4f53\u53c2\u6570\u6570\u636e\u7684\u6784\u5efa\uff0c\u6ca1\u6709\u5199\u660e\uff0c\u4f46\u662f\u5982\u679c\u5bf9\u4ee3\u7801\u611f\u5174\u8da3\u7684\uff0c\u53ef\u4ee5\u987a\u7740\u8fd9\u4e2a\u6838\u5fc3\u6d41\u7a0b\u57fa\u672c\u53ef\u4ee5\u8bfb\u4e0b\u6765\uff0c\u5982\u679c\u5bf9\u4ee3\u7801\u4e0d\u611f\u5174\u8da3\uff0c\u5219\u540e\u9762\u8fd9\u5f20\u56fe\u53ef\u4ee5\u7b97\u4f5c\u4e00\u4e2a\u7cbe\u7b80\u7248\u7684\uff0c\u9762\u8bd5\u53ef\u7528\u7684Pod\u521b\u5efa\u6d41\u7a0b\u56fe"}),"\n",(0,o.jsxs)(e.p,{children:["kubernetes\u5b66\u4e60\u7b14\u8bb0\u5730\u5740: ",(0,o.jsx)(e.a,{href:"https://www.yuque.com/baxiaoshi/tyado3",children:"https://www.yuque.com/baxiaoshi/tyado3"})]})]})}function p(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(l,{...n})}):l(n)}},28453:(n,e,r)=>{r.d(e,{R:()=>a,x:()=>d});var o=r(96540);const t={},i=o.createContext(t);function a(n){const e=o.useContext(i);return o.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:a(n.components),o.createElement(i.Provider,{value:e},n.children)}}}]);