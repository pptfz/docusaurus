"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[8542],{97291:(e,n,d)=>{d.r(n),d.d(n,{assets:()=>s,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>a});var c=d(74848),i=d(28453);const l={},r="containerd \u9ad8\u7ea7\u547d\u4ee4\u884c\u5de5\u5177 nerdctl",t={id:"\u4e91\u539f\u751f/\u5bb9\u5668/containerd/containerd \u9ad8\u7ea7\u547d\u4ee4\u884c\u5de5\u5177 nerdctl",title:"containerd \u9ad8\u7ea7\u547d\u4ee4\u884c\u5de5\u5177 nerdctl",description:"nerrdctl github\u5730\u5740",source:"@site/docs/\u4e91\u539f\u751f/\u5bb9\u5668/containerd/containerd \u9ad8\u7ea7\u547d\u4ee4\u884c\u5de5\u5177 nerdctl.md",sourceDirName:"\u4e91\u539f\u751f/\u5bb9\u5668/containerd",slug:"/\u4e91\u539f\u751f/\u5bb9\u5668/containerd/containerd \u9ad8\u7ea7\u547d\u4ee4\u884c\u5de5\u5177 nerdctl",permalink:"/docs/\u4e91\u539f\u751f/\u5bb9\u5668/containerd/containerd \u9ad8\u7ea7\u547d\u4ee4\u884c\u5de5\u5177 nerdctl",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"harbor\u914d\u7f6e\u955c\u50cf\u540c\u6b65",permalink:"/docs/\u4e91\u539f\u751f/\u4e91\u539f\u751f\u5de5\u5177/harbor/harbor\u914d\u7f6e\u955c\u50cf\u540c\u6b65"},next:{title:"containerd\u4f7f\u7528",permalink:"/docs/\u4e91\u539f\u751f/\u5bb9\u5668/containerd/containerd\u4f7f\u7528"}},s={},a=[{value:"1.nerdctl\u7b80\u4ecb",id:"1nerdctl\u7b80\u4ecb",level:2},{value:"2.nerdctl\u5b89\u88c5",id:"2nerdctl\u5b89\u88c5",level:2},{value:"2.1 \u672a\u5b89\u88c5containerd",id:"21-\u672a\u5b89\u88c5containerd",level:3},{value:"2.1.1 \u4e0b\u8f7d\u5305",id:"211-\u4e0b\u8f7d\u5305",level:4},{value:"2.1.2 \u67e5\u770b\u5305\u5185\u5bb9",id:"212-\u67e5\u770b\u5305\u5185\u5bb9",level:4},{value:"2.1.3 \u89e3\u538b\u7f29\u5305",id:"213-\u89e3\u538b\u7f29\u5305",level:4},{value:"2.1.4 \u67e5\u770b\u76ee\u5f55\u7ed3\u6784",id:"214-\u67e5\u770b\u76ee\u5f55\u7ed3\u6784",level:4},{value:"2.1.5 \u542f\u52a8containerd\u4e0ebuildkit",id:"215-\u542f\u52a8containerd\u4e0ebuildkit",level:4},{value:"2.1.6 \u9a8c\u8bc1",id:"216-\u9a8c\u8bc1",level:4},{value:"2.1.7 \u5378\u8f7dcontainerd\u3001nerdctl\u3001buildkit",id:"217-\u5378\u8f7dcontainerdnerdctlbuildkit",level:4},{value:"2.1.7.1 \u505c\u6b62containerd\u4e0ebuildkit\u670d\u52a1",id:"2171-\u505c\u6b62containerd\u4e0ebuildkit\u670d\u52a1",level:5},{value:"2.1.7.2 \u5378\u8f7dcontainerd\u3001nerdctl\u3001buildkit",id:"2172-\u5378\u8f7dcontainerdnerdctlbuildkit",level:5},{value:"2.2 \u5df2\u5b89\u88c5containerd",id:"22-\u5df2\u5b89\u88c5containerd",level:3},{value:"2.2.1 \u4e0b\u8f7d\u5305",id:"221-\u4e0b\u8f7d\u5305",level:4},{value:"2.2.2 \u67e5\u770b\u5305\u5185\u5bb9",id:"222-\u67e5\u770b\u5305\u5185\u5bb9",level:4},{value:"2.2.3 \u89e3\u538b\u7f29\u5305",id:"223-\u89e3\u538b\u7f29\u5305",level:4},{value:"2.2.4 \u5bfc\u51fa <code>nerdctl</code> \u547d\u4ee4",id:"224-\u5bfc\u51fa-nerdctl-\u547d\u4ee4",level:4},{value:"2.2.5 \u9a8c\u8bc1",id:"225-\u9a8c\u8bc1",level:4},{value:"3.nerdctl\u4f7f\u7528",id:"3nerdctl\u4f7f\u7528",level:2},{value:"3.1 \u6784\u5efa\u955c\u50cf <code>nerdctl build</code>",id:"31-\u6784\u5efa\u955c\u50cf-nerdctl-build",level:3}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.h1,{id:"containerd-\u9ad8\u7ea7\u547d\u4ee4\u884c\u5de5\u5177-nerdctl",children:"containerd \u9ad8\u7ea7\u547d\u4ee4\u884c\u5de5\u5177 nerdctl"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.a,{href:"https://github.com/containerd/nerdctl",children:"nerrdctl github\u5730\u5740"})}),"\n",(0,c.jsx)(n.h2,{id:"1nerdctl\u7b80\u4ecb",children:"1.nerdctl\u7b80\u4ecb"}),"\n",(0,c.jsxs)(n.p,{children:["\u5b89\u88c5containerd\u540e\u662f\u4f7f\u7528 ",(0,c.jsx)(n.code,{children:"ctr"})," \u64cd\u4f5c\u7ba1\u7406 containerd \u955c\u50cf\u5bb9\u5668\uff0c\u4f46\u662f\u5927\u5bb6\u90fd\u4e60\u60ef\u4e86\u4f7f\u7528 docker cli\uff0c",(0,c.jsx)(n.code,{children:"ctr"})," \u4f7f\u7528\u8d77\u6765\u53ef\u80fd\u8fd8\u662f\u4e0d\u592a\u987a\u624b\uff0c\u4e3a\u4e86\u80fd\u591f\u8ba9\u5927\u5bb6\u66f4\u597d\u7684\u8f6c\u5230 containerd \u4e0a\u9762\u6765\uff0c\u793e\u533a\u63d0\u4f9b\u4e86\u4e00\u4e2a\u65b0\u7684\u547d\u4ee4\u884c\u5de5\u5177\uff1a",(0,c.jsx)(n.a,{href:"https://github.com/containerd/nerdctl",children:"nerdctl"}),"\u3002nerdctl \u662f\u4e00\u4e2a\u4e0e docker cli \u98ce\u683c\u517c\u5bb9\u7684 containerd \u5ba2\u6237\u7aef\u5de5\u5177\uff0c\u800c\u4e14\u76f4\u63a5\u517c\u5bb9 docker compose \u7684\u8bed\u6cd5\u7684\uff0c\u8fd9\u5c31\u5927\u5927\u63d0\u9ad8\u4e86\u76f4\u63a5\u5c06 containerd \u4f5c\u4e3a\u672c\u5730\u5f00\u53d1\u3001\u6d4b\u8bd5\u6216\u8005\u5355\u673a\u5bb9\u5668\u90e8\u7f72\u4f7f\u7528\u7684\u6548\u7387\u3002"]}),"\n",(0,c.jsx)(n.h2,{id:"2nerdctl\u5b89\u88c5",children:"2.nerdctl\u5b89\u88c5"}),"\n",(0,c.jsx)(n.h3,{id:"21-\u672a\u5b89\u88c5containerd",children:"2.1 \u672a\u5b89\u88c5containerd"}),"\n",(0,c.jsx)(n.admonition,{title:"\u8bf4\u660e",type:"tip",children:(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u5982\u679c\u6ca1\u6709\u5b89\u88c5 containerd\uff0c\u5219\u53ef\u4ee5\u4e0b\u8f7d nerdctl-full-<VERSION>-linux-amd64.tar.gz \u5305\u8fdb\u884c\u5b89\u88c5\uff0c\u5e76\u4e14nerdctl-full\u8fd9\u4e2a\u5305\u662f\u4e0econtainerd\u7248\u672c\u4e00\u4e00\u5bf9\u5e94\u7684\uff0c\u5373containerd\u53d1\u5e03\u4e00\u4e2a\u7248\u672c\u540e\uff0cnerdctl-full\u4e5f\u968f\u5373\u53d1\u5e03\u4e00\u4e2a\u7248\u672c\uff0c\u867d\u71362\u8005\u7248\u672c\u53f7\u4e0d\u4e00\u81f4\uff0c\u4f46\u662f\u662f\u4e92\u76f8\u5bf9\u5e94\u7684"})})}),"\n",(0,c.jsx)(n.h4,{id:"211-\u4e0b\u8f7d\u5305",children:"2.1.1 \u4e0b\u8f7d\u5305"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"export NERDCTL_VERSION=0.16.1\nwget https://github.com/containerd/nerdctl/releases/download/v${NERDCTL_VERSION}/nerdctl-full-${NERDCTL_VERSION}-linux-amd64.tar.gz\n"})}),"\n",(0,c.jsx)(n.h4,{id:"212-\u67e5\u770b\u5305\u5185\u5bb9",children:"2.1.2 \u67e5\u770b\u5305\u5185\u5bb9"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770b\u5305\u5185\u5bb9\uff0c\u89e3\u538b\u7f29\u540e\u662fbin  lib  libexec  share 4\u4e2a\u76ee\u5f55\n$ tar -tf nerdctl-full-${NERDCTL_VERSION}-linux-amd64.tar.gz\nbin/\nbin/buildctl\nbin/buildkitd\nbin/containerd\nbin/containerd-fuse-overlayfs-grpc\nbin/containerd-rootless-setuptool.sh\nbin/containerd-rootless.sh\nbin/containerd-shim-runc-v2\nbin/containerd-stargz-grpc\nbin/ctd-decoder\nbin/ctr\nbin/ctr-enc\nbin/ctr-remote\nbin/fuse-overlayfs\nbin/ipfs\nbin/nerdctl\nbin/rootlessctl\nbin/rootlesskit\nbin/runc\nbin/slirp4netns\nlib/\nlib/systemd/\nlib/systemd/system/\nlib/systemd/system/buildkit.service\nlib/systemd/system/containerd.service\nlib/systemd/system/stargz-snapshotter.service\nlibexec/\nlibexec/cni/\nlibexec/cni/bandwidth\nlibexec/cni/bridge\nlibexec/cni/dhcp\nlibexec/cni/firewall\nlibexec/cni/host-device\nlibexec/cni/host-local\nlibexec/cni/ipvlan\nlibexec/cni/isolation\nlibexec/cni/loopback\nlibexec/cni/macvlan\nlibexec/cni/portmap\nlibexec/cni/ptp\nlibexec/cni/sbr\nlibexec/cni/static\nlibexec/cni/tuning\nlibexec/cni/vlan\nlibexec/cni/vrf\nshare/\nshare/doc/\nshare/doc/nerdctl/\nshare/doc/nerdctl/README.md\nshare/doc/nerdctl/docs/\nshare/doc/nerdctl/docs/cni.md\nshare/doc/nerdctl/docs/compose.md\nshare/doc/nerdctl/docs/config.md\nshare/doc/nerdctl/docs/cosign.md\nshare/doc/nerdctl/docs/dir.md\nshare/doc/nerdctl/docs/experimental.md\nshare/doc/nerdctl/docs/faq.md\nshare/doc/nerdctl/docs/freebsd.md\nshare/doc/nerdctl/docs/gpu.md\nshare/doc/nerdctl/docs/ipfs.md\nshare/doc/nerdctl/docs/multi-platform.md\nshare/doc/nerdctl/docs/ocicrypt.md\nshare/doc/nerdctl/docs/registry.md\nshare/doc/nerdctl/docs/rootless.md\nshare/doc/nerdctl/docs/stargz.md\nshare/doc/nerdctl-full/\nshare/doc/nerdctl-full/README.md\nshare/doc/nerdctl-full/SHA256SUMS\n"})}),"\n",(0,c.jsx)(n.h4,{id:"213-\u89e3\u538b\u7f29\u5305",children:"2.1.3 \u89e3\u538b\u7f29\u5305"}),"\n",(0,c.jsx)(n.admonition,{title:"\u8bf4\u660e",type:"tip",children:(0,c.jsxs)(n.p,{children:["\u89e3\u538b\u7f29\u5305\u81f3 ",(0,c.jsx)(n.code,{children:"/usr/local"}),"\xa0\u4e0b\uff0c",(0,c.jsx)(n.code,{children:"buildctl"}),"\xa0\u3001 ",(0,c.jsx)(n.code,{children:"buildkitd"}),"\xa0\u3001",(0,c.jsx)(n.code,{children:"containerd"}),"\xa0\u3001",(0,c.jsx)(n.code,{children:"ctr"}),"\xa0\u3001",(0,c.jsx)(n.code,{children:"nerdctl"}),"\xa0\u3001",(0,c.jsx)(n.code,{children:"runc"}),"\xa0\u7b49\u547d\u4ee4\u5c31\u4f1a\u5168\u90e8\u5305\u542b\uff0c\u540c\u65f6\u4f7f\u7528systemd\u7ba1\u7406buildkit\u6587\u4ef6",(0,c.jsx)(n.code,{children:"buildkit.service"}),"\xa0\u3001\u4f7f\u7528systemd\u7ba1\u7406containerd\u6587\u4ef6\xa0",(0,c.jsx)(n.code,{children:"containerd.service"}),"\xa0\u4e5f\u4f1a\u5305\u542b"]})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"tar xf nerdctl-full-${NERDCTL_VERSION}-linux-amd64.tar.gz -C /usr/local\n"})}),"\n",(0,c.jsx)(n.admonition,{title:"\u8bf4\u660e",type:"tip",children:(0,c.jsxs)(n.p,{children:["\u4e5f\u53ef\u4ee5\u53ea\u590d\u5236\u90e8\u5206\u6587\u4ef6\u5230\u76f8\u5173\u76ee\u5f55\uff0c\u4f8b\u5982\xa0",(0,c.jsx)(n.code,{children:"buildctl"})," \u3001 ",(0,c.jsx)(n.code,{children:"buildkitd"})," \u3001",(0,c.jsx)(n.code,{children:"containerd"})," \u3001",(0,c.jsx)(n.code,{children:"ctr"})," \u3001",(0,c.jsx)(n.code,{children:"nerdctl"})," \u3001",(0,c.jsx)(n.code,{children:"runc"})," \u7b49\u547d\u4ee4\u4ee5\u53ca ",(0,c.jsx)(n.code,{children:"buildkit.service"}),"\xa0\u3001",(0,c.jsx)(n.code,{children:"containerd.service"}),"\xa0 \u6587\u4ef6"]})}),"\n",(0,c.jsx)(n.h4,{id:"214-\u67e5\u770b\u76ee\u5f55\u7ed3\u6784",children:"2.1.4 \u67e5\u770b\u76ee\u5f55\u7ed3\u6784"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"$ tree\n.\n\u251c\u2500\u2500 bin\n\u2502\xa0\xa0 \u251c\u2500\u2500 buildctl\n\u2502\xa0\xa0 \u251c\u2500\u2500 buildkitd\n\u2502\xa0\xa0 \u251c\u2500\u2500 containerd\n\u2502\xa0\xa0 \u251c\u2500\u2500 containerd-fuse-overlayfs-grpc\n\u2502\xa0\xa0 \u251c\u2500\u2500 containerd-rootless-setuptool.sh\n\u2502\xa0\xa0 \u251c\u2500\u2500 containerd-rootless.sh\n\u2502\xa0\xa0 \u251c\u2500\u2500 containerd-shim-runc-v2\n\u2502\xa0\xa0 \u251c\u2500\u2500 containerd-stargz-grpc\n\u2502\xa0\xa0 \u251c\u2500\u2500 ctd-decoder\n\u2502\xa0\xa0 \u251c\u2500\u2500 ctr\n\u2502\xa0\xa0 \u251c\u2500\u2500 ctr-enc\n\u2502\xa0\xa0 \u251c\u2500\u2500 ctr-remote\n\u2502\xa0\xa0 \u251c\u2500\u2500 fuse-overlayfs\n\u2502\xa0\xa0 \u251c\u2500\u2500 ipfs\n\u2502\xa0\xa0 \u251c\u2500\u2500 nerdctl\n\u2502\xa0\xa0 \u251c\u2500\u2500 rootlessctl\n\u2502\xa0\xa0 \u251c\u2500\u2500 rootlesskit\n\u2502\xa0\xa0 \u251c\u2500\u2500 runc\n\u2502\xa0\xa0 \u2514\u2500\u2500 slirp4netns\n\u251c\u2500\u2500 lib\n\u2502\xa0\xa0 \u2514\u2500\u2500 systemd\n\u2502\xa0\xa0     \u2514\u2500\u2500 system\n\u2502\xa0\xa0         \u251c\u2500\u2500 buildkit.service\n\u2502\xa0\xa0         \u251c\u2500\u2500 containerd.service\n\u2502\xa0\xa0         \u2514\u2500\u2500 stargz-snapshotter.service\n\u251c\u2500\u2500 libexec\n\u2502\xa0\xa0 \u2514\u2500\u2500 cni\n\u2502\xa0\xa0     \u251c\u2500\u2500 bandwidth\n\u2502\xa0\xa0     \u251c\u2500\u2500 bridge\n\u2502\xa0\xa0     \u251c\u2500\u2500 dhcp\n\u2502\xa0\xa0     \u251c\u2500\u2500 firewall\n\u2502\xa0\xa0     \u251c\u2500\u2500 host-device\n\u2502\xa0\xa0     \u251c\u2500\u2500 host-local\n\u2502\xa0\xa0     \u251c\u2500\u2500 ipvlan\n\u2502\xa0\xa0     \u251c\u2500\u2500 isolation\n\u2502\xa0\xa0     \u251c\u2500\u2500 loopback\n\u2502\xa0\xa0     \u251c\u2500\u2500 macvlan\n\u2502\xa0\xa0     \u251c\u2500\u2500 portmap\n\u2502\xa0\xa0     \u251c\u2500\u2500 ptp\n\u2502\xa0\xa0     \u251c\u2500\u2500 sbr\n\u2502\xa0\xa0     \u251c\u2500\u2500 static\n\u2502\xa0\xa0     \u251c\u2500\u2500 tuning\n\u2502\xa0\xa0     \u251c\u2500\u2500 vlan\n\u2502\xa0\xa0     \u2514\u2500\u2500 vrf\n\u2514\u2500\u2500 share\n    \u2514\u2500\u2500 doc\n        \u251c\u2500\u2500 nerdctl\n        \u2502\xa0\xa0 \u251c\u2500\u2500 docs\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 cni.md\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 compose.md\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 config.md\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 cosign.md\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 dir.md\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 experimental.md\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 faq.md\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 freebsd.md\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 gpu.md\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ipfs.md\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 multi-platform.md\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ocicrypt.md\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 registry.md\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 rootless.md\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 stargz.md\n        \u2502\xa0\xa0 \u2514\u2500\u2500 README.md\n        \u2514\u2500\u2500 nerdctl-full\n            \u251c\u2500\u2500 README.md\n            \u2514\u2500\u2500 SHA256SUMS\n\n11 directories, 57 files\n"})}),"\n",(0,c.jsx)(n.h4,{id:"215-\u542f\u52a8containerd\u4e0ebuildkit",children:"2.1.5 \u542f\u52a8containerd\u4e0ebuildkit"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"systemctl enable containerd buildkit && systemctl start containerd buildkit\n"})}),"\n",(0,c.jsx)(n.h4,{id:"216-\u9a8c\u8bc1",children:"2.1.6 \u9a8c\u8bc1"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"$ ctr version\nClient:\n  Version:  v1.5.9\n  Revision: 1407cab509ff0d96baa4f0eb6ff9980270e6e620\n  Go version: go1.17.6\n\nServer:\n  Version:  v1.5.9\n  Revision: 1407cab509ff0d96baa4f0eb6ff9980270e6e620\n  UUID: 0fd8e6f7-ba7a-4715-844f-c8261932a201\n\n$ nerdctl version\nClient:\n Version:\tv0.16.1\n Git commit:\tc4bd56b3aa220db037cc6c0a4e0c8cc062f2cc4c\n\nServer:\n containerd:\n  Version:\tv1.5.9\n  GitCommit:\t1407cab509ff0d96baa4f0eb6ff9980270e6e620\n\n$ buildctl -v\nbuildctl github.com/moby/buildkit v0.9.3 8d2625494a6a3d413e3d875a2ff7dd9b1ed1b1a9\n\n$ buildkitd -v\nbuildkitd github.com/moby/buildkit v0.9.3 8d2625494a6a3d413e3d875a2ff7dd9b1ed1b1a9\n"})}),"\n",(0,c.jsx)(n.h4,{id:"217-\u5378\u8f7dcontainerdnerdctlbuildkit",children:"2.1.7 \u5378\u8f7dcontainerd\u3001nerdctl\u3001buildkit"}),"\n",(0,c.jsx)(n.h5,{id:"2171-\u505c\u6b62containerd\u4e0ebuildkit\u670d\u52a1",children:"2.1.7.1 \u505c\u6b62containerd\u4e0ebuildkit\u670d\u52a1"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"systemctl disable containerd buildkit && systemctl stop containerd buildkit && systemctl status containerd buildkit\n"})}),"\n",(0,c.jsx)(n.h5,{id:"2172-\u5378\u8f7dcontainerdnerdctlbuildkit",children:"2.1.7.2 \u5378\u8f7dcontainerd\u3001nerdctl\u3001buildkit"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u5378\u8f7dcontainerd\u3001nerdctl\u3001buildkit\u5220\u9664\u76f8\u5173\u76ee\u5f55\u6587\u4ef6\u5373\u53ef"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"rm -rf /usr/local/bin/{buildctl,buildkitd,containerd,containerd-fuse-overlayfs-grpc,containerd-rootless-setuptool.sh,containerd-rootless.sh,containerd-shim-runc-v2,containerd-stargz-grpc,ctd-decoder,ctd-decoder,ctr,ctr-enc,ctr-remote,fuse-overlayfs,ipfs,nerdctl,rootlessctl,rootlesskit,runc,slirp4netns} \\\n/usr/local/lib/systemd/system/{buildkit.service,containerd.service,stargz-snapshotter.service} \\\n/usr/local/libexec/cni \\\n/usr/local/share/doc/{nerdctl,nerdctl-full}\n"})}),"\n",(0,c.jsx)(n.h3,{id:"22-\u5df2\u5b89\u88c5containerd",children:"2.2 \u5df2\u5b89\u88c5containerd"}),"\n",(0,c.jsx)(n.admonition,{title:"\u8bf4\u660e",type:"tip",children:(0,c.jsxs)(n.p,{children:["\u5982\u679c\u5df2\u7ecf\u5b89\u88c5\u8fc7\u4e86containerd\uff0c\u5219\u76f4\u63a5\u4e0b\u8f7d ",(0,c.jsx)(n.code,{children:"nerdctl-<VERSION\\>-linux-amd64.tar.gz"})]})}),"\n",(0,c.jsx)(n.h4,{id:"221-\u4e0b\u8f7d\u5305",children:"2.2.1 \u4e0b\u8f7d\u5305"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"export NERDCTL_VERSION=0.16.1\nwget https://github.com/containerd/nerdctl/releases/download/v${NERDCTL_VERSION}/nerdctl-${NERDCTL_VERSION}-linux-amd64.tar.gz\n"})}),"\n",(0,c.jsx)(n.h4,{id:"222-\u67e5\u770b\u5305\u5185\u5bb9",children:"2.2.2 \u67e5\u770b\u5305\u5185\u5bb9"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770b\u5305\u5185\u5bb9\uff0c\u89e3\u538b\u7f29\u540e\u662f2\u4e2ash\u6587\u4ef6\u548cnerdctl\u4e8c\u8fdb\u5236\u547d\u4ee4\n$ tar tf nerdctl-${NERDCTL_VERSION}-linux-amd64.tar.gz \nnerdctl\ncontainerd-rootless-setuptool.sh\ncontainerd-rootless.sh\n"})}),"\n",(0,c.jsx)(n.h4,{id:"223-\u89e3\u538b\u7f29\u5305",children:"2.2.3 \u89e3\u538b\u7f29\u5305"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"tar xf nerdctl-${NERDCTL_VERSION}-linux-amd64.tar.gz\n"})}),"\n",(0,c.jsxs)(n.h4,{id:"224-\u5bfc\u51fa-nerdctl-\u547d\u4ee4",children:["2.2.4 \u5bfc\u51fa ",(0,c.jsx)(n.code,{children:"nerdctl"})," \u547d\u4ee4"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"mv nerdctl /usr/local/bin\n"})}),"\n",(0,c.jsx)(n.h4,{id:"225-\u9a8c\u8bc1",children:"2.2.5 \u9a8c\u8bc1"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"$ nerdctl version\nClient:\n Version:\tv0.16.1\n Git commit:\tc4bd56b3aa220db037cc6c0a4e0c8cc062f2cc4c\n\nServer:\n containerd:\n  Version:\tv1.5.9\n  GitCommit:\t1407cab509ff0d96baa4f0eb6ff9980270e6e620\n"})}),"\n",(0,c.jsx)(n.h2,{id:"3nerdctl\u4f7f\u7528",children:"3.nerdctl\u4f7f\u7528"}),"\n",(0,c.jsx)(n.p,{children:"nerdctl\u4e0edocker\u547d\u4ee4\u51e0\u4e4e\u4e00\u81f4"}),"\n",(0,c.jsxs)(n.h3,{id:"31-\u6784\u5efa\u955c\u50cf-nerdctl-build",children:["3.1 \u6784\u5efa\u955c\u50cf ",(0,c.jsx)(n.code,{children:"nerdctl build"})]}),"\n",(0,c.jsx)(n.p,{children:"\u7f16\u8f91dockerfile"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-dockerfile",children:"cat > Dockerfile << EOF\nFROM nginx\nRUN echo 'hehe' > /usr/share/nginx/html/index.html\nEOF\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u6267\u884c\u6784\u5efa\uff0c\u53d1\u73b0\u6709\u62a5\u9519\uff0c\u9700\u8981\u6211\u4eec\u5b89\u88c5 ",(0,c.jsx)(n.code,{children:"buildctl"})," \u5e76\u8fd0\u884c ",(0,c.jsx)(n.code,{children:"buildkitd"}),"\uff0c\u8fd9\u662f\u56e0\u4e3a ",(0,c.jsx)(n.code,{children:"nerdctl build"})," \u9700\u8981\u4f9d\u8d56 ",(0,c.jsx)(n.a,{href:"https://github.com/moby/buildkit",children:"buildkit"})," \u5de5\u5177"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:'$ nerdctl build -t nginx:nerdctl -f Dockerfile .\nFATA[0000] `buildctl` needs to be installed and `buildkitd` needs to be running, see https://github.com/moby/buildkit: exec: "buildctl": executable file not found in $PATH \n'})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.a,{href:"https://github.com/moby/buildkit",children:"buildkit"})," \u9879\u76ee\u4e5f\u662f Docker \u516c\u53f8\u5f00\u6e90\u7684\u4e00\u4e2a\u6784\u5efa\u5de5\u5177\u5305\uff0c\u652f\u6301 OCI \u6807\u51c6\u7684\u955c\u50cf\u6784\u5efa\u3002\u5b83\u4e3b\u8981\u5305\u542b\u4ee5\u4e0b\u90e8\u5206:"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\u670d\u52a1\u7aef ",(0,c.jsx)(n.code,{children:"buildkitd"}),"\uff1a\u5f53\u524d\u652f\u6301 runc \u548c containerd \u4f5c\u4e3a worker\uff0c\u9ed8\u8ba4\u662f runc\uff0c\u6211\u4eec\u8fd9\u91cc\u4f7f\u7528 containerd"]}),"\n",(0,c.jsxs)(n.li,{children:["\u5ba2\u6237\u7aef ",(0,c.jsx)(n.code,{children:"buildctl"}),"\uff1a\u8d1f\u8d23\u89e3\u6790 Dockerfile\uff0c\u5e76\u5411\u670d\u52a1\u7aef buildkitd \u53d1\u51fa\u6784\u5efa\u8bf7\u6c42"]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["buildkit \u662f\u5178\u578b\u7684 C/S \u67b6\u6784\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u662f\u53ef\u4ee5\u4e0d\u5728\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\uff0c\u800c ",(0,c.jsx)(n.code,{children:"nerdctl"})," \u5728\u6784\u5efa\u955c\u50cf\u7684\u65f6\u5019\u4e5f\u4f5c\u4e3a ",(0,c.jsx)(n.code,{children:"buildkitd"})," \u7684\u5ba2\u6237\u7aef\uff0c\u6240\u4ee5\u9700\u8981\u6211\u4eec\u5b89\u88c5\u5e76\u8fd0\u884c ",(0,c.jsx)(n.code,{children:"buildkitd"})]}),"\n",(0,c.jsxs)(n.p,{children:["\u5b89\u88c5 ",(0,c.jsx)(n.code,{children:"buildkit"})]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"export BUILDKIT_VERSION=0.9.3\nwget https://github.com/moby/buildkit/releases/download/v${BUILDKIT_VERSION}/buildkit-v${BUILDKIT_VERSION}.linux-amd64.tar.gz\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u89e3\u538b\u7f29\u5305"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"tar xf buildkit-v${BUILDKIT_VERSION}.linux-amd64.tar.gz\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u89e3\u538b\u540e\u662f\u4e00\u4e2a ",(0,c.jsx)(n.code,{children:"bin"})," \u76ee\u5f55\uff0c"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"$ tree bin\nbin\n\u251c\u2500\u2500 buildctl\n\u251c\u2500\u2500 buildkitd\n\u251c\u2500\u2500 buildkit-qemu-aarch64\n\u251c\u2500\u2500 buildkit-qemu-arm\n\u251c\u2500\u2500 buildkit-qemu-i386\n\u251c\u2500\u2500 buildkit-qemu-mips64\n\u251c\u2500\u2500 buildkit-qemu-mips64el\n\u251c\u2500\u2500 buildkit-qemu-ppc64le\n\u251c\u2500\u2500 buildkit-qemu-riscv64\n\u251c\u2500\u2500 buildkit-qemu-s390x\n\u2514\u2500\u2500 buildkit-runc\n\n0 directories, 11 files\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u6211\u4eec\u9700\u89812\u4e2a\u547d\u4ee4 ",(0,c.jsx)(n.code,{children:"buildctl"})," \u3001",(0,c.jsx)(n.code,{children:"buildkitd"})]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"mv bin/{buildctl,buildkitd} /usr/local/bin/\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u9a8c\u8bc1"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"$ buildctl -v\nbuildctl github.com/moby/buildkit v0.9.3 8d2625494a6a3d413e3d875a2ff7dd9b1ed1b1a9\n\n$ buildkitd -v\nbuildkitd github.com/moby/buildkit v0.9.3 8d2625494a6a3d413e3d875a2ff7dd9b1ed1b1a9\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u4f7f\u7528 systemd \u7ba1\u7406 buildkitd"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"cat > /etc/systemd/system/buildkit.service << EOF\n[Unit]\nDescription=BuildKit\nDocumentation=https://github.com/moby/buildkit\n\n[Service]\nExecStart=/usr/local/bin/buildkitd --oci-worker=false --containerd-worker=true\n\n[Install]\nWantedBy=multi-user.target\nEOF\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u542f\u52a8 buildkit"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"systemctl daemon-reload && systemctl enable buildkit && systemctl start buildkit\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u67e5\u770b\u542f\u52a8\u72b6\u6001"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"$ systemctl status buildkit\n\u25cf buildkit.service - BuildKit\n   Loaded: loaded (/etc/systemd/system/buildkit.service; enabled; vendor preset: disabled)\n   Active: active (running) since Sat 2022-02-05 20:23:38 CST; 8s ago\n     Docs: https://github.com/moby/buildkit\n Main PID: 16599 (buildkitd)\n    Tasks: 6\n   Memory: 8.6M\n   CGroup: /system.slice/buildkit.service\n           \u2514\u250016599 /usr/local/bin/buildkitd --oci-worker=false --containerd-worker=true\n\nFeb 05 20:23:38 k8s-test systemd[1]: Started BuildKit.\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u518d\u6b21\u6784\u5efa"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"$ nerdctl build -t nginx:nerdctl -f Dockerfile .\n[+] Building 28.1s (6/6) FINISHED                                                                                                                       \n => [internal] load build definition from Dockerfile                                                                                               1.1s\n => => transferring dockerfile: 99B                                                                                                                0.0s\n => [internal] load .dockerignore                                                                                                                  1.0s\n => => transferring context: 2B                                                                                                                    0.0s\n => [internal] load metadata for docker.io/library/nginx:latest                                                                                    4.9s\n => [1/2] FROM docker.io/library/nginx@sha256:2834dc507516af02784808c5f48b7cbe38b8ed5d0f4837f16e78d00deb7e7767                                     5.9s\n => => resolve docker.io/library/nginx@sha256:2834dc507516af02784808c5f48b7cbe38b8ed5d0f4837f16e78d00deb7e7767                                     0.2s\n => => extracting sha256:5eb5b503b37671af16371272f9c5313a3e82f1d0756e14506704489ad9900803                                                          2.1s\n => => extracting sha256:1ae07ab881bd848493ad54c2ba32017f94d1d8dbfd0ba41b618f17e80f834a0f                                                          2.3s\n => => extracting sha256:78091884b7bea0fa918527207924e9993bcc21bf7f1c9687da40042ceca31ac9                                                          0.3s\n => => extracting sha256:091c283c6a66ad0edd2ab84cb10edacc00a1a7bc5277f5365c0d5c5457a75aff                                                          0.2s\n => => extracting sha256:55de5851019b8f65ed6e28120c6300e35e556689d021e4b3411c7f4e90a9704b                                                          0.2s\n => => extracting sha256:b559bad762bec166fd028483dd2a03f086d363ee827d8c98b7268112c508665a                                                          0.2s\n => [2/2] RUN echo 'hehe' > /usr/share/nginx/html/index.html                                                                                       5.8s\n => exporting to oci image format                                                                                                                  7.3s\n => => exporting layers                                                                                                                            1.7s\n => => exporting manifest sha256:4d1e59bbbfb8ee312290b9e377e6b116f7957ee623e2d38b0e75c99d1ba3ece4                                                  0.2s\n => => exporting config sha256:b3d0a6dd26eb0181ec1cc98d21b580fb61b96d656de91245d1ff342d9963a1e2                                                    0.2s\n => => sending tarball                                                                                                                             4.9s\nunpacking docker.io/library/nginx:nerdctl (sha256:4d1e59bbbfb8ee312290b9e377e6b116f7957ee623e2d38b0e75c99d1ba3ece4)...done\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u67e5\u770b\u6784\u5efa"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"$ nerdctl images\nREPOSITORY     TAG        IMAGE ID        CREATED           PLATFORM       SIZE\nnginx          nerdctl    4d1e59bbbfb8    29 seconds ago    linux/amd64    146.2 MiB\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u6839\u636e\u6784\u5efa\u7684\u955c\u50cf\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"$ nerdctl run -d -p 80:80 --name=nginx --restart=always nginx:nerdctl\n4476ea62f983e67108ccc1c208a2ac8aaa80af63d439e8d701ab1633d037e1f5\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u67e5\u770b\u542f\u52a8\u7684\u5bb9\u5668"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:'$ nerdctl ps -a\nCONTAINER ID    IMAGE                              COMMAND                   CREATED          STATUS    PORTS                 NAMES\n4476ea62f983    docker.io/library/nginx:nerdctl    "/docker-entrypoint.\u2026"    2 minutes ago    Up        0.0.0.0:80->80/tcp    nginx    \n'})}),"\n",(0,c.jsx)(n.p,{children:"\u8bbf\u95ee\u5bb9\u5668"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"$ curl 127.0.0.1:80\nhehe\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u8fd9\u6837\u6211\u4eec\u5c31\u4f7f\u7528 ",(0,c.jsx)(n.code,{children:"nerdctl + buildkitd"})," \u8f7b\u677e\u5b8c\u6210\u4e86\u5bb9\u5668\u955c\u50cf\u7684\u6784\u5efa\u3002\u5f53\u7136\u5982\u679c\u4f60\u8fd8\u60f3\u5728\u5355\u673a\u73af\u5883\u4e0b\u4f7f\u7528 Docker Compose\uff0c\u5728 containerd \u6a21\u5f0f\u4e0b\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528 ",(0,c.jsx)(n.code,{children:"nerdctl"})," \u6765\u517c\u5bb9\u8be5\u529f\u80fd\u3002\u540c\u6837\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ",(0,c.jsx)(n.code,{children:"nerdctl compose"}),"\u3001",(0,c.jsx)(n.code,{children:"nerdctl compose up"}),"\u3001",(0,c.jsx)(n.code,{children:"nerdctl compose logs"}),"\u3001",(0,c.jsx)(n.code,{children:"nerdctl compose build"}),"\u3001",(0,c.jsx)(n.code,{children:"nerdctl compose down"})," \u7b49\u547d\u4ee4\u6765\u7ba1\u7406 Compose \u670d\u52a1\u3002\u8fd9\u6837\u4f7f\u7528 containerd\u3001nerdctl \u7ed3\u5408 buildkit \u7b49\u5de5\u5177\u5c31\u5b8c\u5168\u53ef\u4ee5\u66ff\u4ee3 docker \u5728\u955c\u50cf\u6784\u5efa\u3001\u955c\u50cf\u5bb9\u5668\u65b9\u9762\u7684\u7ba1\u7406\u529f\u80fd\u4e86"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(o,{...e})}):o(e)}},28453:(e,n,d)=>{d.d(n,{R:()=>r,x:()=>t});var c=d(96540);const i={},l=c.createContext(i);function r(e){const n=c.useContext(l);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),c.createElement(l.Provider,{value:n},e.children)}}}]);