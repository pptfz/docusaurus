"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[3254],{97686:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>t,toc:()=>o});var r=n(74848),i=n(28453);const d={},l="CentOS7.5\u5b89\u88c5redis-5.0.7",t={id:"\u6570\u636e\u5e93/redis/CentOS7.5\u5b89\u88c5redis-5.0.7",title:"CentOS7.5\u5b89\u88c5redis-5.0.7",description:"[toc]",source:"@site/docs/\u6570\u636e\u5e93/redis/CentOS7.5\u5b89\u88c5redis-5.0.7.md",sourceDirName:"\u6570\u636e\u5e93/redis",slug:"/\u6570\u636e\u5e93/redis/CentOS7.5\u5b89\u88c5redis-5.0.7",permalink:"/docs/\u6570\u636e\u5e93/redis/CentOS7.5\u5b89\u88c5redis-5.0.7",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"mysql\u666e\u901a\u4e3b\u4ece\u590d\u5236",permalink:"/docs/\u6570\u636e\u5e93/mysql/mysql\u8fdb\u9636/mysql\u666e\u901a\u4e3b\u4ece\u590d\u5236"},next:{title:"redis\u5371\u9669\u547d\u4ee4",permalink:"/docs/\u6570\u636e\u5e93/redis/redis\u5371\u9669\u547d\u4ee4"}},c={},o=[{value:"1.\u4e0b\u8f7dredis",id:"1\u4e0b\u8f7dredis",level:2},{value:"2.\u7f16\u8bd1\u5b89\u88c5redis",id:"2\u7f16\u8bd1\u5b89\u88c5redis",level:2},{value:"2.1 \u89e3\u538b\u7f29\u5305",id:"21-\u89e3\u538b\u7f29\u5305",level:3},{value:"2.2 \u7f16\u8bd1\u5b89\u88c5",id:"22-\u7f16\u8bd1\u5b89\u88c5",level:3},{value:"2.3 \u6dfb\u52a0\u73af\u5883\u53d8\u91cf",id:"23-\u6dfb\u52a0\u73af\u5883\u53d8\u91cf",level:3},{value:"3.\u914d\u7f6eredis",id:"3\u914d\u7f6eredis",level:2},{value:"3.1 \u521b\u5efa\u76f8\u5173\u76ee\u5f55",id:"31-\u521b\u5efa\u76f8\u5173\u76ee\u5f55",level:3},{value:"3.2 \u521b\u5efaredis\u914d\u7f6e\u6587\u4ef6",id:"32-\u521b\u5efaredis\u914d\u7f6e\u6587\u4ef6",level:3},{value:"4.\u4f7f\u7528systemd\u7ba1\u7406redis",id:"4\u4f7f\u7528systemd\u7ba1\u7406redis",level:2},{value:"5.\u542f\u52a8redis",id:"5\u542f\u52a8redis",level:2},{value:"6.\u4f7f\u7528systemd\u7ba1\u7406redis\u9047\u5230\u7684\u95ee\u9898",id:"6\u4f7f\u7528systemd\u7ba1\u7406redis\u9047\u5230\u7684\u95ee\u9898",level:2},{value:"7.redis\u5b89\u5168\u914d\u7f6e",id:"7redis\u5b89\u5168\u914d\u7f6e",level:2}];function a(e){const s={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.p,{children:"[toc]"}),"\n",(0,r.jsx)(s.h1,{id:"centos75\u5b89\u88c5redis-507",children:"CentOS7.5\u5b89\u88c5redis-5.0.7"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://redis.io/",children:"redis\u5b98\u7f51"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://redis.io/download",children:"\u5b98\u7f51\u4e0b\u8f7d\u5730\u5740"})}),"\n",(0,r.jsx)(s.h2,{id:"1\u4e0b\u8f7dredis",children:"1.\u4e0b\u8f7dredis"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:"wget http://download.redis.io/releases/redis-5.0.7.tar.gz\n"})}),"\n",(0,r.jsx)(s.h2,{id:"2\u7f16\u8bd1\u5b89\u88c5redis",children:"2.\u7f16\u8bd1\u5b89\u88c5redis"}),"\n",(0,r.jsx)(s.h3,{id:"21-\u89e3\u538b\u7f29\u5305",children:"2.1 \u89e3\u538b\u7f29\u5305"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"tar xf redis-5.0.7.tar.gz -C /usr/local\n"})}),"\n",(0,r.jsx)(s.h3,{id:"22-\u7f16\u8bd1\u5b89\u88c5",children:"2.2 \u7f16\u8bd1\u5b89\u88c5"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"cd /usr/local/redis-5.0.7 \nmake\n"})}),"\n",(0,r.jsx)(s.h3,{id:"23-\u6dfb\u52a0\u73af\u5883\u53d8\u91cf",children:"2.3 \u6dfb\u52a0\u73af\u5883\u53d8\u91cf"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"cat > /etc/profile.d/redis.sh << 'EOF'\nexport PATH=\"/usr/local/redis-5.0.7/src:$PATH\"\nEOF\nsource /etc/profile\n"})}),"\n",(0,r.jsx)(s.h2,{id:"3\u914d\u7f6eredis",children:"3.\u914d\u7f6eredis"}),"\n",(0,r.jsx)(s.h3,{id:"31-\u521b\u5efa\u76f8\u5173\u76ee\u5f55",children:"3.1 \u521b\u5efa\u76f8\u5173\u76ee\u5f55"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"mkdir -p /etc/redis/6379\nmkdir -p /var/log/redis/6379\nmkdir -p /var/run/redis/6379\n"})}),"\n",(0,r.jsx)(s.h3,{id:"32-\u521b\u5efaredis\u914d\u7f6e\u6587\u4ef6",children:"3.2 \u521b\u5efaredis\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"cat >/etc/redis/6379/redis.conf << EOF\n# \u5b88\u62a4\u8fdb\u7a0b\u6a21\u5f0f\u542f\u52a8\ndaemonize yes\n\nport 6379\nlogfile /var/log/redis/6379/redis.log\npidfile /var/run/redis/redis_6379.pid\n\n# \u6301\u4e45\u5316\u6570\u636e\u6587\u4ef6\u5b58\u50a8\u4f4d\u7f6e\ndir /etc/redis/6379\n\n# RDB\u6301\u4e45\u5316\u6570\u636e\u6587\u4ef6\u540d\u79f0\ndbfilename dump.rdb\nEOF\n"})}),"\n",(0,r.jsx)(s.h2,{id:"4\u4f7f\u7528systemd\u7ba1\u7406redis",children:"4.\u4f7f\u7528systemd\u7ba1\u7406redis"}),"\n",(0,r.jsx)(s.admonition,{title:"\u8bf4\u660e",type:"tip",children:(0,r.jsxs)(s.p,{children:["\u8fd9\u8fb9\u5e76\u6ca1\u6709\u4f7f\u7528 ",(0,r.jsx)(s.code,{children:"ExecStop=/bin/kill -s QUIT $MAINPID"})," \u8fd9\u6837\u7684\u547d\u4ee4\u6765\u505c\u6b62redis, \u56e0\u4e3a\u4f7f\u7528\u8fd9\u4e2a\u8bed\u53e5\u5728\u8fd0\u884c",(0,r.jsx)(s.code,{children:"systemctl stop redis"}),"\u540e, redis\u5e76\u672a\u6267\u884c\u5173\u95ed\u52a8\u4f5c, \u800c\u662f\u76f4\u63a5\u9000\u51fa. \u8fd9\u65f6\u5019\u7528 ",(0,r.jsx)(s.code,{children:"systemctl status redis"})," \u67e5\u770b\u72b6\u6001\u662ffailed. \u53ea\u6709\u7528",(0,r.jsx)(s.code,{children:"ExecStop=/install_path/bin/redis-cli -p 16379 shutdown"})," \u624d\u80fd\u6b63\u786e\u505c\u6b62redis"]})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"cat >/usr/lib/systemd/system/redis.service<<'EOF'\n[Unit]\nDescription=Redis\nAfter=network.target\n \n[Service]\n# Type=forking\nPIDFile=/var/run/redis/redis_6379.pid\nExecStart=/usr/local/redis-5.0.7/src/redis-server /etc/redis/6379/redis.conf \nExecReload=/bin/kill -s HUP $MAINPID\nExecStop=/usr/local/redis-5.0.7/src/redis-cli -p 6379 shutdown\nPrivateTmp=true\n \n[Install]\nWantedBy=multi-user.target\nEOF\n"})}),"\n",(0,r.jsx)(s.h2,{id:"5\u542f\u52a8redis",children:"5.\u542f\u52a8redis"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"# \u91cd\u8f7d\u7cfb\u7edf\u670d\u52a1\nsystemctl daemon-reload\n\n# \u542f\u52a8redis\nsystemctl enable redis && systemctl start redis\n"})}),"\n",(0,r.jsx)(s.h2,{id:"6\u4f7f\u7528systemd\u7ba1\u7406redis\u9047\u5230\u7684\u95ee\u9898",children:"6.\u4f7f\u7528systemd\u7ba1\u7406redis\u9047\u5230\u7684\u95ee\u9898"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"\u95ee\u9898\u4e00\uff1a\u91cd\u8f7d\u7cfb\u7edf\u670d\u52a1\u540e\u542f\u52a8redis\u5361\u4f4f\u4e0d\u52a8"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"\u89e3\u51b3\u65b9\u6cd5"})}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsxs)(s.strong,{children:["\u6ce8\u91ca ",(0,r.jsx)(s.code,{children:"/usr/lib/systemd/system/redis.service"})," \u4e2d ",(0,r.jsx)(s.code,{children:"Type=forking"})," \u4e00\u9879"]})}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"\u7f51\u4e0a\u89e3\u91ca\u539f\u56e0"})}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"If set to forking, it is expected that the process configured with ExecStart= will call fork() as part of its start-up. The parent process is expected to exit when start-up is complete and all communication channels are set up. The child continues to run as the main daemon process. This is the behavior of traditional UNIX daemons. If this setting is used, it is recommended to also use the PIDFile= option, so that systemd can identify the main process of the daemon. systemd will proceed with starting follow-up units as soon as the parent process exits."})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"\u5982\u679c\u8bbe\u7f6e\u4e3afork\uff0c\u5219\u4f7f\u7528ExecStart=\u914d\u7f6e\u7684\u8fdb\u7a0b\u5c06\u8c03\u7528fork()\u4f5c\u4e3a\u542f\u52a8\u7684\u4e00\u90e8\u5206\u3002\u542f\u52a8\u5b8c\u6210\u5e76\u8bbe\u7f6e\u597d\u6240\u6709\u901a\u4fe1\u901a\u9053\u540e\uff0c\u7236\u8fdb\u7a0b\u5c06\u9000\u51fa\u3002\u5b50\u8fdb\u7a0b\u7ee7\u7eed\u4f5c\u4e3a\u4e3b\u5b88\u62a4\u8fdb\u7a0b\u8fd0\u884c\u3002\u8fd9\u662f\u4f20\u7edfUNIX\u5b88\u62a4\u8fdb\u7a0b\u7684\u884c\u4e3a\u3002\u5982\u679c\u4f7f\u7528\u4e86\u8be5\u8bbe\u7f6e\uff0c\u5efa\u8bae\u8fd8\u4f7f\u7528PIDFile=\u9009\u9879\uff0c\u4ee5\u4fbfsystemd\u80fd\u591f\u8bc6\u522b\u5b88\u62a4\u8fdb\u7a0b\u7684\u4e3b\u8fdb\u7a0b\u3002\u4e00\u65e6\u7236\u8fdb\u7a0b\u9000\u51fa\uff0csystemd\u5c06\u5f00\u59cb\u542f\u52a8\u540e\u7eed\u5355\u5143\u3002"})}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsxs)(s.strong,{children:["\u95ee\u9898\u4e8c\uff1apid\u539f\u5148\u8def\u5f84\u4e3a ",(0,r.jsx)(s.code,{children:"/var/run/redis_6379.pid"})," \uff0c\u62a5\u9519 ",(0,r.jsx)(s.code,{children:"Failed at step EXEC spawning /usr/local/redis-5.0.7/src: Permission denied"})]})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"\u89e3\u51b3\u65b9\u6cd5\uff1a"})}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsxs)(s.strong,{children:["\u5c06pid\u8def\u5f84\u6539\u4e3a ",(0,r.jsx)(s.code,{children:"/var/run/redis/redis_6379.pid"})," \u5c31\u53ef\u4ee5\u4e86\uff0c\u539f\u56e0\u672a\u77e5"]})}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"7redis\u5b89\u5168\u914d\u7f6e",children:"7.redis\u5b89\u5168\u914d\u7f6e"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"protected-mode\t\u4fdd\u62a4\u6a21\u5f0f\uff0c\u662f\u5426\u53ea\u5141\u8bb8\u672c\u5730\u8bbf\u95ee\uff0c\u9ed8\u8ba4\u662fyes"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"protected-mode no\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"bind\t\u6307\u5b9aIP\u8fdb\u884c\u76d1\u542c"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"bind 127.0.0.1\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"requirepass\t\u589e\u52a0\u5bc6\u7801"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"requirepass 1\n\n# \u8fde\u63a5\u65b9\u5f0f1\n$ redis-cli\n127.0.0.1:6379> set name xiaoming\n(error) NOAUTH Authentication required.\n127.0.0.1:6379> AUTH 1\nOK\n127.0.0.1:6379> set name xiaoming\nOK\n\n# \u8fde\u63a5\u65b9\u5f0f2\n$ redis-cli -a 1\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n127.0.0.1:6379> set name xiaoliang\nOK\n"})})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>t});var r=n(96540);const i={},d=r.createContext(i);function l(e){const s=r.useContext(d);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(d.Provider,{value:s},e.children)}}}]);