"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[5900],{44374:(n,e,c)=>{c.r(e),c.d(e,{assets:()=>o,contentTitle:()=>r,default:()=>p,frontMatter:()=>l,metadata:()=>t,toc:()=>d});var a=c(74848),s=c(28453);const l={},r="mysql\u7269\u7406\u5907\u4efd\txtrabackup",t={id:"\u6570\u636e\u5e93/mysql/mysql\u57fa\u7840/mysql\u7269\u7406\u5907\u4efd xtrabackup",title:"mysql\u7269\u7406\u5907\u4efd xtrabackup",description:"[toc]",source:"@site/docs/\u6570\u636e\u5e93/mysql/mysql\u57fa\u7840/mysql\u7269\u7406\u5907\u4efd xtrabackup.md",sourceDirName:"\u6570\u636e\u5e93/mysql/mysql\u57fa\u7840",slug:"/\u6570\u636e\u5e93/mysql/mysql\u57fa\u7840/mysql\u7269\u7406\u5907\u4efd xtrabackup",permalink:"/docs/\u6570\u636e\u5e93/mysql/mysql\u57fa\u7840/mysql\u7269\u7406\u5907\u4efd xtrabackup",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"mysql\u65e5\u5fd7",permalink:"/docs/\u6570\u636e\u5e93/mysql/mysql\u57fa\u7840/mysql\u65e5\u5fd7"},next:{title:"mysql\u8bbe\u7f6e\u5bc6\u7801\u53ca\u5fd8\u8bb0\u5bc6\u7801\u5982\u4f55\u89e3\u51b3",permalink:"/docs/\u6570\u636e\u5e93/mysql/mysql\u57fa\u7840/mysql\u8bbe\u7f6e\u5bc6\u7801\u53ca\u5fd8\u8bb0\u5bc6\u7801\u5982\u4f55\u89e3\u51b3"}},o={},d=[{value:"1.\u5b89\u88c5xtrabackup",id:"1\u5b89\u88c5xtrabackup",level:2},{value:"1.1 \u4e0b\u8f7d\u8f6f\u4ef6\u5305\u5e76\u5b89\u88c5",id:"11-\u4e0b\u8f7d\u8f6f\u4ef6\u5305\u5e76\u5b89\u88c5",level:3},{value:"1.2 \u67e5\u770b\u7248\u672c",id:"12-\u67e5\u770b\u7248\u672c",level:3},{value:"2.xtrabackup\u5168\u5907",id:"2xtrabackup\u5168\u5907",level:2},{value:"2.1 \u5168\u5907",id:"21-\u5168\u5907",level:3},{value:"2.1.1 \u5907\u4efd\u65b9\u6cd5\u4e00\t<code>xtrabackup --backup</code>",id:"211-\u5907\u4efd\u65b9\u6cd5\u4e00xtrabackup---backup",level:4},{value:"2.1.2 \u5907\u4efd\u65b9\u6cd5\u4e8c\t<code>innobackupex</code>",id:"212-\u5907\u4efd\u65b9\u6cd5\u4e8cinnobackupex",level:4},{value:"2.2 \u5168\u5907\u6062\u590d",id:"22-\u5168\u5907\u6062\u590d",level:3},{value:"2.2.1 \u67e5\u770b\u539f\u6709\u6570\u636e\u5e93",id:"221-\u67e5\u770b\u539f\u6709\u6570\u636e\u5e93",level:4},{value:"2.2.2 \u539f\u6709\u6570\u636e\u5e93\u4e2d\u7684\u8868",id:"222-\u539f\u6709\u6570\u636e\u5e93\u4e2d\u7684\u8868",level:4},{value:"2.2.3 \u8fdb\u884c\u5168\u5e93\u5907\u4efd",id:"223-\u8fdb\u884c\u5168\u5e93\u5907\u4efd",level:4},{value:"2.2.4 \u5220\u9664db1-3\u6570\u636e\u5e93",id:"224-\u5220\u9664db1-3\u6570\u636e\u5e93",level:4},{value:"2.2.5 \u5c06redo\u8fdb\u884c\u91cd\u505a\uff0c\u5df2\u63d0\u4ea4\u7684\u5199\u5230\u6570\u636e\u6587\u4ef6\uff0c\u672a\u63d0\u4ea4\u7684\u4f7f\u7528undo\u56de\u6eda\uff0c\u6a21\u62dfCSR\u7684\u8fc7\u7a0b",id:"225-\u5c06redo\u8fdb\u884c\u91cd\u505a\u5df2\u63d0\u4ea4\u7684\u5199\u5230\u6570\u636e\u6587\u4ef6\u672a\u63d0\u4ea4\u7684\u4f7f\u7528undo\u56de\u6eda\u6a21\u62dfcsr\u7684\u8fc7\u7a0b",level:4},{value:"2.2.6 \u505c\u6b62mysql\uff0c\u5220\u9664\u539f\u5148\u6570\u636e\u76ee\u5f55",id:"226-\u505c\u6b62mysql\u5220\u9664\u539f\u5148\u6570\u636e\u76ee\u5f55",level:4},{value:"2.2.7 \u5220\u9664\u539f\u5148\u6570\u636e\u76ee\u5f55\u6216\u8005\u4fee\u6539\u540d\u79f0",id:"227-\u5220\u9664\u539f\u5148\u6570\u636e\u76ee\u5f55\u6216\u8005\u4fee\u6539\u540d\u79f0",level:4},{value:"2.2.8 \u8fdb\u884c\u6570\u636e\u6062\u590d",id:"228-\u8fdb\u884c\u6570\u636e\u6062\u590d",level:4},{value:"2.2.9 \u7ed9\u6062\u590d\u7684\u76ee\u5f55\u91cd\u65b0\u6388\u6743\u6240\u6709\u8005\u4e3amysql",id:"229-\u7ed9\u6062\u590d\u7684\u76ee\u5f55\u91cd\u65b0\u6388\u6743\u6240\u6709\u8005\u4e3amysql",level:4},{value:"2.2.10 \u542f\u52a8mysql",id:"2210-\u542f\u52a8mysql",level:4},{value:"2.2.11 \u9a8c\u8bc1\u6570\u636e\u6062\u590d",id:"2211-\u9a8c\u8bc1\u6570\u636e\u6062\u590d",level:4},{value:"3.xtrabackup\u589e\u91cf\u5907\u4efd",id:"3xtrabackup\u589e\u91cf\u5907\u4efd",level:2},{value:"3.1 \u505a\u5168\u5907",id:"31-\u505a\u5168\u5907",level:3},{value:"3.2 \u5f00\u59cb\u589e\u91cf\u5907\u4efd",id:"32-\u5f00\u59cb\u589e\u91cf\u5907\u4efd",level:3},{value:"3.2.1 \u57fa\u4e8e\u5168\u5907\u7684\u7684\u589e\u5907",id:"321-\u57fa\u4e8e\u5168\u5907\u7684\u7684\u589e\u5907",level:4},{value:"3.2.1.1 \u63d2\u5165\u6570\u636e",id:"3211-\u63d2\u5165\u6570\u636e",level:5},{value:"3.2.1.2 \u6267\u884c\u589e\u5907\u547d\u4ee4",id:"3212-\u6267\u884c\u589e\u5907\u547d\u4ee4",level:5},{value:"3.2.1.3 \u589e\u5907\u5b8c\u6210\u67e5\u770b\u5907\u4efd\u7684\u6570\u636e\u76ee\u5f55\u5927\u5c0f",id:"3213-\u589e\u5907\u5b8c\u6210\u67e5\u770b\u5907\u4efd\u7684\u6570\u636e\u76ee\u5f55\u5927\u5c0f",level:5},{value:"3.2.1.4 \u5168\u5907\u7684<code>xtrabackup_checkpoints</code>\u4e0e\u589e\u5907\u7684<code>xtrabackup_checkpoints</code>\u6587\u4ef6\u5bf9\u6bd4",id:"3214-\u5168\u5907\u7684xtrabackup_checkpoints\u4e0e\u589e\u5907\u7684xtrabackup_checkpoints\u6587\u4ef6\u5bf9\u6bd4",level:5},{value:"3.2.2 \u57fa\u4e8e\u589e\u5907\u7684\u589e\u5907",id:"322-\u57fa\u4e8e\u589e\u5907\u7684\u589e\u5907",level:4},{value:"3.2.2.1 \u63d2\u5165\u6570\u636e",id:"3221-\u63d2\u5165\u6570\u636e",level:5},{value:"3.2.2.2 \u6267\u884c\u589e\u5907\u547d\u4ee4",id:"3222-\u6267\u884c\u589e\u5907\u547d\u4ee4",level:5},{value:"3.2.2.3 \u589e\u5907\u5b8c\u6210\u67e5\u770b\u5907\u4efd\u7684\u6570\u636e\u76ee\u5f55\u5927\u5c0f",id:"3223-\u589e\u5907\u5b8c\u6210\u67e5\u770b\u5907\u4efd\u7684\u6570\u636e\u76ee\u5f55\u5927\u5c0f",level:5},{value:"3.2.2.4 \u57fa\u4e8e\u589e\u5907\u7684<code>xtrabackup_checkpoints</code>\u4e0e\u589e\u5907\u7684<code>xtrabackup_checkpoints</code>\u6587\u4ef6\u5bf9\u6bd4",id:"3224-\u57fa\u4e8e\u589e\u5907\u7684xtrabackup_checkpoints\u4e0e\u589e\u5907\u7684xtrabackup_checkpoints\u6587\u4ef6\u5bf9\u6bd4",level:5},{value:"3.3 \u589e\u5907\u6062\u590d",id:"33-\u589e\u5907\u6062\u590d",level:3},{value:"3.3.1 \u5148\u51c6\u5907\u4e00\u4e2a\u5168\u5907",id:"331-\u5148\u51c6\u5907\u4e00\u4e2a\u5168\u5907",level:4},{value:"3.3.2 \u5c06\u589e\u59071\u5e94\u7528\u5230\u5168\u5907\u4efd",id:"332-\u5c06\u589e\u59071\u5e94\u7528\u5230\u5168\u5907\u4efd",level:4},{value:"3.3.3 \u5c06\u589e\u59072\u5e94\u7528\u5230\u5168\u5907",id:"333-\u5c06\u589e\u59072\u5e94\u7528\u5230\u5168\u5907",level:4},{value:"3.3.4 \u628a\u6240\u6709\u5408\u5728\u4e00\u8d77\u7684\u5b8c\u5168\u5907\u4efd\u6574\u4f53\u8fdb\u884c\u4e00\u6b21apply\u64cd\u4f5c\uff0c\u56de\u6eda\u672a\u63d0\u4ea4\u7684\u6570\u636e",id:"334-\u628a\u6240\u6709\u5408\u5728\u4e00\u8d77\u7684\u5b8c\u5168\u5907\u4efd\u6574\u4f53\u8fdb\u884c\u4e00\u6b21apply\u64cd\u4f5c\u56de\u6eda\u672a\u63d0\u4ea4\u7684\u6570\u636e",level:4},{value:"3.3.5 \u5220\u9664db1-3\u6570\u636e\u5e93",id:"335-\u5220\u9664db1-3\u6570\u636e\u5e93",level:4},{value:"3.3.6 \u505c\u6b62mysql\uff0c\u5220\u9664\u539f\u5148\u6570\u636e\u76ee\u5f55",id:"336-\u505c\u6b62mysql\u5220\u9664\u539f\u5148\u6570\u636e\u76ee\u5f55",level:4},{value:"3.3.7 \u5220\u9664\u539f\u5148\u6570\u636e\u76ee\u5f55\u6216\u8005\u4fee\u6539\u540d\u79f0",id:"337-\u5220\u9664\u539f\u5148\u6570\u636e\u76ee\u5f55\u6216\u8005\u4fee\u6539\u540d\u79f0",level:4},{value:"3.3.8 \u8fdb\u884c\u6570\u636e\u6062\u590d",id:"338-\u8fdb\u884c\u6570\u636e\u6062\u590d",level:4},{value:"3.3.9 \u7ed9\u6062\u590d\u7684\u76ee\u5f55\u91cd\u65b0\u6388\u6743\u6240\u6709\u8005\u4e3amysql",id:"339-\u7ed9\u6062\u590d\u7684\u76ee\u5f55\u91cd\u65b0\u6388\u6743\u6240\u6709\u8005\u4e3amysql",level:4},{value:"3.3.10 \u542f\u52a8mysql",id:"3310-\u542f\u52a8mysql",level:4},{value:"3.3.11 \u9a8c\u8bc1\u6570\u636e\u6062\u590d",id:"3311-\u9a8c\u8bc1\u6570\u636e\u6062\u590d",level:4},{value:"4.\u5907\u4efd\u811a\u672c",id:"4\u5907\u4efd\u811a\u672c",level:2}];function i(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.p,{children:"[toc]"}),"\n",(0,a.jsx)(e.h1,{id:"mysql\u7269\u7406\u5907\u4efdxtrabackup",children:"mysql\u7269\u7406\u5907\u4efd\txtrabackup"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://github.com/percona/percona-xtrabackup",children:"xtrabackup github\u5730\u5740"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://www.percona.com/doc/percona-xtrabackup/2.4/index.html",children:"xtrabackup2.4\u5b98\u65b9\u6587\u6863"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://www.percona.com/doc/percona-xtrabackup/8.0/index.html",children:"xtrabackup8.0\u5b98\u65b9\u6587\u6863"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://www.percona.com/downloads/Percona-XtraBackup-2.4/LATEST/",children:"xtrabackup2.4\u5b98\u65b9\u4e0b\u8f7d\u5730\u5740"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://www.percona.com/downloads/Percona-XtraBackup-LATEST/",children:"xtrabackup8.0\u5b98\u65b9\u4e0b\u8f7d\u5730\u5740"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"xtrabackup\u5907\u4efd\u65b9\u5f0f\uff08\u7269\u7406\u5907\u4efd\uff09"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsx)(e.p,{children:"\u5bf9\u4e8e\u975einnodb\u8868\uff08\u6bd4\u5982myisam\uff09\u662f\u76f4\u63a5\u9501\u8868cp\u6570\u636e\u6587\u4ef6\uff0c\u5c5e\u4e8e\u4e00\u79cd\u6e29\u5907"}),"\n"]}),"\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsx)(e.p,{children:"\u5bf9\u4e8einnodb\u7684\u8868\uff08\u652f\u6301\u4e8b\u52a1\uff09\uff0c\u4e0d\u9501\u8868\uff0ccp\u6570\u636e\u9875\u6700\u7ec8\u4ee5\u6570\u636e\u6587\u4ef6\u65b9\u5f0f\u4fdd\u5b58\u4e0b\u6765\uff0c\u5e76\u4e14\u628aredo\u548cundo\u4e00\u5e76\u5907\u8d70\uff0c\u5c5e\u4e8e\u70ed\u5907\u65b9\u5f0f"}),"\n"]}),"\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsxs)(e.p,{children:["\u5907\u4efd\u65f6\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6 ",(0,a.jsx)(e.code,{children:"/etc/my.cnf"})]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(e.h2,{id:"1\u5b89\u88c5xtrabackup",children:"1.\u5b89\u88c5xtrabackup"}),"\n",(0,a.jsx)(e.h3,{id:"11-\u4e0b\u8f7d\u8f6f\u4ef6\u5305\u5e76\u5b89\u88c5",children:"1.1 \u4e0b\u8f7d\u8f6f\u4ef6\u5305\u5e76\u5b89\u88c5"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"wget https://www.percona.com/downloads/Percona-XtraBackup-2.4/Percona-XtraBackup-2.4.20/binary/redhat/7/x86_64/percona-xtrabackup-24-2.4.20-1.el7.x86_64.rpm\n\nyum -y localinstall percona-xtrabackup-24-2.4.20-1.el7.x86_64.rpm\n"})}),"\n",(0,a.jsx)(e.h3,{id:"12-\u67e5\u770b\u7248\u672c",children:"1.2 \u67e5\u770b\u7248\u672c"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"$ xtrabackup -v\nxtrabackup: recognized server arguments: --datadir=/usr/local/mysql/data --server-id=1 --log_bin=binlog\nxtrabackup version 2.4.20 based on MySQL server 5.7.26 Linux (x86_64) (revision id: c8b4056)\n"})}),"\n",(0,a.jsx)(e.h2,{id:"2xtrabackup\u5168\u5907",children:"2.xtrabackup\u5168\u5907"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"xtrabackup"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsx)(e.p,{children:"xtrabackup\u53ef\u4ee5\u5728\u4e0d\u52a0\u9501\u7684\u60c5\u51b5\u4e0b\u5907\u4efdinnodb\u6570\u636e\u8868\uff0c\u4e0d\u8fc7\u6b64\u5de5\u5177\u4e0d\u80fd\u64cd\u4f5cmyisam\u3002"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"innobackupex"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"innobackupex\u662f\u4e00\u4e2a\u5c01\u88c5\u4e86xtrabackup\u7684\u811a\u672c\uff0c\u80fd\u540c\u65f6\u5904\u7406innodb\u548cmyisam\uff0c\u4f46\u5728\u5904\u7406myisam\u65f6\u9700\u8981\u52a0\u4e00\u4e2a\u8bfb\u9501\u3002"}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u5229\u7528\u5b58\u50a8\u8fc7\u7a0b\u751f\u6210\u5927\u91cf\u6570\u636e"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"db1\u3001db2\u6bcf\u4e2a\u5e93\u4e2d\u6709\u4e24\u5f20\u8868\uff0c\u6bcf\u5f20\u886810\u4e07\u6761\u6570\u636e"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"#1.\u521b\u5efa\u6570\u636e\u5e93\nmysql> create database db1;\nQuery OK, 1 row affected (0.00 sec)\n\n#2.\u521b\u5efa\u8868\nmysql> use db1;\nDatabase changed\n\nmysql> create table db1_t1(\n    id int,\n    name varchar(20),\n    gender char(6),\n    email varchar(50),\n    first_name char(10),\n    last_name char(10)\n    );\nQuery OK, 0 rows affected (0.01 sec)\n\n#3.\u521b\u5efa\u5b58\u50a8\u8fc7\u7a0b\nmysql> delimiter $$ #\u58f0\u660e\u5b58\u50a8\u8fc7\u7a0b\u7684\u7ed3\u675f\u7b26\u53f7\u4e3a$$\nmysql> create procedure auto_insert1()\n    BEGIN\n        declare i int default 1;\n        while(i<100001)do\t#\u63d2\u516510\u4e07\u6761\u6570\u636e\n            insert into db1_t1 values(i,'xboyww','man',concat( 'xboyww',i,'@qq'),concat('a',i),concat('b',i));\n            set i=i+1;\n        end while;\n    END$$ #$$\u7ed3\u675f\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> delimiter ; #\u91cd\u65b0\u58f0\u660e\u5206\u53f7\u4e3a\u7ed3\u675f\u7b26\u53f7\uff0c\u6ce8\u610f\u6709\u7a7a\u683c\n\n\n#4.\u67e5\u770b\u5b58\u50a8\u8fc7\u7a0b\nshow create procedure auto_insert1\\G\n\n#5.\u8c03\u7528\u5b58\u50a8\u8fc7\u7a0b\ncall auto_insert1();\n\n#6.\u67e5\u770b\u6570\u636e\nmysql> select count(*) from s1;\n+----------+\n| count(*) |\n+----------+\n|   100000 |\n+----------+\n1 row in set (0.04 sec)\n\nmysql> select * from s1 limit 10;\n+------+--------+--------+-------------+------------+-----------+\n| id   | name   | gender | email       | first_name | last_name |\n+------+--------+--------+-------------+------------+-----------+\n|    1 | xboyww | man    | xboyww1@qq  | a1         | b1        |\n|    2 | xboyww | man    | xboyww2@qq  | a2         | b2        |\n|    3 | xboyww | man    | xboyww3@qq  | a3         | b3        |\n|    4 | xboyww | man    | xboyww4@qq  | a4         | b4        |\n|    5 | xboyww | man    | xboyww5@qq  | a5         | b5        |\n|    6 | xboyww | man    | xboyww6@qq  | a6         | b6        |\n|    7 | xboyww | man    | xboyww7@qq  | a7         | b7        |\n|    8 | xboyww | man    | xboyww8@qq  | a8         | b8        |\n|    9 | xboyww | man    | xboyww9@qq  | a9         | b9        |\n|   10 | xboyww | man    | xboyww10@qq | a10        | b10       |\n+------+--------+--------+-------------+------------+-----------+\n10 rows in set (0.00 sec)\n\n\n#\u5220\u9664\u5b58\u50a8\u8fc7\u7a0b\nDROP PROCEDURE auto_insert1;\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"db3\uff0c\u4e00\u5f20\u8868\uff0c\u4e24\u6761\u6570\u636e"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-mysql",children:"mysql> create database db3;\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> create table t3(id int,name char(10)) engine=myisam;\nQuery OK, 0 rows affected (0.01 sec)\n\nmysql> insert into t3 values(1,'xiaoming'),(2,'xiaohong');\nQuery OK, 2 rows affected (0.00 sec)\nRecords: 2  Duplicates: 0  Warnings: 0\n\nmysql> select * from t3;\n+------+----------+\n| id   | name     |\n+------+----------+\n|    1 | xiaoming |\n|    2 | xiaohong |\n+------+----------+\n2 rows in set (0.00 sec)\n"})}),"\n",(0,a.jsx)(e.h3,{id:"21-\u5168\u5907",children:"2.1 \u5168\u5907"}),"\n",(0,a.jsxs)(e.h4,{id:"211-\u5907\u4efd\u65b9\u6cd5\u4e00xtrabackup---backup",children:["2.1.1 \u5907\u4efd\u65b9\u6cd5\u4e00\t",(0,a.jsx)(e.code,{children:"xtrabackup --backup"})]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://www.percona.com/doc/percona-xtrabackup/2.4/xtrabackup_bin/xbk_option_reference.html",children:"xtrabackup2.4 xtrabackup\u9009\u9879"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u6267\u884c\u5907\u4efd\u547d\u4ee4"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"xtrabackup -uroot -p --backup --target-dir=/data/backups/\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsxs)(e.strong,{children:[(0,a.jsx)(e.code,{children:"/data/backups"}),"\u5907\u4efd\u76ee\u5f55\u4e0b\u7684\u5185\u5bb9"]})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"$ ll\n\u603b\u7528\u91cf 12340\n-rw-r----- 1 root root      487 7\u6708   2 22:43 backup-my.cnf\ndrwxr-x--- 2 root root       92 7\u6708   2 22:43 db1\ndrwxr-x--- 2 root root       92 7\u6708   2 22:43 db2\ndrwxr-x--- 2 root root       62 7\u6708   2 22:43 db3\n-rw-r----- 1 root root      646 7\u6708   2 22:43 ib_buffer_pool\n-rw-r----- 1 root root 12582912 7\u6708   2 22:43 ibdata1\ndrwxr-x--- 2 root root     4096 7\u6708   2 22:43 mysql\ndrwxr-x--- 2 root root     8192 7\u6708   2 22:43 performance_schema\ndrwxr-x--- 2 root root     8192 7\u6708   2 22:43 sys\n-rw-r----- 1 root root       19 7\u6708   2 22:43 xtrabackup_binlog_info\n-rw-r----- 1 root root      141 7\u6708   2 22:43 xtrabackup_checkpoints\n-rw-r----- 1 root root      474 7\u6708   2 22:43 xtrabackup_info\n-rw-r----- 1 root root     2560 7\u6708   2 22:43 xtrabackup_logfile\n"})}),"\n",(0,a.jsxs)(e.h4,{id:"212-\u5907\u4efd\u65b9\u6cd5\u4e8cinnobackupex",children:["2.1.2 \u5907\u4efd\u65b9\u6cd5\u4e8c\t",(0,a.jsx)(e.code,{children:"innobackupex"})]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://www.percona.com/doc/percona-xtrabackup/2.4/innobackupex/innobackupex_option_reference.html",children:"xtrabackup2.4 innobackupex\u9009\u9879"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u6267\u884c\u5907\u4efd\u547d\u4ee4"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:"-S /var/lib/mysql/mysql.sock"})}),"\n",(0,a.jsxs)(e.p,{children:["-S\u9009\u9879\u53ef\u4ee5\u4e0d\u52a0\uff0c\u4f1a\u4ecemysql\u914d\u7f6e\u6587\u4ef6",(0,a.jsx)(e.code,{children:"/etc/my.cnf"}),"\u4e2d\u8bfb\u53d6sock\u6587\u4ef6\u4f4d\u7f6e"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"innobackupex -uroot -p1 /backup\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsxs)(e.strong,{children:["\u5907\u4efd\u5b8c\u6210\u540e\u4f1a\u5728",(0,a.jsx)(e.code,{children:"/backup"}),"\u76ee\u5f55\u4e0b\u751f\u6210\u4e00\u4e2a\u4ee5\u65f6\u95f4\u547d\u4ee4\u5e76\u7cbe\u786e\u5230\u79d2\u7684\u76ee\u5f55"]})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"$ ls\n2020-07-02_22-57-09\n\n$ cd 2020-07-02_22-57-09/\n$ ll\n\u603b\u7528\u91cf 12340\n-rw-r----- 1 root root      487 7\u6708   2 22:57 backup-my.cnf\ndrwxr-x--- 2 root root       92 7\u6708   2 22:57 db1\ndrwxr-x--- 2 root root       92 7\u6708   2 22:57 db2\ndrwxr-x--- 2 root root       62 7\u6708   2 22:57 db3\n-rw-r----- 1 root root      646 7\u6708   2 22:57 ib_buffer_pool\n-rw-r----- 1 root root 12582912 7\u6708   2 22:57 ibdata1\ndrwxr-x--- 2 root root     4096 7\u6708   2 22:57 mysql\ndrwxr-x--- 2 root root     8192 7\u6708   2 22:57 performance_schema\ndrwxr-x--- 2 root root     8192 7\u6708   2 22:57 sys\n-rw-r----- 1 root root       19 7\u6708   2 22:57 xtrabackup_binlog_info\n-rw-r----- 1 root root      141 7\u6708   2 22:57 xtrabackup_checkpoints\n-rw-r----- 1 root root      494 7\u6708   2 22:57 xtrabackup_info\n-rw-r----- 1 root root     2560 7\u6708   2 22:57 xtrabackup_logfile\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsxs)(e.strong,{children:["\u5982\u679c\u60f3\u8981\u81ea\u4e3b\u547d\u540d\u5907\u4efd\u76ee\u5f55\u7684\u8bdd\uff0c\u9700\u8981\u52a0\u53c2\u6570",(0,a.jsx)(e.code,{children:"--no-timestamp"})]})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"innobackupex -uroot -p1 --no-timestamp /backup/bak\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsxs)(e.strong,{children:["\u5728\u5907\u4efd\u76ee\u5f55\u4e0b\u4f1a\u6709\u4e00\u4e2a\u6587\u4ef6",(0,a.jsx)(e.code,{children:"xtrabackup_binlog_info"}),"\uff0c\u8fd9\u4e2a\u6587\u4ef6\u8bb0\u5f55\u4e86binlog\u6587\u4ef6\u540d\u548cbinlog\u7684\u4f4d\u7f6e\u70b9"]})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"$ cat xtrabackup_binlog_info \nbinlog.000009\t1061\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsxs)(e.strong,{children:["\u5728\u5907\u4efd\u76ee\u5f55\u4f1a\u6709\u4e00\u4e2a\u6587\u4ef6",(0,a.jsx)(e.code,{children:"xtrabackup_info "}),"\uff0c\u8fd9\u4e2a\u6587\u4ef6\u8bb0\u5f55\u4e86\u5907\u4efd\u4fe1\u606f\u6c47\u603b"]})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"$ cat xtrabackup_info \nuuid = c47c158f-bc74-11ea-82fa-001c42f33c78\nname = \ntool_name = innobackupex\ntool_command = --user=root --password=... --no-timestamp /backup/bak\ntool_version = 2.4.20\nibbackup_version = 2.4.20\nserver_version = 5.7.28-log\nstart_time = 2020-07-02 23:00:27\nend_time = 2020-07-02 23:00:28\nlock_time = 0\nbinlog_pos = filename 'binlog.000009', position '1061'\ninnodb_from_lsn = 0\ninnodb_to_lsn = 332706000\npartial = N\nincremental = N\nformat = file\ncompact = N\ncompressed = N\nencrypted = N\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsxs)(e.strong,{children:["\u5728\u5907\u4efd\u76ee\u5f55\u4e0b\u4f1a\u6709\u4e00\u4e2a\u6587\u4ef6",(0,a.jsx)(e.code,{children:"xtrabackup_logfile"}),"\uff0c\u8fd9\u4e2a\u6587\u4ef6\u662f\u5907\u4efd\u7684redo_log\u6587\u4ef6"]})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"$ ll xtrabackup_logfile \n-rw-r----- 1 root root 2560 7\u6708   2 23:00 xtrabackup_logfile\n"})}),"\n",(0,a.jsx)(e.h3,{id:"22-\u5168\u5907\u6062\u590d",children:"2.2 \u5168\u5907\u6062\u590d"}),"\n",(0,a.jsx)(e.h4,{id:"221-\u67e5\u770b\u539f\u6709\u6570\u636e\u5e93",children:"2.2.1 \u67e5\u770b\u539f\u6709\u6570\u636e\u5e93"}),"\n",(0,a.jsx)(e.p,{children:"\u67093\u4e2a\u5e93(db1\uff0cdb2\uff0cdb3)\uff0c"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-mysql",children:"mysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| db1                |\n| db2                |\n| db3                |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n7 rows in set (0.00 sec)\n"})}),"\n",(0,a.jsx)(e.h4,{id:"222-\u539f\u6709\u6570\u636e\u5e93\u4e2d\u7684\u8868",children:"2.2.2 \u539f\u6709\u6570\u636e\u5e93\u4e2d\u7684\u8868"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"#db1\uff0c\u6709\u4e24\u5f20\u8868\uff0c\u6bcf\u5f20\u8868\u4e2d\u670910\u4e07\u6761\u6570\u636e\nmysql> use db1;\nmysql> show tables;\n+---------------+\n| Tables_in_db1 |\n+---------------+\n| db1_t1        |\n| db1_t2        |\n+---------------+\n2 rows in set (0.00 sec)\n\nmysql> select count(*) from db1_t1;\n+----------+\n| count(*) |\n+----------+\n|   100000 |\n+----------+\n1 row in set (0.04 sec)\n\nmysql> select count(*) from db1_t2;\n+----------+\n| count(*) |\n+----------+\n|   100000 |\n+----------+\n1 row in set (0.04 sec)\n\n\n#db2\uff0c\u6709\u4e24\u5f20\u8868\uff0c\u6bcf\u5f20\u8868\u4e2d\u670910\u4e07\u6761\u6570\u636e\nmysql> use db1;\nmysql> show tables;\n+---------------+\n| Tables_in_db2 |\n+---------------+\n| db2_t1        |\n| db2_t2        |\n+---------------+\n2 rows in set (0.00 sec)\n\nmysql> select count(*) from db2_t1;\n+----------+\n| count(*) |\n+----------+\n|   100000 |\n+----------+\n1 row in set (0.04 sec)\n\nmysql> select count(*) from db2_t2;\n+----------+\n| count(*) |\n+----------+\n|   100000 |\n+----------+\n1 row in set (0.03 sec)\n\n\n#db3\uff0c\u67091\u5f20\u8868\uff0c\u8868\u4e2d2\u884c\u6570\u636e\nmysql> use db3;\nmysql> show tables;\n+---------------+\n| Tables_in_db3 |\n+---------------+\n| t3            |\n+---------------+\n1 row in set (0.00 sec)\n\nmysql> select count(*) from t3;\n+----------+\n| count(*) |\n+----------+\n|        2 |\n+----------+\n1 row in set (0.00 sec)\n"})}),"\n",(0,a.jsx)(e.h4,{id:"223-\u8fdb\u884c\u5168\u5e93\u5907\u4efd",children:"2.2.3 \u8fdb\u884c\u5168\u5e93\u5907\u4efd"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"innobackupex -uroot -p1 --no-timestamp /backup/bak\n"})}),"\n",(0,a.jsx)(e.h4,{id:"224-\u5220\u9664db1-3\u6570\u636e\u5e93",children:"2.2.4 \u5220\u9664db1-3\u6570\u636e\u5e93"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-mysql",children:"mysql> drop database db1;\nQuery OK, 2 rows affected (0.00 sec)\n\nmysql> drop database db2;\nQuery OK, 2 rows affected (0.01 sec)\n\nmysql> drop database db3;\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n4 rows in set (0.00 sec)\n"})}),"\n",(0,a.jsx)(e.h4,{id:"225-\u5c06redo\u8fdb\u884c\u91cd\u505a\u5df2\u63d0\u4ea4\u7684\u5199\u5230\u6570\u636e\u6587\u4ef6\u672a\u63d0\u4ea4\u7684\u4f7f\u7528undo\u56de\u6eda\u6a21\u62dfcsr\u7684\u8fc7\u7a0b",children:"2.2.5 \u5c06redo\u8fdb\u884c\u91cd\u505a\uff0c\u5df2\u63d0\u4ea4\u7684\u5199\u5230\u6570\u636e\u6587\u4ef6\uff0c\u672a\u63d0\u4ea4\u7684\u4f7f\u7528undo\u56de\u6eda\uff0c\u6a21\u62dfCSR\u7684\u8fc7\u7a0b"}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"--apply-log"}),"\u53c2\u6570\u7684\u4f5c\u7528\u662f\u5e94\u7528 BACKUP-DIR \u4e2d\u7684 ",(0,a.jsx)(e.code,{children:"xtrabackup_logfile"}),' \u4e8b\u52a1\u65e5\u5fd7\u6587\u4ef6\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5728\u5907\u4efd\u5b8c\u6210\u540e\uff0c\u6570\u636e\u5c1a\u4e14\u4e0d\u80fd\u7528\u4e8e\u6062\u590d\u64cd\u4f5c\uff0c\u56e0\u4e3a\u5907\u4efd\u7684\u6570\u636e\u4e2d\u53ef\u80fd\u4f1a\u5305\u542b\u5c1a\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1\u6216\u5df2\u7ecf\u63d0\u4ea4\u4f46\u5c1a\u672a\u540c\u6b65\u81f3\u6570\u636e\u6587\u4ef6\u4e2d\u7684\u4e8b\u52a1\u3002\u56e0\u6b64\uff0c\u6b64\u65f6\u6570\u636e\u6587\u4ef6\u4ecd\u5904\u4e8e\u4e0d\u4e00\u81f4\u72b6\u6001\u3002"\u51c6\u5907"\u7684\u4e3b\u8981\u4f5c\u7528\u6b63\u662f\u901a\u8fc7\u56de\u6eda\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1\u53ca\u540c\u6b65\u5df2\u7ecf\u63d0\u4ea4\u7684\u4e8b\u52a1\u81f3\u6570\u636e\u6587\u4ef6\u4f7f\u5f97\u6570\u636e\u6587\u4ef6\u5904\u4e8e\u4e00\u81f4\u6027\u72b6\u6001\u3002']}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"innobackupex -uroot -p1 --apply-log /backup/bak\n"})}),"\n",(0,a.jsx)(e.h4,{id:"226-\u505c\u6b62mysql\u5220\u9664\u539f\u5148\u6570\u636e\u76ee\u5f55",children:"2.2.6 \u505c\u6b62mysql\uff0c\u5220\u9664\u539f\u5148\u6570\u636e\u76ee\u5f55"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u505c\u6b62mysql"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"$ /etc/init.d/mysqld stop\nShutting down MySQL.... SUCCESS! \n"})}),"\n",(0,a.jsx)(e.h4,{id:"227-\u5220\u9664\u539f\u5148\u6570\u636e\u76ee\u5f55\u6216\u8005\u4fee\u6539\u540d\u79f0",children:"2.2.7 \u5220\u9664\u539f\u5148\u6570\u636e\u76ee\u5f55\u6216\u8005\u4fee\u6539\u540d\u79f0"}),"\n",(0,a.jsx)(e.admonition,{type:"tip",children:(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u6062\u590d\u6570\u636e\u4e4b\u524d\u9700\u8981\u4fdd\u8bc1\u6570\u636e\u76ee\u5f55\u662f\u7a7a\u7684\u72b6\u6001"})})}),"\n",(0,a.jsxs)(e.p,{children:["mysql\u5b89\u88c5\u7684\u6570\u636e\u76ee\u5f55\u4e3a ",(0,a.jsx)(e.code,{children:"/usr/local/mysql/data"})]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"# \u5982\u679c\u505a\u5220\u9664\u64cd\u4f5c\uff0c\u6700\u597d\u5148\u5907\u4efd\u7136\u540e\u518d\u5220\u9664\uff0c\u867d\u7136\u6570\u636e\u5df2\u7ecf\u4e22\u5931\u4e00\u90e8\u5206\uff0c\u8fd9\u91cc\u9009\u62e9\u4fee\u6539\u76ee\u5f55\u540d\u79f0\nmv /usr/local/mysql/data{,-bak}\n"})}),"\n",(0,a.jsx)(e.h4,{id:"228-\u8fdb\u884c\u6570\u636e\u6062\u590d",children:"2.2.8 \u8fdb\u884c\u6570\u636e\u6062\u590d"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsxs)(e.strong,{children:["\u8fd9\u91cc\u8981\u6ce8\u610f\uff0c\u6062\u590d\u7684\u65f6\u5019mysql\u914d\u7f6e\u6587\u4ef6",(0,a.jsx)(e.code,{children:"[mysqld]"}),"\u4e0b\u4e00\u5b9a\u8981\u6307\u5b9amysql data\u76ee\u5f55"]})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"innobackupex -uroot -p1 --copy-back /backup/bak\n\u6216\nxtrabackup -uroot p1 --copy-back --target-dir=/backup/bak\n"})}),"\n",(0,a.jsx)(e.h4,{id:"229-\u7ed9\u6062\u590d\u7684\u76ee\u5f55\u91cd\u65b0\u6388\u6743\u6240\u6709\u8005\u4e3amysql",children:"2.2.9 \u7ed9\u6062\u590d\u7684\u76ee\u5f55\u91cd\u65b0\u6388\u6743\u6240\u6709\u8005\u4e3amysql"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"chown -R mysql.mysql /usr/local/mysql/data\n"})}),"\n",(0,a.jsx)(e.h4,{id:"2210-\u542f\u52a8mysql",children:"2.2.10 \u542f\u52a8mysql"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"$ /etc/init.d/mysqld start\nStarting MySQL.Logging to '/usr/local/mysql/data/error.log'.\n. SUCCESS! \n"})}),"\n",(0,a.jsx)(e.h4,{id:"2211-\u9a8c\u8bc1\u6570\u636e\u6062\u590d",children:"2.2.11 \u9a8c\u8bc1\u6570\u636e\u6062\u590d"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u9a8c\u8bc1\u6570\u636e\u5e93\u662f\u5426\u8fd8\u539f"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"mysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| db1                |\n| db2                |\n| db3                |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n7 rows in set (0.00 sec)\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u9a8c\u8bc1\u8868\u4e2d\u7684\u6570\u636e\u662f\u5426\u8fd8\u539f"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"#db1\uff0c\u6709\u4e24\u5f20\u8868\uff0c\u6bcf\u5f20\u8868\u4e2d\u670910\u4e07\u6761\u6570\u636e\nmysql> use db1;\nmysql> show tables;\n+---------------+\n| Tables_in_db1 |\n+---------------+\n| db1_t1        |\n| db1_t2        |\n+---------------+\n2 rows in set (0.00 sec)\n\nmysql> select count(*) from db1_t1;\n+----------+\n| count(*) |\n+----------+\n|   100000 |\n+----------+\n1 row in set (0.04 sec)\n\nmysql> select count(*) from db1_t2;\n+----------+\n| count(*) |\n+----------+\n|   100000 |\n+----------+\n1 row in set (0.04 sec)\n\n\n#db2\uff0c\u6709\u4e24\u5f20\u8868\uff0c\u6bcf\u5f20\u8868\u4e2d\u670910\u4e07\u6761\u6570\u636e\nmysql> use db1;\nmysql> show tables;\n+---------------+\n| Tables_in_db2 |\n+---------------+\n| db2_t1        |\n| db2_t2        |\n+---------------+\n2 rows in set (0.00 sec)\n\nmysql> select count(*) from db2_t1;\n+----------+\n| count(*) |\n+----------+\n|   100000 |\n+----------+\n1 row in set (0.04 sec)\n\nmysql> select count(*) from db2_t2;\n+----------+\n| count(*) |\n+----------+\n|   100000 |\n+----------+\n1 row in set (0.03 sec)\n\n\n#db3\uff0c\u67091\u5f20\u8868\uff0c\u8868\u4e2d2\u884c\u6570\u636e\nmysql> use db3;\nmysql> show tables;\n+---------------+\n| Tables_in_db3 |\n+---------------+\n| t3            |\n+---------------+\n1 row in set (0.00 sec)\n\nmysql> select count(*) from t3;\n+----------+\n| count(*) |\n+----------+\n|        2 |\n+----------+\n1 row in set (0.00 sec)\n"})}),"\n",(0,a.jsx)(e.h2,{id:"3xtrabackup\u589e\u91cf\u5907\u4efd",children:"3.xtrabackup\u589e\u91cf\u5907\u4efd"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://www.percona.com/doc/percona-xtrabackup/2.4/backup_scenarios/incremental_backup.html",children:"xtrabackup2.4 \u589e\u91cf\u5907\u4efd\u5b98\u65b9\u6587\u6863"})}),"\n",(0,a.jsx)(e.h3,{id:"31-\u505a\u5168\u5907",children:"3.1 \u505a\u5168\u5907"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"db1\u3001db2\u3001db3\u6570\u636e\u5e93\u53ca\u8868\u6570\u636e\u8bf4\u660e"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"$ tree db1 db2 db3\ndb1\t#\u4e24\u5f20\u8868\uff0c\u6bcf\u5f20\u8868\u4e2d10\u4e07\u6761\u6570\u636e\n\u251c\u2500\u2500 db1_t1.frm\n\u251c\u2500\u2500 db1_t1.ibd\n\u251c\u2500\u2500 db1_t2.frm\n\u251c\u2500\u2500 db1_t2.ibd\n\u2514\u2500\u2500 db.opt\ndb2\t#\u4e24\u5f20\u8868\uff0c\u6bcf\u5f20\u8868\u4e2d10\u4e07\u6761\u6570\u636e\n\u251c\u2500\u2500 db2_t1.frm\n\u251c\u2500\u2500 db2_t1.ibd\n\u251c\u2500\u2500 db2_t2.frm\n\u251c\u2500\u2500 db2_t2.ibd\n\u2514\u2500\u2500 db.opt\ndb3\t#\u4e00\u5f20\u8868\uff0c2\u6761\u6570\u636e\n\u251c\u2500\u2500 db.opt\n\u251c\u2500\u2500 t3.frm\n\u251c\u2500\u2500 t3.MYD\n\u2514\u2500\u2500 t3.MYI\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u5220\u9664\u4e4b\u524d\u7684\u5168\u5907\uff0c\u91cd\u65b0\u505a\u5168\u5907"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"innobackupex -uroot -p1 --no-timestamp /backup/bak\n\u6216\nxtrabackup -uroot -p --backup --target-dir=/backup/bak\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsxs)(e.strong,{children:["\u5728\u5907\u4efd\u76ee\u5f55",(0,a.jsx)(e.code,{children:"/backup/bak"}),"\u4e2d\u6709\u4e00\u4e2a\u6587\u4ef6",(0,a.jsx)(e.code,{children:"xtrabackup_checkpoints"}),"\uff0c\u8fd9\u4e2a\u6587\u4ef6\u8bb0\u5f55\u4e86\u5907\u4efd\u7c7b\u578b\u3001lsn(\u65e5\u5fd7\u5e8f\u5217\u53f7)"]})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"$ cat xtrabackup_checkpoints \nbackup_type = full-backuped\nfrom_lsn = 0\nto_lsn = 332706875\nlast_lsn = 332706884\ncompact = 0\nrecover_binlog_info = 0\nflushed_lsn = 332706884\n"})}),"\n",(0,a.jsx)(e.h3,{id:"32-\u5f00\u59cb\u589e\u91cf\u5907\u4efd",children:"3.2 \u5f00\u59cb\u589e\u91cf\u5907\u4efd"}),"\n",(0,a.jsx)(e.h4,{id:"321-\u57fa\u4e8e\u5168\u5907\u7684\u7684\u589e\u5907",children:"3.2.1 \u57fa\u4e8e\u5168\u5907\u7684\u7684\u589e\u5907"}),"\n",(0,a.jsxs)(e.p,{children:["\u5f00\u59cb\u7b2c\u4e00\u6b21\u589e\u5907\uff0c\u53ea\u8981\u5168\u5907\u548c\u591a\u4e2a\u589e\u5907\u7684LSN\u53f7\u8fde\u7eed\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u9010\u4e2a\u8fdb\u884c\u6062\u590d\u3002\u53ef\u4ee5\u5728\u5907\u4efd\u76ee\u5f55",(0,a.jsx)(e.code,{children:"xtrabackup_checkpoints"}),"\u6587\u4ef6\u4e2d\u770b\u5230\uff0c",(0,a.jsxs)(e.strong,{children:["\u5176\u4e2d\u5168\u5907\u7684",(0,a.jsx)(e.code,{children:"from_lsn=0"}),",\u589e\u5907\u7684",(0,a.jsx)(e.code,{children:"from_lsn"}),"\u5e94\u8be5\u7b49\u4e8e\u4e0a\u4e00\u4e2a\u589e\u5907\u6216\u8005\u5168\u5907\u7684",(0,a.jsx)(e.code,{children:"to_lsn"})]})]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"$ cat xtrabackup_checkpoints \nbackup_type = full-backuped\nfrom_lsn = 0\nto_lsn = 332706875\nlast_lsn = 332706884\ncompact = 0\nrecover_binlog_info = 0\nflushed_lsn = 332706884\n"})}),"\n",(0,a.jsx)(e.h5,{id:"3211-\u63d2\u5165\u6570\u636e",children:"3.2.1.1 \u63d2\u5165\u6570\u636e"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"db1\u3001db2\u3001db3\u6bcf\u4e2a\u6570\u636e\u5e93\u4e2d\u7684\u8868\u90fd\u63d2\u5165\u4e00\u6761\u6570\u636e"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-mysql",children:"#db1\nmysql> insert into db1_t1 values(100001,'xboyww','man',concat( 'xboyww',100001,'@qq'),concat('a',100001),concat('b',100001));\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> insert into db1_t2 values(100001,'xboyww','man',concat( 'xboyww',100001,'@qq'),concat('a',100001),concat('b',100001));\nQuery OK, 1 row affected (0.00 sec)\n\n\n#db2\nmysql> insert into db2_t1 values(100001,'xboyww','man',concat( 'xboyww',100001,'@qq'),concat('a',100001),concat('b',100001));\nQuery OK, 1 row affected (0.01 sec)\n\nmysql> insert into db2_t2 values(100001,'xboyww','man',concat( 'xboyww',100001,'@qq'),concat('a',100001),concat('b',100001));\nQuery OK, 1 row affected (0.00 sec)\n\n\n#db3\nmysql> insert into t3 values(3,'dabai');\nQuery OK, 1 row affected (0.00 sec)\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u67e5\u770b\u6bcf\u5f20\u8868\u7684\u6570\u636e"})}),"\n",(0,a.jsx)(e.p,{children:"\u6bcf\u5f20\u8868\u90fd\u5728\u539f\u5148\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u4e00\u884c\u6570\u636e"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"#db1\u7684\u4e24\u5f20\u8868\nmysql> select count(*) from db1_t1;\n+----------+\n| count(*) |\n+----------+\n|   100001 |\n+----------+\n1 row in set (0.03 sec)\n\nmysql> select count(*) from db1_t2;\n+----------+\n| count(*) |\n+----------+\n|   100001 |\n+----------+\n1 row in set (0.04 sec)\n\n#db2\u7684\u4e24\u5f20\u8868\nmysql> select count(*) from db2_t1;\n+----------+\n| count(*) |\n+----------+\n|   100001 |\n+----------+\n1 row in set (0.04 sec)\n\nmysql> select count(*) from db2_t2;\n+----------+\n| count(*) |\n+----------+\n|   100001 |\n+----------+\n1 row in set (0.04 sec)\n\n#db3\u7684\u4e00\u5f20\u8868\nmysql> select count(*) from t3;\n+----------+\n| count(*) |\n+----------+\n|        3 |\n+----------+\n1 row in set (0.00 sec)\n"})}),"\n",(0,a.jsx)(e.h5,{id:"3212-\u6267\u884c\u589e\u5907\u547d\u4ee4",children:"3.2.1.2 \u6267\u884c\u589e\u5907\u547d\u4ee4"}),"\n",(0,a.jsxs)(e.p,{children:["\u589e\u5907\u5c31\u662f\u5728\u5168\u5907\u7684\u547d\u4ee4\u57fa\u7840\u4e0a\u52a0\u4e00\u4e2a\u53c2\u6570",(0,a.jsx)(e.code,{children:"--incremental-basedir="}),"\u6307\u5b9a\u589e\u5907\u7684\u76ee\u5f55"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"innobackupex -uroot -p1 --no-timestamp --incremental /backup/bak_incr1 --incremental-basedir=/backup/bak\n\u6216\nxtrabackup -uroot -p1 --backup --target-dir=/backup/bak_incr1 --incremental-basedir=/backup/bak\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u8bf4\u660e\uff1a"}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"--incremental-basedir"}),"\u662f\u4e0a\u6b21\u5168\u5907\u6216\u8005\u589e\u5907\u51fa\u6765\u7684\u6587\u4ef6\u5939\u3002\u5f53\u7b2c\u4e00\u6b21\u589e\u5907\u7684\u65f6\u5019\uff0c\u4e00\u822c\u586b\u4e0a\u6b21\u5168\u5907\uff0c\u7b2c\u4e8c\u6b21\u589e\u5907\u7684\u65f6\u5019\uff0c\u5982\u679c",(0,a.jsx)(e.code,{children:"--incremental-basedir"}),"\u586b\u4e0a\u6b21\u5168\u5907\uff0c\u90a3\u4e48\u672c\u6b21\u589e\u5907\u5c31\u4f1a\u5305\u542b\u4e0a\u6b21\u5168\u5907\u5230\u73b0\u5728\u53d8\u5316\u7684\u5185\u5bb9\uff0c\u76f8\u5f53\u4e8eoracle\u4f9d\u6b21\u505a1\u7ea7\uff0c2\u7ea7\uff0c3\u7ea7\u3002\u3002\u3002\u589e\u5907\u5982\u679c",(0,a.jsx)(e.code,{children:"--incremental-basedir"}),"\u586b\u7b2c\u4e00\u6b21\u589e\u5907\u7684\u76ee\u5f55\uff0c\u90a3\u4e48\u8be5\u6b21\u589e\u5907\u53ea\u5305\u542b\u7b2c\u4e00\u6b21\u589e\u5907\u5230\u73b0\u5728\u7684\u53d8\u5316\uff0c\u6587\u4ef6\u4f1a\u66f4\u5c0f\uff0c\u76f8\u5f53\u4e8eoracle rman\u91cc\u9762\u6bcf\u6b21\u90fd\u505a1\u7ea7\u589e\u5907\u3002"]}),"\n",(0,a.jsx)(e.h5,{id:"3213-\u589e\u5907\u5b8c\u6210\u67e5\u770b\u5907\u4efd\u7684\u6570\u636e\u76ee\u5f55\u5927\u5c0f",children:"3.2.1.3 \u589e\u5907\u5b8c\u6210\u67e5\u770b\u5907\u4efd\u7684\u6570\u636e\u76ee\u5f55\u5927\u5c0f"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"$ pwd\n/backup\n$ du -sh *\n90M\tbak\n3.2M\tbak_incr1\n\n\n#\u5168\u5907\u7684\u6570\u636e\u5927\u5c0f\n$ du -sh *\n4.0K\tbackup-my.cnf\n33M\tdb1\n33M\tdb2\n24K\tdb3\n4.0K\tib_buffer_pool\n12M\tibdata1\n12M\tmysql\n1.1M\tperformance_schema\n680K\tsys\n4.0K\txtrabackup_binlog_info\n4.0K\txtrabackup_checkpoints\n4.0K\txtrabackup_info\n4.0K\txtrabackup_logfile\n\n#\u589e\u5907\u7684\u6570\u636e\u5927\u5c0f\n$ du -sh *\n4.0K\tbackup-my.cnf\n100K\tdb1\n100K\tdb2\n24K\tdb3\n4.0K\tib_buffer_pool\n176K\tibdata1.delta\n4.0K\tibdata1.meta\n1.2M\tmysql\n1.1M\tperformance_schema\n604K\tsys\n4.0K\txtrabackup_binlog_info\n4.0K\txtrabackup_checkpoints\n4.0K\txtrabackup_info\n4.0K\txtrabackup_logfile\n"})}),"\n",(0,a.jsxs)(e.h5,{id:"3214-\u5168\u5907\u7684xtrabackup_checkpoints\u4e0e\u589e\u5907\u7684xtrabackup_checkpoints\u6587\u4ef6\u5bf9\u6bd4",children:["3.2.1.4 \u5168\u5907\u7684",(0,a.jsx)(e.code,{children:"xtrabackup_checkpoints"}),"\u4e0e\u589e\u5907\u7684",(0,a.jsx)(e.code,{children:"xtrabackup_checkpoints"}),"\u6587\u4ef6\u5bf9\u6bd4"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsxs)(e.strong,{children:["\u53ef\u4ee5\u770b\u5230\u589e\u5907\u4e2d\u7684 ",(0,a.jsx)(e.code,{children:"from_lsn = 332706875"})," \u4e0e\u5168\u5907\u4e2d\u7684",(0,a.jsx)(e.code,{children:"to_lsn = 332706875"})," \u662f\u76f8\u540c\u7684"]})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"#\u5168\u5907\n$ cat xtrabackup_checkpoints \nbackup_type = full-backuped\nfrom_lsn = 0\nto_lsn = 332706875\nlast_lsn = 332706884\ncompact = 0\nrecover_binlog_info = 0\nflushed_lsn = 332706884\n\n\n#\u589e\u5907\n$ cat xtrabackup_checkpoints \nbackup_type = incremental\nfrom_lsn = 332706875\nto_lsn = 332708551\nlast_lsn = 332708560\ncompact = 0\nrecover_binlog_info = 0\nflushed_lsn = 332708560\n"})}),"\n",(0,a.jsx)(e.h4,{id:"322-\u57fa\u4e8e\u589e\u5907\u7684\u589e\u5907",children:"3.2.2 \u57fa\u4e8e\u589e\u5907\u7684\u589e\u5907"}),"\n",(0,a.jsx)(e.h5,{id:"3221-\u63d2\u5165\u6570\u636e",children:"3.2.2.1 \u63d2\u5165\u6570\u636e"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"db1\u3001db2\u3001db3\u6bcf\u4e2a\u6570\u636e\u5e93\u4e2d\u7684\u8868\u90fd\u63d2\u5165\u4e00\u6761\u6570\u636e"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-mysql",children:"#db1\nmysql> insert into db1_t1 values(100002,'xboyww','man',concat( 'xboyww',100002,'@qq'),concat('a',100002),concat('b',100002));\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> insert into db1_t2 values(100002,'xboyww','man',concat( 'xboyww',100002,'@qq'),concat('a',100002),concat('b',100002));\nQuery OK, 1 row affected (0.00 sec)\n\n\n#db2\nmysql> insert into db2_t1 values(100002,'xboyww','man',concat( 'xboyww',100002,'@qq'),concat('a',100002),concat('b',100002));\nQuery OK, 1 row affected (0.01 sec)\n\nmysql> insert into db2_t2 values(100002,'xboyww','man',concat( 'xboyww',100002,'@qq'),concat('a',100002),concat('b',100002));\nQuery OK, 1 row affected (0.00 sec)\n\n\n#db3\nmysql> insert into t3 values(4,'xixixi');\nQuery OK, 1 row affected (0.00 sec)\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u67e5\u770b\u6bcf\u5f20\u8868\u7684\u6570\u636e"})}),"\n",(0,a.jsx)(e.p,{children:"\u6bcf\u5f20\u8868\u90fd\u5728\u539f\u5148\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u4e00\u884c\u6570\u636e"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"#db1\u7684\u4e24\u5f20\u8868\nmysql> select count(*) from db1_t1;\n+----------+\n| count(*) |\n+----------+\n|   100002 |\n+----------+\n1 row in set (0.03 sec)\n\nmysql> select count(*) from db1_t2;\n+----------+\n| count(*) |\n+----------+\n|   100002 |\n+----------+\n1 row in set (0.04 sec)\n\n#db2\u7684\u4e24\u5f20\u8868\nmysql> select count(*) from db2_t1;\n+----------+\n| count(*) |\n+----------+\n|   100002 |\n+----------+\n1 row in set (0.04 sec)\n\nmysql> select count(*) from db2_t2;\n+----------+\n| count(*) |\n+----------+\n|   100002 |\n+----------+\n1 row in set (0.04 sec)\n\n#db3\u7684\u4e00\u5f20\u8868\nmysql> select count(*) from t3;\n+----------+\n| count(*) |\n+----------+\n|        4 |\n+----------+\n1 row in set (0.00 sec)\n"})}),"\n",(0,a.jsx)(e.h5,{id:"3222-\u6267\u884c\u589e\u5907\u547d\u4ee4",children:"3.2.2.2 \u6267\u884c\u589e\u5907\u547d\u4ee4"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"innobackupex -uroot -p1  --no-timestamp --incremental /backup/bak_incr2 --incremental-basedir=/backup/bak_incr1\n\u6216\nxtrabackup -uroot -p1 --backup --target-dir=/backup/bak_incr2 --incremental-basedir=/backup/bak_incr1\n"})}),"\n",(0,a.jsx)(e.h5,{id:"3223-\u589e\u5907\u5b8c\u6210\u67e5\u770b\u5907\u4efd\u7684\u6570\u636e\u76ee\u5f55\u5927\u5c0f",children:"3.2.2.3 \u589e\u5907\u5b8c\u6210\u67e5\u770b\u5907\u4efd\u7684\u6570\u636e\u76ee\u5f55\u5927\u5c0f"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"$ pwd\n/backup\n$ du -sh *\n90M\tbak\n3.2M\tbak_incr1\n3.2M\tbak_incr2\n\n#\u7b2c\u4e00\u6b21\u589e\u5907\u7684\u6570\u636e\u5927\u5c0f\n$ du -sh *\n4.0K\tbackup-my.cnf\n100K\tdb1\n100K\tdb2\n24K\tdb3\n4.0K\tib_buffer_pool\n176K\tibdata1.delta\n4.0K\tibdata1.meta\n1.2M\tmysql\n1.1M\tperformance_schema\n604K\tsys\n4.0K\txtrabackup_binlog_info\n4.0K\txtrabackup_checkpoints\n4.0K\txtrabackup_info\n4.0K\txtrabackup_logfile\n\n\n#\u57fa\u4e8e\u589e\u5907\u7684\u6570\u636e\u5927\u5c0f\ndu -sh *\n4.0K\tbackup-my.cnf\n100K\tdb1\n100K\tdb2\n24K\tdb3\n4.0K\tib_buffer_pool\n144K\tibdata1.delta\n4.0K\tibdata1.meta\n1.2M\tmysql\n1.1M\tperformance_schema\n604K\tsys\n4.0K\txtrabackup_binlog_info\n4.0K\txtrabackup_checkpoints\n4.0K\txtrabackup_info\n4.0K\txtrabackup_logfile\n"})}),"\n",(0,a.jsxs)(e.h5,{id:"3224-\u57fa\u4e8e\u589e\u5907\u7684xtrabackup_checkpoints\u4e0e\u589e\u5907\u7684xtrabackup_checkpoints\u6587\u4ef6\u5bf9\u6bd4",children:["3.2.2.4 \u57fa\u4e8e\u589e\u5907\u7684",(0,a.jsx)(e.code,{children:"xtrabackup_checkpoints"}),"\u4e0e\u589e\u5907\u7684",(0,a.jsx)(e.code,{children:"xtrabackup_checkpoints"}),"\u6587\u4ef6\u5bf9\u6bd4"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsxs)(e.strong,{children:["\u4e4b\u524d\u589e\u5907\u4e2d\u7684",(0,a.jsx)(e.code,{children:"from_lsn = 332706875"}),"\u4e0e\u5168\u5907\u4e2d\u7684",(0,a.jsx)(e.code,{children:"to_lsn = 332706875"}),"\u662f\u76f8\u540c\u7684"]})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsxs)(e.strong,{children:["\u57fa\u4e8e\u589e\u5907\u7684\u589e\u5907",(0,a.jsx)(e.code,{children:"from_lsn = 332708551"}),"\u4e0e\u57fa\u4e8e\u5168\u5907\u7684\u589e\u5907\u4e2d\u7684",(0,a.jsx)(e.code,{children:"to_lsn = 332708551"}),"\u662f\u76f8\u540c\u7684"]})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"#\u57fa\u4e8e\u5168\u5907\u7684\u589e\u5907\n$ cat xtrabackup_checkpoints \nbackup_type = incremental\nfrom_lsn = 332706875\nto_lsn = 332708551\nlast_lsn = 332708560\ncompact = 0\nrecover_binlog_info = 0\nflushed_lsn = 332708560\n\n\n#\u57fa\u4e8e\u589e\u5907\u7684\u589e\u5907\u4efd\n$ cat xtrabackup_checkpoints \nbackup_type = incremental\nfrom_lsn = 332708551\nto_lsn = 332710179\nlast_lsn = 332710188\ncompact = 0\nrecover_binlog_info = 0\nflushed_lsn = 332710188\n"})}),"\n",(0,a.jsx)(e.h3,{id:"33-\u589e\u5907\u6062\u590d",children:"3.3 \u589e\u5907\u6062\u590d"}),"\n",(0,a.jsx)(e.h4,{id:"331-\u5148\u51c6\u5907\u4e00\u4e2a\u5168\u5907",children:"3.3.1 \u5148\u51c6\u5907\u4e00\u4e2a\u5168\u5907"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"innobackupex -uroot -p1 --apply-log --redo-only /backup/bak\n\u6216\nxtrabackup -uroot -p --backup --target-dir=/backup/bak\n"})}),"\n",(0,a.jsx)(e.h4,{id:"332-\u5c06\u589e\u59071\u5e94\u7528\u5230\u5168\u5907\u4efd",children:"3.3.2 \u5c06\u589e\u59071\u5e94\u7528\u5230\u5168\u5907\u4efd"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsxs)(e.strong,{children:["\u589e\u59071\u5c31\u662f\u57fa\u4e8e\u5168\u5907\u7684\u589e\u5907\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e00\u6b21\u589e\u5907",(0,a.jsxs)("span",{style:{color:"red"},children:["\u26a0\ufe0f\u8fd9\u91cc\u8981\u52a0",(0,a.jsx)(e.code,{children:"--redo-only"}),"\u53c2\u6570"]})]})}),"\n",(0,a.jsxs)(e.p,{children:["\u8fd9\u6b21\u8981\u52a0\u5165",(0,a.jsx)(e.code,{children:"--redo-only"}),"\u53c2\u6570\uff0c\u56e0\u4e3a\u5728\u6bcf\u4e2a\u5907\u4efd\u8fc7\u7a0b\u4e2d\uff0c\u90fd\u4f1a\u78b0\u5230\u4e00\u4e9b\u4e8b\u52a1\u8fdb\u6765\u6267\u884c\uff0c\u800c\u5907\u4efd\u7ed3\u675f\u65f6\u53ef\u80fd\u6709\u4e9b\u4e8b\u52a1\u5e76\u6ca1\u6709\u6267\u884c\u5b8c\u6bd5\uff0c\u6240\u4ee5\u5728\u9ed8\u8ba4prepare\u4e2d\u8fd9\u4e9b\u4e8b\u52a1\u5c31\u4f1a\u88ab\u56de\u6eda\uff08rollback\uff09\uff0c\u800c\u52a0\u5165\u4e86",(0,a.jsx)(e.code,{children:"--redo-only"}),"\u5c31\u4e0d\u4f1a\u56de\u6eda\u8fd9\u4e9b\u4e8b\u52a1\uff0c\u800c\u662f\u7b49\u5f85prepare\u4e0b\u6b21\u589e\u5907\u3002"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"innobackupex -uroot -p1 --apply-log --redo-only /backup/bak --incremental-dir=/backup/bak_incr1\n\u6216\nxtrabackup -uroot -p1 --prepare --apply-log-only --target-dir=/backup/bak --incremental-dir=/backup/bak_incr1\n"})}),"\n",(0,a.jsx)(e.h4,{id:"333-\u5c06\u589e\u59072\u5e94\u7528\u5230\u5168\u5907",children:"3.3.3 \u5c06\u589e\u59072\u5e94\u7528\u5230\u5168\u5907"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsxs)(e.strong,{children:["\u589e\u59072\u5c31\u662f\u57fa\u4e8e\u589e\u5907\u7684\u589e\u5907\uff0c",(0,a.jsxs)("span",{style:{color:"red"},children:["\u26a0\ufe0f\u8fd9\u91cc\u4e0d\u8981\u52a0",(0,a.jsx)(e.code,{children:"--redo-only"}),"\u53c2\u6570"]})]})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"innobackupex -uroot -p1 --apply-log /backup/bak --incremental-dir=/backup/bak_incr2\n\u6216\nxtrabackup -uroot -p1 --prepare --target-dir=/backup/bak --incremental-dir=/backup/bak_incr2\n"})}),"\n",(0,a.jsx)(e.h4,{id:"334-\u628a\u6240\u6709\u5408\u5728\u4e00\u8d77\u7684\u5b8c\u5168\u5907\u4efd\u6574\u4f53\u8fdb\u884c\u4e00\u6b21apply\u64cd\u4f5c\u56de\u6eda\u672a\u63d0\u4ea4\u7684\u6570\u636e",children:"3.3.4 \u628a\u6240\u6709\u5408\u5728\u4e00\u8d77\u7684\u5b8c\u5168\u5907\u4efd\u6574\u4f53\u8fdb\u884c\u4e00\u6b21apply\u64cd\u4f5c\uff0c\u56de\u6eda\u672a\u63d0\u4ea4\u7684\u6570\u636e"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"innobackupex -uroot -p1 --apply-log /backup/bak\n\u6216\nxtrabackup --prepare --apply-log --target-dir=/backup/bak\n"})}),"\n",(0,a.jsx)(e.h4,{id:"335-\u5220\u9664db1-3\u6570\u636e\u5e93",children:"3.3.5 \u5220\u9664db1-3\u6570\u636e\u5e93"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-mysql",children:"mysql> drop database db1;\nQuery OK, 2 rows affected (0.00 sec)\n\nmysql> drop database db2;\nQuery OK, 2 rows affected (0.01 sec)\n\nmysql> drop database db3;\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n4 rows in set (0.00 sec)\n"})}),"\n",(0,a.jsx)(e.h4,{id:"336-\u505c\u6b62mysql\u5220\u9664\u539f\u5148\u6570\u636e\u76ee\u5f55",children:"3.3.6 \u505c\u6b62mysql\uff0c\u5220\u9664\u539f\u5148\u6570\u636e\u76ee\u5f55"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u505c\u6b62mysql"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"$ /etc/init.d/mysqld stop\nShutting down MySQL.... SUCCESS! \n"})}),"\n",(0,a.jsx)(e.h4,{id:"337-\u5220\u9664\u539f\u5148\u6570\u636e\u76ee\u5f55\u6216\u8005\u4fee\u6539\u540d\u79f0",children:"3.3.7 \u5220\u9664\u539f\u5148\u6570\u636e\u76ee\u5f55\u6216\u8005\u4fee\u6539\u540d\u79f0"}),"\n",(0,a.jsx)(e.admonition,{type:"tip",children:(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u6062\u590d\u6570\u636e\u4e4b\u524d\u9700\u8981\u4fdd\u8bc1\u6570\u636e\u76ee\u5f55\u662f\u7a7a\u7684\u72b6\u6001"})})}),"\n",(0,a.jsxs)(e.p,{children:["mysql\u5b89\u88c5\u7684\u6570\u636e\u76ee\u5f55\u4e3a",(0,a.jsx)(e.code,{children:"/usr/local/mysql/data"})]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"#\u5982\u679c\u505a\u5220\u9664\u64cd\u4f5c\uff0c\u6700\u597d\u5148\u5907\u4efd\u7136\u540e\u518d\u5220\u9664\uff0c\u867d\u7136\u6570\u636e\u5df2\u7ecf\u4e22\u5931\u4e00\u90e8\u5206\uff0c\u8fd9\u91cc\u9009\u62e9\u4fee\u6539\u76ee\u5f55\u540d\u79f0\nmv /usr/local/mysql/data{,-bak}\n"})}),"\n",(0,a.jsx)(e.h4,{id:"338-\u8fdb\u884c\u6570\u636e\u6062\u590d",children:"3.3.8 \u8fdb\u884c\u6570\u636e\u6062\u590d"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsxs)(e.strong,{children:["\u8fd9\u91cc\u8981\u6ce8\u610f\uff0c\u6062\u590d\u7684\u65f6\u5019mysql\u914d\u7f6e\u6587\u4ef6",(0,a.jsx)(e.code,{children:"[mysqld]"}),"\u4e0b\u4e00\u5b9a\u8981\u6307\u5b9amysql data\u76ee\u5f55"]})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"innobackupex -uroot -p1 --copy-back /backup/bak\n\u6216\nxtrabackup -uroot p1 --copy-back --target-dir=/backup/bak\n"})}),"\n",(0,a.jsx)(e.h4,{id:"339-\u7ed9\u6062\u590d\u7684\u76ee\u5f55\u91cd\u65b0\u6388\u6743\u6240\u6709\u8005\u4e3amysql",children:"3.3.9 \u7ed9\u6062\u590d\u7684\u76ee\u5f55\u91cd\u65b0\u6388\u6743\u6240\u6709\u8005\u4e3amysql"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"chown -R mysql.mysql /usr/local/mysql/data\n"})}),"\n",(0,a.jsx)(e.h4,{id:"3310-\u542f\u52a8mysql",children:"3.3.10 \u542f\u52a8mysql"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"$ /etc/init.d/mysqld start\nStarting MySQL.Logging to '/usr/local/mysql/data/error.log'.\n. SUCCESS! \n"})}),"\n",(0,a.jsx)(e.h4,{id:"3311-\u9a8c\u8bc1\u6570\u636e\u6062\u590d",children:"3.3.11 \u9a8c\u8bc1\u6570\u636e\u6062\u590d"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u9a8c\u8bc1\u6570\u636e\u5e93\u662f\u5426\u8fd8\u539f"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"mysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| db1                |\n| db2                |\n| db3                |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n7 rows in set (0.00 sec)\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u9a8c\u8bc1\u8868\u4e2d\u7684\u6570\u636e\u662f\u5426\u8fd8\u539f"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"#db1\uff0c\u6709\u4e24\u5f20\u8868\uff0c\u6bcf\u5f20\u8868\u4e2d\u670910\u4e07\u96f62\u6761\u6570\u636e\nmysql> use db1;\nmysql> show tables;\n+---------------+\n| Tables_in_db1 |\n+---------------+\n| db1_t1        |\n| db1_t2        |\n+---------------+\n2 rows in set (0.00 sec)\n\nmysql> select count(*) from db1_t1;\n+----------+\n| count(*) |\n+----------+\n|   100002 |\n+----------+\n1 row in set (0.04 sec)\n\nmysql> select count(*) from db1_t2;\n+----------+\n| count(*) |\n+----------+\n|   100002 |\n+----------+\n1 row in set (0.04 sec)\n\n\n#db2\uff0c\u6709\u4e24\u5f20\u8868\uff0c\u6bcf\u5f20\u8868\u4e2d\u670910\u4e07\u96f62\u6761\u6570\u636e\nmysql> use db1;\nmysql> show tables;\n+---------------+\n| Tables_in_db2 |\n+---------------+\n| db2_t1        |\n| db2_t2        |\n+---------------+\n2 rows in set (0.00 sec)\n\nmysql> select count(*) from db2_t1;\n+----------+\n| count(*) |\n+----------+\n|   100002 |\n+----------+\n1 row in set (0.04 sec)\n\nmysql> select count(*) from db2_t2;\n+----------+\n| count(*) |\n+----------+\n|   100002 |\n+----------+\n1 row in set (0.03 sec)\n\n\n#db3\uff0c\u67091\u5f20\u8868\uff0c\u8868\u4e2d4\u884c\u6570\u636e\nmysql> use db3;\nmysql> show tables;\n+---------------+\n| Tables_in_db3 |\n+---------------+\n| t3            |\n+---------------+\n1 row in set (0.00 sec)\n\nmysql> select count(*) from t3;\n+----------+\n| count(*) |\n+----------+\n|        4 |\n+----------+\n1 row in set (0.00 sec)\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsxs)(e.strong,{children:[(0,a.jsx)(e.code,{children:"innobackupex"}),"\u547d\u4ee4\u4e0e",(0,a.jsx)(e.code,{children:"xtrabackup"}),"\u547d\u4ee4\u7684\u533a\u522b"]})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"#\u5168\u5907\ninnobackupex --user=root --password=1 backup\n\nxtrabackup -uroot -p --backup --target-dir=/data/backups/\n\n\n\n#\u589e\u5907\ninnobackupex -uroot -p1  --no-timestamp --incremental /backup/bak_incr2 --incremental-basedir=/backup/bak_incr1\n\nxtrabackup -uroot -p1 --backup --target-dir=/backup/bak_incr2 --incremental-basedir=/backup/bak_incr1\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u9700\u8981\u6ce8\u610f\u7684\u70b9"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.a,{href:"https://www.percona.com/doc/percona-xtrabackup/2.4/xtrabackup_bin/xbk_option_reference.html#cmdoption-xtrabackup-apply-log-only",children:(0,a.jsx)(e.code,{children:"xtrabackup --apply-log-only"})}),"\u5408\u5e76\u9664\u6700\u540e\u4e00\u4e2a\u4ee5\u5916\u7684\u6240\u6709\u589e\u91cf\u65f6\u4f7f\u7528"]}),"\n"]}),"\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsxs)(e.p,{children:["\u589e\u91cf\u5907\u4efd\u7684\u6b65\u9aa4\u4e0e\u5b8c\u5168\u5907\u4efd\u7684\u6b65\u9aa4\u4e0d\u540c\u3002\u5728\u5b8c\u5168\u5907\u4efd\u4e2d\uff0c\u6267\u884c\u4e24\u79cd\u7c7b\u578b\u7684\u64cd\u4f5c\u4ee5\u4f7f\u6570\u636e\u5e93\u4fdd\u6301\u4e00\u81f4\uff1a\u5df2\u63d0\u4ea4\u7684\u4e8b\u52a1\u76f8\u5bf9\u4e8e\u6570\u636e\u6587\u4ef6\u4ece\u65e5\u5fd7\u6587\u4ef6\u4e2d\u91cd\u653e\uff0c\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1\u88ab\u56de\u6eda\u3002\u51c6\u5907\u589e\u91cf\u5907\u4efd\u65f6\uff0c\u5fc5\u987b\u8df3\u8fc7\u672a\u63d0\u4ea4\u4e8b\u52a1\u7684\u56de\u6eda\uff0c\u56e0\u4e3a\u5728\u5907\u4efd\u65f6\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1\u53ef\u80fd\u6b63\u5728\u8fdb\u884c\u4e2d\uff0c\u5e76\u4e14\u5f88\u6709\u53ef\u80fd\u5c06\u5728\u4e0b\u4e00\u6b21\u589e\u91cf\u5907\u4efd\u4e2d\u63d0\u4ea4\u3002\u60a8\u5e94\u8be5\u4f7f\u7528\u8be5 \u9009\u9879\u6765\u9632\u6b62\u56de\u6eda\u9636\u6bb5\u3002",(0,a.jsx)(e.a,{href:"https://www.percona.com/doc/percona-xtrabackup/2.4/xtrabackup_bin/xbk_option_reference.html#cmdoption-xtrabackup-apply-log-only",children:(0,a.jsx)(e.code,{children:"xtrabackup --apply-log-only"})})]}),"\n",(0,a.jsxs)(e.p,{children:["\u26a0\ufe0f",(0,a.jsxs)(e.strong,{children:["\u5982\u679c\u4e0d\u4f7f\u7528\u8be5\u9009\u9879",(0,a.jsx)(e.a,{href:"https://www.percona.com/doc/percona-xtrabackup/2.4/xtrabackup_bin/xbk_option_reference.html#cmdoption-xtrabackup-apply-log-only",children:(0,a.jsx)(e.code,{children:"xtrabackup --apply-log-only"})}),"\u963b\u6b62\u56de\u6eda\u9636\u6bb5\uff0c\u5219\u589e\u91cf\u5907\u4efd\u5c06\u65e0\u7528"]}),"\u3002\u4e8b\u52a1\u56de\u6eda\u540e\uff0c\u4e0d\u80fd\u518d\u5e94\u7528\u589e\u91cf\u5907\u4efd"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(e.h2,{id:"4\u5907\u4efd\u811a\u672c",children:"4.\u5907\u4efd\u811a\u672c"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u6388\u6743"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-mysql",children:"CREATE USER 'bkpuser'@'localhost' IDENTIFIED BY 'bkpuser@1234';\nGRANT RELOAD, LOCK TABLES, PROCESS, REPLICATION CLIENT,super ON *.* TO 'bkpuser'@'localhost';\nFLUSH PRIVILEGES;\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u5168\u5907\u811a\u672c"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:'#!/bin/bash  \nlocal_ip="$(/sbin/ifconfig ens160|grep \'inet\'|grep -v \'::\'| awk  \'{print $2}\')" \nuser=\'bkpuser\' \npasswd=\'bkpuser@1234\' \nconfig=\'/etc/my.cnf\' \nbackup_path=\'/tmsdata/xtrabackup_full\' \nbackup_date=`date  +"%Y%m%d_%H%M%S"` \nbackup_dir="$backup_path/$backup_date/"\nbackup_log="$backup_path/log"\n\n\n#\u90ae\u4ef6\u8bbe\u7f6e\ntitle1=\'percona xtrabackup information(success)\'  \ntitle2=\'percona xtrabackup information(failed)\'  \ncontent1=\'Server_name:\'$(hostname)\' \\n Server_ip:\'$local_ip\' \\n \'$(date +"%y-%m-%d %H:%M:%S")\' \\n mysql full backup Success!\'\ncontent2=\'Server_name:\'$(hostname)\' \\n Server_ip:\'$local_ip\' \\n \'$(date +"%y-%m-%d %H:%M:%S")\' \\n mysql full backup Faild!\'\n\n#\u5224\u65ad\u5907\u4efd\u76ee\u5f55\u662f\u5426\u5b58\u5728\nif [ ! -d "$backup_dir" ] && [ ! -d "$backup_log" ];then  \n    mkdir -p $backup_dir  && mkdir -p $backup_log\nfi  \n#[[ -d $backup_dir ]] || mkdir -p $backup_dir\n#[[ -d $backup_log ]] || mkdir -p $backup_log\n\necho "=========================================Start to backup at $(date +%Y%m%d-%H:%M:%S)=========================================" >> $backup_log/$backup_date.log\n\n#\u5f00\u59cb\u5907\u4efd\nxtrabackup --defaults-file=$config --user=$user --password="$passwd"  --backup --target-dir=$backup_dir &>> $backup_log/$backup_date.log\n\nif [ $? -eq 0 ];then  \n    echo "Backup is success! at $(date +%Y%m%d%H%M)"  \n    echo "Server_name:$(hostname) Server_ip:$local_ip $(date +"%y-%m-%d %H:%M:%S") mysql full backup Success!" >> $backup_log/$backup_date.log\n    echo "$content1" | mail -s "$title1"  huangwb@fslgz.com\nelse  \n    echo "Backup is Fail! at $(date +%Y%m%d%H%M)"  \n    echo "Server_name:$(hostname) Server_ip:$local_ip $(date +"%y-%m-%d %H:%M:%S") mysql full backup Fail!" >> $backup_log/$backup_date.log\n    echo "$content2" | mail -s "$title2"  huangwb@fslgz.com  \nfi  \n\nsleep 3\n#xtrabackup\u4ece\u8be5\u6587\u4ef6\u8bfb\u53d6\u6700\u8fd1\u4e00\u6b21\u7684\u5168\u5907\u8def\u5f84\negrep ".* Backup created in directory .*" $backup_log/$backup_date.log >> $backup_path/complete.info\n\n\n\n#\u6e05\u9664\u8d85\u8fc714\u5929\u7684\u5907\u4efd\nfind $backup_path -mtime +14 -type d  -exec rm -rf {} \\;\n\necho "Backup Process Done"  \n'})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u589e\u5907\u811a\u672c"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:'#!/bin/bash  \nlocal_ip="$(/sbin/ifconfig ens160|grep \'inet\'|grep -v \'::\'| awk  \'{print $2}\')" \nuser=\'bkpuser\' \npasswd=\'bkpuser@1234\' \nconfig=\'/etc/my.cnf\' \nbackup_full=\'/tmsdata/xtrabackup_full\' \nbackup_path=\'/tmsdata/xtrabackup_incr\'\nbackup_date=`date  +"%Y%m%d_%H%M%S"` \nbackup_dir="$backup_path/$backup_date/"\nbackup_log="$backup_path/log"\nFULL_BASE_DIR=$(tail -1 $backup_full/complete.info | cut -d\\\' -f2)\n\n#\u5224\u65ad\u5907\u4efd\u76ee\u5f55\u662f\u5426\u5b58\u5728\nif [ ! -d "$backup_dir" ] && [ ! -d "$backup_log" ];then  \n    mkdir -p $backup_dir  && mkdir -p $backup_log\nfi  \n#[[ -d $backup_dir ]] || mkdir -p $backup_dir\n#[[ -d $backup_log ]] || mkdir -p $backup_log\n\necho "========================================xtrabackup\u6839\u636e$FULL_BASE_DIR\u76ee\u5f55\u5f00\u59cb\u589e\u5907=========================================" >> $backup_log/$backup_date.log\n#\u90ae\u4ef6\u8bbe\u7f6e\ntitle1=\'percona xtrabackup information(success)\'  \ntitle2=\'percona xtrabackup information(failed)\'  \ncontent1=\'Server_name:\'$(hostname)\' <br> Server_ip:\'$local_ip\' <br> \'$(date +"%y-%m-%d %H:%M:%S")\' <br> mysql increment backup Success!\'\ncontent2=\'Server_name:\'$(hostname)\' <br> Server_ip:\'$local_ip\' <br> \'$(date +"%y-%m-%d %H:%M:%S")\' <br> mysql increment backup Faild!\'\n\necho "=========================================Start to backup at $(date +%Y%m%d-%H:%M:%S)=========================================" >> $backup_log/$backup_date.log\n\n\n\n#\u5f00\u59cb\u5907\u4efd\nxtrabackup --defaults-file=$config --user=$user --password="$passwd"  --backup --target-dir=$backup_dir --incremental-basedir=$FULL_BASE_DIR &>> $backup_log/$backup_date.log\n\nif [ $? -eq 0 ];then  \n    echo "Backup is success! at $(date +%Y%m%d%H%M)"  \n    echo "Server_name:$(hostname) Server_ip:$local_ip $(date +"%y-%m-%d %H:%M:%S") mysql full backup Success!" >> $backup_log/$backup_date.log\n    echo "$content1" | mail -s "$title1"  huangwb@fslgz.com\nelse  \n    echo "Backup is Fail! at $(date +%Y%m%d%H%M)"  \n    echo "Server_name:$(hostname) Server_ip:$local_ip $(date +"%y-%m-%d %H:%M:%S") mysql full backup Fail!" >> $backup_log/$backup_date.log\n    echo "$content2" | mail -s "$title2"  huangwb@fslgz.com  \nfi  \n\n\n#\u6e05\u9664\u8d85\u8fc714\u5929\u7684\u5907\u4efd\nfind $backup_path -mtime +14 -type d  -exec rm -rf {} \\;\n\necho "Backup Process Done"  \n'})})]})}function p(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(i,{...n})}):i(n)}},28453:(n,e,c)=>{c.d(e,{R:()=>r,x:()=>t});var a=c(96540);const s={},l=a.createContext(s);function r(n){const e=a.useContext(l);return a.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:r(n.components),a.createElement(l.Provider,{value:e},n.children)}}}]);