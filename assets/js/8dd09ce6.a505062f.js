"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[294],{12042:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>o});var r=s(74848),i=s(28453);const c={},d="\u4f7f\u7528kubeadm\u5b89\u88c5k8s\u96c6\u7fa4",t={id:"\u4e91\u539f\u751f/k8s/k8s\u5b89\u88c5/\u4f7f\u7528kubeadm\u5b89\u88c5k8s\u96c6\u7fa4",title:"\u4f7f\u7528kubeadm\u5b89\u88c5k8s\u96c6\u7fa4",description:"kubeadm\u5b89\u88c5\u5b98\u65b9\u6587\u6863",source:"@site/docs/\u4e91\u539f\u751f/k8s/k8s\u5b89\u88c5/\u4f7f\u7528kubeadm\u5b89\u88c5k8s\u96c6\u7fa4.md",sourceDirName:"\u4e91\u539f\u751f/k8s/k8s\u5b89\u88c5",slug:"/\u4e91\u539f\u751f/k8s/k8s\u5b89\u88c5/\u4f7f\u7528kubeadm\u5b89\u88c5k8s\u96c6\u7fa4",permalink:"/docs/\u4e91\u539f\u751f/k8s/k8s\u5b89\u88c5/\u4f7f\u7528kubeadm\u5b89\u88c5k8s\u96c6\u7fa4",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u4f7f\u7528kubeadm\u5728Rocky linux\u4e0a\u5b89\u88c5k8s\u96c6\u7fa4",permalink:"/docs/\u4e91\u539f\u751f/k8s/k8s\u5b89\u88c5/\u4f7f\u7528kubeadm\u5728Rocky linux\u4e0a\u5b89\u88c5k8s\u96c6\u7fa4"},next:{title:"\u4f7f\u7528kubeadm\u642d\u5efa v1.22.2\u7248\u672c kubernetes\u96c6\u7fa4",permalink:"/docs/\u4e91\u539f\u751f/k8s/k8s\u5b89\u88c5/\u4f7f\u7528kubeadm\u642d\u5efa v1.22.2\u7248\u672c kubernetes\u96c6\u7fa4"}},l={},o=[{value:"\u5b9e\u9a8c\u73af\u5883",id:"\u5b9e\u9a8c\u73af\u5883",level:2},{value:"\u51c6\u5907\u5f00\u59cb",id:"\u51c6\u5907\u5f00\u59cb",level:2},{value:"\u786e\u4fdd\u6bcf\u4e2a\u8282\u70b9\u4e0a MAC \u5730\u5740\u548c product_uuid \u7684\u552f\u4e00\u6027",id:"\u786e\u4fdd\u6bcf\u4e2a\u8282\u70b9\u4e0a-mac-\u5730\u5740\u548c-product_uuid-\u7684\u552f\u4e00\u6027",level:2},{value:"\u68c0\u67e5\u6240\u9700\u7aef\u53e3",id:"\u68c0\u67e5\u6240\u9700\u7aef\u53e3",level:2},{value:"\u5b89\u88c5\u5bb9\u5668\u8fd0\u884c\u65f6",id:"\u5b89\u88c5\u5bb9\u5668\u8fd0\u884c\u65f6",level:2},{value:"\u5bb9\u5668\u8fd0\u884c\u65f6\u7c7b\u578b",id:"\u5bb9\u5668\u8fd0\u884c\u65f6\u7c7b\u578b",level:3},{value:"\u5b89\u88c5\u548c\u914d\u7f6e\u5148\u51b3\u6761\u4ef6",id:"\u5b89\u88c5\u548c\u914d\u7f6e\u5148\u51b3\u6761\u4ef6",level:3},{value:"\u8f6c\u53d1 IPv4 \u5e76\u8ba9 iptables \u770b\u5230\u6865\u63a5\u6d41\u91cf",id:"\u8f6c\u53d1-ipv4-\u5e76\u8ba9-iptables-\u770b\u5230\u6865\u63a5\u6d41\u91cf",level:4},{value:"cgroup\u9a71\u52a8",id:"cgroup\u9a71\u52a8",level:3},{value:"cgroupfs \u9a71\u52a8",id:"cgroupfs-\u9a71\u52a8",level:3},{value:"systemd cgroup \u9a71\u52a8",id:"systemd-cgroup-\u9a71\u52a8",level:3},{value:"\u5b89\u88c5containerd",id:"\u5b89\u88c5containerd",level:3},{value:"\u5b89\u88c5containerd",id:"\u5b89\u88c5containerd-1",level:4},{value:"\u5b89\u88c5runc",id:"\u5b89\u88c5runc",level:4},{value:"\u5b89\u88c5CNI\u63d2\u4ef6",id:"\u5b89\u88c5cni\u63d2\u4ef6",level:4},{value:"\u914d\u7f6econtainerd",id:"\u914d\u7f6econtainerd",level:3},{value:"\u521b\u5efacontainerd\u914d\u7f6e\u6587\u4ef6",id:"\u521b\u5efacontainerd\u914d\u7f6e\u6587\u4ef6",level:4},{value:"\u914d\u7f6e systemd group \u9a71\u52a8",id:"\u914d\u7f6e-systemd-group-\u9a71\u52a8",level:4},{value:"\u4fee\u6539 pause \u955c\u50cf\u5730\u5740",id:"\u4fee\u6539-pause-\u955c\u50cf\u5730\u5740",level:4},{value:"\u914d\u7f6econtainerd\u955c\u50cf\u4ed3\u5e93\u52a0\u901f",id:"\u914d\u7f6econtainerd\u955c\u50cf\u4ed3\u5e93\u52a0\u901f",level:4},{value:"\u5b89\u88c5cri-tools\uff08\u53ef\u9009\uff09",id:"\u5b89\u88c5cri-tools\u53ef\u9009",level:4},{value:"\u5b89\u88c5nerdctl\uff08\u53ef\u9009\uff09",id:"\u5b89\u88c5nerdctl\u53ef\u9009",level:4},{value:"\u5b89\u88c5\u5176\u4ed6\u7ec4\u4ef6",id:"\u5b89\u88c5\u5176\u4ed6\u7ec4\u4ef6",level:5},{value:"CNI plugins CNI \u63d2\u4ef6 ",id:"cni-plugins-cni-\u63d2\u4ef6-",level:6},{value:"BuildKit \u6784\u5efa\u5957\u4ef6  \uff08\u53ef\u9009\uff09",id:"buildkit-\u6784\u5efa\u5957\u4ef6--\u53ef\u9009",level:6},{value:"RootlessKit and slirp4netns \uff08\u53ef\u9009\uff09",id:"rootlesskit-and-slirp4netns-\u53ef\u9009",level:6},{value:"docker\u548ccontainerd\u5e38\u7528\u547d\u4ee4\u5bf9\u6bd4",id:"docker\u548ccontainerd\u5e38\u7528\u547d\u4ee4\u5bf9\u6bd4",level:4},{value:"\u5b89\u88c5kubeadm\u3001kubelet\u3001kubectl",id:"\u5b89\u88c5kubeadmkubeletkubectl",level:2},{value:"\u914d\u7f6eyum\u6e90",id:"\u914d\u7f6eyum\u6e90",level:3},{value:"\u5b89\u88c5 kubelet\u3001kubeadm \u548c kubectl\uff0c\u5e76\u542f\u7528 kubelet \u4ee5\u786e\u4fdd\u5b83\u5728\u542f\u52a8\u65f6\u81ea\u52a8\u542f\u52a8",id:"\u5b89\u88c5-kubeletkubeadm-\u548c-kubectl\u5e76\u542f\u7528-kubelet-\u4ee5\u786e\u4fdd\u5b83\u5728\u542f\u52a8\u65f6\u81ea\u52a8\u542f\u52a8",level:3},{value:"\u8bbe\u7f6e <code>kubectl</code> \u547d\u4ee4\u8865\u5168",id:"\u8bbe\u7f6e-kubectl-\u547d\u4ee4\u8865\u5168",level:3},{value:"\u4f7f\u7528kubeadm\u521b\u5efa\u96c6\u7fa4",id:"\u4f7f\u7528kubeadm\u521b\u5efa\u96c6\u7fa4",level:2},{value:"\u521d\u59cb\u5316master\u8282\u70b9",id:"\u521d\u59cb\u5316master\u8282\u70b9",level:3},{value:"\u521d\u59cb\u5316\u65b9\u5f0f",id:"\u521d\u59cb\u5316\u65b9\u5f0f",level:4},{value:"\u914d\u7f6e\u6587\u4ef6\u65b9\u5f0f",id:"\u914d\u7f6e\u6587\u4ef6\u65b9\u5f0f",level:5},{value:"\u547d\u4ee4\u884c\u65b9\u5f0f",id:"\u547d\u4ee4\u884c\u65b9\u5f0f",level:5},{value:"\u62f7\u8d1d <code>kubeconfig</code> \u6587\u4ef6",id:"\u62f7\u8d1d-kubeconfig-\u6587\u4ef6",level:3},{value:"\u6dfb\u52a0node\u8282\u70b9",id:"\u6dfb\u52a0node\u8282\u70b9",level:3},{value:"\u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6",id:"\u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6",level:3},{value:"flannel",id:"flannel",level:4},{value:"calico",id:"calico",level:4}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"\u4f7f\u7528kubeadm\u5b89\u88c5k8s\u96c6\u7fa4",children:"\u4f7f\u7528kubeadm\u5b89\u88c5k8s\u96c6\u7fa4"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/",children:"kubeadm\u5b89\u88c5\u5b98\u65b9\u6587\u6863"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5b9e\u9a8c\u73af\u5883",children:"\u5b9e\u9a8c\u73af\u5883"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u89d2\u8272"}),(0,r.jsx)(n.th,{children:"IP"}),(0,r.jsx)(n.th,{children:"\u4e3b\u673a\u540d"}),(0,r.jsx)(n.th,{children:"containerd\u7248\u672c"}),(0,r.jsx)(n.th,{children:"\u786c\u4ef6\u914d\u7f6e"}),(0,r.jsx)(n.th,{children:"\u7cfb\u7edf"}),(0,r.jsx)(n.th,{children:"\u5185\u6838"}),(0,r.jsx)(n.th,{children:"\u5b89\u88c5\u7ec4\u4ef6"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"master"}),(0,r.jsx)(n.td,{children:"10.0.0.10"}),(0,r.jsx)(n.td,{children:"k8s-master"}),(0,r.jsx)(n.td,{children:"1.7.8"}),(0,r.jsx)(n.td,{children:"2c4g"}),(0,r.jsx)(n.td,{children:"CentOS7.9"}),(0,r.jsx)(n.td,{children:"6.5.8-1.el7.elrepo.x86_64"}),(0,r.jsx)(n.td,{children:"kube-apiserver\uff0ckube-controller-manager\uff0ckube-scheduler\uff0ckubelet\uff0cetcd"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"node"}),(0,r.jsx)(n.td,{children:"10.0.0.10"}),(0,r.jsx)(n.td,{children:"k8s-node"}),(0,r.jsx)(n.td,{children:"1.7.8"}),(0,r.jsx)(n.td,{children:"2c4g"}),(0,r.jsx)(n.td,{children:"CentOS7.9"}),(0,r.jsx)(n.td,{children:"6.5.8-1.el7.elrepo.x86_64"}),(0,r.jsx)(n.td,{children:"kubelet\uff0ckube-proxy\uff0ccontainerd\uff0cetcd"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"\u51c6\u5907\u5f00\u59cb",children:"\u51c6\u5907\u5f00\u59cb"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B",children:"\u5b98\u65b9\u6587\u6863"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6bcf\u53f0\u673a\u56682G\u6216\u66f4\u591a\u7684\u5185\u5b58"}),"\n",(0,r.jsx)(n.li,{children:"CPU2\u6838\u5fc3\u53ca\u4ee5\u4e0a"}),"\n",(0,r.jsx)(n.li,{children:"\u96c6\u7fa4\u4e2d\u6240\u6709\u673a\u5668\u7f51\u7edc\u4e92\u901a"}),"\n",(0,r.jsxs)(n.li,{children:["\u8282\u70b9\u4e4b\u4e2d\u4e0d\u53ef\u4ee5\u6709\u91cd\u590d\u7684 ",(0,r.jsx)(n.code,{children:"\u4e3b\u673a\u540d"})," \u3001",(0,r.jsx)(n.code,{children:"MAC\u5730\u5740"})," \u6216 ",(0,r.jsx)(n.code,{children:"product_uuid"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u5f00\u542f\u673a\u5668\u4e0a\u7684\u67d0\u4e9b\u7aef\u53e3\u3002\u8bf7\u53c2\u89c1",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#check-required-ports",children:"\u8fd9\u91cc"}),"\u4e86\u89e3\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u4ea4\u6362\u5206\u533a\u7684\u914d\u7f6e\u3002kubelet \u7684\u9ed8\u8ba4\u884c\u4e3a\u662f\u5728\u8282\u70b9\u4e0a\u68c0\u6d4b\u5230\u4ea4\u6362\u5185\u5b58\u65f6\u65e0\u6cd5\u542f\u52a8\u3002 kubelet \u81ea v1.22 \u8d77\u5df2\u5f00\u59cb\u652f\u6301\u4ea4\u6362\u5206\u533a\u3002\u81ea v1.28 \u8d77\uff0c\u4ec5\u9488\u5bf9 cgroup v2 \u652f\u6301\u4ea4\u6362\u5206\u533a\uff1b kubelet \u7684 NodeSwap \u7279\u6027\u95e8\u63a7\u5904\u4e8e Beta \u9636\u6bb5\uff0c\u4f46\u9ed8\u8ba4\u88ab\u7981\u7528\u3002","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u5982\u679c kubelet \u672a\u88ab\u6b63\u786e\u914d\u7f6e\u4f7f\u7528\u4ea4\u6362\u5206\u533a\uff0c\u5219\u4f60",(0,r.jsx)(n.strong,{children:"\u5fc5\u987b"}),"\u7981\u7528\u4ea4\u6362\u5206\u533a\u3002 \u4f8b\u5982\uff0c",(0,r.jsx)(n.code,{children:"sudo swapoff -a"})," \u5c06\u6682\u65f6\u7981\u7528\u4ea4\u6362\u5206\u533a\u3002\u8981\u4f7f\u6b64\u66f4\u6539\u5728\u91cd\u542f\u540e\u4fdd\u6301\u4e0d\u53d8\uff0c\u8bf7\u786e\u4fdd\u5728\u5982 ",(0,r.jsx)(n.code,{children:"/etc/fstab"})," \u3001",(0,r.jsx)(n.code,{children:"systemd.swap"})," \u7b49\u914d\u7f6e\u6587\u4ef6\u4e2d\u7981\u7528\u4ea4\u6362\u5206\u533a\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u4f60\u7684\u7cfb\u7edf\u5982\u4f55\u914d\u7f6e\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{title:"\u8bf4\u660e",type:"info",children:(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"kubeadm"})," \u7684\u5b89\u88c5\u662f\u901a\u8fc7\u4f7f\u7528\u52a8\u6001\u94fe\u63a5\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u5b8c\u6210\u7684\uff0c\u5b89\u88c5\u65f6\u5047\u8bbe\u4f60\u7684\u76ee\u6807\u7cfb\u7edf\u63d0\u4f9b ",(0,r.jsx)(n.code,{children:"glibc"}),"\u3002 \u8fd9\u4e2a\u5047\u8bbe\u5728\u8bb8\u591a Linux \u53d1\u884c\u7248\uff08\u5305\u62ec Debian\u3001Ubuntu\u3001Fedora\u3001CentOS \u7b49\uff09\u4e0a\u662f\u5408\u7406\u7684\uff0c \u4f46\u5bf9\u4e8e\u4e0d\u5305\u542b\u9ed8\u8ba4 ",(0,r.jsx)(n.code,{children:"glibc"})," \u7684\u81ea\u5b9a\u4e49\u548c\u8f7b\u91cf\u7ea7\u53d1\u884c\u7248\uff08\u5982 Alpine Linux\uff09\uff0c\u60c5\u51b5\u5e76\u975e\u603b\u662f\u5982\u6b64\u3002 \u9884\u671f\u7684\u60c5\u51b5\u662f\uff0c\u53d1\u884c\u7248\u8981\u4e48\u5305\u542b ",(0,r.jsx)(n.code,{children:"glibc"}),"\uff0c \u8981\u4e48\u63d0\u4f9b\u4e86\u4e00\u4e2a",(0,r.jsx)(n.a,{href:"https://wiki.alpinelinux.org/wiki/Running_glibc_programs",children:"\u517c\u5bb9\u5c42"}),"\u4ee5\u63d0\u4f9b\u6240\u9700\u7684\u7b26\u53f7\u3002"]})}),"\n",(0,r.jsx)(n.h2,{id:"\u786e\u4fdd\u6bcf\u4e2a\u8282\u70b9\u4e0a-mac-\u5730\u5740\u548c-product_uuid-\u7684\u552f\u4e00\u6027",children:"\u786e\u4fdd\u6bcf\u4e2a\u8282\u70b9\u4e0a MAC \u5730\u5740\u548c product_uuid \u7684\u552f\u4e00\u6027"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#verify-mac-address",children:"\u5b98\u65b9\u6587\u6863"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u4f60\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4 ",(0,r.jsx)(n.code,{children:"ip link"})," \u6216 ",(0,r.jsx)(n.code,{children:"ifconfig -a"})," \u6765\u83b7\u53d6\u7f51\u7edc\u63a5\u53e3\u7684 MAC \u5730\u5740"]}),"\n",(0,r.jsxs)(n.li,{children:["\u53ef\u4ee5\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"sudo cat /sys/class/dmi/id/product_uuid"})," \u547d\u4ee4\u5bf9 product_uuid \u6821\u9a8c"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4e00\u822c\u6765\u8bb2\uff0c\u786c\u4ef6\u8bbe\u5907\u4f1a\u62e5\u6709\u552f\u4e00\u7684\u5730\u5740\uff0c\u4f46\u662f\u6709\u4e9b\u865a\u62df\u673a\u7684\u5730\u5740\u53ef\u80fd\u4f1a\u91cd\u590d\u3002 Kubernetes \u4f7f\u7528\u8fd9\u4e9b\u503c\u6765\u552f\u4e00\u786e\u5b9a\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u3002 \u5982\u679c\u8fd9\u4e9b\u503c\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u4e0d\u552f\u4e00\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5b89\u88c5",(0,r.jsx)(n.a,{href:"https://github.com/kubernetes/kubeadm/issues/31",children:"\u5931\u8d25"}),"\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"\u68c0\u67e5\u6240\u9700\u7aef\u53e3",children:"\u68c0\u67e5\u6240\u9700\u7aef\u53e3"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#check-required-ports",children:"\u5b98\u65b9\u6587\u6863"})}),"\n",(0,r.jsxs)(n.p,{children:["\u542f\u7528\u8fd9\u4e9b",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/reference/networking/ports-and-protocols/",children:"\u5fc5\u8981\u7684\u7aef\u53e3"}),"\u540e\u624d\u80fd\u4f7f Kubernetes \u7684\u5404\u7ec4\u4ef6\u76f8\u4e92\u901a\u4fe1\u3002 \u53ef\u4ee5\u4f7f\u7528 netcat \u4e4b\u7c7b\u7684\u5de5\u5177\u6765\u68c0\u67e5\u7aef\u53e3\u662f\u5426\u542f\u7528\uff0c\u4f8b\u5982\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"nc 127.0.0.1 6443\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u4f60\u4f7f\u7528\u7684 Pod \u7f51\u7edc\u63d2\u4ef6 (\u8be6\u89c1\u540e\u7eed\u7ae0\u8282) \u4e5f\u53ef\u80fd\u9700\u8981\u5f00\u542f\u67d0\u4e9b\u7279\u5b9a\u7aef\u53e3\u3002 \u7531\u4e8e\u5404\u4e2a Pod \u7f51\u7edc\u63d2\u4ef6\u7684\u529f\u80fd\u90fd\u6709\u6240\u4e0d\u540c\uff0c\u8bf7\u53c2\u9605\u4ed6\u4eec\u5404\u81ea\u6587\u6863\u4e2d\u5bf9\u7aef\u53e3\u7684\u8981\u6c42\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"master\u8282\u70b9\u9700\u8981\u542f\u7528\u7684\u7aef\u53e3"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u534f\u8bae"}),(0,r.jsx)(n.th,{children:"\u65b9\u5411"}),(0,r.jsx)(n.th,{children:"\u7aef\u53e3\u8303\u56f4"}),(0,r.jsx)(n.th,{children:"\u76ee\u7684"}),(0,r.jsx)(n.th,{children:"\u4f7f\u7528\u8005"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"TCP"}),(0,r.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,r.jsx)(n.td,{children:"6443"}),(0,r.jsx)(n.td,{children:"Kubernetes API server"}),(0,r.jsx)(n.td,{children:"\u6240\u6709"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"TCP"}),(0,r.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,r.jsx)(n.td,{children:"2379-2380"}),(0,r.jsx)(n.td,{children:"etcd server client API"}),(0,r.jsx)(n.td,{children:"kube-apiserver, etcd"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"TCP"}),(0,r.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,r.jsx)(n.td,{children:"10250"}),(0,r.jsx)(n.td,{children:"Kubelet API"}),(0,r.jsx)(n.td,{children:"\u81ea\u8eab, master\u8282\u70b9"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"TCP"}),(0,r.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,r.jsx)(n.td,{children:"10259"}),(0,r.jsx)(n.td,{children:"kube-scheduler"}),(0,r.jsx)(n.td,{children:"\u81ea\u8eab"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"TCP"}),(0,r.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,r.jsx)(n.td,{children:"10257"}),(0,r.jsx)(n.td,{children:"kube-controller-manager"}),(0,r.jsx)(n.td,{children:"\u81ea\u8eab"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"node\u8282\u70b9\u9700\u8981\u542f\u7528\u7684\u7aef\u53e3"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u534f\u8bae"}),(0,r.jsx)(n.th,{children:"\u65b9\u5411"}),(0,r.jsx)(n.th,{children:"\u7aef\u53e3\u8303\u56f4"}),(0,r.jsx)(n.th,{children:"\u76ee\u7684"}),(0,r.jsx)(n.th,{children:"\u4f7f\u7528\u8005"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"TCP"}),(0,r.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,r.jsx)(n.td,{children:"10250"}),(0,r.jsx)(n.td,{children:"Kubelet API"}),(0,r.jsx)(n.td,{children:"\u81ea\u8eab, master\u8282\u70b9"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"TCP"}),(0,r.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,r.jsx)(n.td,{children:"30000-32767"}),(0,r.jsx)(n.td,{children:"NodePort Services\u2020"}),(0,r.jsx)(n.td,{children:"\u6240\u6709"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"\u5b89\u88c5\u5bb9\u5668\u8fd0\u884c\u65f6",children:"\u5b89\u88c5\u5bb9\u5668\u8fd0\u884c\u65f6"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#installing-runtime",children:"\u5b98\u65b9\u6587\u6863"})}),"\n",(0,r.jsxs)(n.p,{children:["\u4e3a\u4e86\u5728 Pod \u4e2d\u8fd0\u884c\u5bb9\u5668\uff0cKubernetes \u4f7f\u7528 ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes",children:"\u5bb9\u5668\u8fd0\u884c\u65f6\uff08Container Runtime\uff09"}),"\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cKubernetes \u4f7f\u7528 ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/concepts/overview/components/#container-runtime",children:"\u5bb9\u5668\u8fd0\u884c\u65f6\u63a5\u53e3\uff08Container Runtime Interface\uff0cCRI\uff09"})," \u6765\u4e0e\u4f60\u6240\u9009\u62e9\u7684\u5bb9\u5668\u8fd0\u884c\u65f6\u4ea4\u4e92\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u4f60\u4e0d\u6307\u5b9a\u8fd0\u884c\u65f6\uff0ckubeadm \u4f1a\u81ea\u52a8\u5c1d\u8bd5\u901a\u8fc7\u626b\u63cf\u5df2\u77e5\u7684\u7aef\u70b9\u5217\u8868\u6765\u68c0\u6d4b\u5df2\u5b89\u88c5\u7684\u5bb9\u5668\u8fd0\u884c\u65f6\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u68c0\u6d4b\u5230\u6709\u591a\u4e2a\u6216\u8005\u6ca1\u6709\u5bb9\u5668\u8fd0\u884c\u65f6\uff0ckubeadm \u5c06\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\u5e76\u8981\u6c42\u4f60\u6307\u5b9a\u4e00\u4e2a\u60f3\u8981\u4f7f\u7528\u7684\u8fd0\u884c\u65f6\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u53c2\u9605",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/",children:"\u5bb9\u5668\u8fd0\u884c\u65f6"})," \u4ee5\u4e86\u89e3\u66f4\u591a\u4fe1\u606f\u3002"]}),"\n",(0,r.jsx)(n.admonition,{title:"\u8bf4\u660e",type:"tip",children:(0,r.jsxs)(n.p,{children:["Docker Engine \u6ca1\u6709\u5b9e\u73b0 ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/concepts/architecture/cri/",children:"CRI"}),"\uff0c \u800c\u8fd9\u662f\u5bb9\u5668\u8fd0\u884c\u65f6\u5728 Kubernetes \u4e2d\u5de5\u4f5c\u6240\u9700\u8981\u7684\u3002 \u4e3a\u6b64\uff0c\u5fc5\u987b\u5b89\u88c5\u4e00\u4e2a\u989d\u5916\u7684\u670d\u52a1 ",(0,r.jsx)(n.a,{href:"https://github.com/Mirantis/cri-dockerd",children:"cri-dockerd"}),"\u3002 cri-dockerd \u662f\u4e00\u4e2a\u57fa\u4e8e\u4f20\u7edf\u7684\u5185\u7f6e Docker \u5f15\u64ce\u652f\u6301\u7684\u9879\u76ee\uff0c \u5b83\u5728 1.24 \u7248\u672c\u4ece kubelet \u4e2d",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/dockershim",children:"\u79fb\u9664"}),"\u3002"]})}),"\n",(0,r.jsx)(n.p,{children:"\u4e0b\u9762\u7684\u8868\u683c\u5305\u62ec\u88ab\u652f\u6301\u7684\u64cd\u4f5c\u7cfb\u7edf\u7684\u5df2\u77e5\u7aef\u70b9\u3002"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u8fd0\u884c\u65f6"}),(0,r.jsx)(n.th,{children:"Unix \u57df\u5957\u63a5\u5b57"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"containerd"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"unix:///var/run/containerd/containerd.sock"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"CRI-O"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"unix:///var/run/crio/crio.sock"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Docker Engine\uff08\u4f7f\u7528 cri-dockerd\uff09"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"unix:///var/run/cri-dockerd.sock"})})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"\u5bb9\u5668\u8fd0\u884c\u65f6\u7c7b\u578b",children:"\u5bb9\u5668\u8fd0\u884c\u65f6\u7c7b\u578b"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://github.com/containerd/containerd",children:"containerd"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://github.com/cri-o/cri-o",children:"cri-o"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://docs.docker.com/engine/install/#server",children:"docker"}),"   ",(0,r.jsx)(n.a,{href:"https://github.com/Mirantis/cri-dockerd",children:"cri-dockerd"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://docs.mirantis.com/mcr/20.10/install.html",children:"Mirantis Container Runtime"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5b89\u88c5\u548c\u914d\u7f6e\u5148\u51b3\u6761\u4ef6",children:"\u5b89\u88c5\u548c\u914d\u7f6e\u5148\u51b3\u6761\u4ef6"}),"\n",(0,r.jsx)(n.h4,{id:"\u8f6c\u53d1-ipv4-\u5e76\u8ba9-iptables-\u770b\u5230\u6865\u63a5\u6d41\u91cf",children:"\u8f6c\u53d1 IPv4 \u5e76\u8ba9 iptables \u770b\u5230\u6865\u63a5\u6d41\u91cf"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/#%E8%BD%AC%E5%8F%91-ipv4-%E5%B9%B6%E8%AE%A9-iptables-%E7%9C%8B%E5%88%B0%E6%A1%A5%E6%8E%A5%E6%B5%81%E9%87%8F",children:"\u5b98\u65b9\u6587\u6863"})}),"\n",(0,r.jsx)(n.p,{children:"\u6267\u884c\u547d\u4ee4"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf\noverlay\nbr_netfilter\nEOF\n\nsudo modprobe overlay\nsudo modprobe br_netfilter\n\n# \u8bbe\u7f6e\u6240\u9700\u7684 sysctl \u53c2\u6570\uff0c\u53c2\u6570\u5728\u91cd\u65b0\u542f\u52a8\u540e\u4fdd\u6301\u4e0d\u53d8\ncat <<EOF | sudo tee /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-iptables  = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.ipv4.ip_forward                 = 1\nEOF\n\n# \u5e94\u7528 sysctl \u53c2\u6570\u800c\u4e0d\u91cd\u65b0\u542f\u52a8\nsudo sysctl --system\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u901a\u8fc7\u8fd0\u884c\u4ee5\u4e0b\u6307\u4ee4\u786e\u8ba4 ",(0,r.jsx)(n.code,{children:"br_netfilter"})," \u548c ",(0,r.jsx)(n.code,{children:"overlay"})," \u6a21\u5757\u88ab\u52a0\u8f7d"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"lsmod | grep br_netfilter\nlsmod | grep overlay\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u901a\u8fc7\u8fd0\u884c\u4ee5\u4e0b\u6307\u4ee4\u786e\u8ba4 ",(0,r.jsx)(n.code,{children:"net.bridge.bridge-nf-call-iptables"}),"\u3001",(0,r.jsx)(n.code,{children:"net.bridge.bridge-nf-call-ip6tables"})," \u548c ",(0,r.jsx)(n.code,{children:"net.ipv4.ip_forward"})," \u7cfb\u7edf\u53d8\u91cf\u5728\u4f60\u7684 ",(0,r.jsx)(n.code,{children:"sysctl"})," \u914d\u7f6e\u4e2d\u88ab\u8bbe\u7f6e\u4e3a 1\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sysctl net.bridge.bridge-nf-call-iptables net.bridge.bridge-nf-call-ip6tables net.ipv4.ip_forward\n"})}),"\n",(0,r.jsx)(n.h3,{id:"cgroup\u9a71\u52a8",children:"cgroup\u9a71\u52a8"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/#cgroup-drivers",children:"\u5b98\u65b9\u6587\u6863"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 Linux \u4e0a\uff0c",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-cgroup",children:"\u63a7\u5236\u7ec4\uff08CGroup\uff09"}),"\u7528\u4e8e\u9650\u5236\u5206\u914d\u7ed9\u8fdb\u7a0b\u7684\u8d44\u6e90\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/generated/kubelet",children:"kubelet"})," \u548c\u5e95\u5c42\u5bb9\u5668\u8fd0\u884c\u65f6\u90fd\u9700\u8981\u5bf9\u63a5\u63a7\u5236\u7ec4\u6765\u5f3a\u5236\u6267\u884c ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/concepts/configuration/manage-resources-containers/",children:"\u4e3a Pod \u548c\u5bb9\u5668\u7ba1\u7406\u8d44\u6e90"})," \u5e76\u4e3a\u8bf8\u5982 CPU\u3001\u5185\u5b58\u8fd9\u7c7b\u8d44\u6e90\u8bbe\u7f6e\u8bf7\u6c42\u548c\u9650\u5236\u3002\u82e5\u8981\u5bf9\u63a5\u63a7\u5236\u7ec4\uff0ckubelet \u548c\u5bb9\u5668\u8fd0\u884c\u65f6\u9700\u8981\u4f7f\u7528\u4e00\u4e2a ",(0,r.jsx)(n.strong,{children:"cgroup \u9a71\u52a8"}),"\u3002 \u5173\u952e\u7684\u4e00\u70b9\u662f kubelet \u548c\u5bb9\u5668\u8fd0\u884c\u65f6\u9700\u4f7f\u7528\u76f8\u540c\u7684 cgroup \u9a71\u52a8\u5e76\u4e14\u91c7\u7528\u76f8\u540c\u7684\u914d\u7f6e\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u53ef\u7528\u7684 cgroup \u9a71\u52a8\u6709\u4e24\u4e2a\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/#cgroupfs-cgroup-driver",children:(0,r.jsx)(n.code,{children:"cgroupfs"})})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/#systemd-cgroup-driver",children:(0,r.jsx)(n.code,{children:"systemd"})})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"cgroupfs-\u9a71\u52a8",children:"cgroupfs \u9a71\u52a8"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"cgroupfs"})," \u9a71\u52a8\u662f ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/reference/config-api/kubelet-config.v1beta1",children:"kubelet \u4e2d\u9ed8\u8ba4\u7684 cgroup \u9a71\u52a8"}),"\u3002 \u5f53\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"cgroupfs"})," \u9a71\u52a8\u65f6\uff0c kubelet \u548c\u5bb9\u5668\u8fd0\u884c\u65f6\u5c06\u76f4\u63a5\u5bf9\u63a5 cgroup \u6587\u4ef6\u7cfb\u7edf\u6765\u914d\u7f6e cgroup\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5f53 ",(0,r.jsx)(n.a,{href:"https://www.freedesktop.org/wiki/Software/systemd/",children:"systemd"})," \u662f\u521d\u59cb\u5316\u7cfb\u7edf\u65f6\uff0c ",(0,r.jsx)(n.strong,{children:"\u4e0d"})," \u63a8\u8350\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"cgroupfs"})," \u9a71\u52a8\uff0c\u56e0\u4e3a systemd \u671f\u671b\u7cfb\u7edf\u4e0a\u53ea\u6709\u4e00\u4e2a cgroup \u7ba1\u7406\u5668\u3002 \u6b64\u5916\uff0c\u5982\u679c\u4f60\u4f7f\u7528 ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/concepts/architecture/cgroups",children:"cgroup v2"}),"\uff0c \u5219\u5e94\u7528 ",(0,r.jsx)(n.code,{children:"systemd"})," cgroup \u9a71\u52a8\u53d6\u4ee3 ",(0,r.jsx)(n.code,{children:"cgroupfs"}),"\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"systemd-cgroup-\u9a71\u52a8",children:"systemd cgroup \u9a71\u52a8"}),"\n",(0,r.jsxs)(n.p,{children:["\u5f53\u67d0\u4e2a Linux \u7cfb\u7edf\u53d1\u884c\u7248\u4f7f\u7528 ",(0,r.jsx)(n.a,{href:"https://www.freedesktop.org/wiki/Software/systemd/",children:"systemd"})," \u4f5c\u4e3a\u5176\u521d\u59cb\u5316\u7cfb\u7edf\u65f6\uff0c\u521d\u59cb\u5316\u8fdb\u7a0b\u4f1a\u751f\u6210\u5e76\u4f7f\u7528\u4e00\u4e2a root \u63a7\u5236\u7ec4\uff08",(0,r.jsx)(n.code,{children:"cgroup"}),"\uff09\uff0c\u5e76\u5145\u5f53 cgroup \u7ba1\u7406\u5668\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["systemd \u4e0e cgroup \u96c6\u6210\u7d27\u5bc6\uff0c\u5e76\u5c06\u4e3a\u6bcf\u4e2a systemd \u5355\u5143\u5206\u914d\u4e00\u4e2a cgroup\u3002 \u56e0\u6b64\uff0c\u5982\u679c\u4f60 ",(0,r.jsx)(n.code,{children:"systemd"})," \u7528\u4f5c\u521d\u59cb\u5316\u7cfb\u7edf\uff0c\u540c\u65f6\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"cgroupfs"})," \u9a71\u52a8\uff0c\u5219\u7cfb\u7edf\u4e2d\u4f1a\u5b58\u5728\u4e24\u4e2a\u4e0d\u540c\u7684 cgroup \u7ba1\u7406\u5668\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u540c\u65f6\u5b58\u5728\u4e24\u4e2a cgroup \u7ba1\u7406\u5668\u5c06\u9020\u6210\u7cfb\u7edf\u4e2d\u9488\u5bf9\u53ef\u7528\u7684\u8d44\u6e90\u548c\u4f7f\u7528\u4e2d\u7684\u8d44\u6e90\u51fa\u73b0\u4e24\u4e2a\u89c6\u56fe\u3002\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c \u5c06 kubelet \u548c\u5bb9\u5668\u8fd0\u884c\u65f6\u914d\u7f6e\u4e3a\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"cgroupfs"}),"\u3001\u4f46\u4e3a\u5269\u4f59\u7684\u8fdb\u7a0b\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"systemd"})," \u7684\u90a3\u4e9b\u8282\u70b9\u5c06\u5728\u8d44\u6e90\u538b\u529b\u589e\u5927\u65f6\u53d8\u5f97\u4e0d\u7a33\u5b9a\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5f53 systemd \u662f\u9009\u5b9a\u7684\u521d\u59cb\u5316\u7cfb\u7edf\u65f6\uff0c\u7f13\u89e3\u8fd9\u4e2a\u4e0d\u7a33\u5b9a\u95ee\u9898\u7684\u65b9\u6cd5\u662f\u9488\u5bf9 kubelet \u548c\u5bb9\u5668\u8fd0\u884c\u65f6\u5c06 ",(0,r.jsx)(n.code,{children:"systemd"})," \u7528\u4f5c cgroup \u9a71\u52a8\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u8981\u5c06 ",(0,r.jsx)(n.code,{children:"systemd"})," \u8bbe\u7f6e\u4e3a cgroup \u9a71\u52a8\uff0c\u9700\u7f16\u8f91 ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubelet-config-file/",children:(0,r.jsx)(n.code,{children:"KubeletConfiguration"})})," \u7684 ",(0,r.jsx)(n.code,{children:"cgroupDriver"})," \u9009\u9879\uff0c\u5e76\u5c06\u5176\u8bbe\u7f6e\u4e3a ",(0,r.jsx)(n.code,{children:"systemd"}),"\u3002\u4f8b\u5982\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\n...\ncgroupDriver: systemd\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"\u8bf4\u660e",type:"tip",children:(0,r.jsxs)(n.p,{children:["\u4ece v1.22 \u5f00\u59cb\uff0c\u5728\u4f7f\u7528 kubeadm \u521b\u5efa\u96c6\u7fa4\u65f6\uff0c\u5982\u679c\u7528\u6237\u6ca1\u6709\u5728 ",(0,r.jsx)(n.code,{children:"KubeletConfiguration"})," \u4e0b\u8bbe\u7f6e ",(0,r.jsx)(n.code,{children:"cgroupDriver"})," \u5b57\u6bb5\uff0ckubeadm \u9ed8\u8ba4\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"systemd"}),"\u3002"]})}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 Kubernetes v1.28 \u4e2d\uff0c\u542f\u7528 ",(0,r.jsx)(n.code,{children:"KubeletCgroupDriverFromCRI"})," ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/feature-gates/",children:"\u7279\u6027\u95e8\u63a7"}),"\u7ed3\u5408\u652f\u6301 ",(0,r.jsx)(n.code,{children:"RuntimeConfig"})," CRI RPC \u7684\u5bb9\u5668\u8fd0\u884c\u65f6\uff0ckubelet \u4f1a\u81ea\u52a8\u4ece\u8fd0\u884c\u65f6\u68c0\u6d4b\u9002\u5f53\u7684 Cgroup \u9a71\u52a8\u7a0b\u5e8f\uff0c\u5e76\u5ffd\u7565 kubelet \u914d\u7f6e\u4e2d\u7684 ",(0,r.jsx)(n.code,{children:"cgroupDriver"})," \u8bbe\u7f6e\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u4f60\u5c06 ",(0,r.jsx)(n.code,{children:"systemd"})," \u914d\u7f6e\u4e3a kubelet \u7684 cgroup \u9a71\u52a8\uff0c\u4f60\u4e5f\u5fc5\u987b\u5c06 ",(0,r.jsx)(n.code,{children:"systemd"})," \u914d\u7f6e\u4e3a\u5bb9\u5668\u8fd0\u884c\u65f6\u7684 cgroup \u9a71\u52a8\u3002\u53c2\u9605\u5bb9\u5668\u8fd0\u884c\u65f6\u6587\u6863\uff0c\u4e86\u89e3\u6307\u793a\u8bf4\u660e\u3002\u4f8b\u5982\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/#containerd-systemd",children:"containerd"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/#cri-o",children:"CRI-O"})}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{title:"\u6ce8\u610f",type:"caution",children:[(0,r.jsx)(n.p,{children:"\u6ce8\u610f\uff1a\u66f4\u6539\u5df2\u52a0\u5165\u96c6\u7fa4\u7684\u8282\u70b9\u7684 cgroup \u9a71\u52a8\u662f\u4e00\u9879\u654f\u611f\u7684\u64cd\u4f5c\u3002 \u5982\u679c kubelet \u5df2\u7ecf\u4f7f\u7528\u67d0 cgroup \u9a71\u52a8\u7684\u8bed\u4e49\u521b\u5efa\u4e86 Pod\uff0c\u66f4\u6539\u8fd0\u884c\u65f6\u4ee5\u4f7f\u7528\u522b\u7684 cgroup \u9a71\u52a8\uff0c\u5f53\u4e3a\u73b0\u6709 Pod \u91cd\u65b0\u521b\u5efa PodSandbox \u65f6\u4f1a\u4ea7\u751f\u9519\u8bef\u3002 \u91cd\u542f kubelet \u4e5f\u53ef\u80fd\u65e0\u6cd5\u89e3\u51b3\u6b64\u7c7b\u95ee\u9898\u3002"}),(0,r.jsx)(n.p,{children:"\u5982\u679c\u4f60\u6709\u5207\u5b9e\u53ef\u884c\u7684\u81ea\u52a8\u5316\u65b9\u6848\uff0c\u4f7f\u7528\u5176\u4ed6\u5df2\u66f4\u65b0\u914d\u7f6e\u7684\u8282\u70b9\u6765\u66ff\u6362\u8be5\u8282\u70b9\uff0c \u6216\u8005\u4f7f\u7528\u81ea\u52a8\u5316\u65b9\u6848\u6765\u91cd\u65b0\u5b89\u88c5\u3002"})]}),"\n",(0,r.jsx)(n.h3,{id:"\u5b89\u88c5containerd",children:"\u5b89\u88c5containerd"}),"\n",(0,r.jsx)(n.h4,{id:"\u5b89\u88c5containerd-1",children:"\u5b89\u88c5containerd"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://github.com/containerd/containerd/blob/main/RELEASES.md#kubernetes-support",children:"\u67e5\u770bk8s\u548ccontainerd\u7248\u672c\u517c\u5bb9\u5173\u7cfb"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://github.com/containerd/containerd/blob/main/docs/getting-started.md",children:"containerd\u5b98\u65b9\u5b89\u88c5\u6587\u6863"})}),"\n",(0,r.jsx)(n.admonition,{title:"\u6ce8\u610f",type:"caution",children:(0,r.jsxs)(n.p,{children:["\u4ecev1.6\u7248\u672c\u5f00\u59cb\uff0c\u6346\u7ed1\u5305 ",(0,r.jsx)(n.code,{children:"cri-containerd-*.tar.gz"})," \u5df2\u7ecf\u88ab\u5f03\u7528\uff0c\u5e76\u4e14\u4f1a\u5728v2.0\u7248\u672c\u5220\u9664\uff0c\u8fd9\u91cc\u6709 ",(0,r.jsx)(n.a,{href:"https://github.com/containerd/containerd/blob/main/RELEASES.md#deprecated-features",children:"\u5b98\u65b9\u8bf4\u660e"})]})}),"\n",(0,r.jsx)(n.p,{children:"\u4e0b\u8f7d\u5b89\u88c5\u5305"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"export CONTAINERD_VERSION=1.7.8\nwget https://github.com/containerd/containerd/releases/download/v${CONTAINERD_VERSION}/containerd-${CONTAINERD_VERSION}-linux-amd64.tar.gz\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u538b\u7f29\u5305\u5185\u5bb9\u5982\u4e0b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ tar tf containerd-1.7.8-linux-amd64.tar.gz \nbin/\nbin/containerd-shim-runc-v1\nbin/containerd-stress\nbin/containerd-shim-runc-v2\nbin/containerd\nbin/containerd-shim\nbin/ctr\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u89e3\u538b\u7f29"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"tar Cxzvf /usr/local containerd-${CONTAINERD_VERSION}-linux-amd64.tar.gz\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528systemd\u7ba1\u7406containerd"}),"\n",(0,r.jsx)(n.p,{children:"\u4e0b\u8f7d\u6587\u4ef6"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"curl https://raw.githubusercontent.com/containerd/containerd/main/containerd.service -o /usr/lib/systemd/system/containerd.service\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"containerd.service"})," \u6587\u4ef6\u5185\u5bb9\u5982\u4e0b"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'# Copyright The containerd Authors.\n#\n# Licensed under the Apache License, Version 2.0 (the "License");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an "AS IS" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\n[Unit]\nDescription=containerd container runtime\nDocumentation=https://containerd.io\nAfter=network.target local-fs.target\n\n[Service]\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/usr/local/bin/containerd\n\nType=notify\nDelegate=yes\nKillMode=process\nRestart=always\nRestartSec=5\n\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNPROC=infinity\nLimitCORE=infinity\n\n# Comment TasksMax if your systemd version does not supports it.\n# Only systemd 226 and above support this version.\nTasksMax=infinity\nOOMScoreAdjust=-999\n\n[Install]\nWantedBy=multi-user.target\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u91cd\u65b0\u52a0\u8f7d systemd \u7684\u914d\u7f6e\u5e76\u8bbe\u7f6econtainerd\u670d\u52a1\u5f00\u673a\u81ea\u542f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"systemctl daemon-reload\nsystemctl enable --now containerd\n"})}),"\n",(0,r.jsx)(n.h4,{id:"\u5b89\u88c5runc",children:"\u5b89\u88c5runc"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://github.com/opencontainers/runc",children:"runc github\u5730\u5740"})}),"\n",(0,r.jsx)(n.p,{children:"\u4e0b\u8f7d\u5b89\u88c5\u5305"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"export RUNC_VERSION=1.1.9\nwget https://github.com/opencontainers/runc/releases/download/v${RUNC_VERSION}/runc.amd64\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5b89\u88c5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"install -m 755 runc.amd64 /usr/local/sbin/runc\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u9a8c\u8bc1"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ runc -v\nrunc version 1.1.9\ncommit: v1.1.9-0-gccaecfcb\nspec: 1.0.2-dev\ngo: go1.20.3\nlibseccomp: 2.5.4\n"})}),"\n",(0,r.jsx)(n.h4,{id:"\u5b89\u88c5cni\u63d2\u4ef6",children:"\u5b89\u88c5CNI\u63d2\u4ef6"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://github.com/containernetworking/plugins",children:"CNI\u63d2\u4ef6github\u5730\u5740"})}),"\n",(0,r.jsx)(n.p,{children:"\u4e0b\u8f7d\u5b89\u88c5\u5305"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"export CNI_VERSION=1.3.0\nwget https://github.com/containernetworking/plugins/releases/download/v${CNI_VERSION}/cni-plugins-linux-amd64-v${CNI_VERSION}.tgz\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5b89\u88c5\u5305\u5185\u5bb9\u5982\u4e0b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"$ tar tf cni-plugins-linux-amd64-v1.3.0.tgz \n./\n./loopback\n./bandwidth\n./ptp\n./vlan\n./host-device\n./tuning\n./vrf\n./sbr\n./tap\n./dhcp\n./static\n./firewall\n./macvlan\n./dummy\n./bridge\n./ipvlan\n./portmap\n./host-local\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u89e3\u538b\u7f29"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"tar Cxzvf /usr/local/bin cni-plugins-linux-amd64-v${CNI_VERSION}.tgz\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u914d\u7f6econtainerd",children:"\u914d\u7f6econtainerd"}),"\n",(0,r.jsx)(n.h4,{id:"\u521b\u5efacontainerd\u914d\u7f6e\u6587\u4ef6",children:"\u521b\u5efacontainerd\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://github.com/containerd/containerd/blob/main/docs/getting-started.md#advanced-topics",children:"\u5b98\u65b9\u8bf4\u660e\u6587\u6863"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"mkdir -p /etc/containerd && containerd config default > /etc/containerd/config.toml\n"})}),"\n",(0,r.jsx)(n.h4,{id:"\u914d\u7f6e-systemd-group-\u9a71\u52a8",children:"\u914d\u7f6e systemd group \u9a71\u52a8"}),"\n",(0,r.jsxs)(n.admonition,{title:"\u8bf4\u660e",type:"tip",children:[(0,r.jsxs)(n.p,{children:["\u5f53 ",(0,r.jsx)(n.a,{href:"https://www.freedesktop.org/wiki/Software/systemd/",children:"systemd"})," \u662f\u521d\u59cb\u5316\u7cfb\u7edf\u65f6\uff0c ",(0,r.jsx)(n.strong,{children:"\u4e0d"})," \u63a8\u8350\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"cgroupfs"})," \u9a71\u52a8\uff0c\u56e0\u4e3a systemd \u671f\u671b\u7cfb\u7edf\u4e0a\u53ea\u6709\u4e00\u4e2a cgroup \u7ba1\u7406\u5668\u3002 \u6b64\u5916\uff0c\u5982\u679c\u4f60\u4f7f\u7528 ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/concepts/architecture/cgroups",children:"cgroup v2"}),"\uff0c \u5219\u5e94\u7528 ",(0,r.jsx)(n.code,{children:"systemd"})," cgroup \u9a71\u52a8\u53d6\u4ee3 ",(0,r.jsx)(n.code,{children:"cgroupfs"}),"\u3002"]}),(0,r.jsxs)(n.p,{children:["\u5f53\u67d0\u4e2a Linux \u7cfb\u7edf\u53d1\u884c\u7248\u4f7f\u7528 ",(0,r.jsx)(n.a,{href:"https://www.freedesktop.org/wiki/Software/systemd/",children:"systemd"})," \u4f5c\u4e3a\u5176\u521d\u59cb\u5316\u7cfb\u7edf\u65f6\uff0c\u521d\u59cb\u5316\u8fdb\u7a0b\u4f1a\u751f\u6210\u5e76\u4f7f\u7528\u4e00\u4e2a root \u63a7\u5236\u7ec4\uff08",(0,r.jsx)(n.code,{children:"cgroup"}),"\uff09\uff0c\u5e76\u5145\u5f53 cgroup \u7ba1\u7406\u5668\u3002"]}),(0,r.jsxs)(n.p,{children:["systemd \u4e0e cgroup \u96c6\u6210\u7d27\u5bc6\uff0c\u5e76\u5c06\u4e3a\u6bcf\u4e2a systemd \u5355\u5143\u5206\u914d\u4e00\u4e2a cgroup\u3002 \u56e0\u6b64\uff0c\u5982\u679c\u4f60 ",(0,r.jsx)(n.code,{children:"systemd"})," \u7528\u4f5c\u521d\u59cb\u5316\u7cfb\u7edf\uff0c\u540c\u65f6\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"cgroupfs"})," \u9a71\u52a8\uff0c\u5219\u7cfb\u7edf\u4e2d\u4f1a\u5b58\u5728\u4e24\u4e2a\u4e0d\u540c\u7684 cgroup \u7ba1\u7406\u5668\u3002"]}),(0,r.jsxs)(n.p,{children:["\u540c\u65f6\u5b58\u5728\u4e24\u4e2a cgroup \u7ba1\u7406\u5668\u5c06\u9020\u6210\u7cfb\u7edf\u4e2d\u9488\u5bf9\u53ef\u7528\u7684\u8d44\u6e90\u548c\u4f7f\u7528\u4e2d\u7684\u8d44\u6e90\u51fa\u73b0\u4e24\u4e2a\u89c6\u56fe\u3002\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c \u5c06 kubelet \u548c\u5bb9\u5668\u8fd0\u884c\u65f6\u914d\u7f6e\u4e3a\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"cgroupfs"}),"\u3001\u4f46\u4e3a\u5269\u4f59\u7684\u8fdb\u7a0b\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"systemd"})," \u7684\u90a3\u4e9b\u8282\u70b9\u5c06\u5728\u8d44\u6e90\u538b\u529b\u589e\u5927\u65f6\u53d8\u5f97\u4e0d\u7a33\u5b9a\u3002"]}),(0,r.jsxs)(n.p,{children:["\u5f53 systemd \u662f\u9009\u5b9a\u7684\u521d\u59cb\u5316\u7cfb\u7edf\u65f6\uff0c\u7f13\u89e3\u8fd9\u4e2a\u4e0d\u7a33\u5b9a\u95ee\u9898\u7684\u65b9\u6cd5\u662f\u9488\u5bf9 kubelet \u548c\u5bb9\u5668\u8fd0\u884c\u65f6\u5c06 ",(0,r.jsx)(n.code,{children:"systemd"})," \u7528\u4f5c cgroup \u9a71\u52a8\u3002"]})]}),"\n",(0,r.jsxs)(n.p,{children:["\u4fee\u6539 ",(0,r.jsx)(n.code,{children:"/etc/containerd/config.toml"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"\u4fee\u6539\n    SystemdCgroup = false\n\n\u4fee\u6539\u4e3a\n    SystemdCgroup = true\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u7528\u5982\u4e0b\u547d\u4ee4\u4fee\u6539"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sed -i.bak 's/SystemdCgroup = false/SystemdCgroup = true/' /etc/containerd/config.toml\n"})}),"\n",(0,r.jsx)(n.h4,{id:"\u4fee\u6539-pause-\u955c\u50cf\u5730\u5740",children:"\u4fee\u6539 pause \u955c\u50cf\u5730\u5740"}),"\n",(0,r.jsxs)(n.admonition,{title:"\u8bf4\u660e",type:"tip",children:[(0,r.jsxs)(n.p,{children:["\u5728 ",(0,r.jsx)(n.code,{children:"/etc/containerd/config.toml"})," \u914d\u7f6e\u6587\u4ef6\u4e2d\uff0cpause\u955c\u50cf\u7684\u9ed8\u8ba4\u5730\u5740\u662f ",(0,r.jsx)(n.code,{children:"registry.k8s.io/pause:3.8"}),"\uff0c\u7531\u4e8e\u67d0\u4e9b\u7279\u6b8a\u539f\u56e0\uff0c\u9700\u8981\u4fee\u6539\u8fd9\u4e2a\u955c\u50cf\u7684\u5730\u5740\uff0c\u53ef\u4ee5\u4f7f\u7528ucloud\u63d0\u4f9b\u7684\u52a0\u901f\u5730\u5740"]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"uhub.service.ucloud.cn/996.icu/pause:3.8"})})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'[plugins."io.containerd.grpc.v1.cri"]\n  ......\n  sandbox_image = "registry.k8s.io/pause:3.8"\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u7528\u5982\u4e0b\u547d\u4ee4\u4fee\u6539"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sed -i 's#registry.k8s.io#uhub.service.ucloud.cn/996.icu#' /etc/containerd/config.toml\n"})}),"\n",(0,r.jsx)(n.h4,{id:"\u914d\u7f6econtainerd\u955c\u50cf\u4ed3\u5e93\u52a0\u901f",children:"\u914d\u7f6econtainerd\u955c\u50cf\u4ed3\u5e93\u52a0\u901f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'[plugins."io.containerd.grpc.v1.cri"]\n  ...\n  # sandbox_image = "k8s.gcr.io/pause:3.8"\n  sandbox_image = "registry.aliyuncs.com/k8sxio/pause:3.8"\n  ...\n  [plugins."io.containerd.grpc.v1.cri".registry]\n    [plugins."io.containerd.grpc.v1.cri".registry.mirrors]\n      [plugins."io.containerd.grpc.v1.cri".registry.mirrors."docker.io"]\n        endpoint = ["https://bqr1dr1n.mirror.aliyuncs.com"]\n      [plugins."io.containerd.grpc.v1.cri".registry.mirrors."k8s.gcr.io"]\n        endpoint = ["https://registry.aliyuncs.com/k8sxio"]\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u91cd\u542fcontainerd"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"systemctl restart containerd\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770b\u8fd0\u884c\u72b6\u6001"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'$ systemctl status containerd\n\u25cf containerd.service - containerd container runtime\n   Loaded: loaded (/usr/lib/systemd/system/containerd.service; enabled; vendor preset: disabled)\n   Active: active (running) since Thu 2023-10-26 19:41:04 CST; 6min ago\n     Docs: https://containerd.io\n  Process: 27269 ExecStartPre=/sbin/modprobe overlay (code=exited, status=0/SUCCESS)\n Main PID: 27273 (containerd)\n    Tasks: 9\n   Memory: 29.1M\n   CGroup: /system.slice/containerd.service\n           \u2514\u250027273 /usr/local/bin/containerd\n\nOct 26 19:41:05 k8s containerd[27273]: time="2023-10-26T19:41:04.974636799+08:00" level=info msg="Start subscribing containerd event"\nOct 26 19:41:05 k8s containerd[27273]: time="2023-10-26T19:41:04.974851585+08:00" level=info msg="Start recovering state"\nOct 26 19:41:05 k8s containerd[27273]: time="2023-10-26T19:41:04.975620149+08:00" level=info msg="Start event monitor"\nOct 26 19:41:05 k8s containerd[27273]: time="2023-10-26T19:41:04.975638830+08:00" level=info msg="Start snapshots syncer"\nOct 26 19:41:05 k8s containerd[27273]: time="2023-10-26T19:41:04.975648925+08:00" level=info msg="Start cni network conf syncer for default"\nOct 26 19:41:05 k8s containerd[27273]: time="2023-10-26T19:41:04.975655890+08:00" level=info msg="Start streaming server"\nOct 26 19:41:05 k8s containerd[27273]: time="2023-10-26T19:41:04.977412869+08:00" level=info msg="skipping tracing processor initialization (no tracing plugin)"...kip plugin"\nOct 26 19:41:05 k8s containerd[27273]: time="2023-10-26T19:41:04.978883545+08:00" level=info msg=serving... address=/run/containerd/containerd.sock.ttrpc\nOct 26 19:41:05 k8s containerd[27273]: time="2023-10-26T19:41:04.978946259+08:00" level=info msg=serving... address=/run/containerd/containerd.sock\nOct 26 19:41:05 k8s containerd[27273]: time="2023-10-26T19:41:04.983535827+08:00" level=info msg="containerd successfully booted in 0.090335s"\nHint: Some lines were ellipsized, use -l to show in full.\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u5b89\u88c5cri-tools\u53ef\u9009",children:"\u5b89\u88c5cri-tools\uff08\u53ef\u9009\uff09"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://github.com/kubernetes-sigs/cri-tools",children:"cri-tools github\u5730\u5740"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://github.com/kubernetes-sigs/cri-tools/blob/master/docs/crictl.md",children:"cri-tools\u5b98\u65b9\u6587\u6863"})}),"\n",(0,r.jsx)(n.p,{children:"\u4e0b\u8f7d\u5b89\u88c5\u5305"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"export CRICTL_VERSION=1.28.0\nhttps://github.com/kubernetes-sigs/cri-tools/releases/download/v${CRICTL_VERSION}/crictl-v${CRICTL_VERSION}-linux-amd64.tar.gz\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u89e3\u538b\u7f29"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"tar Cxzvf /usr/local/bin crictl-v${CRICTL_VERSION}-linux-amd64.tar.gz\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6267\u884c\u547d\u4ee4\u62a5\u9519"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:'$ crictl images\nWARN[0000] image connect using default endpoints: [unix:///var/run/dockershim.sock unix:///run/containerd/containerd.sock unix:///run/crio/crio.sock unix:///var/run/cri-dockerd.sock]. As the default settings are now deprecated, you should set the endpoint instead. \nERRO[0000] validate service connection: validate CRI v1 image API for endpoint "unix:///var/run/dockershim.sock": rpc error: code = Unavailable desc = connection error: desc = "transport: Error while dialing: dial unix /var/run/dockershim.sock: connect: no such file or directory" \n'})}),"\n",(0,r.jsx)(n.p,{children:"\u89e3\u51b3\u65b9\u6cd5"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://www.cyberithub.com/solved-error-while-dialing-dial-unix-var-run-dockershim-sock/",children:"\u89e3\u51b3\u65b9\u6cd5\u94fe\u63a5"})}),"\n",(0,r.jsx)(n.p,{children:"\u56e0\u4e3a\u4f7f\u7528\u7684\u662fcontainerd\uff0c\u56e0\u6b64\u9700\u8981\u5c06\u5bb9\u5668\u8fd0\u884c\u65f6\u4fee\u6539\u4e3acontainerd\uff0c\u4fee\u6539\u5b8c\u6210\u540e\u5c31\u53ef\u4ee5\u6210\u529f\u6267\u884c\u547d\u4ee4\u4e86"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"crictl config --set runtime-endpoint=unix:///run/containerd/containerd.sock --set image-endpoint=unix:///run/containerd/containerd.sock\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"/etc/crictl.yaml"})," \u6587\u4ef6\u5185\u5bb9\u6700\u7ec8\u5982\u4e0b"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"$ cat /etc/crictl.yaml \nruntime-endpoint: unix:///run/containerd/containerd.sock\nimage-endpoint: unix:///run/containerd/containerd.sock\ntimeout: 0\ndebug: false\npull-image-on-create: false\ndisable-pull-on-run: false\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u914d\u7f6e ",(0,r.jsx)(n.code,{children:"crictl"})," \u547d\u4ee4\u8865\u5168"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'echo "source <(crictl completion bash)" >> ~/.bashrc\nsource ~/.bashrc\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u5b89\u88c5nerdctl\u53ef\u9009",children:"\u5b89\u88c5nerdctl\uff08\u53ef\u9009\uff09"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://github.com/containerd/nerdctl",children:"nerdctl github\u5730\u5740"})}),"\n",(0,r.jsxs)(n.admonition,{title:"\u8bf4\u660e",type:"tip",children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"nerdctl"})," \u662f\u4e00\u4e2a\u9002\u7528\u4e8econtainerd\u7684dcoker\u517c\u5bb9CLI"]}),(0,r.jsxs)(n.p,{children:["\u5b89\u88c5containerd\u540e\u9700\u8981\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"ctr"})," \u547d\u4ee4\u7ba1\u7406\u64cd\u4f5c\u5bb9\u5668\uff0c\u4f46\u662f\u64cd\u4f5c\u547d\u4ee4\u4e0edocker\u76f8\u5dee\u6bd4\u8f83\u5927\uff0c ",(0,r.jsx)(n.code,{children:"nerdctl"})," \u5c31\u5f88\u597d\u7684\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\uff0c\u65e2\u80fd\u5728\u4f7f\u7528containerd\u7684\u540c\u65f6\u53c8\u80fd\u4f7f\u7528\u539f\u5148docker\u547d\u4ee4\u7684\u7528\u6cd5"]})]}),"\n",(0,r.jsx)(n.p,{children:"\u4e0b\u8f7d\u5b89\u88c5\u5305"}),"\n",(0,r.jsx)(n.admonition,{title:"\u8bf4\u660e",type:"tip",children:(0,r.jsxs)(n.p,{children:["\u5982\u679c\u6ca1\u6709\u5b89\u88c5 containerd\uff0c\u5219\u53ef\u4ee5\u4e0b\u8f7d ",(0,r.jsx)(n.code,{children:"nerdctl-full-\\<VERSION>-linux-amd64.tar.gz"})," \u5305\u8fdb\u884c\u5b89\u88c5\uff0c\u5e76\u4e14 ",(0,r.jsx)(n.code,{children:"nerdctl-full"})," \u8fd9\u4e2a\u5305\u662f\u4e0econtainerd\u7248\u672c\u4e00\u4e00\u5bf9\u5e94\u7684\uff0c\u5373containerd\u53d1\u5e03\u4e00\u4e2a\u7248\u672c\u540e\uff0c",(0,r.jsx)(n.code,{children:"nerdctl-full"})," \u4e5f\u968f\u5373\u53d1\u5e03\u4e00\u4e2a\u7248\u672c\uff0c\u867d\u71362\u8005\u7248\u672c\u53f7\u4e0d\u4e00\u81f4\uff0c\u4f46\u662f\u662f\u4e92\u76f8\u5bf9\u5e94\u7684"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"# \u8fd9\u91cc\u5b89\u88c5\u7684containerd\u7248\u672c\u4e3a1.7.8\nexport NERDCTL_VERSION=1.6.2\nwget https://github.com/containerd/nerdctl/releases/download/v${NERDCTL_VERSION}/nerdctl-${NERDCTL_VERSION}-linux-amd64.tar.gz\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u89e3\u538b\u7f29"}),"\n",(0,r.jsxs)(n.admonition,{title:"\u8bf4\u660e",type:"tip",children:[(0,r.jsxs)(n.p,{children:["\u538b\u7f29\u5305\u5185\u5bb9\u4e3a ",(0,r.jsx)(n.code,{children:"nerdctl"})," \u547d\u4ee4\u4ee5\u53ca ",(0,r.jsx)(n.code,{children:"containerd-rootless-setuptool.sh"})," \u548c ",(0,r.jsx)(n.code,{children:"containerd-rootless.sh"})," \uff0c\u5747\u6709\u6267\u884c\u6743\u9650"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ tar tf nerdctl-${NERDCTL_VERSION}-linux-amd64.tar.gz \nnerdctl\ncontainerd-rootless-setuptool.sh\ncontainerd-rootless.sh\n"})})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"tar xf nerdctl-${NERDCTL_VERSION}-linux-amd64.tar.gz \n"})}),"\n",(0,r.jsx)(n.p,{children:"\u62f7\u8d1d\u4e8c\u8fdb\u5236\u6587\u4ef6"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"mv nerdctl /usr/local/bin\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u914d\u7f6e ",(0,r.jsx)(n.code,{children:"nerdctl"})," \u547d\u4ee4\u8865\u5168"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'echo "source <(nerdctl completion bash)" >> ~/.bashrc\nsource ~/.bashrc\n'})}),"\n",(0,r.jsx)(n.h5,{id:"\u5b89\u88c5\u5176\u4ed6\u7ec4\u4ef6",children:"\u5b89\u88c5\u5176\u4ed6\u7ec4\u4ef6"}),"\n",(0,r.jsx)(n.h6,{id:"cni-plugins-cni-\u63d2\u4ef6-",children:(0,r.jsx)(n.a,{href:"https://github.com/containernetworking/plugins",children:"CNI plugins CNI \u63d2\u4ef6 "})}),"\n",(0,r.jsxs)(n.p,{children:["\u6b64\u63d2\u4ef6\u7528\u4e8e\u6267\u884c ",(0,r.jsx)(n.code,{children:"nerdctl run"})," \u547d\u4ee4\uff0c\u5f3a\u70c8\u5efa\u8bae\u4f7f\u7528 v1.1.0 \u6216\u66f4\u9ad8\u7248\u672c\u3002\u65e7\u7248\u672c\u9700\u8981\u989d\u5916\u7684 CNI \u9694\u79bb\u63d2\u4ef6\u6765\u9694\u79bb\u6865\u63a5\u7f51\u7edc"]}),"\n",(0,r.jsxs)(n.h6,{id:"buildkit-\u6784\u5efa\u5957\u4ef6--\u53ef\u9009",children:[(0,r.jsx)(n.a,{href:"https://github.com/moby/buildkit",children:"BuildKit \u6784\u5efa\u5957\u4ef6 "})," \uff08\u53ef\u9009\uff09"]}),"\n",(0,r.jsxs)(n.p,{children:["\u6b64\u63d2\u4ef6\u7528\u4e8e\u6267\u884c ",(0,r.jsx)(n.code,{children:"nerdctl build"})," \uff0c\u5f3a\u70c8\u5efa\u8bae\u4f7f\u7528 v0.11.0 \u6216\u66f4\u9ad8\u7248\u672c\u3002\u67d0\u4e9b\u529f\u80fd\uff08\u4f8b\u5982\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"nerdctl system prune"}),"\uff09\u4e0d\u9002\u7528\u4e8e\u65e7\u7248\u672c\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["BuildKit \u5b88\u62a4\u7a0b\u5e8f\u9700\u8981\u8fd0\u884c\uff0c\u53c2\u8003 ",(0,r.jsx)(n.a,{href:"https://github.com/containerd/nerdctl/blob/main/docs/build.md",children:"\u6709\u5173\u8bbe\u7f6e BuildKit \u7684\u6587\u6863"})," \uff0c\u5426\u5219\u8fd0\u884c ",(0,r.jsx)(n.code,{children:"nerdctl build"})," \u4f1a\u62a5\u9519\u5982\u4e0b"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'$ nerdctl build\nbuild    (Build an image from a Dockerfile. Needs buildkitd to be running.)  builder  (Manage builds)\n[root@k8s ~]# nerdctl build -t hehe.com/devops/nginx .\nERRO[0000] `buildctl` needs to be installed and `buildkitd` needs to be running, see https://github.com/moby/buildkit  error="failed to ping to host unix:///run/buildkit-default/buildkitd.sock: exec: \\"buildctl\\": executable file not found in $PATH\\nfailed to ping to host unix:///run/buildkit/buildkitd.sock: exec: \\"buildctl\\": executable file not found in $PATH"\nFATA[0000] no buildkit host is available, tried 2 candidates: failed to ping to host unix:///run/buildkit-default/buildkitd.sock: exec: "buildctl": executable file not found in $PATH\nfailed to ping to host unix:///run/buildkit/buildkitd.sock: exec: "buildctl": executable file not found in $PATH \n'})}),"\n",(0,r.jsx)(n.p,{children:"\u4e0b\u8f7d\u5b89\u88c5\u5305"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"export BUILDKIT_VERSION=0.12.3\nwget https://github.com/moby/buildkit/releases/download/v${BUILDKIT_VERSION}/buildkit-v${BUILDKIT_VERSION}.linux-amd64.tar.gz\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u89e3\u538b\u7f29"}),"\n",(0,r.jsxs)(n.admonition,{title:"\u8bf4\u660e",type:"tip",children:[(0,r.jsx)(n.p,{children:"\u538b\u7f29\u5305\u5185\u5bb9\u5982\u4e0b"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ tar tf buildkit-v0.12.3.linux-amd64.tar.gz \nbin/\nbin/buildctl\nbin/buildkit-qemu-aarch64\nbin/buildkit-qemu-arm\nbin/buildkit-qemu-i386\nbin/buildkit-qemu-mips64\nbin/buildkit-qemu-mips64el\nbin/buildkit-qemu-ppc64le\nbin/buildkit-qemu-riscv64\nbin/buildkit-qemu-s390x\nbin/buildkit-runc\nbin/buildkitd\n"})})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"tar xf buildkit-v${BUILDKIT_VERSION}.linux-amd64.tar.gz\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u62f7\u8d1d ",(0,r.jsx)(n.code,{children:"buildkitd"})," \u547d\u4ee4"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"cp bin/buildkitd /usr/local/bin\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u542f\u52a8 ",(0,r.jsx)(n.code,{children:"buildkitd"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"buildkitd &\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"buildkitd"})," \u542f\u52a8\u6210\u529f\u540e\u5c31\u53ef\u4ee5\u6267\u884c ",(0,r.jsx)(n.code,{children:"nerdctl build"})," \u547d\u4ee4\u4e86"]}),"\n",(0,r.jsxs)(n.h6,{id:"rootlesskit-and-slirp4netns-\u53ef\u9009",children:[(0,r.jsx)(n.a,{href:"https://github.com/rootless-containers/rootlesskit",children:"RootlessKit"})," and ",(0,r.jsx)(n.a,{href:"https://github.com/rootless-containers/slirp4netns",children:"slirp4netns"})," \uff08\u53ef\u9009\uff09"]}),"\n",(0,r.jsx)(n.p,{children:"RootlessKit \u9700\u8981\u662f v0.10.0 \u6216\u66f4\u9ad8\u7248\u672c\u3002\u63a8\u8350v0.14.1\u6216\u66f4\u9ad8\u7248\u672c\u3002"}),"\n",(0,r.jsx)(n.p,{children:"slirp4netns \u9700\u8981\u662f v0.4.0 \u6216\u66f4\u9ad8\u7248\u672c\u3002\u63a8\u8350v1.1.7\u6216\u66f4\u9ad8\u7248\u672c\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u6b64\u63d2\u4ef6\u7528\u4e8e ",(0,r.jsx)(n.code,{children:"rootless"})," \u6a21\u5f0f\uff0c\u53ef\u4ee5\u53c2\u8003",(0,r.jsx)(n.a,{href:"https://docs.docker.com/engine/security/rootless/",children:"docker\u5b98\u65b9\u5bf9rootless\u6a21\u5f0f\u7684\u8bf4\u660e"})]}),"\n",(0,r.jsx)(n.admonition,{title:"\u8bf4\u660e",type:"info",children:(0,r.jsxs)(n.p,{children:["\u4ee5\u4e0a3\u4e2a\u63d2\u4ef6\u5305\u542b\u5728 ",(0,r.jsx)(n.code,{children:"nerdctl-full-<VERSION>-<OS>-<ARCH>.tar.gz"})," \u4e2d\uff0c\u4f46\u4e0d\u5305\u542b\u5728 ",(0,r.jsx)(n.code,{children:"nerdctl-<VERSION>-<OS>-<ARCH>.tar.gz"})," \u4e2d"]})}),"\n",(0,r.jsx)(n.h4,{id:"docker\u548ccontainerd\u5e38\u7528\u547d\u4ee4\u5bf9\u6bd4",children:"docker\u548ccontainerd\u5e38\u7528\u547d\u4ee4\u5bf9\u6bd4"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u547d\u4ee4"}),(0,r.jsx)(n.th,{children:"docker"}),(0,r.jsx)(n.th,{children:"crictl"}),(0,r.jsx)(n.th,{children:"nerdctl"}),(0,r.jsx)(n.th,{children:"ctr"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u67e5\u770b\u5bb9\u5668\u5217\u8868"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docker ps"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"crictl ps"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nerdctl ps"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ctr -n k8s.io c ls"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u67e5\u770b\u5bb9\u5668\u8be6\u60c5"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docker inspect"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"crictl inspect"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nerdctl inspect"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ctr -n k8s.io c info"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u67e5\u770b\u5bb9\u5668\u65e5\u5fd7"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docker logs"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"crictl logs"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nerdctl logs"})}),(0,r.jsx)(n.td,{children:"\u65e0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u5bb9\u5668\u5185\u6267\u884c\u547d\u4ee4"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docker exec"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"crictl exec"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nerdctl exec"})}),(0,r.jsx)(n.td,{children:"\u65e0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u6302\u8f7d\u5bb9\u5668"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docker attach"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"crictl attach"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nerdctl attach"})}),(0,r.jsx)(n.td,{children:"\u65e0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u663e\u793a\u5bb9\u5668\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docker stats"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"crictl stats"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nerdctl stats"})}),(0,r.jsx)(n.td,{children:"\u65e0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u521b\u5efa\u5bb9\u5668"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docker create"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"crictl create"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nerdctl create"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ctr -n k8s.io c create"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u542f\u52a8\u5bb9\u5668"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docker start"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"crictl start"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nerdctl start"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ctr -n k8s.io run"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u505c\u6b62\u5bb9\u5668"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docker stop"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"crictl stop"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nerdctl stop"})}),(0,r.jsx)(n.td,{children:"\u65e0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u5220\u9664\u5bb9\u5668"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docker rm"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"crictl rm"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nerdctl rm"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ctr -n k8s.io c del"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u67e5\u770b\u955c\u50cf\u5217\u8868"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docker images"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"crictl images"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nerdctl images"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ctr -n k8s.io i ls"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u67e5\u770b\u955c\u50cf\u8be6\u60c5"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docker inspect"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"crictl inspecti"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nerdctl inspect"})}),(0,r.jsx)(n.td,{children:"\u65e0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u62c9\u53d6\u955c\u50cf"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docker pull"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"crictl pull"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nerdctl pull"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ctr -n k8s.io i pull"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u63a8\u9001\u955c\u50cf"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docker push"})}),(0,r.jsx)(n.td,{children:"\u65e0"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nerdctl push"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ctr -n k8s.io i push"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u5220\u9664\u955c\u50cf"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docker rmi"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"crictl rmi"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nerdctl rmi"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ctr -n k8s.io i rm"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u67e5\u770bPod\u5217\u8868"}),(0,r.jsx)(n.td,{children:"\u65e0"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"crictl pods"})}),(0,r.jsx)(n.td,{children:"\u65e0"}),(0,r.jsx)(n.td,{children:"\u65e0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u67e5\u770bPod\u8be6\u60c5"}),(0,r.jsx)(n.td,{children:"\u65e0"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"crictl inspectp"})}),(0,r.jsx)(n.td,{children:"\u65e0"}),(0,r.jsx)(n.td,{children:"\u65e0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u542f\u52a8Pod"}),(0,r.jsx)(n.td,{children:"\u65e0"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"crictl runp"})}),(0,r.jsx)(n.td,{children:"\u65e0"}),(0,r.jsx)(n.td,{children:"\u65e0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u505c\u6b62Pod"}),(0,r.jsx)(n.td,{children:"\u65e0"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"crictl stop"})}),(0,r.jsx)(n.td,{children:"\u65e0"}),(0,r.jsx)(n.td,{children:"\u65e0"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"\u5b89\u88c5kubeadmkubeletkubectl",children:"\u5b89\u88c5kubeadm\u3001kubelet\u3001kubectl"}),"\n",(0,r.jsx)(n.h3,{id:"\u914d\u7f6eyum\u6e90",children:"\u914d\u7f6eyum\u6e90"}),"\n",(0,r.jsx)(n.p,{children:"\u5b98\u65b9yum\u6e90"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://pkgs.k8s.io/core:/stable:/v1.28/rpm/\nenabled=1\ngpgcheck=1\ngpgkey=https://pkgs.k8s.io/core:/stable:/v1.28/rpm/repodata/repomd.xml.key\nexclude=kubelet kubeadm kubectl cri-tools kubernetes-cni\nEOF\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u963f\u91cc\u4e91yum\u6e90"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"cat > /etc/yum.repos.d/kubernetes.repo << EOF\n[kubernetes]\nname=Kubernetes\nbaseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg\n        http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5b89\u88c5-kubeletkubeadm-\u548c-kubectl\u5e76\u542f\u7528-kubelet-\u4ee5\u786e\u4fdd\u5b83\u5728\u542f\u52a8\u65f6\u81ea\u52a8\u542f\u52a8",children:"\u5b89\u88c5 kubelet\u3001kubeadm \u548c kubectl\uff0c\u5e76\u542f\u7528 kubelet \u4ee5\u786e\u4fdd\u5b83\u5728\u542f\u52a8\u65f6\u81ea\u52a8\u542f\u52a8"}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770b\u53ef\u5b89\u88c5\u7684\u7248\u672c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"yum list kubeadm --showduplicates\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6307\u5b9a\u5b89\u88c5\u7248\u672c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"export K8S_VERSION=1.28.3\nyum -y install kubelet-${K8S_VERSION} kubeadm-${K8S_VERSION} kubectl-${K8S_VERSION} --disableexcludes=kubernetes\nsystemctl enable --now kubelet\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5b89\u88c5\u6700\u65b0\u7248"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes\nsystemctl enable --now kubelet\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"\u8bbe\u7f6e-kubectl-\u547d\u4ee4\u8865\u5168",children:["\u8bbe\u7f6e ",(0,r.jsx)(n.code,{children:"kubectl"})," \u547d\u4ee4\u8865\u5168"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'yum -y install bash-completion \necho "source <(kubectl completion bash)" >> ~/.bashrc && source ~/.bashrc\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u4f7f\u7528kubeadm\u521b\u5efa\u96c6\u7fa4",children:"\u4f7f\u7528kubeadm\u521b\u5efa\u96c6\u7fa4"}),"\n",(0,r.jsx)(n.h3,{id:"\u521d\u59cb\u5316master\u8282\u70b9",children:"\u521d\u59cb\u5316master\u8282\u70b9"}),"\n",(0,r.jsxs)(n.p,{children:["\u53ef\u6267\u884c ",(0,r.jsx)(n.code,{children:"kubeadm config print init-defaults"})," \u67e5\u770b\u9ed8\u8ba4\u914d\u7f6e"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"$ kubeadm config print init-defaults\napiVersion: kubeadm.k8s.io/v1beta3\nbootstrapTokens:\n- groups:\n  - system:bootstrappers:kubeadm:default-node-token\n  token: abcdef.0123456789abcdef\n  ttl: 24h0m0s\n  usages:\n  - signing\n  - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n  advertiseAddress: 1.2.3.4\n  bindPort: 6443\nnodeRegistration:\n  criSocket: unix:///var/run/containerd/containerd.sock\n  imagePullPolicy: IfNotPresent\n  name: node\n  taints: null\n---\napiServer:\n  timeoutForControlPlane: 4m0s\napiVersion: kubeadm.k8s.io/v1beta3\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrollerManager: {}\ndns: {}\netcd:\n  local:\n    dataDir: /var/lib/etcd\nimageRepository: registry.k8s.io\nkind: ClusterConfiguration\nkubernetesVersion: 1.30.0\nnetworking:\n  dnsDomain: cluster.local\n  serviceSubnet: 10.96.0.0/12\nscheduler: {}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"\u521d\u59cb\u5316\u65b9\u5f0f",children:"\u521d\u59cb\u5316\u65b9\u5f0f"}),"\n",(0,r.jsx)(n.h5,{id:"\u914d\u7f6e\u6587\u4ef6\u65b9\u5f0f",children:"\u914d\u7f6e\u6587\u4ef6\u65b9\u5f0f"}),"\n",(0,r.jsxs)(n.admonition,{title:"\u8bf4\u660e",type:"tip",children:[(0,r.jsx)(n.p,{children:"\u521d\u59cb\u5316\u65b9\u5f0f\u6709\u547d\u4ee4\u884c\u548c\u914d\u7f6e\u6587\u4ef6\u65b9\u5f0f2\u79cd"}),(0,r.jsxs)(n.p,{children:["\u914d\u7f6e\u6587\u4ef6\u65b9\u5f0f\u53ef\u4ee5\u53c2\u8003",(0,r.jsx)(n.a,{href:"https://pkg.go.dev/k8s.io/kubernetes/cmd/kubeadm/app/apis/kubeadm/v1beta3",children:"\u5b98\u65b9\u8bf4\u660e\u6587\u6863"})," \uff0c\u5982\u4e0b\u662f\u5b98\u65b9\u793a\u4f8b\u5b8c\u6574\u914d\u7f6e\u6587\u4ef6"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kubeadm.k8s.io/v1beta3\nkind: InitConfiguration\nbootstrapTokens:\n- token: "9a08jv.c0izixklcxtmnze7"\n  description: "kubeadm bootstrap token"\n  ttl: "24h"\n- token: "783bde.3f89s0fje9f38fhf"\n  description: "another bootstrap token"\n  usages:\n  - authentication\n  - signing\n  groups:\n  - system:bootstrappers:kubeadm:default-node-token\nnodeRegistration:\n  name: "ec2-10-100-0-1"\n  criSocket: "unix:///var/run/containerd/containerd.sock"\n  taints:\n  - key: "kubeadmNode"\n    value: "someValue"\n    effect: "NoSchedule"\n  kubeletExtraArgs:\n    v: 4\n  ignorePreflightErrors:\n  - IsPrivilegedUser\n  imagePullPolicy: "IfNotPresent"\nlocalAPIEndpoint:\n  advertiseAddress: "10.100.0.1"\n  bindPort: 6443\ncertificateKey: "e6a2eb8581237ab72a4f494f30285ec12a9694d750b9785706a83bfcbbbd2204"\nskipPhases:\n- addon/kube-proxy\n---\napiVersion: kubeadm.k8s.io/v1beta3\nkind: ClusterConfiguration\netcd:\n  # one of local or external\n  local:\n    imageRepository: "registry.k8s.io"\n    imageTag: "3.2.24"\n    dataDir: "/var/lib/etcd"\n    extraArgs:\n      listen-client-urls: "http://10.100.0.1:2379"\n    serverCertSANs:\n    -  "ec2-10-100-0-1.compute-1.amazonaws.com"\n    peerCertSANs:\n    - "10.100.0.1"\n  # external:\n    # endpoints:\n    # - "10.100.0.1:2379"\n    # - "10.100.0.2:2379"\n    # caFile: "/etcd/kubernetes/pki/etcd/etcd-ca.crt"\n    # certFile: "/etcd/kubernetes/pki/etcd/etcd.crt"\n    # keyFile: "/etcd/kubernetes/pki/etcd/etcd.key"\nnetworking:\n  serviceSubnet: "10.96.0.0/16"\n  podSubnet: "10.244.0.0/24"\n  dnsDomain: "cluster.local"\nkubernetesVersion: "v1.21.0"\ncontrolPlaneEndpoint: "10.100.0.1:6443"\napiServer:\n  extraArgs:\n    authorization-mode: "Node,RBAC"\n  extraVolumes:\n  - name: "some-volume"\n    hostPath: "/etc/some-path"\n    mountPath: "/etc/some-pod-path"\n    readOnly: false\n    pathType: File\n  certSANs:\n  - "10.100.1.1"\n  - "ec2-10-100-0-1.compute-1.amazonaws.com"\n  timeoutForControlPlane: 4m0s\ncontrollerManager:\n  extraArgs:\n    "node-cidr-mask-size": "20"\n  extraVolumes:\n  - name: "some-volume"\n    hostPath: "/etc/some-path"\n    mountPath: "/etc/some-pod-path"\n    readOnly: false\n    pathType: File\nscheduler:\n  extraArgs:\n    address: "10.100.0.1"\n  extraVolumes:\n  - name: "some-volume"\n    hostPath: "/etc/some-path"\n    mountPath: "/etc/some-pod-path"\n    readOnly: false\n    pathType: File\ncertificatesDir: "/etc/kubernetes/pki"\nimageRepository: "registry.k8s.io"\nclusterName: "example-cluster"\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\n# kubelet specific options here\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\n# kube-proxy specific options here\n'})})]}),"\n",(0,r.jsx)(n.p,{children:"\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u65b9\u5f0f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"kubeadm init --config kubeadm.yaml \n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"kubeadm.yaml "})," \u6587\u4ef6\u5185\u5bb9"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kubeadm.k8s.io/v1beta3\nbootstrapTokens:\n- groups:\n  - system:bootstrappers:kubeadm:default-node-token\n  token: abcdef.0123456789abcdef\n  ttl: 24h0m0s\n  usages:\n  - signing\n  - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n  advertiseAddress: 10.0.0.10  # \u6307\u5b9amaster\u8282\u70b9\u5185\u7f51IP\n  bindPort: 6443\nnodeRegistration:\n  criSocket: /run/containerd/containerd.sock  # \u4f7f\u7528 containerd \u7684 Unix socket \u5730\u5740\n  imagePullPolicy: IfNotPresent\n  name: k8s-master01 # master\u8282\u70b9\u4e3b\u673a\u540d\n  taints:  # \u7ed9master\u6dfb\u52a0\u6c61\u70b9\uff0cmaster\u8282\u70b9\u4e0d\u80fd\u8c03\u5ea6\u5e94\u7528\n  - effect: "NoSchedule"\n    key: "node-role.kubernetes.io/master"\n\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nmode: iptables  # kube-proxy \u6a21\u5f0f\n\n---\napiServer:\n  timeoutForControlPlane: 4m0s\napiVersion: kubeadm.k8s.io/v1beta3\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrollerManager: {}\ndns: {}\netcd:\n  local:\n    dataDir: /var/lib/etcd\nimageRepository: registry.aliyuncs.com/google_containers\nkind: ClusterConfiguration\nkubernetesVersion: 1.28.2\nnetworking:\n  dnsDomain: cluster.local\n  serviceSubnet: 10.96.0.0/12\n  podSubnet: 10.244.0.0/16  # \u6307\u5b9a pod \u5b50\u7f51\nscheduler: {}\n\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    cacheTTL: 0s\n    enabled: true\n  x509:\n    clientCAFile: /etc/kubernetes/pki/ca.crt\nauthorization:\n  mode: Webhook\n  webhook:\n    cacheAuthorizedTTL: 0s\n    cacheUnauthorizedTTL: 0s\nclusterDNS:\n- 10.96.0.10\nclusterDomain: cluster.local\ncpuManagerReconcilePeriod: 0s\nevictionPressureTransitionPeriod: 0s\nfileCheckFrequency: 0s\nhealthzBindAddress: 127.0.0.1\nhealthzPort: 10248\nhttpCheckFrequency: 0s\nimageMinimumGCAge: 0s\nkind: KubeletConfiguration\ncgroupDriver: systemd  # \u914d\u7f6e cgroup driver\nlogging: {}\nmemorySwap: {}\nnodeStatusReportFrequency: 0s\nnodeStatusUpdateFrequency: 0s\nrotateCertificates: true\nruntimeRequestTimeout: 0s\nshutdownGracePeriod: 0s\nshutdownGracePeriodCriticalPods: 0s\nstaticPodPath: /etc/kubernetes/manifests\nstreamingConnectionIdleTimeout: 0s\nsyncFrequency: 0s\nvolumeStatsAggPeriod: 0s\n'})}),"\n",(0,r.jsx)(n.h5,{id:"\u547d\u4ee4\u884c\u65b9\u5f0f",children:"\u547d\u4ee4\u884c\u65b9\u5f0f"}),"\n",(0,r.jsxs)(n.admonition,{title:"\u8bf4\u660e",type:"tip",children:[(0,r.jsxs)(n.p,{children:["\u521d\u59cb\u5316\u524d\u4e5f\u53ef\u4ee5\u6267\u884c ",(0,r.jsx)(n.code,{children:"kubeadm config images pull"}),"  \u628a\u9700\u8981\u7684\u955c\u50cf\u5148\u62c9\u53d6\u4e0b\u6765"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubeadm config images pull --image-repository registry.aliyuncs.com/google_containers\n"})})]}),"\n",(0,r.jsx)(n.p,{children:"\u547d\u4ee4\u884c\u65b9\u5f0f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubeadm init \\\n--apiserver-advertise-address=10.0.0.12 \\\n--image-repository registry.aliyuncs.com/google_containers \\\n--kubernetes-version v1.30.0 \\\n--service-cidr=10.96.0.0/16 \\\n--pod-network-cidr=10.244.0.0/16\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"init"})," \u6267\u884c\u6210\u529f\u540e\u4f1a\u6709\u5982\u4e0b\u8f93\u51fa"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:'Your Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nAlternatively, if you are the root user, you can run:\n\n  export KUBECONFIG=/etc/kubernetes/admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun "kubectl apply -f [podnetwork].yaml" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 10.0.0.12:6443 --token a2jb7m.q7sve4dy7qdj9du3 \\\n\t--discovery-token-ca-cert-hash sha256:70bd8cbebb1209e556866de47a97a627dfb8fac3a7821702bcb48ebeffffb78c \n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"kubeadm init"})," \u9009\u9879"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u9009\u9879"}),(0,r.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--apiserver-advertise-address string"}),(0,r.jsx)(n.td,{children:"API \u670d\u52a1\u5668\u6240\u516c\u5e03\u7684\u5176\u6b63\u5728\u76d1\u542c\u7684 IP \u5730\u5740\u3002\u5982\u679c\u672a\u8bbe\u7f6e\uff0c\u5219\u4f7f\u7528\u9ed8\u8ba4\u7f51\u7edc\u63a5\u53e3\u3002"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--apiserver-bind-port int32"}),(0,r.jsx)(n.td,{children:"API \u670d\u52a1\u5668\u7ed1\u5b9a\u7684\u7aef\u53e3\u3002\u9ed8\u8ba4\u503c\uff1a6443"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--apiserver-cert-extra-sans strings"}),(0,r.jsx)(n.td,{children:"\u7528\u4e8e API Server \u670d\u52a1\u8bc1\u4e66\u7684\u53ef\u9009\u9644\u52a0\u4e3b\u9898\u5907\u7528\u540d\u79f0\uff08SAN\uff09\u3002\u53ef\u4ee5\u662f IP \u5730\u5740\u548c DNS \u540d\u79f0\u3002"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--cert-dir string"}),(0,r.jsxs)(n.td,{children:["\u4fdd\u5b58\u548c\u5b58\u50a8\u8bc1\u4e66\u7684\u8def\u5f84\u3002\u9ed8\u8ba4\u503c ",(0,r.jsx)(n.code,{children:"/etc/kubernetes/pki"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--certificate-key string"}),(0,r.jsx)(n.td,{children:"\u7528\u4e8e\u52a0\u5bc6 kubeadm-certs Secret \u4e2d\u7684\u63a7\u5236\u5e73\u9762\u8bc1\u4e66\u7684\u5bc6\u94a5\u3002"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--config string"}),(0,r.jsx)(n.td,{children:"kubeadm \u914d\u7f6e\u6587\u4ef6\u7684\u8def\u5f84\u3002"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--control-plane-endpoint string"}),(0,r.jsx)(n.td,{children:"\u4e3a\u63a7\u5236\u5e73\u9762\u6307\u5b9a\u4e00\u4e2a\u7a33\u5b9a\u7684 IP \u5730\u5740\u6216 DNS \u540d\u79f0\u3002"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--cri-socket string"}),(0,r.jsx)(n.td,{children:"\u8981\u8fde\u63a5\u7684 CRI \u5957\u63a5\u5b57\u7684\u8def\u5f84\u3002\u5982\u679c\u4e3a\u7a7a\uff0c\u5219 kubeadm \u5c06\u5c1d\u8bd5\u81ea\u52a8\u68c0\u6d4b\u6b64\u503c\uff1b \u4ec5\u5f53\u5b89\u88c5\u4e86\u591a\u4e2a CRI \u6216\u5177\u6709\u975e\u6807\u51c6 CRI \u5957\u63a5\u5b57\u65f6\uff0c\u624d\u4f7f\u7528\u6b64\u9009\u9879\u3002"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--dry-run"}),(0,r.jsx)(n.td,{children:"\u4e0d\u505a\u4efb\u4f55\u66f4\u6539\uff1b\u53ea\u8f93\u51fa\u5c06\u8981\u6267\u884c\u7684\u64cd\u4f5c\u3002"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--feature-gates string"}),(0,r.jsx)(n.td,{children:"\u4e00\u7ec4\u7528\u6765\u63cf\u8ff0\u5404\u79cd\u529f\u80fd\u7279\u6027\u7684\u952e\u503c\uff08key=value\uff09\u5bf9\u3002\u9009\u9879\u662f\uff1aEtcdLearnerMode=true  PublicKeysECDSA=true  RootlessControlPlane=true  UpgradeAddonsBeforeControlPlane=true"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"-h, --help"}),(0,r.jsx)(n.td,{children:"init \u64cd\u4f5c\u7684\u5e2e\u52a9\u547d\u4ee4\u3002"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--ignore-preflight-errors strings"}),(0,r.jsxs)(n.td,{children:["\u9519\u8bef\u5c06\u663e\u793a\u4e3a\u8b66\u544a\u7684\u68c0\u67e5\u5217\u8868\uff1b\u4f8b\u5982\uff1a",(0,r.jsx)(n.code,{children:"IsPrivilegedUser,Swap"}),"\u3002\u53d6\u503c\u4e3a ",(0,r.jsx)(n.code,{children:"all"}),"  \u65f6\u5c06\u5ffd\u7565\u68c0\u67e5\u4e2d\u7684\u6240\u6709\u9519\u8bef\u3002"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--image-repository string"}),(0,r.jsxs)(n.td,{children:["\u9009\u62e9\u7528\u4e8e\u62c9\u53d6\u63a7\u5236\u5e73\u9762\u955c\u50cf\u7684\u5bb9\u5668\u4ed3\u5e93\u3002\u9ed8\u8ba4\u503c",(0,r.jsx)(n.code,{children:"registry.k8s.io"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--kubernetes-version string"}),(0,r.jsxs)(n.td,{children:["\u4e3a\u63a7\u5236\u5e73\u9762\u9009\u62e9\u4e00\u4e2a\u7279\u5b9a\u7684 Kubernetes \u7248\u672c\u3002\u9ed8\u8ba4\u503c\uff1a",(0,r.jsx)(n.code,{children:"stable-1"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--node-name string"}),(0,r.jsx)(n.td,{children:"\u6307\u5b9a\u8282\u70b9\u7684\u540d\u79f0\u3002"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--patches string"}),(0,r.jsxs)(n.td,{children:["\u5b83\u5305\u542b\u540d\u4e3a ",(0,r.jsx)(n.code,{children:"target[suffix][+patchtype].extension"})," \u7684\u6587\u4ef6\u7684\u76ee\u5f55\u7684\u8def\u5f84\u3002 \u4f8b\u5982\uff0c",(0,r.jsx)(n.code,{children:"kube-apiserver0+merge.yaml"}),"\u6216\u4ec5\u4ec5\u662f ",(0,r.jsx)(n.code,{children:"etcd.json"}),"\u3002 ",(0,r.jsx)(n.code,{children:"target"})," \u53ef\u4ee5\u662f ",(0,r.jsx)(n.code,{children:"kube-apiserver"}),"\u3001",(0,r.jsx)(n.code,{children:"kube-controller-manager"}),"\u3001",(0,r.jsx)(n.code,{children:"kube-scheduler"}),"\u3001",(0,r.jsx)(n.code,{children:"etcd"}),"\u3001",(0,r.jsx)(n.code,{children:"kubeletconfiguration"})," \u4e4b\u4e00\u3002 ",(0,r.jsx)(n.code,{children:"patchtype"})," \u53ef\u4ee5\u662f ",(0,r.jsx)(n.code,{children:"strategic"}),"\u3001",(0,r.jsx)(n.code,{children:"merge"})," \u6216\u8005 ",(0,r.jsx)(n.code,{children:"json"})," \u4e4b\u4e00\uff0c \u5e76\u4e14\u5b83\u4eec\u4e0e kubectl \u652f\u6301\u7684\u8865\u4e01\u683c\u5f0f\u76f8\u540c\u3002 \u9ed8\u8ba4",(0,r.jsx)("br",{}),"\u7684 ",(0,r.jsx)(n.code,{children:"patchtype"})," \u662f ",(0,r.jsx)(n.code,{children:"strategic"}),"\u3002 ",(0,r.jsx)(n.code,{children:"extension"})," \u5fc5\u987b\u662f",(0,r.jsx)(n.code,{children:"json"})," \u6216",(0,r.jsx)(n.code,{children:"yaml"}),"\u3002 ",(0,r.jsx)(n.code,{children:"suffix"})," \u662f\u4e00\u4e2a\u53ef\u9009\u5b57\u7b26\u4e32\uff0c\u53ef\u7528\u4e8e\u786e\u5b9a\u9996\u5148\u6309\u5b57\u6bcd\u987a\u5e8f\u5e94\u7528\u54ea\u4e9b\u8865\u4e01\u3002"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--pod-network-cidr string"}),(0,r.jsx)(n.td,{children:"\u6307\u660e Pod \u7f51\u7edc\u53ef\u4ee5\u4f7f\u7528\u7684 IP \u5730\u5740\u6bb5\u3002\u5982\u679c\u8bbe\u7f6e\u4e86\u8fd9\u4e2a\u53c2\u6570\uff0c\u63a7\u5236\u5e73\u9762\u5c06\u4f1a\u4e3a\u6bcf\u4e00\u4e2a\u8282\u70b9\u81ea\u52a8\u5206\u914d CIDR\u3002"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--service-cidr string"}),(0,r.jsxs)(n.td,{children:["\u4e3a\u670d\u52a1\u7684\u865a\u62df IP \u5730\u5740\u53e6\u5916\u6307\u5b9a IP \u5730\u5740\u6bb5\u3002\u9ed8\u8ba4\u503c\uff1a",(0,r.jsx)(n.code,{children:"10.96.0.0/12"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--service-dns-domain string"}),(0,r.jsxs)(n.td,{children:["\u4e3a\u670d\u52a1\u53e6\u5916\u6307\u5b9a\u57df\u540d\uff0c\u4f8b\u5982\uff1a",(0,r.jsx)(n.code,{children:"myorg.internal"}),"\u3002 \u9ed8\u8ba4\u503c\uff1a",(0,r.jsx)(n.code,{children:"cluster.local"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--skip-certificate-key-print"}),(0,r.jsx)(n.td,{children:"\u4e0d\u8981\u6253\u5370\u7528\u4e8e\u52a0\u5bc6\u63a7\u5236\u5e73\u9762\u8bc1\u4e66\u7684\u5bc6\u94a5\u3002"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--skip-phases strings"}),(0,r.jsx)(n.td,{children:"\u8981\u8df3\u8fc7\u7684\u9636\u6bb5\u5217\u8868\u3002"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--skip-token-print"}),(0,r.jsxs)(n.td,{children:["\u8df3\u8fc7\u6253\u5370 ",(0,r.jsx)(n.code,{children:"kubeadm init"})," \u751f\u6210\u7684\u9ed8\u8ba4\u5f15\u5bfc\u4ee4\u724c\u3002"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--token string"}),(0,r.jsxs)(n.td,{children:["\u8fd9\u4e2a\u4ee4\u724c\u7528\u4e8e\u5efa\u7acb\u63a7\u5236\u5e73\u9762\u8282\u70b9\u4e0e\u5de5\u4f5c\u8282\u70b9\u95f4\u7684\u53cc\u5411\u901a\u4fe1\u3002 \u683c\u5f0f\u4e3a ",(0,r.jsx)(n.code,{children:"[a-z0-9]{6}.[a-z0-9]{16}"})," - \u793a\u4f8b\uff1a",(0,r.jsx)(n.code,{children:"abcdef.0123456789abcdef"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--token-ttl duration"}),(0,r.jsxs)(n.td,{children:["\u4ee4\u724c\u88ab\u81ea\u52a8\u5220\u9664\u4e4b\u524d\u7684\u6301\u7eed\u65f6\u95f4\uff08\u4f8b\u5982 1s\uff0c2m\uff0c3h\uff09\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a ",(0,r.jsx)(n.code,{children:"0"}),"\uff0c\u5219\u4ee4\u724c\u5c06\u6c38\u4e0d\u8fc7\u671f\u3002"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--upload-certs"}),(0,r.jsx)(n.td,{children:"\u5c06\u63a7\u5236\u5e73\u9762\u8bc1\u4e66\u4e0a\u4f20\u5230 kubeadm-certs Secret\u3002"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"Init"})," \u547d\u4ee4\u7684\u5de5\u4f5c\u6d41\u7a0b"]})}),"\n",(0,r.jsxs)(n.p,{children:["1.\u5728\u505a\u51fa\u53d8\u66f4\u524d\u8fd0\u884c\u4e00\u7cfb\u5217\u7684\u9884\u68c0\u9879\u6765\u9a8c\u8bc1\u7cfb\u7edf\u72b6\u6001\u3002\u4e00\u4e9b\u68c0\u67e5\u9879\u76ee\u4ec5\u4ec5\u89e6\u53d1\u8b66\u544a\uff0c \u5176\u5b83\u7684\u5219\u4f1a\u88ab\u89c6\u4e3a\u9519\u8bef\u5e76\u4e14\u9000\u51fa kubeadm\uff0c\u9664\u975e\u95ee\u9898\u5f97\u5230\u89e3\u51b3\u6216\u8005\u7528\u6237\u6307\u5b9a\u4e86 ",(0,r.jsx)(n.code,{children:"--ignore-preflight-errors=<\u9519\u8bef\u5217\u8868>"})," \u53c2\u6570\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["2.\u751f\u6210\u4e00\u4e2a\u81ea\u7b7e\u540d\u7684 CA \u8bc1\u4e66\u6765\u4e3a\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e00\u4e2a\u7ec4\u4ef6\u5efa\u7acb\u8eab\u4efd\u6807\u8bc6\u3002 \u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u5c06\u5176\u653e\u5165 ",(0,r.jsx)(n.code,{children:"--cert-dir"})," \u914d\u7f6e\u7684\u8bc1\u4e66\u76ee\u5f55\u4e2d\uff08\u9ed8\u8ba4\u4e3a ",(0,r.jsx)(n.code,{children:"/etc/kubernetes/pki"}),"\uff09 \u6765\u63d0\u4f9b\u4ed6\u4eec\u81ea\u5df1\u7684 CA \u8bc1\u4e66\u4ee5\u53ca/\u6216\u8005\u5bc6\u94a5\u3002 APIServer \u8bc1\u4e66\u5c06\u4e3a\u4efb\u4f55 ",(0,r.jsx)(n.code,{children:"--apiserver-cert-extra-sans"})," \u53c2\u6570\u503c\u63d0\u4f9b\u9644\u52a0\u7684 SAN \u6761\u76ee\uff0c\u5fc5\u8981\u65f6\u5c06\u5176\u5c0f\u5199\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["3.\u5c06 kubeconfig \u6587\u4ef6\u5199\u5165 ",(0,r.jsx)(n.code,{children:"/etc/kubernetes/"})," \u76ee\u5f55\u4ee5\u4fbf kubelet\u3001\u63a7\u5236\u5668\u7ba1\u7406\u5668\u548c\u8c03\u5ea6\u5668\u7528\u6765\u8fde\u63a5\u5230 API \u670d\u52a1\u5668\uff0c\u5b83\u4eec\u6bcf\u4e00\u4e2a\u90fd\u6709\u81ea\u5df1\u7684\u8eab\u4efd\u6807\u8bc6\uff0c\u540c\u65f6\u751f\u6210\u4e00\u4e2a\u540d\u4e3a ",(0,r.jsx)(n.code,{children:"admin.conf"})," \u7684\u72ec\u7acb\u7684 kubeconfig \u6587\u4ef6\uff0c\u7528\u4e8e\u7ba1\u7406\u64cd\u4f5c\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"4.\u4e3a API \u670d\u52a1\u5668\u3001\u63a7\u5236\u5668\u7ba1\u7406\u5668\u548c\u8c03\u5ea6\u5668\u751f\u6210\u9759\u6001 Pod \u7684\u6e05\u5355\u6587\u4ef6\u3002\u5047\u4f7f\u6ca1\u6709\u63d0\u4f9b\u4e00\u4e2a\u5916\u90e8\u7684 etcd \u670d\u52a1\u7684\u8bdd\uff0c\u4e5f\u4f1a\u4e3a etcd \u751f\u6210\u4e00\u4efd\u989d\u5916\u7684\u9759\u6001 Pod \u6e05\u5355\u6587\u4ef6"}),"\n",(0,r.jsxs)(n.p,{children:["\u9759\u6001 Pod \u7684\u6e05\u5355\u6587\u4ef6\u88ab\u5199\u5165\u5230 ",(0,r.jsx)(n.code,{children:"/etc/kubernetes/manifests"})," \u76ee\u5f55\uff1b kubelet \u4f1a\u76d1\u89c6\u8fd9\u4e2a\u76ee\u5f55\u4ee5\u4fbf\u5728\u7cfb\u7edf\u542f\u52a8\u7684\u65f6\u5019\u521b\u5efa Pod\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4e00\u65e6\u63a7\u5236\u5e73\u9762\u7684 Pod \u90fd\u8fd0\u884c\u8d77\u6765\uff0c",(0,r.jsx)(n.code,{children:"kubeadm init"})," \u7684\u5de5\u4f5c\u6d41\u7a0b\u5c31\u7ee7\u7eed\u5f80\u4e0b\u6267\u884c\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"5.\u5bf9\u63a7\u5236\u5e73\u9762\u8282\u70b9\u5e94\u7528\u6807\u7b7e\u548c\u6c61\u70b9\u6807\u8bb0\u4ee5\u4fbf\u4e0d\u4f1a\u5728\u5b83\u4e0a\u9762\u8fd0\u884c\u5176\u5b83\u7684\u5de5\u4f5c\u8d1f\u8f7d\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["6.\u751f\u6210\u4ee4\u724c\uff0c\u5c06\u6765\u5176\u4ed6\u8282\u70b9\u53ef\u4f7f\u7528\u8be5\u4ee4\u724c\u5411\u63a7\u5236\u5e73\u9762\u6ce8\u518c\u81ea\u5df1\u3002\u5982 ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/reference/setup-tools/kubeadm/kubeadm-token/",children:"kubeadm token"})," \u6587\u6863\u6240\u8ff0\uff0c\u7528\u6237\u53ef\u4ee5\u9009\u62e9\u901a\u8fc7 ",(0,r.jsx)(n.code,{children:"--token"})," \u63d0\u4f9b\u4ee4\u724c\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["7.\u4e3a\u4e86\u4f7f\u5f97\u8282\u70b9\u80fd\u591f\u9075\u7167",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/bootstrap-tokens/",children:"\u542f\u52a8\u5f15\u5bfc\u4ee4\u724c"}),"\u548c ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/kubelet-tls-bootstrapping/",children:"TLS \u542f\u52a8\u5f15\u5bfc"})," \u8fd9\u4e24\u4efd\u6587\u6863\u4e2d\u63cf\u8ff0\u7684\u673a\u5236\u52a0\u5165\u5230\u96c6\u7fa4\u4e2d\uff0ckubeadm \u4f1a\u6267\u884c\u6240\u6709\u7684\u5fc5\u8981\u914d\u7f6e\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u521b\u5efa\u4e00\u4e2a ConfigMap \u63d0\u4f9b\u6dfb\u52a0\u96c6\u7fa4\u8282\u70b9\u6240\u9700\u7684\u4fe1\u606f\uff0c\u5e76\u4e3a\u8be5 ConfigMap \u8bbe\u7f6e\u76f8\u5173\u7684 RBAC \u8bbf\u95ee\u89c4\u5219\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u5141\u8bb8\u542f\u52a8\u5f15\u5bfc\u4ee4\u724c\u8bbf\u95ee CSR \u7b7e\u540d API\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u914d\u7f6e\u81ea\u52a8\u7b7e\u53d1\u65b0\u7684 CSR \u8bf7\u6c42\u3002"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u66f4\u591a\u76f8\u5173\u4fe1\u606f\uff0c\u8bf7\u67e5\u770b ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/reference/setup-tools/kubeadm/kubeadm-join/",children:"kubeadm join"}),"\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"8.\u901a\u8fc7 API \u670d\u52a1\u5668\u5b89\u88c5\u4e00\u4e2a DNS \u670d\u52a1\u5668 (CoreDNS) \u548c kube-proxy \u9644\u52a0\u7ec4\u4ef6\u3002 \u5728 Kubernetes v1.11 \u548c\u66f4\u9ad8\u7248\u672c\u4e2d\uff0cCoreDNS \u662f\u9ed8\u8ba4\u7684 DNS \u670d\u52a1\u5668\u3002 \u8bf7\u6ce8\u610f\uff0c\u5c3d\u7ba1\u5df2\u90e8\u7f72 DNS \u670d\u52a1\u5668\uff0c\u4f46\u76f4\u5230\u5b89\u88c5 CNI \u65f6\u624d\u8c03\u5ea6\u5b83\u3002"}),"\n",(0,r.jsx)(n.admonition,{title:"\u8b66\u544a",type:"caution",children:(0,r.jsx)(n.p,{children:"\u4ece v1.18 \u5f00\u59cb\uff0c\u5728 kubeadm \u4e2d\u4f7f\u7528 kube-dns \u7684\u652f\u6301\u5df2\u88ab\u5e9f\u5f03\uff0c\u5e76\u5df2\u5728 v1.21 \u7248\u672c\u4e2d\u79fb\u9664\u3002"})}),"\n",(0,r.jsxs)(n.h3,{id:"\u62f7\u8d1d-kubeconfig-\u6587\u4ef6",children:["\u62f7\u8d1d ",(0,r.jsx)(n.code,{children:"kubeconfig"})," \u6587\u4ef6"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"mkdir -p $HOME/.kube\ncp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nchown $(id -u):$(id -g) $HOME/.kube/config\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u6dfb\u52a0node\u8282\u70b9",children:"\u6dfb\u52a0node\u8282\u70b9"}),"\n",(0,r.jsxs)(n.p,{children:["\u901a\u8fc7\u8fd0\u884c ",(0,r.jsx)(n.code,{children:"kubeadm init"})," \u6700\u540e\u8f93\u51fa\u7684\u547d\u4ee4"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubeadm join 10.0.0.12:6443 --token a2jb7m.q7sve4dy7qdj9du3 \\\n\t--discovery-token-ca-cert-hash sha256:70bd8cbebb1209e556866de47a97a627dfb8fac3a7821702bcb48ebeffffb78c\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770btoken"}),"\n",(0,r.jsxs)(n.admonition,{title:"\u8bf4\u660e",type:"tip",children:[(0,r.jsx)(n.p,{children:"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4ee4\u724c\u4f1a\u5728 24 \u5c0f\u65f6\u540e\u8fc7\u671f\u3002\u5982\u679c\u8981\u5728\u5f53\u524d\u4ee4\u724c\u8fc7\u671f\u540e\u5c06\u8282\u70b9\u52a0\u5165\u96c6\u7fa4\uff0c \u5219\u53ef\u4ee5\u901a\u8fc7\u5728\u63a7\u5236\u5e73\u9762\u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u6765\u521b\u5efa\u65b0\u4ee4\u724c\uff1a"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubeadm token create\n"})})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ kubeadm token list\nTOKEN                     TTL         EXPIRES                USAGES                   DESCRIPTION                                                EXTRA GROUPS\na2jb7m.q7sve4dy7qdj9du3   23h         2023-11-02T06:36:56Z   authentication,signing   The default bootstrap token generated by 'kubeadm init'.   system:bootstrappers:kubeadm:default-node-token\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770bsha256"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | \\\n>    openssl dgst -sha256 -hex | sed 's/^.* //'\n70bd8cbebb1209e556866de47a97a627dfb8fac3a7821702bcb48ebeffffb78c\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u540c\u65f6\u67e5\u770btoken\u548csha256"}),"\n",(0,r.jsx)(n.admonition,{title:"\u6ce8\u610f",type:"caution",children:(0,r.jsx)(n.p,{children:"\u6267\u884c\u6b64\u547d\u4ee4\u4f1a\u91cd\u65b0\u521b\u5efa\u4e00\u4e2atoken"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ kubeadm token create --print-join-command\nkubeadm join 10.0.0.12:6443 --token knn1yv.a0qmgazqdo3mpgb2 --discovery-token-ca-cert-hash sha256:70bd8cbebb1209e556866de47a97a627dfb8fac3a7821702bcb48ebeffffb78c \n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u60f3\u8981\u5728master\u8282\u70b9\u4e0a\u8fdb\u884c\u8c03\u5ea6pod\uff0c\u4f8b\u5982\u5355\u673a Kubernetes \u96c6\u7fa4\uff0c\u5e94\u8be5\u8fd0\u884c\u5982\u4e0b\u547d\u4ee4"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"kubectl taint nodes --all node-role.kubernetes.io/control-plane-\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6",children:"\u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#pod-network",children:"\u5b98\u65b9\u6587\u6863"})}),"\n",(0,r.jsxs)(n.p,{children:["\u53ef\u4ee5\u5728\u8fd9\u91cc\u67e5\u770bk8s ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/concepts/cluster-administration/addons/#networking-and-network-policy",children:"\u652f\u6301\u7684\u7f51\u7edc\u63d2\u4ef6"})]}),"\n",(0,r.jsxs)(n.admonition,{title:"\u6ce8\u610f",type:"caution",children:[(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["\u4f60\u5fc5\u987b\u90e8\u7f72\u4e00\u4e2a\u57fa\u4e8e Pod \u7f51\u7edc\u63d2\u4ef6\u7684 ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/",children:"\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3"})," (CNI)\uff0c\u4ee5\u4fbf\u4f60\u7684 Pod \u53ef\u4ee5\u76f8\u4e92\u901a\u4fe1\u3002 \u5728\u5b89\u88c5\u7f51\u7edc\u4e4b\u524d\uff0c\u96c6\u7fa4 DNS (CoreDNS) \u5c06\u4e0d\u4f1a\u542f\u52a8\u3002"]})}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u6ce8\u610f\u4f60\u7684 Pod \u7f51\u7edc\u4e0d\u5f97\u4e0e\u4efb\u4f55\u4e3b\u673a\u7f51\u7edc\u91cd\u53e0\uff1a \u5982\u679c\u6709\u91cd\u53e0\uff0c\u4f60\u5f88\u53ef\u80fd\u4f1a\u9047\u5230\u95ee\u9898\u3002 \uff08\u5982\u679c\u4f60\u53d1\u73b0\u7f51\u7edc\u63d2\u4ef6\u7684\u9996\u9009 Pod \u7f51\u7edc\u4e0e\u67d0\u4e9b\u4e3b\u673a\u7f51\u7edc\u4e4b\u95f4\u5b58\u5728\u51b2\u7a81\uff0c \u5219\u5e94\u8003\u8651\u4f7f\u7528\u4e00\u4e2a\u5408\u9002\u7684 CIDR \u5757\u6765\u4ee3\u66ff\uff0c \u7136\u540e\u5728\u6267\u884c ",(0,r.jsx)(n.code,{children:"kubeadm init"})," \u65f6\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"--pod-network-cidr"})," \u53c2\u6570\u5e76\u5728\u4f60\u7684\u7f51\u7edc\u63d2\u4ef6\u7684 YAML \u4e2d\u66ff\u6362\u5b83\uff09\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c",(0,r.jsx)(n.code,{children:"kubeadm"})," \u5c06\u96c6\u7fa4\u8bbe\u7f6e\u4e3a\u4f7f\u7528\u548c\u5f3a\u5236\u4f7f\u7528 ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/rbac/",children:"RBAC"}),"\uff08\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff09\u3002 \u786e\u4fdd\u4f60\u7684 Pod \u7f51\u7edc\u63d2\u4ef6\u652f\u6301 RBAC\uff0c\u4ee5\u53ca\u7528\u4e8e\u90e8\u7f72\u5b83\u7684\u6e05\u5355\u4e5f\u662f\u5982\u6b64\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u8981\u4e3a\u96c6\u7fa4\u4f7f\u7528 IPv6\uff08\u53cc\u534f\u8bae\u6808\u6216\u4ec5\u5355\u534f\u8bae\u6808 IPv6 \u7f51\u7edc\uff09\uff0c \u8bf7\u786e\u4fdd\u4f60\u7684 Pod \u7f51\u7edc\u63d2\u4ef6\u652f\u6301 IPv6\u3002 IPv6 \u652f\u6301\u5df2\u5728 CNI ",(0,r.jsx)(n.a,{href:"https://github.com/containernetworking/cni/releases/tag/v0.6.0",children:"v0.6.0"})," \u7248\u672c\u4e2d\u6dfb\u52a0\u3002"]}),"\n"]}),"\n"]})]}),"\n",(0,r.jsx)(n.h4,{id:"flannel",children:"flannel"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://github.com/flannel-io/flannel",children:"flannnel github"})}),"\n",(0,r.jsx)(n.p,{children:"\u4e0b\u8f7d\u63d2\u4ef6"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"export VERSION=0.23.0\nwget https://github.com/flannel-io/flannel/releases/download/v${VERSION}/kube-flannel.yml\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5b89\u88c5"}),"\n",(0,r.jsx)(n.admonition,{title:"\u8bf4\u660e",type:"tip",children:(0,r.jsxs)(n.p,{children:["\u5982\u679c\u96c6\u7fa4pod\u7f51\u7edc\u4e0d\u662f ",(0,r.jsx)(n.code,{children:"10.244.0.0/16"})," \uff0c\u5219\u9700\u8981\u4fee\u6539 ",(0,r.jsx)(n.code,{children:"kube-flannel.yml"})," \u4e2d ",(0,r.jsx)(n.code,{children:"Networ"})," \u5b57\u6bb5"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f kube-flannel.yml \n"})}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770b\u6240\u6709pod\u72b6\u6001"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ kubectl get pod -A\nNAMESPACE      NAME                          READY   STATUS    RESTARTS   AGE\nkube-flannel   kube-flannel-ds-45wk7         1/1     Running   0          3m36s\nkube-flannel   kube-flannel-ds-nl52c         1/1     Running   0          3m36s\nkube-system    coredns-66f779496c-bpsx7      1/1     Running   0          78m\nkube-system    coredns-66f779496c-mdpkb      1/1     Running   0          78m\nkube-system    etcd-k8s                      1/1     Running   0          78m\nkube-system    kube-apiserver-k8s            1/1     Running   0          78m\nkube-system    kube-controller-manager-k8s   1/1     Running   0          78m\nkube-system    kube-proxy-6kw6b              1/1     Running   0          78m\nkube-system    kube-proxy-t2s76              1/1     Running   0          63m\nkube-system    kube-scheduler-k8s            1/1     Running   0          78m\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5b89\u88c5\u5b8c\u7f51\u7edc\u63d2\u4ef6\u540e\uff0c\u5f53\u6240\u6709pod\u90fd\u4e3a ",(0,r.jsx)(n.code,{children:"running"})," \u72b6\u6001\u540e\uff0c\u96c6\u7fa4\u6240\u6709\u8282\u70b9\u72b6\u6001\u624d\u4e3a ",(0,r.jsx)(n.code,{children:"Ready"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ kubectl get no\nNAME       STATUS   ROLES           AGE   VERSION\nk8s-master Ready    control-plane   78m   v1.28.3\nk8s-node   Ready    <none>          63m   v1.28.3\n"})}),"\n",(0,r.jsx)(n.h4,{id:"calico",children:"calico"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://github.com/projectcalico/calico",children:"calico github"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://docs.tigera.io/",children:"calico\u5b98\u7f51"})}),"\n",(0,r.jsx)(n.p,{children:"\u5b89\u88c5calico tigera-operator\u548c\u81ea\u5b9a\u4e49\u8d44\u6e90"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.27.0/manifests/tigera-operator.yaml\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5b89\u88c5calico"}),"\n",(0,r.jsx)(n.admonition,{title:"\u6ce8\u610f",type:"caution",children:(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"custom-resources.yaml"})," \u6587\u4ef6\u4e2d\u7684pod\u7f51\u6bb5\u9ed8\u8ba4\u662f ",(0,r.jsx)(n.code,{children:"192.168.0.0/16"})," \uff0c\u5982\u679c\u96c6\u7fa4\u7684pod\u7f51\u6bb5\u4e0d\u662f ",(0,r.jsx)(n.code,{children:"192.168.0.0/16"})," \u5219\u9700\u8981\u4fee\u6539"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.27.0/manifests/custom-resources.yaml\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770b\u6240\u6709pod\u72b6\u6001"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"$ kubectl get pod -A\nNAMESPACE          NAME                                       READY   STATUS    RESTARTS   AGE\ncalico-apiserver   calico-apiserver-867b8496d6-g5bln          1/1     Running   0          2m8s\ncalico-apiserver   calico-apiserver-867b8496d6-knbdj          1/1     Running   0          2m8s\ncalico-system      calico-kube-controllers-79f555774b-t4szx   1/1     Running   0          3m25s\ncalico-system      calico-node-6bqs7                          1/1     Running   0          17m\ncalico-system      calico-node-6zr9b                          1/1     Running   0          17m\ncalico-system      calico-node-gf4m9                          1/1     Running   0          17m\ncalico-system      calico-node-pcsvl                          1/1     Running   0          17m\ncalico-system      calico-typha-b4884f588-g8z88               1/1     Running   0          17m\ncalico-system      calico-typha-b4884f588-s59sv               1/1     Running   0          17m\ncalico-system      csi-node-driver-b548q                      2/2     Running   0          17m\ncalico-system      csi-node-driver-fjmvl                      2/2     Running   0          17m\ncalico-system      csi-node-driver-n8sk8                      2/2     Running   0          17m\ncalico-system      csi-node-driver-qzvxr                      2/2     Running   0          17m\nkube-system        coredns-66f779496c-62d8l                   1/1     Running   0          46m\nkube-system        coredns-66f779496c-8ks6d                   1/1     Running   0          46m\nkube-system        etcd-k8s-master01                          1/1     Running   0          47m\nkube-system        kube-apiserver-k8s-master01                1/1     Running   0          47m\nkube-system        kube-controller-manager-k8s-master01       1/1     Running   0          47m\nkube-system        kube-proxy-hnkz2                           1/1     Running   0          46m\nkube-system        kube-proxy-ncx7z                           1/1     Running   0          46m\nkube-system        kube-proxy-qmf5p                           1/1     Running   0          46m\nkube-system        kube-proxy-wpzbh                           1/1     Running   0          46m\nkube-system        kube-scheduler-k8s-master01                1/1     Running   0          47m\ntigera-operator    tigera-operator-55585899bf-c65gw           1/1     Running   0          17m\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5b89\u88c5\u5b8c\u7f51\u7edc\u63d2\u4ef6\u540e\uff0c\u5f53\u6240\u6709pod\u90fd\u4e3a ",(0,r.jsx)(n.code,{children:"running"})," \u72b6\u6001\u540e\uff0c\u96c6\u7fa4\u6240\u6709\u8282\u70b9\u72b6\u6001\u624d\u4e3a ",(0,r.jsx)(n.code,{children:"Ready"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"$ kubectl get no\nNAME           STATUS   ROLES           AGE   VERSION\nk8s-master01   Ready    control-plane   47m   v1.28.2\nk8s-node01     Ready    <none>          47m   v1.28.2\nk8s-node02     Ready    <none>          46m   v1.28.2\nk8s-node03     Ready    <none>          46m   v1.28.2\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>t});var r=s(96540);const i={},c=r.createContext(i);function d(e){const n=r.useContext(c);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);