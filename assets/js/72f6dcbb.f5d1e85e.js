"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[9359],{37748:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var i=t(74848),s=t(28453);const r={},a="kubeadm \u4e13\u9898 \u4e00 init \u7a76\u7adf\u5e72\u4e86\u4e9b\u4ec0\u4e48",o={id:"\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u6587\u7ae0/kubeadm \u4e13\u9898 \u4e00 init \u7a76\u7adf\u5e72\u4e86\u4e9b\u4ec0\u4e48",title:"kubeadm \u4e13\u9898 \u4e00 init \u7a76\u7adf\u5e72\u4e86\u4e9b\u4ec0\u4e48",description:"[toc]",source:"@site/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u6587\u7ae0/kubeadm \u4e13\u9898 \u4e00 init \u7a76\u7adf\u5e72\u4e86\u4e9b\u4ec0\u4e48.md",sourceDirName:"\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u6587\u7ae0",slug:"/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u6587\u7ae0/kubeadm \u4e13\u9898 \u4e00 init \u7a76\u7adf\u5e72\u4e86\u4e9b\u4ec0\u4e48",permalink:"/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u6587\u7ae0/kubeadm \u4e13\u9898 \u4e00 init \u7a76\u7adf\u5e72\u4e86\u4e9b\u4ec0\u4e48",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"k8s\u8bbe\u7f6e\u901a\u8fc7kubeconfig\u767b\u9646dashboard",permalink:"/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u6587\u7ae0/k8s\u8bbe\u7f6e\u901a\u8fc7kubeconfig\u767b\u9646dashboard"},next:{title:"\u672c\u673a\u901a\u8fc7config\u6587\u4ef6\u8fde\u63a5\u591a\u4e2ak8s\u96c6\u7fa4",permalink:"/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u6587\u7ae0/\u672c\u673a\u901a\u8fc7config\u6587\u4ef6\u8fde\u63a5\u591a\u4e2ak8s\u96c6\u7fa4"}},l={},c=[{value:"kubeadm init \u7684\u6d41\u7a0b\uff08phase\uff09\u4ecb\u7ecd",id:"kubeadm-init-\u7684\u6d41\u7a0bphase\u4ecb\u7ecd",level:2},{value:"kubeadm \u547d\u4ee4\u884c\u53c2\u6570",id:"kubeadm-\u547d\u4ee4\u884c\u53c2\u6570",level:2},{value:"init \u5de5\u4f5c\u6d41",id:"init-\u5de5\u4f5c\u6d41",level:2},{value:"kubeadm init phase \u7684\u7528\u6cd5",id:"kubeadm-init-phase-\u7684\u7528\u6cd5",level:2},{value:"\u67e5\u770b kubeadm init phase \u5217\u8868",id:"\u67e5\u770b-kubeadm-init-phase-\u5217\u8868",level:3},{value:"\u53ef\u4ee5\u67e5\u770b\u67d0\u4e2a\u5177\u4f53\u7684phase\u4e0b\u7684\u5b50phase \u5217\u8868",id:"\u53ef\u4ee5\u67e5\u770b\u67d0\u4e2a\u5177\u4f53\u7684phase\u4e0b\u7684\u5b50phase-\u5217\u8868",level:3},{value:"\u67e5\u770b control-plane phase \u4e0b controller-manager \u5b50 phase \u7684\u7528\u6cd5\u8be6\u60c5",id:"\u67e5\u770b-control-plane-phase-\u4e0b-controller-manager-\u5b50-phase-\u7684\u7528\u6cd5\u8be6\u60c5",level:3},{value:"\u6267\u884c\u67d0\u4e2a phase \u6216\u8005\u8df3\u8fc7\u67d0\u4e2a phase",id:"\u6267\u884c\u67d0\u4e2a-phase-\u6216\u8005\u8df3\u8fc7\u67d0\u4e2a-phase",level:3},{value:"kubeadm config \u6587\u4ef6",id:"kubeadm-config-\u6587\u4ef6",level:2},{value:"\u4f7f\u7528\u81ea\u5b9a\u4e49\u955c\u50cf\u4ed3\u5e93",id:"\u4f7f\u7528\u81ea\u5b9a\u4e49\u955c\u50cf\u4ed3\u5e93",level:3},{value:"kubeadm \u914d\u7f6e cri runtime",id:"kubeadm-\u914d\u7f6e-cri-runtime",level:3},{value:"kubeadm \u81ea\u52a8\u5316",id:"kubeadm-\u81ea\u52a8\u5316",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"[toc]"}),"\n",(0,i.jsx)(n.h1,{id:"kubeadm-\u4e13\u9898-\u4e00-init-\u7a76\u7adf\u5e72\u4e86\u4e9b\u4ec0\u4e48",children:"kubeadm \u4e13\u9898 \u4e00 init \u7a76\u7adf\u5e72\u4e86\u4e9b\u4ec0\u4e48"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://www.jianshu.com/p/1e65610dd223",children:"\u672c\u6587\u4e25\u91cd\u6284\u88ad\u81f3\u4e92\u8054\u7f51"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"kubeadm \u6240\u5728\u5c42\u6b21"})}),"\n",(0,i.jsx)(n.p,{children:"kubeadm \u5c5e\u4e8e\u7b2c\u4e8c\u5c42\uff0c\u7528\u4e8e\u7ba1\u7406\u96c6\u7fa4\u3002"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-04-1518.37.50.png",alt:"iShot2020-04-1518.37.50"})}),"\n",(0,i.jsx)(n.h2,{id:"kubeadm-init-\u7684\u6d41\u7a0bphase\u4ecb\u7ecd",children:"kubeadm init \u7684\u6d41\u7a0b\uff08phase\uff09\u4ecb\u7ecd"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"phase \u9636\u6bb5"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"preflight                  \u9884\u7f6e\u68c0\u67e5\nkubelet-start                \u751f\u6210 kubelet \u914d\u7f6e\uff0c\u5e76\u91cd\u542fkubelet\ncerts                        \u751f\u6210\u8ba4\u8bc1\n  /etcd-ca                   \u751f\u6210\u81ea\u7b7e\u540dCA\u4ee5\u4e3aetcd\u914d\u7f6e\u6807\u8bc6\n  /apiserver-etcd-client     \u751f\u6210apiserver\u7528\u4e8e\u8bbf\u95eeetcd\u7684\u8bc1\u4e66\n  /etcd-healthcheck-client   \u751f\u6210liveness\u63a2\u9488\u4f7f\u7528\u7684\u8bc1\u4e66\uff0c\u7528\u4e8e\u68c0\u67e5etcd \u7684 healtcheck \u72b6\u6001\n  /etcd-server               \u751f\u6210 etcd \u670d\u52a1\u4f7f\u7528\u7684\u7684\u8bc1\u4e66\n  /etcd-peer                 \u4e3aetcd\u8282\u70b9\u751f\u6210\u8bc1\u4e66\u4ee5\u76f8\u4e92\u901a\u4fe1\n  /ca                        \u751f\u6210\u81ea\u7b7e\u540d\u7684 Kubernetes CA\uff0c\u4e3a\u5176\u4ed6 Kubernetes \u7ec4\u4ef6\u9884\u914d\u6807\u8bc6\n  /apiserver                 \u751f\u6210\u7528\u4e8e\u63d0\u4f9b Kubernetes API \u7684\u8bc1\u4e66 api server\u7aef\u8bc1\u4e66\n  /apiserver-kubelet-client  \u4e3a API \u670d\u52a1\u5668\u751f\u6210\u8bc1\u4e66\u4ee5\u8fde\u63a5\u5230 kubelet\n  /front-proxy-ca            \u751f\u6210\u81ea\u7b7e\u540d CA \u4ee5\u9884\u914dfront proxy \u6807\u8bc6\n  /front-proxy-client        \u4e3a\u524d\u7aef\u4ee3\u7406\u5ba2\u6237\u7aef\u751f\u6210\u8bc1\u4e66\n  /sa                        \u751f\u6210\u7528\u4e8e\u5bf9\u670d\u52a1\u5e10\u6237\u4ee4\u724c\u53ca\u5176\u516c\u94a5\u8fdb\u884c\u7b7e\u540d\u7684\u79c1\u94a5\nkubeconfig                   \u751f\u6210 control plane \u548c admin \u7ba1\u7406\u5458\u76f8\u5173\u7684kubeconfig \u6587\u4ef6\n  /admin                     \u751f\u6210admin \u7ba1\u7406\u5458\u548ckubeadm \u81ea\u8eab\u4f7f\u7528\u7684kubeconfig\u6587\u4ef6\n  /kubelet                   \u751f\u6210kebelet\u4f7f\u7528\u7684\uff0c\u4ec5\u7528\u4e8e\u5f15\u5bfc\u96c6\u7fa4\uff08bootstrap\uff09\u7684kubeconfig \u6587\u4ef6\n  /controller-manager        \u751f\u6210 controller manager \u4f7f\u7528\u7684kubeconfig\u6587\u4ef6\n  /scheduler                 \u751f\u6210 scheduler \u4f7f\u7528\u7684kubeconfig\u6587\u4ef6\nkubelet-start                \u751f\u6210kubelet\u7684\u73af\u5883\u53d8\u91cf\u6587\u4ef6/var/lib/kubelet/kubeadm-flags.env \u548c \u914d\u7f6e\u4fe1\u606f\u6587\u4ef6 /var/lib/kubelet/config.yaml\uff0c\u7136\u540e \u542f\u52a8/\u91cd\u542f kubelet\uff08systemd \u6a21\u5f0f\uff09\ncontrol-plane                \u751f\u6210\u62c9\u8d77 control plane\uff08master\uff09static Pod \u7684 manifest \u6587\u4ef6\n  /apiserver                 \u751f\u6210\u62c9\u8d77 kube-apiserver \u7684 static Pod manifest\n  /controller-manager        \u751f\u6210\u62c9\u8d77 kube-controller-manager \u7684static Pod manifest\n  /scheduler                 \u751f\u6210\u62c9\u8d77 kube-scheduler \u7684 static Pod manifest\netcd                         \u751f\u6210\u672c\u5730 ETCD\u7684 static Pod manifest \u6587\u4ef6\n  /local                     \u751f\u6210\u5355\u8282\u70b9\u672c\u5730 ETCD static Pod manifest \u6587\u4ef6\nupload-config                \u4e0a\u4f20kubeadm\u548ckubelet\u914d\u7f6e\u4e3a ConfigMap\n  /kubeadm                   \u4e0a\u4f20 kubeadm ClusterConfiguration \u4e3a ConfigMap\n  /kubelet                   \u4e0a\u4f20 kubelet component config \u4e3a ConfigMap\nupload-certs                 \u4e0a\u4f20\u8bc1\u4e66\u5230 kubeadm-certs\nmark-control-plane           \u6807\u8bc6\u8282\u70b9\u4e3a control-plane\nbootstrap-token              \u751f\u6210 bootstrap tokens \u7528\u4e8e\u5176\u4ed6\u8282\u70b9\u52a0\u5165\u96c6\u7fa4\naddon                        \u5b89\u88c5\u6240\u9700\u7684\u63d2\u4ef6\u4ee5\u901a\u8fc7\u4e00\u81f4\u6027\u6d4b\u8bd5\n  /coredns                   \u5b89\u88c5 CoreDNS \u63d2\u4ef6\n  /kube-proxy                \u5b89\u88c5 kube-proxy \u63d2\u4ef6\n"})}),"\n",(0,i.jsx)(n.h2,{id:"kubeadm-\u547d\u4ee4\u884c\u53c2\u6570",children:"kubeadm \u547d\u4ee4\u884c\u53c2\u6570"}),"\n",(0,i.jsx)(n.p,{children:"\u547d\u4ee4\u7528\u6cd5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"kubeadm init [flags]\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u53c2\u6570\u8bf4\u660e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'--apiserver-advertise-address string   \u8bbe\u7f6e apiserver \u7ed1\u5b9a\u7684 IP.\n\n--apiserver-bind-port int32            \u8bbe\u7f6eapiserver \u76d1\u542c\u7684\u7aef\u53e3. (\u9ed8\u8ba4 6443)\n\n--apiserver-cert-extra-sans strings    api\u8bc1\u4e66\u4e2d\u6307\u5b9a\u989d\u5916\u7684Subject Alternative Names (SANs) \u53ef\u4ee5\u662fIP \u4e5f\u53ef\u4ee5\u662fDNS\u540d\u79f0\u3002 \u8bc1\u4e66\u662f\u548cSAN\u7ed1\u5b9a\u7684\u3002\n\n--cert-dir string                      \u8bc1\u4e66\u5b58\u653e\u7684\u76ee\u5f55 (\u9ed8\u8ba4 "/etc/kubernetes/pki")\n\n--certificate-key string               kubeadm-cert secret \u4e2d \u7528\u4e8e\u52a0\u5bc6 control-plane \u8bc1\u4e66\u7684key\n\n--config string                        kubeadm \u914d\u7f6e\u6587\u4ef6\u7684\u8def\u5f84.\n\n--cri-socket string                    CRI socket \u6587\u4ef6\u8def\u5f84\uff0c\u5982\u679c\u4e3a\u7a7a kubeadm \u5c06\u81ea\u52a8\u53d1\u73b0\u76f8\u5173\u7684socket\u6587\u4ef6; \u53ea\u6709\u5f53\u673a\u5668\u4e2d\u5b58\u5728\u591a\u4e2a CRI  socket \u6216\u8005 \u5b58\u5728\u975e\u6807\u51c6 CRI socket \u65f6\u624d\u6307\u5b9a.\n\n--dry-run                              \u6d4b\u8bd5\uff0c\u5e76\u4e0d\u771f\u6b63\u6267\u884c;\u8f93\u51fa\u8fd0\u884c\u540e\u7684\u7ed3\u679c.\n\n--feature-gates string                 \u6307\u5b9a\u542f\u7528\u54ea\u4e9b\u989d\u5916\u7684feature \u4f7f\u7528 key=value \u5bf9\u7684\u5f62\u5f0f\u3002\n\n--help                                 \u5e2e\u52a9\u6587\u6863\n\n--ignore-preflight-errors strings      \u5ffd\u7565\u524d\u7f6e\u68c0\u67e5\u9519\u8bef\uff0c\u88ab\u5ffd\u7565\u7684\u9519\u8bef\u5c06\u88ab\u663e\u793a\u4e3a\u8b66\u544a. \u4f8b\u5b50: \'IsPrivilegedUser,Swap\'. Value \'all\' ignores errors from all checks.\n\n--image-repository string              \u9009\u62e9\u62c9\u53d6 control plane images \u7684\u955c\u50cfrepo (default "k8s.gcr.io")\n\n--kubernetes-version string            \u9009\u62e9K8S\u7248\u672c. (default "stable-1")\n\n--node-name string                     \u6307\u5b9anode\u7684\u540d\u79f0\uff0c\u9ed8\u8ba4\u4f7f\u7528 node \u7684 hostname.\n\n--pod-network-cidr string              \u6307\u5b9a pod \u7684\u7f51\u7edc\uff0c control plane \u4f1a\u81ea\u52a8\u5c06 \u7f51\u7edc\u53d1\u5e03\u5230\u5176\u4ed6\u8282\u70b9\u7684node\uff0c\u8ba9\u5176\u4e0a\u542f\u52a8\u7684\u5bb9\u5668\u4f7f\u7528\u6b64\u7f51\u7edc\n\n--service-cidr string                  \u6307\u5b9aservice \u7684IP \u8303\u56f4. (default "10.96.0.0/12")\n\n--service-dns-domain string            \u6307\u5b9a service \u7684 dns \u540e\u7f00, e.g. "myorg.internal". (default "cluster.local")\n\n--skip-certificate-key-print           \u4e0d\u6253\u5370 control-plane \u7528\u4e8e\u52a0\u5bc6\u8bc1\u4e66\u7684key.\n\n--skip-phases strings                  \u8df3\u8fc7\u6307\u5b9a\u7684\u9636\u6bb5\uff08phase\uff09\n\n--skip-token-print                     \u4e0d\u6253\u5370 kubeadm init \u751f\u6210\u7684 default bootstrap token \n\n--token string                         \u6307\u5b9a node \u548ccontrol plane \u4e4b\u95f4\uff0c\u7b80\u5386\u53cc\u5411\u8ba4\u8bc1\u7684token \uff0c\u683c\u5f0f\u4e3a [a-z0-9]{6}\\.[a-z0-9]{16} - e.g. abcdef.0123456789abcdef\n\n--token-ttl duration                   token \u81ea\u52a8\u5220\u9664\u7684\u65f6\u95f4\u95f4\u9694\u3002 (e.g. 1s, 2m, 3h). \u5982\u679c\u8bbe\u7f6e\u4e3a \'0\', token \u6c38\u4e0d\u8fc7\u671f (default 24h0m0s)\n\n--upload-certs                         \u4e0a\u4f20 control-plane \u8bc1\u4e66\u5230 kubeadm-certs Secret.\n'})}),"\n",(0,i.jsx)(n.h2,{id:"init-\u5de5\u4f5c\u6d41",children:"init \u5de5\u4f5c\u6d41"}),"\n",(0,i.jsx)(n.p,{children:"kubeadm init\u901a\u8fc7\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4\u6765\u5f15\u5bfcKubernetes\u63a7\u5236\u5e73\u9762\u8282\u70b9\uff1a"}),"\n",(0,i.jsxs)(n.p,{children:["1.\u5728\u8fdb\u884c\u66f4\u6539\u4e4b\u524d\u8fd0\u884c\u4e00\u7cfb\u5217\u98de\u884c\u524d\u68c0\u67e5\u4ee5\u9a8c\u8bc1\u7cfb\u7edf\u72b6\u6001\u3002\u67d0\u4e9b\u68c0\u67e5\u4ec5\u89e6\u53d1\u8b66\u544a\uff0c\u5176\u4ed6\u68c0\u67e5\u88ab\u89c6\u4e3a\u9519\u8bef\uff0c\u5e76\u5c06\u9000\u51fakubeadm\uff0c\u76f4\u5230\u95ee\u9898\u5f97\u5230\u7ea0\u6b63\u6216\u7528\u6237\u6307\u5b9a ",(0,i.jsx)(n.code,{children:"--ignore-preflight-errors = <list-of-errors>"})," \u6765\u5ffd\u7565\u9519\u8bef\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["2.\u751f\u6210\u81ea\u7b7e\u540d CA\uff08\u6216\u4f7f\u7528\u73b0\u6709CA\uff09\uff0c\u4ee5\u4fbf\u4e3a\u7fa4\u96c6\u4e2d\u7684\u6bcf\u4e2a\u7ec4\u4ef6\u8bbe\u7f6e\u6807\u8bc6\u3002\u5982\u679c\u7528\u6237\u901a\u8fc7\u5c06\u5176\u653e\u5728\u901a\u8fc7--cert-dir\u914d\u7f6e\u7684cert\u76ee\u5f55\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a",(0,i.jsx)(n.code,{children:"/etc/kubernetes/pki"}),"\uff09\u4e2d\u63d0\u4f9b\u4e86\u81ea\u5df1\u7684CA\u8bc1\u4e66\u548c/\u6216\u5bc6\u94a5\uff0c\u5219\u4f1a\u8df3\u8fc7\u6b64\u6b65\u9aa4\uff0c\u5982\u4f7f",(0,i.jsx)(n.a,{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fkubernetes.io%2Fdocs%2Freference%2Fsetup-tools%2Fkubeadm%2Fkubeadm-init%2F%23custom-certificates",children:"\u7528\u81ea\u5b9a\u4e49\u8bc1\u4e66\u6587\u6863"}),"\u4e2d\u6240\u8ff0\u3002 APIServer\u8bc1\u4e66\u5c06 ",(0,i.jsx)(n.code,{children:"--apiserver-cert-extra-sans"})," \u53c2\u6570\u63d0\u4f9b\u7684\u989d\u5916SAN\u6761\u76ee\u6dfb\u52a0\u5230\u8bc1\u4e66\u4fe1\u606f\u4e2d\uff0c\u5982\u679c\u9700\u8981\uff0c\u53ef\u4ee5\u5c0f\u5199\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["3.\u5728 ",(0,i.jsx)(n.code,{children:"/etc/kubernetes/"})," \u4e2d\u4e3a kubelet\uff0c controller-manager\u548cscheduler \u5199\u5165kubeconfig\u6587\u4ef6\uff0c\u7528\u4e8e\u8fde\u63a5\u5230API\u670d\u52a1\u5668\uff0c\u6bcf\u4e2a\u90fd\u6709\u81ea\u5df1\u7684\u6807\u8bc6\uff0c\u4ee5\u53ca\u53e6\u4e00\u4e2a\u540d\u4e3a ",(0,i.jsx)(n.code,{children:"admin.conf"})," \u7684\u7ba1\u7406\u5458kubeconfig\u6587\u4ef6\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"4.\u751f\u6210\u542f\u52a8 kubelet \u670d\u52a1\u6240\u9700\u7684\u914d\u7f6e\u6587\u4ef6\u548c\u73af\u5883\u53d8\u91cf\uff0c\u5e76\u542f\u52a8kubelet \uff08systemd \u65b9\u5f0f\uff09\u751f\u6210\u6587\u4ef6\u5982\u4e0b"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"/usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf \u73af\u5883\u53d8\u91cf"}),"\n",(0,i.jsx)(n.li,{children:"/etc/kubernetes/bootstrap-kubelet.conf/"}),"\n",(0,i.jsx)(n.li,{children:"/etc/kubernetes/kubelet.conf"}),"\n",(0,i.jsx)(n.li,{children:"/var/lib/kubelet/config.yaml"}),"\n",(0,i.jsx)(n.li,{children:"/var/lib/kubelet/kubeadm-flags.env \u73af\u5883\u53d8\u91cf"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"kubelet \u4f7f\u75284\u4e2a\u6587\u4ef6\u7684\u65b9\u5f0f\u5982\u4e0b"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"$ systemctl status kubelet\n\u25cf kubelet.service - kubelet: The Kubernetes Node Agent\n   Loaded: loaded (/usr/lib/systemd/system/kubelet.service; disabled; vendor preset: disabled)\n  Drop-In: /usr/lib/systemd/system/kubelet.service.d\n           \u2514\u250010-kubeadm.conf\n   Active: active (running) since Sun 2019-08-18 14:16:37 CST; 13min ago\n     Docs: https://kubernetes.io/docs/\n Main PID: 14980 (kubelet)\n   CGroup: /system.slice/kubelet.service\n           \u2514\u250014980 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml\n"})}),"\n",(0,i.jsx)(n.p,{children:"1.\u4e3aapiserver\uff0ccontrol-manager \u548cscheduler \u751f\u6210\u9759\u6001Pod\u6e05\u5355\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u5982\u679c\u672a\u63d0\u4f9b\u5916\u90e8etcd\uff0c\u5219\u4f1a\u4e3aetcd\u751f\u6210\u5176\u4ed6\u9759\u6001Pod\u6e05\u5355\u3002 Static Pod\u6e05\u5355\u5199\u5165",(0,i.jsx)(n.code,{children:"/etc/kubernetes/manifests"}),"; kubelet\u76d1\u89c6\u6b64\u76ee\u5f55\u4ee5\u4fbfPods\u5728\u542f\u52a8\u65f6\u521b\u5efa\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"control plane \u7684pod \u542f\u52a8\u540e\uff0cinit \u5f00\u59cb\u7ee7\u7eed\u6267\u884c\u540e\u9762\u7684\u6d41\u7a0b\u3002"}),"\n",(0,i.jsx)(n.p,{children:"2.\u5c06\u6807\u7b7e\u548c\u6c61\u70b9\u5e94\u7528\u4e8e\u63a7\u5236\u5e73\u9762\u8282\u70b9\uff0c\u4ee5\u4fbf\u4e0d\u4f1a\u5728\u90a3\u91cc\u8fd0\u884c\u5176\u4ed6\u5de5\u4f5c\u8d1f\u8f7d\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["3.\u751f\u6210\u5176\u4ed6\u8282\u70b9\u5c06\u6765\u53ef\u7528\u4e8e\u5411\u63a7\u4ef6\u5e73\u9762\u6ce8\u518c\u81ea\u5df1\u7684\u4ee4\u724c\u3002\u6216\u8005\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7",(0,i.jsx)(n.code,{children:"--token"})," \u53c2\u6570\u6765\u6307\u5b9a\u4e00\u4e2a\u4ee4\u724c\u3002,\u5177\u4f53\u5728 ",(0,i.jsx)(n.a,{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fkubernetes.io%2Fdocs%2Freference%2Fsetup-tools%2Fkubeadm%2Fkubeadm-token%2F",children:"kubeadm token"})," \u6587\u6863\u4e2d."]}),"\n",(0,i.jsxs)(n.p,{children:["4.\u8fdb\u884c\u6240\u6709\u5fc5\u8981\u7684\u914d\u7f6e\uff0c\u4ee5\u5141\u8bb8\u5176\u4ed6\u8282\u70b9\u901a\u8fc7",(0,i.jsx)(n.a,{href:"https://links.jianshu.com/go?to=https%EF%BC%9A%2F%2Fkubernetes.io%2Fdocs%2F%E5%BC%95%E7%94%A8%2F%E8%AE%BF%E9%97%AE-authn-authz%2Fboottrap-tokens%2F",children:"\u5f15\u5bfc\u4ee4\u724c bootstrap token"})," \u548c ",(0,i.jsx)(n.a,{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fkubernetes.io%2Fdocs%2Freference%2Fcommand-line-tools-reference%2Fkubelet-tls-bootstrapping%2F",children:"TLS boostrap"})," \u673a\u5236\u8fdb\u884c\u52a0\u5165"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5199\u5165\u52a0\u5165\u96c6\u7fa4\u7684\u6240\u9700\u7684\u4fe1\u606f\u5230configmap\uff0c \u8bbe\u7f6e\u76f8\u5173\u7684RBAC \u89c4\u5219\u3002"}),"\n",(0,i.jsxs)(n.li,{children:["\u8ba9bootstrap token \u8bbf\u95ee CSR",(0,i.jsx)(n.code,{children:"\uff08\u8bc1\u4e66\u7b7e\u540d\u8bf7\u6c42\uff09"})," \u7b7e\u540d API"]}),"\n",(0,i.jsxs)(n.li,{children:["Configure auto-approval for new CSR requests. \u5bf9CSR \u8bf7\u6c42",(0,i.jsx)(n.code,{children:"\uff08\u8bc1\u4e66\u7b7e\u540d\u8bf7\u6c42\uff09"}),"\u914d\u7f6e\u81ea\u52a8\u540c\u610f\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u901a\u8fc7 API server \u5b89\u88c5 DNS \u670d\u52a1\u5668 \uff08CoreDNS\uff09 \u548c kube-proxy \u7ec4\u4ef6\u3002\u5728 Kubernetes \u7248\u672c 1.11 \u548c\u66f4\u9ad8\u7248\u672c\u4e2d\uff0cCoreDNS \u662f\u9ed8\u8ba4 DNS \u670d\u52a1\u5668\u3002\u8981\u5b89\u88c5 kube-dns \u800c\u4e0d\u662f CoreDNS\uff0c\u5fc5\u987b\u5728 kubeadm \u914d\u7f6e\u6587\u4ef6\u7684ClusterConfiguration \u5b57\u6bb5\u4e2d\u914d\u7f6e DNS \u9644\u52a0\u7ec4\u4ef6(\u901a\u8fc7 kubeadm config \u6587\u4ef6\uff09\u3002\u8bf7\u6ce8\u610f\uff0c\u867d\u7136\u5df2\u90e8\u7f72 DNS \u670d\u52a1\u5668\uff0c\u4f46\u5b89\u88c5 CNI \u524d\u8be5POD \u4e0d\u4f1a\u88ab\u8c03\u5ea6\u5230\u8282\u70b9\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e0d\u56de\u88ab\u5b9e\u9645\u90e8\u7f72\uff0c\u6216\u4e0d\u4f1a\u751f\u6548\uff09\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"kubeadm-init-phase-\u7684\u7528\u6cd5",children:"kubeadm init phase \u7684\u7528\u6cd5"}),"\n",(0,i.jsx)(n.h3,{id:"\u67e5\u770b-kubeadm-init-phase-\u5217\u8868",children:"\u67e5\u770b kubeadm init phase \u5217\u8868"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"$ kubeadm init phase\nUse this command to invoke single phase of the init workflow\n\nUsage:\n  kubeadm init phase [command]\n\nAvailable Commands:\n  addon              Install required addons for passing Conformance tests\n  bootstrap-token    Generates bootstrap tokens used to join a node to a cluster\n  certs              Certificate generation\n  control-plane      Generate all static Pod manifest files necessary to establish the control plane\n  etcd               Generate static Pod manifest file for local etcd\n  kubeconfig         Generate all kubeconfig files necessary to establish the control plane and the admin kubeconfig file\n  kubelet-start      Write kubelet settings and (re)start the kubelet\n  mark-control-plane Mark a node as a control-plane\n  preflight          Run pre-flight checks\n  upload-certs       Upload certificates to kubeadm-certs\n  upload-config      Upload the kubeadm and kubelet configuration to a ConfigMap\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u53ef\u4ee5\u67e5\u770b\u67d0\u4e2a\u5177\u4f53\u7684phase\u4e0b\u7684\u5b50phase-\u5217\u8868",children:"\u53ef\u4ee5\u67e5\u770b\u67d0\u4e2a\u5177\u4f53\u7684phase\u4e0b\u7684\u5b50phase \u5217\u8868"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"$ kubeadm init phase control-plane --help\nThis command is not meant to be run on its own. See list of available subcommands.\n\nUsage:\n  kubeadm init phase control-plane [flags]\n  kubeadm init phase control-plane [command]\n\nAvailable Commands: #\u4e0b\u9762\u7684\u5c31\u662f\u5b50phase\n  all                Generate all static Pod manifest files\n  apiserver          Generates the kube-apiserver static Pod manifest\n  controller-manager Generates the kube-controller-manager static Pod manifest\n  scheduler          Generates the kube-scheduler static Pod manifest\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u67e5\u770b-control-plane-phase-\u4e0b-controller-manager-\u5b50-phase-\u7684\u7528\u6cd5\u8be6\u60c5",children:"\u67e5\u770b control-plane phase \u4e0b controller-manager \u5b50 phase \u7684\u7528\u6cd5\u8be6\u60c5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'$ kubeadm init phase control-plane controller-manager --help\nGenerates the kube-controller-manager static Pod manifest\n\nUsage:\n  kubeadm init phase control-plane controller-manager [flags]\n\nFlags:\n      --cert-dir string                                 The path where to save and store the certificates. (default "/etc/kubernetes/pki")\n      --config string                                   Path to a kubeadm configuration file.\n      --controller-manager-extra-args mapStringString   A set of extra flags to pass to the Controller Manager or override default ones in form of <flagname>=<value>\n  -h, --help                                            help for controller-manager\n      --image-repository string                         Choose a container registry to pull control plane images from (default "k8s.gcr.io")\n      --kubernetes-version string                       Choose a specific Kubernetes version for the control plane. (default "stable-1")\n      --pod-network-cidr string                         Specify range of IP addresses for the pod network. If set, the control plane will automatically allocate CIDRs for every node.\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u6267\u884c\u67d0\u4e2a-phase-\u6216\u8005\u8df3\u8fc7\u67d0\u4e2a-phase",children:"\u6267\u884c\u67d0\u4e2a phase \u6216\u8005\u8df3\u8fc7\u67d0\u4e2a phase"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"sudo kubeadm init phase control-plane all --config=configfile.yaml\nsudo kubeadm init phase etcd local --config=configfile.yaml\n# you can now modify the control plane and etcd manifest files\nsudo kubeadm init --skip-phases=control-plane,etcd --config=configfile.yaml\n"})}),"\n",(0,i.jsx)(n.h2,{id:"kubeadm-config-\u6587\u4ef6",children:"kubeadm config \u6587\u4ef6"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u6ce8\u610f\uff0c\u8fd9\u4e2a config \u6587\u4ef6\u7279\u6027\u57281.15 \u4e2d\u4f9d\u7136\u662f beta\uff0c\u5728\u5c06\u6765\u53ef\u80fd\u6539\u53d8"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u67e5\u770b kubeadm config print\u7684\u5e2e\u52a9"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"[root@rancher ~]# kubeadm config print -h\nThis command prints configurations for subcommands provided.\n\nUsage:\n  kubeadm config print [flags]\n  kubeadm config print [command]\n\nAvailable Commands:\n  init-defaults Print default init configuration, that can be used for 'kubeadm init'\n  join-defaults Print default join configuration, that can be used for 'kubeadm join'\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u6253\u5370\u9ed8\u8ba4\u7684init \u914d\u7f6e\u6587\u4ef6"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"kubeadm config print init-defaults > initconfig.yaml\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u6253\u5f00 initconfig\uff0c \u5185\u5bb9\u5982\u4e0b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: kubeadm.k8s.io/v1beta2\nbootstrapTokens:\n- groups:\n  - system:bootstrappers:kubeadm:default-node-token\n  token: abcdef.0123456789abcdef\n  ttl: 24h0m0s\n  usages:\n  - signing\n  - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n  advertiseAddress: 1.2.3.4\n  bindPort: 6443\nnodeRegistration:\n  criSocket: /var/run/dockershim.sock\n  name: rancher.local\n  taints:\n  - effect: NoSchedule\n    key: node-role.kubernetes.io/master\n---\napiServer:\n  timeoutForControlPlane: 4m0s\napiVersion: kubeadm.k8s.io/v1beta2\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrollerManager: {}\ndns:\n  type: CoreDNS\netcd:\n  local:\n    dataDir: /var/lib/etcd\nimageRepository: k8s.gcr.io\nkind: ClusterConfiguration\nkubernetesVersion: v1.14.0\nnetworking:\n  dnsDomain: cluster.local\n  serviceSubnet: 10.96.0.0/12\nscheduler: {}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u4e0a\u9762\u7684\u5185\u5bb9\u53ea\u5305\u542b\u989d\u4e86\u6700\u7b80\u8bdd\u7684InitConfiguration type \u7684\u5185\u5bb9\uff0ckubeadm \u5b8c\u6574\u7684\u5185\u5bb9\u5305\u542b5\u5927\u90e8\u5206\uff0c\u5982\u4e0b\uff0c\u6bcf\u4e2atype \u4e4b\u95f4\uff0c\u9700\u8981\u7528yaml\u7684 ",(0,i.jsx)(n.code,{children:"---"})," \u6587\u6863\u9694\u79bb\u8fdb\u884c\u5206\u79bb\u3002\ninit-full-config.yaml \u6587\u4ef6\u7ed3\u6784"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"---\napiVersion: kubeadm.k8s.io/v1beta2\nkind: InitConfiguration\n---\napiVersion: kubeadm.k8s.io/v1beta2\nkind: ClusterConfiguration\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\n---\napiVersion: kubeadm.k8s.io/v1beta2\nkind: JoinConfiguration\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u60f3\u7ec6\u7684\u5185\u5bb9\u53ef\u4ee5\u53c2\u9605",(0,i.jsx)(n.a,{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fgodoc.org%2Fk8s.io%2Fkubernetes%2Fcmd%2Fkubeadm%2Fapp%2Fapis%2Fkubeadm%2Fv1beta2",children:"kubeadm api"}),"\uff0ckube-proxy\u914d\u7f6e\u90e8\u5206\u7684\u5185\u5bb9\u7ec6\u8282\u5728\u8fd9\u91cc",(0,i.jsx)(n.a,{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fgodoc.org%2Fk8s.io%2Fkubernetes%2Fpkg%2Fproxy%2Fapis%2Fconfig%23KubeProxyConfiguration",children:"KubeProxyConfiguration "}),"\n\u6bd4\u5982\u6211\u8981\u4fee\u6539kube-proxy\u7684\u6a21\u5f0f\u4e3aIPVS \u90a3\u4e48\u4fee\u6539\u540e\u7684init-full-config.yaml \u5185\u5bb9\u4e3a\u5982\u4e0b"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'---\napiVersion: kubeadm.k8s.io/v1beta2\nkind: InitConfiguration\n---\napiVersion: kubeadm.k8s.io/v1beta2\nkind: ClusterConfiguration\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nmode: "ipvs"  \u4fee\u6539\u5728\u8fd9\u91cc\n---\napiVersion: kubeadm.k8s.io/v1beta2\nkind: JoinConfiguration\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u5173\u4e8e\u5982\u4f55\u901a\u8fc7kubeadm \u914d\u7f6e\u542f\u7528 IPVS \u8bf7",(0,i.jsx)(n.a,{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fkubernetes%2Fkubernetes%2Fblob%2Fmaster%2Fpkg%2Fproxy%2Fipvs%2FREADME.md",children:"\u53c2\u9605"}),"\n\u5173\u4e8e\u5982\u4f55\u5b9a\u5236\u5316 control plane \u8bf7",(0,i.jsx)(n.a,{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fkubernetes.io%2Fdocs%2Fsetup%2Fproduction-environment%2Ftools%2Fkubeadm%2Fcontrol-plane-flags%2F",children:"\u53c2\u9605"})]}),"\n",(0,i.jsx)(n.h3,{id:"\u4f7f\u7528\u81ea\u5b9a\u4e49\u955c\u50cf\u4ed3\u5e93",children:"\u4f7f\u7528\u81ea\u5b9a\u4e49\u955c\u50cf\u4ed3\u5e93"}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9\u4e8egoogle \u63d0\u4f9b\u7684\u955c\u50cf\uff0c\u5728\u4f17\u6240\u5468\u77e5\u7684\u539f\u56e0\u4e0b\uff0c\u65e0\u6cd5\u8bbf\u95ee\u3002\u6240\u4ee5\u9700\u8981\u4f7f\u7528\u56fd\u5185\u955c\u50cf\u6216\u8005\u81ea\u5efa\u7684\u955c\u50cf\u4ed3\u5e93\u3002 kubeadm \u63d0\u4f9b\u4e86\u53c2\u6570\uff0c\u540c\u4e8b\u4e5f\u652f\u6301\u4fee\u6539 kubeadm config \u6587\u4ef6\u6765\u6307\u5b9a\u5b9a\u5236\u5316\u7684\u4ed3\u5e93"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# imageRepository: k8s.gcr.io\nimageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers \n"})}),"\n",(0,i.jsx)(n.p,{children:"\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\uff0c\u53ef\u4ee5\u67e5\u770b\u548c\u62c9\u53d6 init \u6240\u9700\u7684\u955c\u50cf\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"kubeadm config images list \nkubeadm config images pull --config init-full-config.yaml\n"})}),"\n",(0,i.jsx)(n.h3,{id:"kubeadm-\u914d\u7f6e-cri-runtime",children:"kubeadm \u914d\u7f6e cri runtime"}),"\n",(0,i.jsxs)(n.p,{children:["kubelet \u9ed8\u8ba4\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"docker"})," \u4f5c\u4e3aruntime \u5e76\u4f7f\u7528\u5185\u5efa\u7684 ",(0,i.jsx)(n.code,{children:"dockershim"})," \u8fdb\u884c\u4ea4\u4e92\u3002\n\u5176\u4ed6\u7684runtime\u5305\u62ec:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fcontainerd%2Fcri-containerd",children:"cri-containerd"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fkubernetes-incubator%2Fcri-o",children:"cri-o"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fkubernetes%2Ffrakti",children:"frakti"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fkubernetes-incubator%2Frktlet",children:"rkt"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u5b89\u88c5\u6587\u6863 ",(0,i.jsx)(n.a,{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fkubernetes.io%2Fdocs%2Fsetup%2Fcri",children:"CRI installation instructions"})]}),"\n",(0,i.jsx)(n.p,{children:"\u6839\u636e\u5b89\u88c5\u6587\u6863\u5b89\u88c5\u597druntime\u540e\uff0c\u9700\u8981\u5bf9kubeadm \u548ckubelet \u505a\u5982\u4e0b\u914d\u7f6e"}),"\n",(0,i.jsx)(n.p,{children:"1.\u5728\u6bcf\u4e2a\u8282\u70b9\u5b89\u88c5runtime \u5bf9\u5e94\u7684 shim\uff0c\u5982\u4f55\u5b89\u88c5\u5728runtime \u8bf4\u660e\u6587\u6863\u4e2d\u6709\u4ecb\u7ecd"}),"\n",(0,i.jsxs)(n.p,{children:["2.\u914d\u7f6e kubelet \u4f7f\u7528\u8fdc\u7a0b CRI runtime \uff08\u5b9e\u9645\u662f\u4f7f\u7528linux sockets\uff09\uff0c\u8bb0\u5f97\u4fee\u6539 RUNTIME_ENDPOINT \u4e3a\u4f60\u81ea\u5df1\u5bf9\u5e94\u7684\u503c\uff0c\u6bd4\u5982  ",(0,i.jsx)(n.code,{children:"/var/run/{your_runtime}.sock:"}),"\n\u6bd4\u5982\uff0c\u5982\u4e0b\u662fcri\u7684\u914d\u7f6e\u6587\u4ef6\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'cat > /etc/systemd/system/kubelet.service.d/20-cri.conf <<EOF\n[Service]\nEnvironment="KUBELET_EXTRA_ARGS=--container-runtime=remote --container-runtime-endpoint=$RUNTIME_ENDPOINT"\nEOF\n\nsystemctl daemon-reload\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7kubeadm init/reset \u7684 ",(0,i.jsx)(n.code,{children:"--cri-socket"})," \u53c2\u6570\u6765\u662f\u5148\u540c\u6837\u7684\u4e8b\u60c5\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"kubeadm-\u81ea\u52a8\u5316",children:"kubeadm \u81ea\u52a8\u5316"}),"\n",(0,i.jsxs)(n.p,{children:["\u4e0e\u5176\u50cf",(0,i.jsx)(n.a,{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fkubernetes.io%2Fdocs%2Fsetup%2Fproduction-environment%2Ftools%2Fkubeadm%2Fcreate-cluster-kubeadm%2F",children:"kubeadm \u57fa\u7840\u6559\u7a0b"}),"\u4e2d\u90a3\u6837\uff0c\u5c06\u4ece kubeadm init \u83b7\u5f97\u7684\u4ee4\u724c\u590d\u5236\u5230\u6bcf\u4e2a\u8282\u70b9\uff0c\u4e0d\u5982\u5e76\u884c\u5316\u4ee4\u724c\u5206\u53d1\uff0c\u4ee5\u4fbf\u66f4\u8f7b\u677e\u5730\u5b9e\u73b0\u81ea\u52a8\u5316\u3002\u8981\u5b9e\u73b0\u6b64\u81ea\u52a8\u5316\uff0c\u60a8\u5fc5\u987b\u77e5\u9053\u63a7\u5236\u5e73\u9762\u8282\u70b9\u5728\u542f\u52a8\u540e\u5c06\u5177\u6709\u7684 IP \u5730\u5740\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u6b65\u9aa4"}),"\n",(0,i.jsx)(n.p,{children:"1.\u4f7f\u7528 kubeadm \u751f\u6210\u4ee4\u724c\uff08token\uff09"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"kubeadm token generate\n"})}),"\n",(0,i.jsxs)(n.p,{children:["2.\u7528\u6b64\u4ee4\u724c(token)\u540c\u65f6\u542f\u52a8\u63a7\u5236\u5e73\u9762\u8282\u70b9\u548c\u5de5\u4f5c\u8282\u70b9\u3002\u5f53\u5b83\u4eec\u542f\u52a8\u65f6\uff0c\u5b83\u4eec\u4f1a\u627e\u5230\u5f7c\u6b64\u5e76\u5f62\u6210\u96c6\u7fa4\u3002\u76f8\u540c\u7684 ",(0,i.jsx)(n.code,{children:"--token"})," \u53c2\u6570\u53ef\u4ee5\u5728kubeadm init\u548ckubeadm join\u4e0a\u4f7f\u7528"]}),"\n",(0,i.jsxs)(n.p,{children:["3.\u53ef\u4ee5\u7528\u540c\u6837\u7684\u65b9\u6cd5\u6765\u6dfb\u52a0master\u8282\u70b9\uff0c\u901a\u8fc7\u8bbe\u7f6e ",(0,i.jsx)(n.code,{children:"--certificate-key"})," \u53c2\u6570\u6765\u8fbe\u5230\u52a0\u5165\u7684\u76ee\u7684\u3002\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u6765\u751f\u6210key\uff0c\u7ed9\u6bcf\u4e2amaster \u8282\u70b9\u4f7f\u7528"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"kubeadm alpha certs certificate-key\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u96c6\u7fa4\u542f\u52a8\u4e4b\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7",(0,i.jsx)(n.code,{children:"/etc/kubernetes/admin.conf"}),"\u4e2d\u7684\u51ed\u8bc1\u6765\u548c\u96c6\u7fa4\u4fe1\u3002"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u8fd9\u79cd\u65b9\u5f0f\u4e0d\u5141\u8bb8root ca \u901a\u8fc7--discovery-token-ca-cert-hash \u6765\u9a8c\u8bc1\u8bc1\u4e66hash \u6240\u4ee5\u6709\u4e00\u5b9a\u7684\u5b89\u5168\u9690\u60a3\u3002"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var i=t(96540);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);