"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[7043],{96851:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>i,default:()=>p,frontMatter:()=>l,metadata:()=>d,toc:()=>t});var r=n(74848),c=n(28453);const l={},i="headless service",d={id:"\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u670d\u52a1\u3001\u8d1f\u8f7d\u5747\u8861\u548c\u8054\u7f51/service/headless service",title:"headless service",description:"headless service\u5b98\u65b9\u6587\u6863",source:"@site/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u670d\u52a1\u3001\u8d1f\u8f7d\u5747\u8861\u548c\u8054\u7f51/service/headless service.md",sourceDirName:"\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u670d\u52a1\u3001\u8d1f\u8f7d\u5747\u8861\u548c\u8054\u7f51/service",slug:"/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u670d\u52a1\u3001\u8d1f\u8f7d\u5747\u8861\u548c\u8054\u7f51/service/headless service",permalink:"/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u670d\u52a1\u3001\u8d1f\u8f7d\u5747\u8861\u548c\u8054\u7f51/service/headless service",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"ingress-nginx\u914d\u7f6e\u8bbf\u95ee\u8ba4\u8bc1",permalink:"/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u670d\u52a1\u3001\u8d1f\u8f7d\u5747\u8861\u548c\u8054\u7f51/ingress/ingress-nginx/ingress-nginx\u914d\u7f6e\u8bbf\u95ee\u8ba4\u8bc1"},next:{title:"service\u7b80\u4ecb",permalink:"/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u670d\u52a1\u3001\u8d1f\u8f7d\u5747\u8861\u548c\u8054\u7f51/service/service\u7b80\u4ecb"}},a={},t=[{value:"\u65e0\u5934\u670d\u52a1\uff08Headless Services\uff09",id:"\u65e0\u5934\u670d\u52a1headless-services",level:2},{value:"\u5e26\u9009\u62e9\u7b97\u7b26\u7684\u670d\u52a1",id:"\u5e26\u9009\u62e9\u7b97\u7b26\u7684\u670d\u52a1",level:3},{value:"\u65e0\u9009\u62e9\u7b97\u7b26\u7684\u670d\u52a1",id:"\u65e0\u9009\u62e9\u7b97\u7b26\u7684\u670d\u52a1",level:3},{value:"headless service\u4f7f\u7528\u573a\u666f",id:"headless-service\u4f7f\u7528\u573a\u666f",level:2},{value:"\u4ec0\u4e48\u662fheadless service",id:"\u4ec0\u4e48\u662fheadless-service",level:2}];function o(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h1,{id:"headless-service",children:"headless service"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/#headless-services",children:"headless service\u5b98\u65b9\u6587\u6863"})}),"\n",(0,r.jsx)(s.h2,{id:"\u65e0\u5934\u670d\u52a1headless-services",children:"\u65e0\u5934\u670d\u52a1\uff08Headless Services\uff09"}),"\n",(0,r.jsxs)(s.p,{children:["\u6709\u65f6\u4e0d\u9700\u8981\u6216\u4e0d\u60f3\u8981\u8d1f\u8f7d\u5747\u8861\uff0c\u4ee5\u53ca\u5355\u72ec\u7684 Service IP\u3002 \u9047\u5230\u8fd9\u79cd\u60c5\u51b5\uff0c\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a Cluster IP\uff08",(0,r.jsx)(s.code,{children:"spec.clusterIP"}),"\uff09\u7684\u503c\u4e3a ",(0,r.jsx)(s.code,{children:'"None"'})," \u6765\u521b\u5efa ",(0,r.jsx)(s.code,{children:"Headless"})," Service\u3002"]}),"\n",(0,r.jsx)(s.p,{children:"\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u65e0\u5934 Service \u4e0e\u5176\u4ed6\u670d\u52a1\u53d1\u73b0\u673a\u5236\u8fdb\u884c\u63a5\u53e3\uff0c\u800c\u4e0d\u5fc5\u4e0e Kubernetes \u7684\u5b9e\u73b0\u6346\u7ed1\u5728\u4e00\u8d77\u3002"}),"\n",(0,r.jsxs)(s.p,{children:["\u5bf9\u4e8e\u65e0\u5934 ",(0,r.jsx)(s.code,{children:"Services"})," \u5e76\u4e0d\u4f1a\u5206\u914d Cluster IP\uff0ckube-proxy \u4e0d\u4f1a\u5904\u7406\u5b83\u4eec\uff0c \u800c\u4e14\u5e73\u53f0\u4e5f\u4e0d\u4f1a\u4e3a\u5b83\u4eec\u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\u548c\u8def\u7531\u3002 DNS \u5982\u4f55\u5b9e\u73b0\u81ea\u52a8\u914d\u7f6e\uff0c\u4f9d\u8d56\u4e8e Service \u662f\u5426\u5b9a\u4e49\u4e86\u9009\u62e9\u7b97\u7b26\u3002"]}),"\n",(0,r.jsx)(s.h3,{id:"\u5e26\u9009\u62e9\u7b97\u7b26\u7684\u670d\u52a1",children:"\u5e26\u9009\u62e9\u7b97\u7b26\u7684\u670d\u52a1"}),"\n",(0,r.jsxs)(s.p,{children:["\u5bf9\u5b9a\u4e49\u4e86\u9009\u62e9\u7b97\u7b26\u7684\u65e0\u5934\u670d\u52a1\uff0cKubernetes \u63a7\u5236\u5e73\u9762\u5728 Kubernetes API \u4e2d\u521b\u5efa EndpointSlice \u5bf9\u8c61\uff0c \u5e76\u4e14\u4fee\u6539 DNS \u914d\u7f6e\u8fd4\u56de A \u6216 AAA \u6761\u8bb0\u5f55\uff08IPv4 \u6216 IPv6 \u5730\u5740\uff09\uff0c\u901a\u8fc7\u8fd9\u4e2a\u5730\u5740\u76f4\u63a5\u5230\u8fbe ",(0,r.jsx)(s.code,{children:"Service"})," \u7684\u540e\u7aef Pod \u4e0a\u3002"]}),"\n",(0,r.jsx)(s.h3,{id:"\u65e0\u9009\u62e9\u7b97\u7b26\u7684\u670d\u52a1",children:"\u65e0\u9009\u62e9\u7b97\u7b26\u7684\u670d\u52a1"}),"\n",(0,r.jsx)(s.p,{children:"\u5bf9\u6ca1\u6709\u5b9a\u4e49\u9009\u62e9\u7b97\u7b26\u7684\u65e0\u5934\u670d\u52a1\uff0c\u63a7\u5236\u5e73\u9762\u4e0d\u4f1a\u521b\u5efa EndpointSlice \u5bf9\u8c61\u3002 \u7136\u800c DNS \u7cfb\u7edf\u4f1a\u67e5\u627e\u548c\u914d\u7f6e\u4ee5\u4e0b\u4e4b\u4e00\uff1a"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\u5bf9\u4e8e ",(0,r.jsx)(s.a,{href:"https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/#externalname",children:(0,r.jsx)(s.code,{children:"type: ExternalName"})})," \u670d\u52a1\uff0c\u67e5\u627e\u548c\u914d\u7f6e\u5176 CNAME \u8bb0\u5f55"]}),"\n",(0,r.jsxs)(s.li,{children:["\u5bf9\u6240\u6709\u5176\u4ed6\u7c7b\u578b\u7684\u670d\u52a1\uff0c\u9488\u5bf9 Service \u7684\u5c31\u7eea\u7aef\u70b9\u7684\u6240\u6709 IP \u5730\u5740\uff0c\u67e5\u627e\u548c\u914d\u7f6e DNS A / AAAA \u6761\u8bb0\u5f55","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"\u5bf9\u4e8e IPv4 \u7aef\u70b9\uff0cDNS \u7cfb\u7edf\u521b\u5efa A \u6761\u8bb0\u5f55\u3002"}),"\n",(0,r.jsx)(s.li,{children:"\u5bf9\u4e8e IPv6 \u7aef\u70b9\uff0cDNS \u7cfb\u7edf\u521b\u5efa AAAA \u6761\u8bb0\u5f55\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"\u4ee5\u4e0a\u662f\u5b98\u65b9\u6587\u6863\u4e2d\u5bf9\u4e8eheadless service\u7684\u4ecb\u7ecd\uff0c\u6bd4\u8f83\u7b80\u5355"}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://dev.to/eddiehale3/building-a-headless-service-in-kubernetes-3bk8",children:"\u8fd9\u91cc\u6709\u4e00\u7bc7\u5173\u4e8eheadless service\u7684\u6587\u7ae0"})}),"\n",(0,r.jsx)(s.h2,{id:"headless-service\u4f7f\u7528\u573a\u666f",children:"headless service\u4f7f\u7528\u573a\u666f"}),"\n",(0,r.jsx)(s.p,{children:"\u67d0\u4e9b\u60c5\u51b5\u4e0b\u9700\u8981\u4e0epod\u76f4\u63a5\u901a\u4fe1\u800c\u4e0d\u662f\u901a\u8fc7\u8d1f\u8f7d\u5747\u8861"}),"\n",(0,r.jsx)(s.h2,{id:"\u4ec0\u4e48\u662fheadless-service",children:"\u4ec0\u4e48\u662fheadless service"}),"\n",(0,r.jsxs)(s.p,{children:["headless service\u662f\u5177\u6709service ip\u7684service\uff0c\u4f46\u662f\u5b83\u4e0d\u4f1a\u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\uff0c\u800c\u662f\u76f4\u63a5\u8fd4\u56de\u6240\u5173\u8054\u7684pod\u7684ip\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u76f4\u63a5\u4e0epod\u4ea4\u4e92\u800c\u4e0d\u662f\u4ee3\u7406\uff0c\u914d\u7f6eservice\u662fheadless service\u9700\u8981\u5c06 ",(0,r.jsx)(s.code,{children:".spec.clusterIP"})," \u6307\u5b9a\u4e3a ",(0,r.jsx)(s.code,{children:"None"})," \u5373\u53ef\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728\u6709\u6216\u8005\u6ca1\u6709\u9009\u62e9\u7b97\u7b26\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528"]}),"\n",(0,r.jsx)(s.p,{children:"headless service\u914d\u7f6e\u793a\u4f8b"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Service\nmetadata:\n  name: my-headless-service\nspec:\n  clusterIP: None # clusterIP\u6307\u5b9a\u4e3aNone\n  selector:\n    app: test-app\n  ports:\n    - protocol: TCP\n      port: 80\n      targetPort: 3000\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u4e0b\u9762\u662f\u4e00\u4e2a\u793a\u4f8b"}),"\n",(0,r.jsx)(s.p,{children:"\u521b\u5efa\u4e00\u4e2a\u5305\u542b5\u4e2apod\u7684deployment"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"cat > api-deployment.yaml << EOF\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: api-deployment\n  labels:\n    app: api\nspec:\n  replicas: 5\n  selector:\n    matchLabels:\n      app: api\n  template:\n    metadata:\n      labels:\n        app: api\n    spec:\n      containers:\n      - name: api\n        image: eddiehale/hellonodeapi\n        ports:\n        - containerPort: 3000\nEOF\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u521b\u5efa\u5e38\u89c4service"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"cat > normal-service.yaml << EOF\napiVersion: v1\nkind: Service\nmetadata:\n  name: normal-service\nspec:\n  selector:\n    app: api\n  ports:\n    - protocol: TCP\n      port: 80\n      targetPort: 3000\nEOF\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u521b\u5efa\u65e0\u5934service"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"cat > headless-service.yaml << EOF\napiVersion: v1\nkind: Service\nmetadata:\n  name: headless-service\nspec:\n  clusterIP: None # clusterIP\u9700\u8981\u6307\u5b9a\u4e3aNone\n  selector:\n    app: api\n  ports:\n    - protocol: TCP\n      port: 80\n      targetPort: 3000\nEOF\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u521b\u5efa\u8fd9\u4e9b\u8d44\u6e90"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"kubectl apply -f api-deployment.yaml\nkubectl apply -f normal-service.yaml\nkubectl apply -f headless-service.yaml\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u67e5\u770b\u6240\u6709"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"$ kubectl get all\nNAME                                 READY   STATUS    RESTARTS   AGE\npod/api-deployment-7898bdd89-6rtpb   1/1     Running   0          13s\npod/api-deployment-7898bdd89-9qvtl   1/1     Running   0          13s\npod/api-deployment-7898bdd89-bkw6f   1/1     Running   0          13s\npod/api-deployment-7898bdd89-hvlv6   1/1     Running   0          13s\npod/api-deployment-7898bdd89-j5r64   1/1     Running   0          13s\n\nNAME                       TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE\nservice/headless-service   ClusterIP   None          <none>        80/TCP    11s\nservice/normal-service     ClusterIP   10.96.1.136   <none>        80/TCP    13s\n\nNAME                             READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/api-deployment   5/5     5            5           13s\n\nNAME                                       DESIRED   CURRENT   READY   AGE\nreplicaset.apps/api-deployment-7898bdd89   5         5         5       13s\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u8fd0\u884c\u4e00\u4e2abusybox\u6765\u8fdb\u884c\u4e00\u4e9b\u6d4b\u8bd5"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"kubectl run -it --image busybox:1.28.3 test --restart=Never --rm /bin/sh\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u89e3\u6790\u5e38\u89c4service\uff0c\u53ef\u4ee5\u770b\u5230\u53ea\u8fd4\u56de\u4e86service\u7684ip\u5730\u5740"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"/ # nslookup normal-service\nServer:    10.96.0.10\nAddress 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local\n\nName:      normal-service\nAddress 1: 10.96.1.136 normal-service.test.svc.cluster.local\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u89e3\u6790\u65e0\u5934service\uff0c\u53ef\u4ee5\u770b\u5230\u76f4\u63a5\u8fd4\u56de\u4e86\u65e0\u5934service\u6240\u5bf9\u5e94\u76845\u4e2apod\u7684ip"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"/ # nslookup headless-service\nServer:    10.96.0.10\nAddress 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local\n\nName:      headless-service\nAddress 1: 100.108.251.47 100-108-251-47.normal-service.test.svc.cluster.local\nAddress 2: 100.108.251.43 100-108-251-43.headless-service.test.svc.cluster.local\nAddress 3: 100.108.251.30 100-108-251-30.headless-service.test.svc.cluster.local\nAddress 4: 100.108.251.67 100-108-251-67.normal-service.test.svc.cluster.local\nAddress 5: 100.108.251.59 100-108-251-59.normal-service.test.svc.cluster.local\n"})})]})}function p(e={}){const{wrapper:s}={...(0,c.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>d});var r=n(96540);const c={},l=r.createContext(c);function i(e){const s=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),r.createElement(l.Provider,{value:s},e.children)}}}]);