"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[4403],{52744:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>t,default:()=>a,frontMatter:()=>o,metadata:()=>c,toc:()=>u});var r=s(74848),i=s(28453);const o={},t="supervisor\u7ba1\u7406nginx",c={id:"linux/linux\u670d\u52a1/supervisor/supervisor\u7ba1\u7406nginx",title:"supervisor\u7ba1\u7406nginx",description:"supervisor\u914d\u7f6e\u6587\u4ef6 /etc/supervisor/supervisord.conf \u4e2d\u5b9a\u4e49\u4e86include\uff0c\u56e0\u6b64\u5982\u679c\u60f3\u8981\u7ba1\u7406\u670d\u52a1\uff0c\u5c31\u9700\u8981\u7f16\u8f91 /etc/supervisor/config.d/*.ini \u6587\u4ef6",source:"@site/docs/linux/linux\u670d\u52a1/supervisor/supervisor\u7ba1\u7406nginx.md",sourceDirName:"linux/linux\u670d\u52a1/supervisor",slug:"/linux/linux\u670d\u52a1/supervisor/supervisor\u7ba1\u7406nginx",permalink:"/docs/linux/linux\u670d\u52a1/supervisor/supervisor\u7ba1\u7406nginx",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"supervisor\u7ba1\u7406mysql",permalink:"/docs/linux/linux\u670d\u52a1/supervisor/supervisor\u7ba1\u7406mysql"},next:{title:"supervisor\u7ba1\u7406php",permalink:"/docs/linux/linux\u670d\u52a1/supervisor/supervisor\u7ba1\u7406php"}},l={},u=[];function d(n){const e={admonition:"admonition",code:"code",h1:"h1",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h1,{id:"supervisor\u7ba1\u7406nginx",children:"supervisor\u7ba1\u7406nginx"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsxs)(e.strong,{children:["supervisor\u914d\u7f6e\u6587\u4ef6 ",(0,r.jsx)(e.code,{children:"/etc/supervisor/supervisord.conf"})," \u4e2d\u5b9a\u4e49\u4e86include\uff0c\u56e0\u6b64\u5982\u679c\u60f3\u8981\u7ba1\u7406\u670d\u52a1\uff0c\u5c31\u9700\u8981\u7f16\u8f91 ",(0,r.jsx)(e.code,{children:"/etc/supervisor/config.d/*.ini"})," \u6587\u4ef6"]})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"[include] \nfiles = /etc/supervisor/config.d/*.ini\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsxs)(e.strong,{children:["\u7f16\u8f91nginx\u670d\u52a1\u914d\u7f6e\u6587\u4ef6 ",(0,r.jsx)(e.code,{children:"/etc/supervisor/config.d/nginx.ini"})]})}),"\n",(0,r.jsx)(e.admonition,{type:"caution",children:(0,r.jsxs)(e.p,{children:["\u26a0\ufe0f\u9700\u8981\u6ce8\u610f\u7684\u662f ",(0,r.jsx)(e.code,{children:"/usr/sbin/nginx"})," \u8868\u793a\u5728\u540e\u53f0\u8fd0\u884c\uff0c\u4f46\u662f**",(0,r.jsx)("span",{style:{color:"red"},children:"supervisor\u4e0d\u80fd\u76d1\u63a7\u540e\u53f0\u7a0b\u5e8f"}),"**\uff0c \u6240\u4ee5supervisor\u5c31\u4e00\u76f4\u6267\u884c\u8fd9\u4e2a\u547d\u4ee4 \uff0c\u56e0\u6b64\u4f1a\u62a5\u9519"]})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"/usr/sbin/nginx "}),"\u540e\u5fc5\u987b\u52a0\u53c2\u6570  ",(0,r.jsx)(e.code,{children:"-g 'daemon off;'"}),"  \u8868\u793a\u5728\u524d\u53f0\u8fd0\u884c"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"cat > /etc/supervisor/config.d/nginx.ini <<EOF\n[program:nginx]\n# use default nginx config file and dir\ncommand = `which nginx` -g 'daemon off;'\nstdout_logfile = /var/log/supervisor/nginx.log\nredirect_stderr = true\nautorestart = true\nEOF\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u5c06nginx\u52a0\u5165supervisor"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"$ supervisorctl update nginx\nnginx: added process group\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u67e5\u770b\u72b6\u6001"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"$ supervisorctl status nginx\nnginx           RUNNING   pid 9464, uptime 0:00:03\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u8be6\u7ec6\u914d\u7f6e"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"[program:nginx]\n# use default nginx config file and dir\ncommand = /usr/local/nginx/sbin/nginx -g 'daemon off;'\nstdout_logfile = /var/log/supervisord/nginx.log\nredirect_stderr = true\nautorestart = true\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"nginx\u914d\u7f6e\u6587\u4ef6"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-nginx",children:"#user  www www;\nworker_processes auto;\n# worker_cpu_affinity auto;\t# openresty-1.9.15\nworker_rlimit_nofile 65535;\n\nerror_log  logs/error.log;\npid        /var/run/nginx.pid;\n\nevents {\n    use epoll;\n    worker_connections  65565;\n}\n\nhttp {\n\n    server_tokens off;\n    sendfile on;\n    tcp_nodelay on;\n    tcp_nopush on;\n    keepalive_timeout  0;\n    charset utf-8;\n\n    include mime.types;\n    default_type application/json;\n\n    log_format  main  ' $http_X_Forwarded_Proto - $http_SLB_IP - $upstream_addr - $http_X_Forwarded_For - '\n                      '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status [$upstream_response_time]  '\n                      '[$request_time] $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\"';\n    client_header_buffer_size 16k;\n    large_client_header_buffers 8 16k;\n    server_names_hash_bucket_size 128;\n    client_max_body_size 4096m;\n\n    client_header_timeout 30s;\n    client_body_timeout 30s;\n    send_timeout 30s;\n    lingering_close off;\n\n    gzip on;\n    gzip_vary on;\n    gzip_min_length  1000;\n    gzip_comp_level  6;\n    gzip_types text/plain text/xml text/css application/javascript application/json;\n    gzip_http_version 1.0;\n\n    #index index.html index.shtml index.php;\n\n\n\tinclude upstream.conf;\n\tinclude default.conf;\n\tinclude vhosts/*.conf;\n        include vhosts/jr/*.conf;\n        include vhosts/yg/*.conf;\n        include vhosts/yjk/*.conf;\n        include vhosts/ys/*.conf;\n        include vhosts/sec/*.conf;\n        include vhosts/saas/*.conf;\n        include vhosts/bd/*.conf;\n        include vhosts/autom/*.conf;\n\n\n    lua_code_cache on;\n    lua_package_path \"../?.lua;../lib/?.lua;../lib/lua-resty-core/lib/?.lua;;\";\n    lua_need_request_body on;\n\n}\n"})})]})}function a(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},28453:(n,e,s)=>{s.d(e,{R:()=>t,x:()=>c});var r=s(96540);const i={},o=r.createContext(i);function t(n){const e=r.useContext(o);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:t(n.components),r.createElement(o.Provider,{value:e},n.children)}}}]);