"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[3178],{70613:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>d});var t=s(74848),l=s(28453);const r={},i="\u5229\u7528libreswan+V2Ray\u5b9e\u73b0\u79d1\u5b66\u4e0a\u7f51",a={id:"linux/\u79d1\u5b66\u4e0a\u7f51/\u5229\u7528libreswan+r2ray\u5b9e\u73b0\u79d1\u5b66\u4e0a\u7f51",title:"\u5229\u7528libreswan+V2Ray\u5b9e\u73b0\u79d1\u5b66\u4e0a\u7f51",description:"\u5b9e\u9a8c\u80cc\u666f",source:"@site/docs/linux/\u79d1\u5b66\u4e0a\u7f51/\u5229\u7528libreswan+r2ray\u5b9e\u73b0\u79d1\u5b66\u4e0a\u7f51.md",sourceDirName:"linux/\u79d1\u5b66\u4e0a\u7f51",slug:"/linux/\u79d1\u5b66\u4e0a\u7f51/\u5229\u7528libreswan+r2ray\u5b9e\u73b0\u79d1\u5b66\u4e0a\u7f51",permalink:"/docs/linux/\u79d1\u5b66\u4e0a\u7f51/\u5229\u7528libreswan+r2ray\u5b9e\u73b0\u79d1\u5b66\u4e0a\u7f51",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u79d1\u5b66\u4e0a\u7f51",permalink:"/docs/linux/\u79d1\u5b66\u4e0a\u7f51/"},next:{title:"HTTP \u534f\u8bae",permalink:"/docs/linux/\u7f51\u7edc\u534f\u8bae/http/HTTP \u534f\u8bae"}},c={},d=[{value:"\u5b9e\u9a8c\u80cc\u666f",id:"\u5b9e\u9a8c\u80cc\u666f",level:2},{value:"\u5b9e\u9a8c\u73af\u5883",id:"\u5b9e\u9a8c\u73af\u5883",level:2},{value:"1.\u5b89\u88c5\u914d\u7f6elibreswan",id:"1\u5b89\u88c5\u914d\u7f6elibreswan",level:2},{value:"1.0 \u7f16\u8f91\u73af\u5883\u53d8\u91cf\u6587\u4ef6",id:"10-\u7f16\u8f91\u73af\u5883\u53d8\u91cf\u6587\u4ef6",level:3},{value:"1.1 \u5b89\u88c5\u4f9d\u8d56\u5305",id:"11-\u5b89\u88c5\u4f9d\u8d56\u5305",level:3},{value:"1.2 \u5b89\u88c5libreswan",id:"12-\u5b89\u88c5libreswan",level:3},{value:"1.3 \u914d\u7f6e\u5185\u6838\u53c2\u6570",id:"13-\u914d\u7f6e\u5185\u6838\u53c2\u6570",level:3},{value:"1.4 \u542f\u52a8ipsec",id:"14-\u542f\u52a8ipsec",level:3},{value:"1.5 \u9632\u706b\u5899\u914d\u7f6e",id:"15-\u9632\u706b\u5899\u914d\u7f6e",level:3},{value:"1.6 \u9a8c\u8bc1\u7aef\u53e3\u8fde\u901a\u6027",id:"16-\u9a8c\u8bc1\u7aef\u53e3\u8fde\u901a\u6027",level:3},{value:"1.7 \u914d\u7f6e\u9884\u5171\u4eab\u5bc6\u94a5",id:"17-\u914d\u7f6e\u9884\u5171\u4eab\u5bc6\u94a5",level:3},{value:"1.8 \u914d\u7f6eipsec\u8fde\u63a5",id:"18-\u914d\u7f6eipsec\u8fde\u63a5",level:3},{value:"1.8.1 \u914d\u7f6e\u9999\u6e2f\u533a\u670d\u52a1\u5668",id:"181-\u914d\u7f6e\u9999\u6e2f\u533a\u670d\u52a1\u5668",level:4},{value:"1.8.2 \u914d\u7f6e\u5317\u4eac\u533a\u670d\u52a1\u5668",id:"182-\u914d\u7f6e\u5317\u4eac\u533a\u670d\u52a1\u5668",level:4},{value:"1.8.3 \u5f00\u542fipsec\u65e5\u5fd7",id:"183-\u5f00\u542fipsec\u65e5\u5fd7",level:4},{value:"1.8.4 \u91cd\u542fipsec",id:"184-\u91cd\u542fipsec",level:4},{value:"1.8.5 \u9a8c\u8bc1",id:"185-\u9a8c\u8bc1",level:4},{value:"1.8.5.1 \u4e24\u7aef\u4e92ping",id:"1851-\u4e24\u7aef\u4e92ping",level:5},{value:"1.8.5.2 \u67e5\u770bipsec\u72b6\u6001",id:"1852-\u67e5\u770bipsec\u72b6\u6001",level:5},{value:"1.8.5.3 \u67e5\u770b\u65e5\u5fd7",id:"1853-\u67e5\u770b\u65e5\u5fd7",level:5},{value:"1.8.5.4 \u67e5\u770b\u8fde\u63a5\u60c5\u51b5",id:"1854-\u67e5\u770b\u8fde\u63a5\u60c5\u51b5",level:5},{value:"2.\u5b89\u88c5\u914d\u7f6eV2Ray",id:"2\u5b89\u88c5\u914d\u7f6ev2ray",level:2},{value:"2.1 \u9999\u6e2f\u533a\u670d\u52a1\u5668\u64cd\u4f5c",id:"21-\u9999\u6e2f\u533a\u670d\u52a1\u5668\u64cd\u4f5c",level:3},{value:"2.2 \u5317\u4eac\u533a\u670d\u52a1\u5668\u64cd\u4f5c",id:"22-\u5317\u4eac\u533a\u670d\u52a1\u5668\u64cd\u4f5c",level:3},{value:"2.2.1 \u4e0b\u8f7d\u4e00\u952e\u5b89\u88c5\u811a\u672c",id:"221-\u4e0b\u8f7d\u4e00\u952e\u5b89\u88c5\u811a\u672c",level:4},{value:"2.2.2 \u4e0b\u8f7d\u5b89\u88c5\u5305",id:"222-\u4e0b\u8f7d\u5b89\u88c5\u5305",level:4},{value:"2.2.3 \u5b89\u88c5v2ray",id:"223-\u5b89\u88c5v2ray",level:4},{value:"2.3 \u542f\u52a8v2ray",id:"23-\u542f\u52a8v2ray",level:3},{value:"2.4 \u7f16\u8f91\u914d\u7f6e\u6587\u4ef6",id:"24-\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6",level:3},{value:"2.5 \u91cd\u542fv2ray",id:"25-\u91cd\u542fv2ray",level:3},{value:"2.6 \u67e5\u770b\u542f\u52a8",id:"26-\u67e5\u770b\u542f\u52a8",level:3},{value:"2.7 \u914d\u7f6e\u4ee3\u7406",id:"27-\u914d\u7f6e\u4ee3\u7406",level:3},{value:"2.8 \u9a8c\u8bc1",id:"28-\u9a8c\u8bc1",level:3}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"\u5229\u7528libreswanv2ray\u5b9e\u73b0\u79d1\u5b66\u4e0a\u7f51",children:"\u5229\u7528libreswan+V2Ray\u5b9e\u73b0\u79d1\u5b66\u4e0a\u7f51"}),"\n",(0,t.jsx)(n.h2,{id:"\u5b9e\u9a8c\u80cc\u666f",children:"\u5b9e\u9a8c\u80cc\u666f"}),"\n",(0,t.jsxs)(n.p,{children:["\u5728\u4e91\u4e3b\u673a\u4e2d(\u963f\u91cc\u4e91\u3001\u817e\u8baf\u4e91\u7b49)\uff0c\u5927\u9646\u5730\u533a\u7684\u673a\u5668\u662f\u65e0\u6cd5\u79d1\u5b66\u4e0a\u7f51\u7684\uff0c\u5e76\u4e14\u597d\u591a\u4f18\u79c0\u7684\u7f51\u7ad9\u3001\u5de5\u5177\u7b49\u65e0\u6cd5\u8bbf\u95ee\u6216\u8005\u4e0b\u8f7d\u901f\u5ea6\u5f88\u6162\uff0c\u4f8b\u5982\u4e0b\u8f7dgithub\u4e0a\u7684\u4e00\u4e9b\u8d44\u6e90\uff0c\u6211\u4eec\u53ef\u4ee5\u8d2d\u4e70VPS(\u4f8b\u5982",(0,t.jsx)(n.a,{href:"https://www.itblogcn.com/vultr",children:"Vultr"}),")\u6216\u8005\u9999\u6e2f\u7b49\u5730\u533a\u7684\u4e3b\u673a\uff0c\u518d\u914d\u5408\u4e00\u4e9b\u8f6f\u4ef6\u5c31\u53ef\u4ee5\u5b9e\u73b0\u79d1\u5b66\u4e0a\u7f51\u4e86"]}),"\n",(0,t.jsxs)(n.p,{children:["\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ",(0,t.jsx)(n.a,{href:"https://github.com/libreswan/libreswan/",children:"libreswan"})," \u642d\u5efa ",(0,t.jsx)(n.code,{children:"ipssec"})," \u96a7\u9053\u5b9e\u73b0\u4e0d\u901a\u5730\u57df\u4e3b\u673a\u5185\u7f51\u4e92\u901a\uff0c\u7136\u540e\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"V2Ray"})," \u4f5c\u4e3a\u4ee3\u7406\u5de5\u5177\u5b9e\u73b0\u79d1\u5b66\u4e0a\u7f51"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://libreswan.org/",children:"libreswan\u5b98\u7f51"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://github.com/libreswan/libreswan/",children:"libreswan github"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://libreswan.org/wiki",children:"libreswan\u5b98\u65b9\u6587\u6863"})}),"\n",(0,t.jsx)(n.h2,{id:"\u5b9e\u9a8c\u73af\u5883",children:"\u5b9e\u9a8c\u73af\u5883"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u533a\u57df"}),(0,t.jsx)(n.th,{children:"\u516c\u7f51IP"}),(0,t.jsx)(n.th,{children:"\u5185\u7f51IP\u6bb5"}),(0,t.jsx)(n.th,{children:"\u5185\u7f51IP"}),(0,t.jsx)(n.th,{children:"\u7cfb\u7edf"}),(0,t.jsx)(n.th,{children:"\u5185\u6838\u7248\u672c"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u5317\u4eac"}),(0,t.jsx)(n.td,{children:"81.70.22.232"}),(0,t.jsx)(n.td,{children:"172.31.0.0/24"}),(0,t.jsx)(n.td,{children:"172.31.0.3"}),(0,t.jsx)(n.td,{children:"CentOS7.9"}),(0,t.jsx)(n.td,{children:"3.10.0-1160.45.1.el7.x86_64"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u9999\u6e2f"}),(0,t.jsx)(n.td,{children:"129.226.167.89"}),(0,t.jsx)(n.td,{children:"10.0.0.0/24"}),(0,t.jsx)(n.td,{children:"10.0.0.17"}),(0,t.jsx)(n.td,{children:"CentOS7.9"}),(0,t.jsx)(n.td,{children:"3.10.0-1160.45.1.el7.x86_64"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"1\u5b89\u88c5\u914d\u7f6elibreswan",children:"1.\u5b89\u88c5\u914d\u7f6elibreswan"}),"\n",(0,t.jsx)(n.h3,{id:"10-\u7f16\u8f91\u73af\u5883\u53d8\u91cf\u6587\u4ef6",children:"1.0 \u7f16\u8f91\u73af\u5883\u53d8\u91cf\u6587\u4ef6"}),"\n",(0,t.jsx)(n.p,{children:"\u5317\u4eac\u3001\u9999\u6e2f\u533a\u670d\u52a1\u5668\u64cd\u505a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# \u7f16\u8f91\u6587\u4ef6\ncat > /opt/wall_env << EOF\nBJ_PUBLIC_IP=81.70.22.232\nBJ_PRIVATE_IP=172.31.0.3\nBJ_IP_SUBNET=172.31.0.0/24\nHK_PUBLIC_IP=129.226.167.89\nHK_PRIVATE_IP=10.0.0.17\nHK_IP_SUBNET=10.0.0.0/24\nEOF\n\n# \u52a0\u8f7d\u73af\u5883\u53d8\u91cf\nsource /opt/wall_env\n"})}),"\n",(0,t.jsx)(n.h3,{id:"11-\u5b89\u88c5\u4f9d\u8d56\u5305",children:"1.1 \u5b89\u88c5\u4f9d\u8d56\u5305"}),"\n",(0,t.jsx)(n.p,{children:"\u5317\u4eac\u3001\u9999\u6e2f\u533a\u670d\u52a1\u5668\u64cd\u505a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"yum -y install audit-libs-devel bison curl-devel fipscheck-devel flex gcc ldns-devel libcap-ng-devel libevent-devel libseccomp-devel libselinux-devel make nspr-devel nss-devel pam-devel pkgconfig systemd-devel unbound-devel xmlto\n"})}),"\n",(0,t.jsx)(n.h3,{id:"12-\u5b89\u88c5libreswan",children:"1.2 \u5b89\u88c5libreswan"}),"\n",(0,t.jsx)(n.p,{children:"\u5317\u4eac\u3001\u9999\u6e2f\u533a\u670d\u52a1\u5668\u64cd\u505a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"yum -y install libreswan\n"})}),"\n",(0,t.jsx)(n.h3,{id:"13-\u914d\u7f6e\u5185\u6838\u53c2\u6570",children:"1.3 \u914d\u7f6e\u5185\u6838\u53c2\u6570"}),"\n",(0,t.jsx)(n.p,{children:"\u5317\u4eac\u3001\u9999\u6e2f\u533a\u670d\u52a1\u5668\u64cd\u505a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# \u5f00\u542f\u8def\u7531\u8f6c\u53d1\nsed -i '/^net.ipv4.ip_forward/d' /etc/sysctl.conf \ncat >> /etc/sysctl.conf << EOF\nnet.ipv4.ip_forward = 1\nEOF\n\n# \u4f7f\u914d\u7f6e\u751f\u6548\nsysctl -p\n"})}),"\n",(0,t.jsx)(n.h3,{id:"14-\u542f\u52a8ipsec",children:"1.4 \u542f\u52a8ipsec"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"systemctl start ipsec && systemctl enable ipsec\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u67e5\u770b\u72b6\u6001"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'$ systemctl status ipsec\n\u25cf ipsec.service - Internet Key Exchange (IKE) Protocol Daemon for IPsec\n   Loaded: loaded (/usr/lib/systemd/system/ipsec.service; enabled; vendor preset: disabled)\n   Active: active (running) since Tue 2022-03-29 10:38:39 CST; 14s ago\n     Docs: man:ipsec(8)\n           man:pluto(8)\n           man:ipsec.conf(5)\n Main PID: 6483 (pluto)\n   Status: "Startup completed."\n   CGroup: /system.slice/ipsec.service\n           \u2514\u25006483 /usr/libexec/ipsec/pluto --leak-detective --config /etc/ipsec.conf --nofork\n\nMar 29 10:38:39 hk pluto[6483]: adding interface lo/lo 127.0.0.1:500\nMar 29 10:38:39 hk pluto[6483]: adding interface lo/lo 127.0.0.1:4500\nMar 29 10:38:39 hk pluto[6483]: adding interface lo/lo ::1:500\nMar 29 10:38:39 hk pluto[6483]: | setup callback for interface lo:500 fd 19\nMar 29 10:38:39 hk pluto[6483]: | setup callback for interface lo:4500 fd 18\nMar 29 10:38:39 hk pluto[6483]: | setup callback for interface lo:500 fd 17\nMar 29 10:38:39 hk pluto[6483]: | setup callback for interface eth0:4500 fd 16\nMar 29 10:38:39 hk pluto[6483]: | setup callback for interface eth0:500 fd 15\nMar 29 10:38:39 hk pluto[6483]: loading secrets from "/etc/ipsec.secrets"\nMar 29 10:38:39 hk pluto[6483]: no secrets filename matched "/etc/ipsec.d/*.secrets"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"15-\u9632\u706b\u5899\u914d\u7f6e",children:"1.5 \u9632\u706b\u5899\u914d\u7f6e"}),"\n",(0,t.jsx)(n.p,{children:"\u9999\u6e2f\u533a\u670d\u52a1\u5668\u64cd\u4f5c"}),"\n",(0,t.jsx)(n.p,{children:"\u9632\u706b\u5899\u7b56\u7565\u5f00\u653e udp 500 \u548c udp 4500 \u7aef\u53e3\uff0c\u5141\u8bb8\u5317\u4eac\u533a\u4e3b\u673a\u516c\u7f51IP\u8bbf\u95ee"}),"\n",(0,t.jsx)(n.h3,{id:"16-\u9a8c\u8bc1\u7aef\u53e3\u8fde\u901a\u6027",children:"1.6 \u9a8c\u8bc1\u7aef\u53e3\u8fde\u901a\u6027"}),"\n",(0,t.jsx)(n.p,{children:"\u5317\u4eac\u533a\u670d\u52a1\u5668\u64cd\u4f5c"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"$ nmap -sU 2.2.2.2 -p 500,4500 -Pn\n\nStarting Nmap 6.40 ( http://nmap.org ) at 2022-03-20 21:32 CST\nNmap scan report for 2.2.2.2\nHost is up.\nPORT     STATE         SERVICE\n500/udp  open|filtered isakmp\n4500/udp open|filtered nat-t-ike\n\nNmap done: 1 IP address (1 host up) scanned in 3.17 seconds\n"})}),"\n",(0,t.jsx)(n.h3,{id:"17-\u914d\u7f6e\u9884\u5171\u4eab\u5bc6\u94a5",children:"1.7 \u914d\u7f6e\u9884\u5171\u4eab\u5bc6\u94a5"}),"\n",(0,t.jsx)(n.p,{children:"\u5317\u4eac\u3001\u9999\u6e2f\u533a\u670d\u52a1\u5668\u64cd\u505a"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"/etc/ipsec.secrets"})," \u914d\u7f6e\u6587\u4ef6\u4e2d\u6709 ",(0,t.jsx)(n.code,{children:"include /etc/ipsec.d/*.secrets"})," \uff0c\u56e0\u6b64\u6211\u4eec\u5728 ",(0,t.jsx)(n.code,{children:"/etc/ipsec.d"})," \u76ee\u5f55\u4e0b\u65b0\u5efa ",(0,t.jsx)(n.code,{children:"*.secrets"})," \u6587\u4ef6"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ cat /etc/ipsec.secrets\ninclude /etc/ipsec.d/*.secrets\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u65b0\u5efa ",(0,t.jsx)(n.code,{children:"/etc/ipsec.d/vm.secrets"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'cat > /etc/ipsec.d/vm.secrets << EOF\n# \u6e90ip \u76ee\u7684ip : PSK "key"\n0.0.0.0 0.0.0.0 : PSK "baidu666com"\nEOF\n'})}),"\n",(0,t.jsx)(n.h3,{id:"18-\u914d\u7f6eipsec\u8fde\u63a5",children:"1.8 \u914d\u7f6eipsec\u8fde\u63a5"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"/etc/ipsec.conf"})," \u914d\u7f6e\u6587\u4ef6\u4e2d\u6709 ",(0,t.jsx)(n.code,{children:"include /etc/ipsec.d/*.conf"})," \uff0c\u56e0\u6b64\u6211\u4eec\u5728 ",(0,t.jsx)(n.code,{children:"/etc/ipsec.d"})," \u76ee\u5f55\u4e0b\u65b0\u5efa ",(0,t.jsx)(n.code,{children:"*.conf"})," \u6587\u4ef6\uff0c\u540c\u65f6 ",(0,t.jsx)(n.code,{children:"/etc/ipsec.conf"})," \u6587\u4ef6\u4e2d\u6709\u8be6\u7ec6\u7684\u793a\u4f8b\u8bf4\u660e"]}),"\n",(0,t.jsx)(n.h4,{id:"181-\u914d\u7f6e\u9999\u6e2f\u533a\u670d\u52a1\u5668",children:"1.8.1 \u914d\u7f6e\u9999\u6e2f\u533a\u670d\u52a1\u5668"}),"\n",(0,t.jsxs)(n.p,{children:["Libreswan \u4e0d\u4f7f\u7528\u672f\u8bed ",(0,t.jsx)(n.code,{children:"source"})," \u6216 ",(0,t.jsx)(n.code,{children:"destination"}),"\u3002\u76f8\u53cd\uff0c\u5b83\u7528\u672f\u8bed  ",(0,t.jsx)(n.code,{children:"left"})," \u548c ",(0,t.jsx)(n.code,{children:"right"}),"\u6765\u4ee3\u6307\u7ec8\u7aef\uff08\u4e3b\u673a\uff09\u3002\u867d\u7136\u5927\u591a\u6570\u7ba1\u7406\u5458\u7528 ",(0,t.jsx)(n.code,{children:"left"})," \u8868\u793a\u672c\u5730\u4e3b\u673a\uff0c",(0,t.jsx)(n.code,{children:"right"})," \u8868\u793a\u8fdc\u7a0b\u4e3b\u673a\uff0c\u4f46\u662f\u8fd9\u6837\u53ef\u4ee5\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u5728\u4e24\u4e2a\u7ec8\u7aef\u4e0a\u4f7f\u7528\u76f8\u540c\u7684\u914d\u7f6e\u3002\n\u7531\u4e8e\u6211\u4eec\u7684\u670d\u52a1\u5668\u4f7f\u7528\u7684\u662fvpc\u7f51\u7edc\uff0c\u91c7\u7528\u9759\u6001nat\u7684\u5f62\u5f0f\uff0c\u5728\u914d\u7f6e ",(0,t.jsx)(n.code,{children:"left"})," \u548c ",(0,t.jsx)(n.code,{children:"right"})," \u65f6\uff0c\u672c\u7aef\u7684ip\u9700\u8981\u4f7f\u7528\u5185\u7f51ip\u6216 ",(0,t.jsx)(n.code,{children:"%defaultroute"}),"\u3002",(0,t.jsx)(n.code,{children:"left"})," \u548c ",(0,t.jsx)(n.code,{children:"right"})," \u662f\u4e24\u7aef\u7684ip\u5730\u5740\uff0c\u800c ",(0,t.jsx)(n.code,{children:"leftid"})," \u548c ",(0,t.jsx)(n.code,{children:"rightid"})," \u4e3a\u4ee3\u53f7id\u3002\n\u8fd9\u91cc\u6211\u4eec\u6307\u5b9a\u5317\u4eac\u533a\u4e3a ",(0,t.jsx)(n.code,{children:"left"}),"\xa0 \u3001\u9999\u6e2f\u533a\u4e3a\xa0",(0,t.jsx)(n.code,{children:"right"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"cat > /etc/ipsec.d/vm.conf << EOF\nconn bj-vm-hk\n        authby=secret # \u6307\u5b9a\u8ba4\u8bc1\u7c7b\u578b\u9884\u5171\u4eab\u79d8\u94a5\n        ike=3des-sha1 # \u6307\u5b9aike\u7b97\u6cd5\u4e3a3des-sha1\n        keyexchange=ike # \u6307\u5b9aike\n        phase2=esp\n        phase2alg=3des-sha1\n        compress=no # \u6307\u5b9a\u662f\u5426\u538b\u7f29\n        pfs=yes # \u6307\u5b9a\u662f\u5426\u52a0\u5bc6\n        auto=start # \u6307\u5b9a\u8fde\u63a5\u6dfb\u52a0\u7c7b\u578b\u3002start\u4e3a\u5f00\u673a\u81ea\u542f\uff0cadd\u4e3a\u6dfb\u52a0\u4e0d\u4e3b\u52a8\u8fde\u63a5\n        type=tunnel # \u6307\u5b9a\u6a21\u5f0f\u7c7b\u578b\u4e3a\u96a7\u9053\u6a21\u5f0f|\u4f20\u8f93\u6a21\u5f0f\n        \n        left=%any # \u5141\u8bb8\u54ea\u4e9bIP\u53ef\u4ee5\u8bbf\u95ee\uff01\uff01\uff01\n        leftsubnets={$BJ_IP_SUBNET} # \u5317\u4eac\u533a\u4e3b\u673a\u5185\u7f51IP\u6bb5\n        leftid=%any\n        leftnexthop=%defaultroute\n        \n        right=$HK_PRIVATE_IP # \u8fd9\u91cc\u8981\u6307\u5b9a\u9999\u6e2f\u533a\u4e3b\u673a\u5185\u7f51IP\n        rightsubnets={$HK_IP_SUBNET} # \u8fd9\u91cc\u8981\u6307\u5b9a\u9999\u6e2f\u533a\u4e3b\u673a\u5185\u7f51IP\u6bb5\n        rightid=%any # \u7ecf\u9a8c\u8bc1\uff0c\u8fd9\u91cc\u53ea\u80fd\u5199%any\u3001\u516c\u7f51IP\u3001@east\u6216@west\n        rightnexthop=%defaultroute\nEOF\n"})}),"\n",(0,t.jsx)(n.h4,{id:"182-\u914d\u7f6e\u5317\u4eac\u533a\u670d\u52a1\u5668",children:"1.8.2 \u914d\u7f6e\u5317\u4eac\u533a\u670d\u52a1\u5668"}),"\n",(0,t.jsxs)(n.p,{children:["Libreswan \u4e0d\u4f7f\u7528\u672f\u8bed ",(0,t.jsx)(n.code,{children:"source"})," \u6216 ",(0,t.jsx)(n.code,{children:"destination"}),"\u3002\u76f8\u53cd\uff0c\u5b83\u7528\u672f\u8bed  ",(0,t.jsx)(n.code,{children:"left"})," \u548c ",(0,t.jsx)(n.code,{children:"right"}),"\u6765\u4ee3\u6307\u7ec8\u7aef\uff08\u4e3b\u673a\uff09\u3002\u867d\u7136\u5927\u591a\u6570\u7ba1\u7406\u5458\u7528 ",(0,t.jsx)(n.code,{children:"left"})," \u8868\u793a\u672c\u5730\u4e3b\u673a\uff0c",(0,t.jsx)(n.code,{children:"right"})," \u8868\u793a\u8fdc\u7a0b\u4e3b\u673a\uff0c\u4f46\u662f\u8fd9\u6837\u53ef\u4ee5\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u5728\u4e24\u4e2a\u7ec8\u7aef\u4e0a\u4f7f\u7528\u76f8\u540c\u7684\u914d\u7f6e\u3002\n\u7531\u4e8e\u6211\u4eec\u7684\u670d\u52a1\u5668\u4f7f\u7528\u7684\u662fvpc\u7f51\u7edc\uff0c\u91c7\u7528\u9759\u6001nat\u7684\u5f62\u5f0f\uff0c\u5728\u914d\u7f6e ",(0,t.jsx)(n.code,{children:"left"})," \u548c ",(0,t.jsx)(n.code,{children:"right"})," \u65f6\uff0c\u672c\u7aef\u7684ip\u9700\u8981\u4f7f\u7528\u5185\u7f51ip\u6216 ",(0,t.jsx)(n.code,{children:"%defaultroute"}),"\u3002",(0,t.jsx)(n.code,{children:"left"})," \u548c ",(0,t.jsx)(n.code,{children:"right"})," \u662f\u4e24\u7aef\u7684ip\u5730\u5740\uff0c\u800c ",(0,t.jsx)(n.code,{children:"leftid"})," \u548c ",(0,t.jsx)(n.code,{children:"rightid"})," \u4e3a\u4ee3\u53f7id\u3002\n\u8fd9\u91cc\u6211\u4eec\u6307\u5b9a\u9999\u6e2f\u533a\u4e3a\u672c\u7aef\u673a\u5668\uff0c\u5317\u4eac\u533a\u4e3a\u5bf9\u7aef\u673a\u5668\uff0c\u5373\u9999\u6e2f\u533a\u4e3a ",(0,t.jsx)(n.code,{children:"left"}),"  \u3001 \u5317\u4eac\u533a\u4e3a ",(0,t.jsx)(n.code,{children:"right"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"cat > /etc/ipsec.d/vm.conf << EOF\nconn bj-vm-hk\n        authby=secret # \u6307\u5b9a\u8ba4\u8bc1\u7c7b\u578b\u9884\u5171\u4eab\u79d8\u94a5\n        ike=3des-sha1 # \u6307\u5b9aike\u7b97\u6cd5\u4e3a3des-sha1\n        keyexchange=ike # \u6307\u5b9aike\n        phase2=esp\n        phase2alg=3des-sha1\n        compress=no # \u6307\u5b9a\u662f\u5426\u538b\u7f29\n        pfs=yes # \u6307\u5b9a\u662f\u5426\u52a0\u5bc6\n        auto=start # \u6307\u5b9a\u8fde\u63a5\u6dfb\u52a0\u7c7b\u578b\u3002start\u4e3a\u5f00\u673a\u81ea\u542f\uff0cadd\u4e3a\u6dfb\u52a0\u4e0d\u4e3b\u52a8\u8fde\u63a5\n        type=tunnel # \u6307\u5b9a\u6a21\u5f0f\u7c7b\u578b\u4e3a\u96a7\u9053\u6a21\u5f0f|\u4f20\u8f93\u6a21\u5f0f\n        \n        left=$BJ_PRIVATE_IP # \u8fd9\u91cc\u5fc5\u987b\u662f\u5317\u4eac\u533a\u4e3b\u673a\u672c\u673a\u5185\u7f51IP\uff01\uff01\uff01\n        leftsubnets={$BJ_IP_SUBNET} # \u5317\u4eac\u533a\u4e3b\u673a\u5185\u7f51IP\u6bb5\n        leftid=%any\n        leftnexthop=%defaultroute\n        \n        right=$HK_PUBLIC_IP # \u8fd9\u91cc\u8981\u6307\u5b9a\u9999\u6e2f\u533a\u4e3b\u673a\u516c\u7f51IP\n        rightsubnets={$HK_IP_SUBNET} # \u8fd9\u91cc\u8981\u6307\u5b9a\u9999\u6e2f\u533a\u4e3b\u673a\u5185\u7f51IP\u6bb5\n        rightid=%any # \u7ecf\u9a8c\u8bc1\uff0c\u8fd9\u91cc\u53ea\u80fd\u5199%any\u3001\u516c\u7f51IP\u3001@east\u6216@west\n        rightnexthop=%defaultroute\nEOF\n"})}),"\n",(0,t.jsx)(n.h4,{id:"183-\u5f00\u542fipsec\u65e5\u5fd7",children:"1.8.3 \u5f00\u542fipsec\u65e5\u5fd7"}),"\n",(0,t.jsx)(n.p,{children:"\u5317\u4eac\u3001\u9999\u6e2f\u533a\u670d\u52a1\u5668\u64cd\u505a"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["\u8fd9\u91cc\u9700\u8981\u7f16\u8f91 ",(0,t.jsx)(n.code,{children:"/etc/ipsec.conf"})," \u628a\u65e5\u5fd7\u6253\u5f00\uff0c\u9ed8\u8ba4\u65e5\u5fd7\u8def\u5f84\u4e3a ",(0,t.jsx)(n.code,{children:"/var/log/pluto.log"})]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"sed -i 's/#logfile=/logfile=/' /etc/ipsec.conf\n"})}),"\n",(0,t.jsx)(n.h4,{id:"184-\u91cd\u542fipsec",children:"1.8.4 \u91cd\u542fipsec"}),"\n",(0,t.jsx)(n.p,{children:"\u5317\u4eac\u3001\u9999\u6e2f\u533a\u670d\u52a1\u5668\u64cd\u505a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"systemctl restart ipsec\n"})}),"\n",(0,t.jsx)(n.h4,{id:"185-\u9a8c\u8bc1",children:"1.8.5 \u9a8c\u8bc1"}),"\n",(0,t.jsx)(n.h5,{id:"1851-\u4e24\u7aef\u4e92ping",children:"1.8.5.1 \u4e24\u7aef\u4e92ping"}),"\n",(0,t.jsx)(n.p,{children:"\u5317\u4eac\u533a\u670d\u52a1\u5668ping\u9999\u6e2f\u533a\u670d\u52a1\u5668"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ ping -c2 $HK_PRIVATE_IP\nPING 10.0.0.3 (10.0.0.3) 56(84) bytes of data.\n64 bytes from 10.0.0.3: icmp_seq=1 ttl=64 time=46.6 ms\n64 bytes from 10.0.0.3: icmp_seq=2 ttl=64 time=46.6 ms\n\n--- 10.0.0.3 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 46.648/46.666/46.685/0.216 ms\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u9999\u6e2f\u533a\u670d\u52a1\u5668ping\u5317\u4eac\u533a\u670d\u52a1\u5668"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ ping -c2 $BJ_PRIVATE_IP\nPING 172.31.0.14 (172.31.0.14) 56(84) bytes of data.\n64 bytes from 172.31.0.14: icmp_seq=1 ttl=64 time=46.5 ms\n64 bytes from 172.31.0.14: icmp_seq=2 ttl=64 time=46.6 ms\n\n--- 172.31.0.14 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1000ms\nrtt min/avg/max/mdev = 46.586/46.618/46.650/0.032 ms\n"})}),"\n",(0,t.jsx)(n.h5,{id:"1852-\u67e5\u770bipsec\u72b6\u6001",children:"1.8.5.2 \u67e5\u770bipsec\u72b6\u6001"}),"\n",(0,t.jsx)(n.p,{children:"\u63d0\u793a\u5982\u4e0b\u5373\u4e3a\u6210\u529f"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'$ systemctl status ipsec\n\u25cf ipsec.service - Internet Key Exchange (IKE) Protocol Daemon for IPsec\n   Loaded: loaded (/usr/lib/systemd/system/ipsec.service; enabled; vendor preset: disabled)\n   Active: active (running) since Wed 2022-03-23 21:00:37 CST; 4s ago\n     Docs: man:ipsec(8)\n           man:pluto(8)\n           man:ipsec.conf(5)\n  Process: 6246 ExecStopPost=/usr/sbin/ipsec --stopnflog (code=exited, status=0/SUCCESS)\n  Process: 6243 ExecStopPost=/sbin/ip xfrm state flush (code=exited, status=0/SUCCESS)\n  Process: 6240 ExecStopPost=/sbin/ip xfrm policy flush (code=exited, status=0/SUCCESS)\n  Process: 6227 ExecStop=/usr/libexec/ipsec/whack --shutdown (code=exited, status=0/SUCCESS)\n  Process: 6521 ExecStartPre=/usr/sbin/ipsec --checknflog (code=exited, status=0/SUCCESS)\n  Process: 6518 ExecStartPre=/usr/sbin/ipsec --checknss (code=exited, status=0/SUCCESS)\n  Process: 6256 ExecStartPre=/usr/libexec/ipsec/_stackmanager start (code=exited, status=0/SUCCESS)\n  Process: 6254 ExecStartPre=/usr/libexec/ipsec/addconn --config /etc/ipsec.conf --checkconfig (code=exited, status=0/SUCCESS)\n Main PID: 6534 (pluto)\n   Status: "Startup completed."\n   CGroup: /system.slice/ipsec.service\n           \u2514\u25006534 /usr/libexec/ipsec/pluto --leak-detective --config /etc/ipsec.conf --nofork\n\nMar 23 21:00:37 hk systemd[1]: Starting Internet Key Exchange (IKE) Protocol Daemon for IPsec...\nMar 23 21:00:37 hk ipsec[6521]: nflog ipsec capture disabled\nMar 23 21:00:37 hk systemd[1]: Started Internet Key Exchange (IKE) Protocol Daemon for IPsec.\n'})}),"\n",(0,t.jsx)(n.h5,{id:"1853-\u67e5\u770b\u65e5\u5fd7",children:"1.8.5.3 \u67e5\u770b\u65e5\u5fd7"}),"\n",(0,t.jsxs)(n.p,{children:["\u67e5\u770b\u65e5\u5fd7 ",(0,t.jsx)(n.code,{children:"/var/log/pluto.log"})," \uff0c\u6709\u5305\u7684\u53d1\u9001\u4ee5\u53ca\u8fd4\u56de\u5373\u4e3a\u6b63\u786e"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'Mar 23 21:00:37.774360: "bj-vm-hk/1x1"[1] 42.193.112.127 #1: STATE_MAIN_R1: sent MR1, expecting MI2\nMar 23 21:00:37.825502: "bj-vm-hk/1x1"[1] 42.193.112.127 #1: STATE_MAIN_R2: sent MR2, expecting MI3\nMar 23 21:00:37.875013: "bj-vm-hk/1x1"[1] 42.193.112.127 #1: Peer ID is ID_IPV4_ADDR: \'172.31.0.14\'\nMar 23 21:00:37.875269: "bj-vm-hk/1x1"[1] 42.193.112.127 #1: STATE_MAIN_R3: sent MR3, ISAKMP SA established {auth=PRESHARED_KEY cipher=3des_cbc_192 integ=sha group=MODP2048}\nMar 23 21:00:37.923920: "bj-vm-hk/1x1"[1] 42.193.112.127 #1: the peer proposed: 10.0.0.0/24:0/0 -> 172.31.0.0/24:0/0\nMar 23 21:00:37.926134: "bj-vm-hk/1x1"[1] 42.193.112.127 #2: responding to Quick Mode proposal {msgid:4323d821}\nMar 23 21:00:37.926162: "bj-vm-hk/1x1"[1] 42.193.112.127 #2:     us: 10.0.0.0/24===10.0.0.3<10.0.0.3>[43.154.53.42]\nMar 23 21:00:37.926169: "bj-vm-hk/1x1"[1] 42.193.112.127 #2:   them: 42.193.112.127===172.31.0.0/24\nMar 23 21:00:37.926600: "bj-vm-hk/1x1"[1] 42.193.112.127 #2: STATE_QUICK_R1: sent QR1, inbound IPsec SA installed, expecting QI2 tunnel mode {ESP/NAT=>0x33ba4428 <0xf89429e6 xfrm=3DES_CBC_0-HMAC_SHA1_96 NATOA=none NATD=42.193.112.127:4500 DPD=passive}\nMar 23 21:00:38.020561: "bj-vm-hk/1x1"[1] 42.193.112.127 #2: STATE_QUICK_R2: IPsec SA established tunnel mode {ESP/NAT=>0x33ba4428 <0xf89429e6 xfrm=3DES_CBC_0-HMAC_SHA1_96 NATOA=none NATD=42.193.112.127:4500 DPD=passive}\n'})}),"\n",(0,t.jsx)(n.h5,{id:"1854-\u67e5\u770b\u8fde\u63a5\u60c5\u51b5",children:"1.8.5.4 \u67e5\u770b\u8fde\u63a5\u60c5\u51b5"}),"\n",(0,t.jsxs)(n.p,{children:["\u53ef\u4ee5\u6267\u884c\u547d\u4ee4 ",(0,t.jsx)(n.code,{children:"ipsec auto --status"})," \u67e5\u770b\u8fde\u63a5\u60c5\u51b5"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'000 "bj-vm-hk/1x1"[1]:   IKE algorithms: 3DES_CBC-HMAC_SHA1-MODP2048, 3DES_CBC-HMAC_SHA1-MODP1536\n000 "bj-vm-hk/1x1"[1]:   IKE algorithm newest: 3DES_CBC_192-HMAC_SHA1-MODP2048\n000 "bj-vm-hk/1x1"[1]:   ESP algorithms: 3DES_CBC-HMAC_SHA1_96\n000 "bj-vm-hk/1x1"[1]:   ESP algorithm newest: 3DES_CBC_000-HMAC_SHA1_96; pfsgroup=<Phase1>\n000  \n000 Total IPsec connections: loaded 2, active 1\n000  \n000 State Information: DDoS cookies not required, Accepting new IKE connections\n000 IKE SAs: total(1), half-open(0), open(0), authenticated(1), anonymous(0)\n000 IPsec SAs: total(1), authenticated(1), anonymous(0)\n000  \n000 #1: "bj-vm-hk/1x1"[1] 42.193.112.127:4500 STATE_MAIN_R3 (sent MR3, ISAKMP SA established); EVENT_SA_REPLACE in 3143s; newest ISAKMP; lastdpd=-1s(seq in:0 out:0); idle; import:not set\n000 #2: "bj-vm-hk/1x1"[1] 42.193.112.127:4500 STATE_QUICK_R2 (IPsec SA established); EVENT_SA_REPLACE in 28343s; newest IPSEC; eroute owner; isakmp#1; idle; import:not set\n000 #2: "bj-vm-hk/1x1"[1] 42.193.112.127 esp.33ba4428@42.193.112.127 esp.f89429e6@10.0.0.3 tun.0@42.193.112.127 tun.0@10.0.0.3 ref=0 refhim=0 Traffic: ESPin=0B ESPout=0B! ESPmax=4194303B \n000  \n000 Bare Shunt list:\n000  \n'})}),"\n",(0,t.jsx)(n.h2,{id:"2\u5b89\u88c5\u914d\u7f6ev2ray",children:"2.\u5b89\u88c5\u914d\u7f6eV2Ray"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://v2ray.com/",children:"v2ray\u5b98\u7f51"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://github.com/v2ray/v2ray-core",children:"v2ray github"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://github.com/v2fly/fhs-install-v2ray",children:"v2ray\u811a\u672c\u5b89\u88c5github"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://github.com/v2fly/v2ray-core/releases",children:"v2ray github\u4e0b\u8f7d\u5730\u5740"})}),"\n",(0,t.jsx)(n.h3,{id:"21-\u9999\u6e2f\u533a\u670d\u52a1\u5668\u64cd\u4f5c",children:"2.1 \u9999\u6e2f\u533a\u670d\u52a1\u5668\u64cd\u4f5c"}),"\n",(0,t.jsx)(n.p,{children:"\u622a\u6b622022.3.23\uff0cv2ray\u6700\u65b0\u7a33\u5b9a\u7248\u672c\u4e3a4.44"}),"\n",(0,t.jsx)(n.p,{children:"\u9999\u6e2f\u533a\u670d\u52a1\u5668\u53ef\u4ee5\u76f4\u63a5\u6267\u884c\u811a\u672c\u5b89\u88c5\u5373\u53ef"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"bash <(curl -L https://raw/branch.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh)\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u4ee5\u4e0b\u4e3a\u5177\u4f53\u8f93\u51fa"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"bash <(curl -L https://raw/branch.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh)\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100 21647  100 21647    0     0   124k      0 --:--:-- --:--:-- --:--:--  125k\ninfo: Installing V2Ray v4.44.0 for x86_64\nDownloading V2Ray archive: https://github.com/v2fly/v2ray-core/releases/download/v4.44.0/v2ray-linux-64.zip\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100   657  100   657    0     0   2634      0 --:--:-- --:--:-- --:--:--  2638\n100 13.2M  100 13.2M    0     0  16.1M      0 --:--:-- --:--:-- --:--:-- 16.1M\nDownloading verification file for V2Ray archive: https://github.com/v2fly/v2ray-core/releases/download/v4.44.0/v2ray-linux-64.zip.dgst\ninfo: Extract the V2Ray package to /tmp/tmp.nDCxE147dh and prepare it for installation.\ninfo: Systemd service files have been installed successfully!\nwarning: The following are the actual parameters for the v2ray service startup.\nwarning: Please make sure the configuration file path is correctly set.\n~~~~~~~~~~~~~~~~\n[Unit]\nDescription=V2Ray Service\nDocumentation=https://www.v2fly.org/\nAfter=network.target nss-lookup.target\n\n[Service]\nUser=nobody\nCapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE\nAmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE\nNoNewPrivileges=true\nExecStart=/usr/local/bin/v2ray -config /usr/local/etc/v2ray/config.json\nRestart=on-failure\nRestartPreventExitStatus=23\n\n[Install]\nWantedBy=multi-user.target\n# In case you have a good reason to do so, duplicate this file in the same directory and make your customizes there.\n# Or all changes you made will be lost!  # Refer: https://www.freedesktop.org/software/systemd/man/systemd.unit.html\n[Service]\nExecStart=\nExecStart=/usr/local/bin/v2ray -config /usr/local/etc/v2ray/config.json\n~~~~~~~~~~~~~~~~\nwarning: The systemd version on the current operating system is too low.\nwarning: Please consider to upgrade the systemd or the operating system.\n\ninstalled: /usr/local/bin/v2ray\ninstalled: /usr/local/bin/v2ctl\ninstalled: /usr/local/share/v2ray/geoip.dat\ninstalled: /usr/local/share/v2ray/geosite.dat\ninstalled: /usr/local/etc/v2ray/config.json\ninstalled: /var/log/v2ray/\ninstalled: /var/log/v2ray/access.log\ninstalled: /var/log/v2ray/error.log\ninstalled: /etc/systemd/system/v2ray.service\ninstalled: /etc/systemd/system/v2ray@.service\nremoved: /tmp/tmp.nDCxE147dh\ninfo: V2Ray v4.44.0 is installed.\nYou may need to execute a command to remove dependent software: yum remove curl unzip\nPlease execute the command: systemctl enable v2ray; systemctl start v2ray\n"})}),"\n",(0,t.jsx)(n.h3,{id:"22-\u5317\u4eac\u533a\u670d\u52a1\u5668\u64cd\u4f5c",children:"2.2 \u5317\u4eac\u533a\u670d\u52a1\u5668\u64cd\u4f5c"}),"\n",(0,t.jsx)(n.p,{children:"\u5317\u4eac\u533a\u670d\u52a1\u5668\u7531\u4e8e\u6267\u884c\u4e00\u952e\u5b89\u88c5\u811a\u672c\u592a\u592a\u592a\ud83d\udc148\u20e3\ufe0f\u6162\u4e86\uff0c\u56e0\u6b64\u9700\u8981\u5148\u4e0b\u8f7d\u5b89\u88c5\u811a\u672c\uff0c\u7136\u540e\u901a\u8fc7\u52a0\u901f\u5730\u5740\u4e0b\u8f7dv2ray\u5b89\u88c5\u5305\uff0c\u6700\u540e\u6267\u884c\u672c\u5730\u5b89\u88c5"}),"\n",(0,t.jsx)(n.h4,{id:"221-\u4e0b\u8f7d\u4e00\u952e\u5b89\u88c5\u811a\u672c",children:"2.2.1 \u4e0b\u8f7d\u4e00\u952e\u5b89\u88c5\u811a\u672c"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"wget https://raw/branch.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh\n"})}),"\n",(0,t.jsx)(n.h4,{id:"222-\u4e0b\u8f7d\u5b89\u88c5\u5305",children:"2.2.2 \u4e0b\u8f7d\u5b89\u88c5\u5305"}),"\n",(0,t.jsx)(n.p,{children:"\u622a\u6b622022.3.23\uff0cv2ray\u6700\u65b0\u7a33\u5b9a\u7248\u672c\u4e3a4.44"}),"\n",(0,t.jsxs)(n.p,{children:["\u7531\u4e8e ",(0,t.jsx)(n.code,{children:"https://github.com/v2fly/v2ray-core/releases/download/v4.44.0/v2ray-linux-64.zip"})," \u4e0b\u8f7d\u592a\u6162\u4e86\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u52a0\u901f\u5730\u5740"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"wget https://download.fastgit.org/v2fly/v2ray-core/releases/download/v4.44.0/v2ray-linux-64.zip\n\u6216\nwget https://ghproxy.com/https://github.com/v2fly/v2ray-core/releases/download/v4.44.0/v2ray-linux-64.zip\n"})}),"\n",(0,t.jsx)(n.h4,{id:"223-\u5b89\u88c5v2ray",children:"2.2.3 \u5b89\u88c5v2ray"}),"\n",(0,t.jsx)(n.p,{children:"\u8d4b\u4e88\u811a\u672c\u53ef\u6267\u884c\u6743\u9650"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"chmod +x install-release.sh \n"})}),"\n",(0,t.jsx)(n.p,{children:"\u6267\u884c\u5b89\u88c5"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"./install-release.sh -l v2ray-linux-64.zip \n"})}),"\n",(0,t.jsx)(n.p,{children:"\u4ee5\u4e0b\u4e3a\u5177\u4f53\u8f93\u51fa"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"warn: Install V2Ray from a local file, but still need to make sure the network is available.\nwarn: Please make sure the file is valid because we cannot confirm it. (Press any key) ...\ninfo: Extract the V2Ray package to /tmp/tmp.nXaK0Gt7ur and prepare it for installation.\ninfo: Systemd service files have been installed successfully!\nwarning: The following are the actual parameters for the v2ray service startup.\nwarning: Please make sure the configuration file path is correctly set.\n~~~~~~~~~~~~~~~~\n[Unit]\nDescription=V2Ray Service\nDocumentation=https://www.v2fly.org/\nAfter=network.target nss-lookup.target\n\n[Service]\nUser=nobody\nCapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE\nAmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE\nNoNewPrivileges=true\nExecStart=/usr/local/bin/v2ray -config /usr/local/etc/v2ray/config.json\nRestart=on-failure\nRestartPreventExitStatus=23\n\n[Install]\nWantedBy=multi-user.target\n# In case you have a good reason to do so, duplicate this file in the same directory and make your customizes there.\n# Or all changes you made will be lost!  # Refer: https://www.freedesktop.org/software/systemd/man/systemd.unit.html\n[Service]\nExecStart=\nExecStart=/usr/local/bin/v2ray -config /usr/local/etc/v2ray/config.json\n~~~~~~~~~~~~~~~~\nwarning: The systemd version on the current operating system is too low.\nwarning: Please consider to upgrade the systemd or the operating system.\n\ninstalled: /usr/local/bin/v2ray\ninstalled: /usr/local/bin/v2ctl\ninstalled: /usr/local/share/v2ray/geoip.dat\ninstalled: /usr/local/share/v2ray/geosite.dat\ninstalled: /usr/local/etc/v2ray/config.json\ninstalled: /var/log/v2ray/\ninstalled: /var/log/v2ray/access.log\ninstalled: /var/log/v2ray/error.log\ninstalled: /etc/systemd/system/v2ray.service\ninstalled: /etc/systemd/system/v2ray@.service\nremoved: /tmp/tmp.nXaK0Gt7ur\ninfo: V2Ray v4.44.0 is installed.\nYou may need to execute a command to remove dependent software: yum remove curl unzip\nPlease execute the command: systemctl enable v2ray; systemctl start v2ray\n"})}),"\n",(0,t.jsx)(n.h3,{id:"23-\u542f\u52a8v2ray",children:"2.3 \u542f\u52a8v2ray"}),"\n",(0,t.jsx)(n.p,{children:"\u5317\u4eac\u3001\u9999\u6e2f\u533a\u670d\u52a1\u5668\u64cd\u505a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"systemctl enable v2ray && systemctl start v2ray\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u67e5\u770bv2ray\u8fd0\u884c\u72b6\u6001"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ systemctl status v2ray\n\u25cf v2ray.service - V2Ray Service\n   Loaded: loaded (/etc/systemd/system/v2ray.service; enabled; vendor preset: disabled)\n  Drop-In: /etc/systemd/system/v2ray.service.d\n           \u2514\u250010-donot_touch_single_conf.conf\n   Active: active (running) since Wed 2022-03-23 21:36:38 CST; 27s ago\n     Docs: https://www.v2fly.org/\n Main PID: 13273 (v2ray)\n   CGroup: /system.slice/v2ray.service\n           \u2514\u250013273 /usr/local/bin/v2ray -config /usr/local/etc/v2ray/config.json\n\nMar 23 21:36:38 bj systemd[1]: Started V2Ray Service.\nMar 23 21:36:38 bj v2ray[13273]: V2Ray 4.44.0 (V2Fly, a community-driven edition of V2Ray.) Custom (go1.17.3 linux/amd64)\nMar 23 21:36:38 bj v2ray[13273]: A unified platform for anti-censorship.\nMar 23 21:36:38 bj v2ray[13273]: 2022/03/23 21:36:38 [Info] main/jsonem: Reading config: /usr/local/etc/v2ray/config.json\nMar 23 21:36:38 bj v2ray[13273]: 2022/03/23 21:36:38 [Warning] V2Ray 4.44.0 started\n"})}),"\n",(0,t.jsx)(n.h3,{id:"24-\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6",children:"2.4 \u7f16\u8f91\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://github.com/v2fly/v2ray-examples",children:"v2ray\u914d\u7f6e\u6587\u4ef6\u5b98\u65b9\u6a21\u677f"})}),"\n",(0,t.jsx)(n.p,{children:"\u9999\u6e2f\u533a\u670d\u52a1\u5668\u64cd\u505a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'cat > /usr/local/etc/v2ray/config.json << EOF\n{\n  "log": {\n    "loglevel": "warning",\n    "access": "/var/log/v2ray/access.log",\n    "error": "/var/log/v2ray/error.log"\n  },\n  "inbounds": [\n {\n      "protocol": "socks",\n      "settings": {\n        "udp": false,\n        "auth": "noauth"\n      },\n      "port": "1080"\n    },\n    {\n      "protocol": "http",\n      "sniffing": {\n        "enabled": true,\n        "destOverride": ["http", "tls"]\n      },\n      "settings": {\n        "timeout": 360\n      },\n      "port": "1087"\n    },\n    {\n    "port": 2008,\n    "protocol": "vmess",\n    "settings": {\n      "clients": [\n        {\n          "id": "6cd17a99-1f70-4f41-9d85-1d151e3ffb7c",\n          "level": 1,\n          "alterId": 0\n        }\n      ]\n    }\n  }],\n  "outbounds": [{\n    "protocol": "freedom",\n    "settings": {}\n  },{\n    "protocol": "blackhole",\n    "settings": {},\n    "tag": "blocked"\n  }],\n  "routing": {\n    "rules": [\n      {\n        "type": "field",\n        "ip": ["geoip:private"],\n        "outboundTag": "blocked"\n      }\n    ]\n  }\n}\nEOF\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u5317\u4eac\u533a\u670d\u52a1\u5668\u64cd\u505a"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 ",(0,t.jsx)(n.code,{children:"address"})," \u8981\u5199\u9999\u6e2f\u533a\u670d\u52a1\u5668\u7684\u5185\u7f51IP"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"accounts"})," \u4e0b\u7684 ",(0,t.jsx)(n.code,{children:"user"})," \u548c ",(0,t.jsx)(n.code,{children:"pass"})," \u662f\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u7528\u4e8e\u7535\u8111\u672c\u673a\u914d\u7f6e\u8ba4\u8bc1\u6240\u7528"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'cat > /usr/local/etc/v2ray/config.json << EOF\n{\n  "log": {\n    "loglevel": "info",\n    "access": "/var/log/v2ray/access.log",\n    "error": "/var/log/v2ray/error.log"\n  },\n  "inbounds": [\n\n    {\n      "protocol": "http",\n      "settings": {\n        "timeout": 360\n      },\n      "port": "1087"\n    },\n    {\n      "protocol": "http",\n      "settings": {\n        "timeout": 360,\n        "accounts": [\n            {\n              "user": "admin",\n              "pass": "admin"\n            }\n          ]\n      },\n      "port": "1088"\n    }\n  ],\n  "outbounds": [\n    {\n      "mux": {\n        "enabled": false,\n        "concurrency": 8\n      },\n      "protocol": "vmess",\n      "streamSettings": {\n        "network": "tcp",\n        "tcpSettings": {\n          "header": {\n            "type": "none"\n          }\n        },\n        "security": "none"\n      },\n      "tag": "proxy",\n      "settings": {\n        "vnext": [\n          {\n            "address": "10.0.0.3",\n            "users": [\n              {\n                "id": "6cd17a99-1f70-4f41-9d85-1d151e3ffb7c",\n                "alterId": 0,\n                "level": 1,\n                "security": "auto"\n              }\n            ],\n            "port": 2008\n          }\n        ]\n      }\n    },\n    {\n      "tag": "direct",\n      "protocol": "freedom",\n      "settings": {\n        "domainStrategy": "UseIP",\n        "redirect": "",\n        "userLevel": 0\n      }\n    },\n    {\n      "tag": "block",\n      "protocol": "blackhole",\n      "settings": {\n        "response": {\n          "type": "none"\n        }\n      }\n    }\n  ],\n  "dns": {},\n  "routing": {\n    "settings": {\n      "domainStrategy": "AsIs",\n      "rules": []\n    }\n  },\n  "transport": {}\n}\nEOF\n'})}),"\n",(0,t.jsx)(n.h3,{id:"25-\u91cd\u542fv2ray",children:"2.5 \u91cd\u542fv2ray"}),"\n",(0,t.jsx)(n.p,{children:"\u5317\u4eac\u3001\u9999\u6e2f\u533a\u670d\u52a1\u5668\u64cd\u505a"}),"\n",(0,t.jsx)(n.p,{children:"\u7f16\u8f91\u5b8c\u914d\u7f6e\u6587\u4ef6\u91cd\u542f\u751f\u6548"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"systemctl restart v2ray\n"})}),"\n",(0,t.jsx)(n.h3,{id:"26-\u67e5\u770b\u542f\u52a8",children:"2.6 \u67e5\u770b\u542f\u52a8"}),"\n",(0,t.jsx)(n.p,{children:"\u9999\u6e2f\u533a\u670d\u52a1\u5668\u64cd\u505a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ netstat -ntpl|grep v2ray\ntcp6       0      0 :::1080                 :::*                    LISTEN      12808/v2ray         \ntcp6       0      0 :::2008                 :::*                    LISTEN      12808/v2ray         \ntcp6       0      0 :::1087                 :::*                    LISTEN      12808/v2ray \n"})}),"\n",(0,t.jsx)(n.p,{children:"\u5317\u4eac\u533a\u670d\u52a1\u5668\u64cd\u505a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ netstat -ntpl|grep v2ray\ntcp6       0      0 :::1087                 :::*                    LISTEN      14445/v2ray         \ntcp6       0      0 :::1088                 :::*                    LISTEN      14445/v2ray        \n"})}),"\n",(0,t.jsx)(n.h3,{id:"27-\u914d\u7f6e\u4ee3\u7406",children:"2.7 \u914d\u7f6e\u4ee3\u7406"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"export http_proxy=http://10.0.0.3:1087\nexport https_proxy=http://10.0.0.3:1087\n"})}),"\n",(0,t.jsx)(n.h3,{id:"28-\u9a8c\u8bc1",children:"2.8 \u9a8c\u8bc1"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ curl -I google.com\nHTTP/1.1 301 Moved Permanently\nContent-Length: 219\nCache-Control: public, max-age=2592000\nConnection: keep-alive\nContent-Type: text/html; charset=UTF-8\nDate: Wed, 23 Mar 2022 13:50:28 GMT\nExpires: Fri, 22 Apr 2022 13:50:28 GMT\nKeep-Alive: timeout=4\nLocation: http://www.google.com/\nProxy-Connection: keep-alive\nServer: gws\nX-Frame-Options: SAMEORIGIN\nX-Xss-Protection: 0\n"})})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>a});var t=s(96540);const l={},r=t.createContext(l);function i(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);