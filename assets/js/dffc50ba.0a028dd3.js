"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[9652],{29242:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>t});var r=s(74848),l=s(28453);const i={},c="nfs\u5171\u4eab\u5b58\u50a8",a={id:"\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u5b58\u50a8/nfs\u5171\u4eab\u5b58\u50a8",title:"nfs\u5171\u4eab\u5b58\u50a8",description:"nfs\u5b58\u50a8\u5b98\u65b9\u6587\u6863",source:"@site/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u5b58\u50a8/nfs\u5171\u4eab\u5b58\u50a8.md",sourceDirName:"\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u5b58\u50a8",slug:"/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u5b58\u50a8/nfs\u5171\u4eab\u5b58\u50a8",permalink:"/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u5b58\u50a8/nfs\u5171\u4eab\u5b58\u50a8",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"OpenEBS",permalink:"/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u5b58\u50a8/OpenEBS"},next:{title:"CronJob\u7b80\u4ecb",permalink:"/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/\u5de5\u4f5c\u8d1f\u8f7d/CronJob/CronJob\u7b80\u4ecb"}},d={},t=[{value:"1.\u5b89\u88c5\u914d\u7f6enfs",id:"1\u5b89\u88c5\u914d\u7f6enfs",level:2},{value:"1.1 \u5b89\u88c5nfs",id:"11-\u5b89\u88c5nfs",level:3},{value:"1.2 \u521b\u5efa\u5171\u4eab\u76ee\u5f55",id:"12-\u521b\u5efa\u5171\u4eab\u76ee\u5f55",level:3},{value:"1.3 \u7f16\u8f91\u914d\u7f6e\u6587\u4ef6",id:"13-\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6",level:3},{value:"1.4 \u542f\u52a8nfs",id:"14-\u542f\u52a8nfs",level:3},{value:"1.5 \u67e5\u770b\u542f\u52a8\u72b6\u6001",id:"15-\u67e5\u770b\u542f\u52a8\u72b6\u6001",level:3},{value:"1.6 \u67e5\u770bnfs\u5171\u4eab\u8bb0\u5f55\u4fe1\u606f",id:"16-\u67e5\u770bnfs\u5171\u4eab\u8bb0\u5f55\u4fe1\u606f",level:3},{value:"2.\u5728k8s\u96c6\u7fa4\u4e2d\u4f7f\u7528nfs",id:"2\u5728k8s\u96c6\u7fa4\u4e2d\u4f7f\u7528nfs",level:2},{value:"2.1 \u624b\u52a8\u521b\u5efapv",id:"21-\u624b\u52a8\u521b\u5efapv",level:3},{value:"2.1.1 \u7f16\u8f91yaml\u6587\u4ef6",id:"211-\u7f16\u8f91yaml\u6587\u4ef6",level:4},{value:"2.1.2 \u521b\u5efapv pvc",id:"212-\u521b\u5efapv-pvc",level:4},{value:"2.1.3 \u67e5\u770bpv pvc",id:"213-\u67e5\u770bpv-pvc",level:4},{value:"2.1.4 \u521b\u5efapod\u5e76\u5f15\u7528\u521b\u5efa\u7684pvc",id:"214-\u521b\u5efapod\u5e76\u5f15\u7528\u521b\u5efa\u7684pvc",level:4},{value:"2.2 \u901a\u8fc7StorageClass\u81ea\u52a8\u521b\u5efapv",id:"22-\u901a\u8fc7storageclass\u81ea\u52a8\u521b\u5efapv",level:3},{value:"2.2.1 \u5b89\u88c5 nfs-subdir-external-provisioner",id:"221-\u5b89\u88c5-nfs-subdir-external-provisioner",level:4},{value:"2.2.2 \u81ea\u52a8\u521b\u5efapv",id:"222-\u81ea\u52a8\u521b\u5efapv",level:4}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"nfs\u5171\u4eab\u5b58\u50a8",children:"nfs\u5171\u4eab\u5b58\u50a8"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/concepts/storage/volumes/#nfs",children:"nfs\u5b58\u50a8\u5b98\u65b9\u6587\u6863"})}),"\n",(0,r.jsx)(n.h2,{id:"1\u5b89\u88c5\u914d\u7f6enfs",children:"1.\u5b89\u88c5\u914d\u7f6enfs"}),"\n",(0,r.jsx)(n.h3,{id:"11-\u5b89\u88c5nfs",children:"1.1 \u5b89\u88c5nfs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"yum -y install nfs-utils rpcbind\n"})}),"\n",(0,r.jsx)(n.h3,{id:"12-\u521b\u5efa\u5171\u4eab\u76ee\u5f55",children:"1.2 \u521b\u5efa\u5171\u4eab\u76ee\u5f55"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[ -d /data/nfs ] || mkdir -p /data/nfs && chown nfsnobody.nfsnobody /data/nfs\n"})}),"\n",(0,r.jsx)(n.h3,{id:"13-\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6",children:"1.3 \u7f16\u8f91\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"cat > /etc/exports << EOF\n/data/nfs 192.168.1.0/24(rw,sync,no_root_squash)\nEOF\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u53c2\u6570\u8bf4\u660e"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u53c2\u6570"}),(0,r.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"/data/nfs"}),(0,r.jsx)(n.td,{children:"nfs\u670d\u52a1\u7aef\u5171\u4eab\u76ee\u5f55"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"192.168.1.0/24"}),(0,r.jsx)(n.td,{children:"\u5141\u8bb8\u6302\u8f7d\u7684\u5ba2\u6237\u7aef\u7f51\u6bb5"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"rw"}),(0,r.jsx)(n.td,{children:"\u6302\u8f7d\u6743\u9650"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"sync"}),(0,r.jsx)(n.td,{children:"\u540c\u65f6\u5c06\u6570\u636e\u5199\u5165\u5230\u5185\u5b58\u4e0e\u786c\u76d8\u4e2d\uff0c\u4fdd\u8bc1\u4e0d\u4e22\u5931\u6570\u636e"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"no_root_squash"}),(0,r.jsx)(n.td,{children:"\u5f53\u767b\u5f55 NFS \u4e3b\u673a\u4f7f\u7528\u5171\u4eab\u76ee\u5f55\u7684\u4f7f\u7528\u8005\u662f root \u65f6\uff0c\u5176\u6743\u9650\u5c06\u88ab\u8f6c\u6362\u6210\u4e3a\u533f\u540d\u4f7f\u7528\u8005\uff0c\u901a\u5e38\u5b83\u7684 UID \u4e0e GID\uff0c\u90fd\u4f1a\u53d8\u6210 nobody \u8eab\u4efd"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"14-\u542f\u52a8nfs",children:"1.4 \u542f\u52a8nfs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"systemctl start rpcbind nfs-server && systemctl enable rpcbind nfs-server\n"})}),"\n",(0,r.jsx)(n.h3,{id:"15-\u67e5\u770b\u542f\u52a8\u72b6\u6001",children:"1.5 \u67e5\u770b\u542f\u52a8\u72b6\u6001"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ systemctl status rpcbind nfs-server\n\u25cf rpcbind.service - RPC bind service\n   Loaded: loaded (/usr/lib/systemd/system/rpcbind.service; enabled; vendor preset: enabled)\n   Active: active (running) since Mon 2022-11-14 21:31:52 CST; 55s ago\n Main PID: 21841 (rpcbind)\n   CGroup: /system.slice/rpcbind.service\n           \u2514\u250021841 /sbin/rpcbind -w\n\nNov 14 21:31:52 ctyun systemd[1]: Starting RPC bind service...\nNov 14 21:31:52 ctyun systemd[1]: Started RPC bind service.\n\n\u25cf nfs-server.service - NFS server and services\n   Loaded: loaded (/usr/lib/systemd/system/nfs-server.service; enabled; vendor preset: disabled)\n  Drop-In: /run/systemd/generator/nfs-server.service.d\n           \u2514\u2500order-with-mounts.conf\n   Active: active (exited) since Mon 2022-11-14 21:31:52 CST; 55s ago\n Main PID: 21874 (code=exited, status=0/SUCCESS)\n   CGroup: /system.slice/nfs-server.service\n\nNov 14 21:31:52 ctyun systemd[1]: Starting NFS server and services...\nNov 14 21:31:52 ctyun systemd[1]: Started NFS server and services.\n"})}),"\n",(0,r.jsx)(n.h3,{id:"16-\u67e5\u770bnfs\u5171\u4eab\u8bb0\u5f55\u4fe1\u606f",children:"1.6 \u67e5\u770bnfs\u5171\u4eab\u8bb0\u5f55\u4fe1\u606f"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["nfs\u542f\u52a8\u540e\u4f1a\u5728 ",(0,r.jsx)(n.code,{children:"/var/lib/nfs/etab"})," \u6587\u4ef6\u4e2d\u8bb0\u5f55\u5171\u4eab\u5185\u5bb9"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ cat /var/lib/nfs/etab \n/data/nfs\t192.168.1.0/24(rw,sync,wdelay,hide,nocrossmnt,secure,no_root_squash,no_all_squash,no_subtree_check,secure_locks,acl,no_pnfs,anonuid=65534,anongid=65534,sec=sys,rw,secure,no_root_squash,no_all_squash)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"2\u5728k8s\u96c6\u7fa4\u4e2d\u4f7f\u7528nfs",children:"2.\u5728k8s\u96c6\u7fa4\u4e2d\u4f7f\u7528nfs"}),"\n",(0,r.jsx)(n.h3,{id:"21-\u624b\u52a8\u521b\u5efapv",children:"2.1 \u624b\u52a8\u521b\u5efapv"}),"\n",(0,r.jsx)(n.h4,{id:"211-\u7f16\u8f91yaml\u6587\u4ef6",children:"2.1.1 \u7f16\u8f91yaml\u6587\u4ef6"}),"\n",(0,r.jsx)(n.p,{children:":::tip\u8bf4\u660e"}),"\n",(0,r.jsx)(n.p,{children:"\u7528\u6237\u771f\u6b63\u4f7f\u7528\u7684\u662fpvc\uff0c\u800c\u8981\u4f7f\u7528pvc\u7684\u524d\u63d0\u5c31\u662f\u5fc5\u987b\u8981\u5148\u548c\u67d0\u4e2a\u7b26\u5408\u6761\u4ef6\u7684pv\u8fdb\u884c\u4e00\u5bf9\u4e00\u7684\u7ed1\u5b9a\uff0c\u6bd4\u5982\u5b58\u50a8\u5bb9\u5668\u3001\u8bbf\u95ee\u6a21\u5f0f\uff0c\u4ee5\u53capvc\u548cpv\u7684storageClassName \u5b57\u6bb5\u5fc5\u987b\u4e00\u6837\uff0c\u8fd9\u6837\u624d\u80fd\u591f\u8fdb\u884c\u7ed1\u5b9a\uff0c\u5f53pvc\u548cpv\u7ed1\u5b9a\u6210\u529f\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e2apvc\u5bf9\u8c61\u4e86"}),"\n",(0,r.jsx)(n.p,{children:":::"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"cat > nfs-volume.yaml << EOF\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: nfs-pv\nspec:\n  storageClassName: manual\n  capacity:\n    storage: 1Gi\n  accessModes:\n  - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Retain\n  nfs:\n    path: /data/nfs  # \u6307\u5b9anfs\u7684\u6302\u8f7d\u70b9\n    server: 192.168.1.96  # \u6307\u5b9anfs\u670d\u52a1\u5730\u5740\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: nfs-pvc\nspec:\n  storageClassName: manual\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 1Gi\nEOF\n"})}),"\n",(0,r.jsx)(n.h4,{id:"212-\u521b\u5efapv-pvc",children:"2.1.2 \u521b\u5efapv pvc"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ kubectl apply -f nfs-volume.yaml \npersistentvolume/nfs-pv created\npersistentvolumeclaim/nfs-pvc created\n"})}),"\n",(0,r.jsx)(n.h4,{id:"213-\u67e5\u770bpv-pvc",children:"2.1.3 \u67e5\u770bpv pvc"}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770bpv"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ kubectl get pv\nNAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM          STORAGECLASS   REASON   AGE\nnfs-pv   1Gi        RWO            Retain           Bound    test/nfs-pvc   manual                  30s\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770bpvc"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ kubectl get pvc\nNAME      STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE\nnfs-pvc   Bound    nfs-pv   1Gi        RWO            manual         29s\n"})}),"\n",(0,r.jsx)(n.h4,{id:"214-\u521b\u5efapod\u5e76\u5f15\u7528\u521b\u5efa\u7684pvc",children:"2.1.4 \u521b\u5efapod\u5e76\u5f15\u7528\u521b\u5efa\u7684pvc"}),"\n",(0,r.jsx)(n.p,{children:"\u7f16\u8f91yaml\u6587\u4ef6"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'cat > nfs-pod.yaml << EOF\napiVersion: v1\nkind: Pod\nmetadata:\n  name: test-volumes\nspec:\n  volumes:\n  - name: nfs\n    persistentVolumeClaim:\n      claimName: nfs-pvc\n  containers:\n  - name: web\n    image: nginx\n    ports:\n    - name: web\n      containerPort: 80\n    volumeMounts:\n    - name: nfs\n      subPath: test-volumes\n      mountPath: "/usr/share/nginx/html"\nEOF\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u521b\u5efapod"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ kubectl apply -f nfs-pod.yaml \npod/test-volumes created\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770bpod"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ kubectl get pod -o wide\nNAME           READY   STATUS    RESTARTS   AGE   IP              NODE    NOMINATED NODE   READINESS GATES\ntest-volumes   1/1     Running   0          31s   100.108.251.8   ctyun   <none>           <none>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u7531\u4e8e\u6211\u4eec\u8fd9\u91ccpv\u4e2d\u7684\u6570\u636e\u4e3a\u7a7a\uff0c\u6240\u4ee5\u6302\u8f7d\u540e\u4f1a\u5c06nginx\u5bb9\u5668\u4e2d\u7684 ",(0,r.jsx)(n.code,{children:"/usr/share/nginx/html"})," \u76ee\u5f55\u8986\u76d6\uff0c\u90a3\u4e48\u8bbf\u95ee\u5e94\u7528\u7684\u65f6\u5019\u5c31\u6ca1\u6709\u5185\u5bb9\u4e86"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ curl 100.108.251.8\n<html>\n<head><title>403 Forbidden</title></head>\n<body>\n<center><h1>403 Forbidden</h1></center>\n<hr><center>nginx/1.23.2</center>\n</body>\n</html>\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5411pv\u76ee\u5f55\u5199\u5165\u6587\u4ef6\u5185\u5bb9"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"echo 'test-volumes' > /data/nfs/test-volumes/index.html\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u518d\u6b21\u8bbf\u95ee\u5c31\u53ef\u4ee5\u770b\u5230\u521a\u624d\u5199\u5165\u7684\u5185\u5bb9\u4e86"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ curl 100.108.251.8\ntest-volumes\n"})}),"\n",(0,r.jsx)(n.h3,{id:"22-\u901a\u8fc7storageclass\u81ea\u52a8\u521b\u5efapv",children:"2.2 \u901a\u8fc7StorageClass\u81ea\u52a8\u521b\u5efapv"}),"\n",(0,r.jsx)(n.p,{children:":::tip\u8bf4\u660e"}),"\n",(0,r.jsxs)(n.p,{children:["\u4e0a\u8ff0\u8fd9\u79cd\u65b9\u5f0f\u662f\u624b\u52a8\u521b\u5efapv pvc\uff0c\u5982\u679c\u60f3\u8981\u81ea\u52a8\u521b\u5efapv pvc\u5219\u9700\u8981\u4f7f\u7528StorageClass\u4e86\uff0c\u5e76\u4e14\u9700\u8981\u4e00\u4e2a\u5bf9\u5e94\u7684provisioner\u6765\u81ea\u52a8\u521b\u5efapv\uff0c\u6bd4\u5982\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u7684nfs\u5b58\u50a8\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 ",(0,r.jsx)(n.a,{href:"https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner",children:"nfs-subdir-external-provisioner"})," \u8fd9\u4e2a provisioner\uff0c\u5b83\u4f7f\u7528\u73b0\u6709\u7684\u548c\u5df2\u914d\u7f6e\u7684nfs\u670d\u52a1\u5668\u6765\u652f\u6301\u901a\u8fc7pvc\u52a8\u6001\u914d\u7f6epv\uff0c\u6301\u4e45\u5377\u914d\u7f6e\u4e3a ",(0,r.jsx)(n.code,{children:"${namespace}-${pvcName}-${pvName}"})]}),"\n",(0,r.jsx)(n.p,{children:":::"}),"\n",(0,r.jsxs)(n.h4,{id:"221-\u5b89\u88c5-nfs-subdir-external-provisioner",children:["2.2.1 \u5b89\u88c5 ",(0,r.jsx)(n.a,{href:"https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner",children:"nfs-subdir-external-provisioner"})]}),"\n",(0,r.jsx)(n.p,{children:"\u6dfb\u52a0helm\u4ed3\u5e93"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"helm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5b89\u88c5"}),"\n",(0,r.jsx)(n.p,{children:":::tip\u8bf4\u660e"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"--set storageClass.defaultClass=true"})," \u6307\u5b9asc\u4e3a\u9ed8\u8ba4sc"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"nfs-subdir-external-provisioner/nfs-subdir-external-provisioner"})," \u4f1a\u4ece ",(0,r.jsx)(n.code,{children:"k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner"})," pull\u955c\u50cf\uff0c\u4f46\u662f\u7531\u4e8e\u67d0\u4e9b\u7279\u6b8a\u539f\u56e0\u8fd9\u4e2a\u5730\u5740\u662f\u65e0\u6cd5\u8bbf\u95ee\u7684\uff0c\u56e0\u6b64\u9700\u8981\u79d1\u5b66\u4e0a\u7f51\uff0c\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528ucloud\u63d0\u4f9b\u7684\u955c\u50cf\u52a0\u901f\u670d\u52a1 ",(0,r.jsx)(n.code,{children:"uhub.service.ucloud.cn/996.icu/nfs-subdir-external-provisioner:v4.0.2"})," \uff0c\u5e76\u628a\u8fd9\u4e2a\u955c\u50cf\u63a8\u9001\u5230docker hub\u4ed3\u5e93"]}),"\n",(0,r.jsxs)(n.p,{children:["\u622a\u6b62\u52302022.11.15\uff0c",(0,r.jsx)(n.code,{children:"nfs-subdir-external-provisioner/nfs-subdir-external-provisioner"})," \u955c\u50cf\u6700\u65b0\u7248\u672c\u662f ",(0,r.jsx)(n.code,{children:"v4.0.2"})]}),"\n",(0,r.jsx)(n.p,{children:":::"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"export NFS_SERVER_IP=192.168.1.96\nexport NFS_SHARE_DIR=/data/nfs\nhelm upgrade --install nfs-subdir-external-provisioner nfs-subdir-external-provisioner/nfs-subdir-external-provisioner \\\n    --set nfs.server=${NFS_SERVER_IP} \\\n    --set nfs.path=${NFS_SHARE_DIR} \\\n    --set storageClass.defaultClass=true \\\n    --set image.repository=pptfz/nfs-subdir-external-provisioner\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770bsc"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ kubectl get sc\nNAME                   PROVISIONER                                     RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE\nnfs-client (default)   cluster.local/nfs-subdir-external-provisioner   Delete          Immediate           true                   7m20s\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770bsc\u7684yaml\u6587\u4ef6"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'$ kubectl get sc nfs-client -o yaml\nallowVolumeExpansion: true\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  annotations:\n    meta.helm.sh/release-name: nfs-subdir-external-provisioner\n    meta.helm.sh/release-namespace: test\n  creationTimestamp: "2022-11-14T14:35:46Z"\n  labels:\n    app: nfs-subdir-external-provisioner\n    app.kubernetes.io/managed-by: Helm\n    chart: nfs-subdir-external-provisioner-4.0.17\n    heritage: Helm\n    release: nfs-subdir-external-provisioner\n  name: nfs-client\n  resourceVersion: "217312"\n  uid: 5186b712-8214-46e1-b26e-aaed6bf1de7e\nparameters:\n  archiveOnDelete: "true"\nprovisioner: cluster.local/nfs-subdir-external-provisioner\nreclaimPolicy: Delete\nvolumeBindingMode: Immediate\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528helm\u5b89\u88c5\u5b9e\u9645\u4e0a\u662f\u90e8\u7f72\u4e00\u4e2adeployment"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ kubectl get all\nNAME                                                   READY   STATUS    RESTARTS   AGE\npod/nfs-subdir-external-provisioner-69f5686876-z47fl   1/1     Running   0          3m45s\n\nNAME                                              READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/nfs-subdir-external-provisioner   1/1     1            1           3m45s\n\nNAME                                                         DESIRED   CURRENT   READY   AGE\nreplicaset.apps/nfs-subdir-external-provisioner-69f5686876   1         1         1       3m45s\n"})}),"\n",(0,r.jsx)(n.h4,{id:"222-\u81ea\u52a8\u521b\u5efapv",children:"2.2.2 \u81ea\u52a8\u521b\u5efapv"}),"\n",(0,r.jsx)(n.p,{children:"\u7f16\u8f91yaml\u6587\u4ef6"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"cat > nfs-sc-pvc << EOF\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: nfs-sc-pvc\nspec:\n  # storageClassName: nfs-client  # \u4e0d\u6307\u5b9a\u5219\u4f7f\u7528\u9ed8\u8ba4\u7684sc\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 1Gi\nEOF\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u521b\u5efapvc"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f nfs-sc-pvc.yaml\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770b\u521b\u5efa\u7684pvc"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ kubectl get pvc\nNAME         STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE\nnfs-sc-pvc   Bound    pvc-e1357f25-9ffe-41d7-8607-4d311f0338bb   1Gi        RWO            nfs-client     3s\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u521b\u5efa\u5b8cpvc\u540e\u5c31\u4f1a\u81ea\u52a8\u7ed1\u5b9a\u4e00\u4e2apv"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ kubectl get pv\nNAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM             STORAGECLASS   REASON   AGE\npvc-e1357f25-9ffe-41d7-8607-4d311f0338bb   1Gi        RWO            Delete           Bound    test/nfs-sc-pvc   nfs-client              5s\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770bpv yaml\u6587\u4ef6"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'$ kubectl get pv -o yaml\napiVersion: v1\nitems:\n- apiVersion: v1\n  kind: PersistentVolume\n  metadata:\n    annotations:\n      pv.kubernetes.io/provisioned-by: cluster.local/nfs-subdir-external-provisioner\n    creationTimestamp: "2022-11-14T16:12:08Z"\n    finalizers:\n    - kubernetes.io/pv-protection\n    name: pvc-e1357f25-9ffe-41d7-8607-4d311f0338bb\n    resourceVersion: "231102"\n    uid: 51c97978-298b-4015-a250-2b694fefe90c\n  spec:\n    accessModes:\n    - ReadWriteOnce\n    capacity:\n      storage: 1Gi\n    claimRef:\n      apiVersion: v1\n      kind: PersistentVolumeClaim\n      name: nfs-sc-pvc\n      namespace: test\n      resourceVersion: "231097"\n      uid: e1357f25-9ffe-41d7-8607-4d311f0338bb\n    nfs:\n      path: /data/nfs/test-nfs-sc-pvc-pvc-e1357f25-9ffe-41d7-8607-4d311f0338bb\n      server: 192.168.1.96\n    persistentVolumeReclaimPolicy: Delete\n    storageClassName: nfs-client\n    volumeMode: Filesystem\n  status:\n    phase: Bound\nkind: List\nmetadata:\n  resourceVersion: ""\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u53ef\u4ee5\u770b\u5230\u6302\u8f7d\u7684nfs\u76ee\u5f55\u4e3a ",(0,r.jsx)(n.code,{children:"/data/nfs/test-nfs-sc-pvc-pvc-e1357f25-9ffe-41d7-8607-4d311f0338bb"})," \uff0c\u547d\u540d\u683c\u5f0f\u4e3a  ",(0,r.jsx)(n.code,{children:"${namespace}-${pvcName}-${pvName}"}),"\uff0c\u5176\u4e2d ",(0,r.jsx)(n.code,{children:"test"})," \u662f\u547d\u540d\u7a7a\u95f4\u540d\u79f0\uff0c",(0,r.jsx)(n.code,{children:"nfs-sc-pvc"})," \u662fpvc\u540d\u79f0\uff0c",(0,r.jsx)(n.code,{children:"pvc-e1357f25-9ffe-41d7-8607-4d311f0338bb"})," \u662fpv\u540d\u79f0"]})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>a});var r=s(96540);const l={},i=r.createContext(l);function c(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:c(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);