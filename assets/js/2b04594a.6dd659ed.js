"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[3616],{37538:(s,e,n)=>{n.r(e),n.d(e,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>a});var r=n(74848),l=n(28453);const o={},i="supervisor\u7ba1\u7406mysql",t={id:"linux/linux\u670d\u52a1/supervisor/supervisor\u7ba1\u7406mysql",title:"supervisor\u7ba1\u7406mysql",description:"supervisor\u914d\u7f6e\u6587\u4ef6 /etc/supervisor/supervisord.conf \u4e2d\u5b9a\u4e49\u4e86include\uff0c\u56e0\u6b64\u5982\u679c\u60f3\u8981\u7ba1\u7406\u670d\u52a1\uff0c\u5c31\u9700\u8981\u7f16\u8f91 /etc/supervisor/config.d/*.ini \u6587\u4ef6",source:"@site/docs/linux/linux\u670d\u52a1/supervisor/supervisor\u7ba1\u7406mysql.md",sourceDirName:"linux/linux\u670d\u52a1/supervisor",slug:"/linux/linux\u670d\u52a1/supervisor/supervisor\u7ba1\u7406mysql",permalink:"/docs/linux/linux\u670d\u52a1/supervisor/supervisor\u7ba1\u7406mysql",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"supervisor\u7ba1\u7406mongodb",permalink:"/docs/linux/linux\u670d\u52a1/supervisor/supervisor\u7ba1\u7406mongodb"},next:{title:"supervisor\u7ba1\u7406nginx",permalink:"/docs/linux/linux\u670d\u52a1/supervisor/supervisor\u7ba1\u7406nginx"}},d={},a=[];function c(s){const e={code:"code",h1:"h1",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,l.R)(),...s.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h1,{id:"supervisor\u7ba1\u7406mysql",children:"supervisor\u7ba1\u7406mysql"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsxs)(e.strong,{children:["supervisor\u914d\u7f6e\u6587\u4ef6 ",(0,r.jsx)(e.code,{children:"/etc/supervisor/supervisord.conf"})," \u4e2d\u5b9a\u4e49\u4e86include\uff0c\u56e0\u6b64\u5982\u679c\u60f3\u8981\u7ba1\u7406\u670d\u52a1\uff0c\u5c31\u9700\u8981\u7f16\u8f91 ",(0,r.jsx)(e.code,{children:"/etc/supervisor/config.d/*.ini"})," \u6587\u4ef6"]})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"[include] \nfiles = /etc/supervisor/config.d/*.ini\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsxs)(e.strong,{children:["\u7f16\u8f91mysql\u670d\u52a1\u914d\u7f6e\u6587\u4ef6 ",(0,r.jsx)(e.code,{children:"/etc/supervisor/config.d/mysql.ini"})]})}),"\n",(0,r.jsxs)(e.p,{children:["\u26a0\ufe0f\u793a\u4f8b\u4e2d\u7684mysql\u662f\u4e8c\u8fdb\u5236\u5b89\u88c5\u5728\u4e86 ",(0,r.jsx)(e.code,{children:"/usr/local/mysql"})," \uff0c\u4f8b\u5982\u6570\u636e\u76ee\u5f55\u662f ",(0,r.jsx)(e.code,{children:"/usr/local/mysql/data"})," \uff0c\u5176\u4f59\u63d2\u4ef6\u76ee\u5f55\u3001\u9519\u8bef\u65e5\u5fd7\u76ee\u5f55\u3001pid\u76ee\u5f55\u7b49\u8fd8\u9700\u8981\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u4fee\u6539"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"cat > /etc/supervisor/config.d/mysql.ini<<'EOF'\n[program:mysql]\ncommand=/usr/local/mysql/bin/mysqld --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --plugin-dir=/usr/local/mysql/lib/plugin --user=mysql --log-error=/usr/local/mysql/data/error.log --pid-file=/usr/local/mysql/data/hwyun.pid --socket=/tmp/mysql.sock\npriority=1                    ; \u6570\u5b57\u8d8a\u9ad8\uff0c\u4f18\u5148\u7ea7\u8d8a\u9ad8\nnumprocs=1                    ; \u542f\u52a8\u51e0\u4e2a\u8fdb\u7a0b\nautostart=true                ; \u968f\u7740supervisord\u7684\u542f\u52a8\u800c\u542f\u52a8\nautorestart=true              ; \u81ea\u52a8\u91cd\u542f\nstartretries=10               ; \u542f\u52a8\u5931\u8d25\u65f6\u7684\u6700\u591a\u91cd\u8bd5\u6b21\u6570\nexitcodes=0                   ; \u6b63\u5e38\u9000\u51fa\u4ee3\u7801\nstopsignal=KILL               ; \u7528\u6765\u6740\u6b7b\u8fdb\u7a0b\u7684\u4fe1\u53f7\nstopwaitsecs=10               ; \u53d1\u9001SIGKILL\u524d\u7684\u7b49\u5f85\u65f6\u95f4\nredirect_stderr=true          ; \u91cd\u5b9a\u5411stderr\u5230stdout\n\nstdout_logfile_maxbytes = 1024MB\nstdout_logfile_backups  = 10\nstdout_logfile          = /var/log/supervisor/mysql.log\nEOF\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u521b\u5efa\u5b58\u653e\u65e5\u5fd7\u76ee\u5f55"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"mkdir -p /var/log/supervisor\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u5c06mysql\u52a0\u5165supervisor"})}),"\n",(0,r.jsxs)(e.p,{children:["\u65b9\u6cd5\u4e00\t\u4f7f\u7528 ",(0,r.jsx)(e.code,{children:"supervisorctl update \u7a0b\u5e8f\u540d"})," \u628a\u76f8\u5e94\u670d\u52a1\u52a0\u5165supervisor"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"$ supervisorctl update mysql\nmysql: added process group\n"})}),"\n",(0,r.jsxs)(e.p,{children:["\u65b9\u6cd5\u4e8c\t\u4f7f\u7528 ",(0,r.jsx)(e.code,{children:"supervisorctl"})," \u547d\u4ee4\u8fdb\u5165\u4ea4\u4e92\u64cd\u4f5c\u754c\u9762\uff0c\u7136\u540e\u518d\u6dfb\u52a0\u670d\u52a1"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"$ supervisorctl\n$ update mysql\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u67e5\u770b\u670d\u52a1\u8fd0\u884c"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"$ supervisorctl status mysql\nmysql      RUNNING   pid 4415, uptime 0:00:36\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u8be6\u7ec6\u914d\u7f6e"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"[program:mysql]\ncommand=/usr/local/mysql/bin/mysqld --basedir=/usr/local/mysql --datadir=/data/db/mysql/data --plugin-dir=/usr/local/mysql/lib/plugin --user=mysql --log-error=/data/db/mysql/logs/mysqld.log --pid-file=/data/db/mysql/mysqld/mysqld.pid --socket=/data/db/mysql/sock/mysqld.sock\npriority=1                    \nnumprocs=1                   \nautostart=true                \nautorestart=true             \nstartretries=10              \nexitcodes=0                  \nstopsignal=KILL               \nstopwaitsecs=10               \nredirect_stderr=true          \n\nstdout_logfile_maxbytes = 1024MB\nstdout_logfile_backups  = 10\nstdout_logfile          = /var/log/supervisord/mysql.log\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"mysql\u914d\u7f6e\u6587\u4ef6"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"[client]\nport = 3306\nsocket = /data/db/mysql/sock/mysql.sock\n[mysqld]\nport = 3306\nsocket = /data/db/mysql/sock/mysql.sock\npid-file = /data/db/mysql/sock/mysqld.pid\nlog-error = /data/db/mysql/logs/mysql-err.log\nlog = /data/db/mysql/logs/mysqld.log\ntmpdir = /data/db/mysql/tmp/\nslow_query_log = ON\nlong_query_time = 5\nslow_query_log_file = /data/db/mysql/logs/slow_query.log\nlog_queries_not_using_indexes = ON\nskip-external-locking\nkey_buffer_size = 256M\nmax_allowed_packet = 64M\ntable_open_cache = 256\nsort_buffer_size = 1M\nread_buffer_size = 1M\nread_rnd_buffer_size = 4M\nmyisam_sort_buffer_size = 64M\nthread_cache_size = 8\nquery_cache_size= 16M\nthread_concurrency = 8\nmax_connections = 20000\nmax_connect_errors = 20000\nlog-bin=/data/db/mysql/log-bin/mysql-bin\nexpire_logs_days=4\nrelay-log =/data/db/mysql/relay-log\nlog_slave_updates =1\nrelay_log_purge =1\nrelay_log_space_limit = 10G\nbinlog_format=mixed\nserver-id\t= 21\ninnodb_data_home_dir = /data/db/mysql/data\ninnodb_data_file_path = ibdata1:20G;ibdata2:20G;ibdata3:20G;ibdataext:10M:autoextend\ninnodb_log_group_home_dir = /data/db/mysql/data\ninnodb_buffer_pool_size = 4800M\ninnodb_additional_mem_pool_size = 20M\ninnodb_log_file_size = 64M\ninnodb_log_buffer_size = 8M\ninnodb_lock_wait_timeout = 50\n[mysqldump]\nquick\nmax_allowed_packet = 16M\n[mysql]\nno-auto-rehash\n[myisamchk]\nkey_buffer_size = 128M\nsort_buffer_size = 128M\nread_buffer = 2M\nwrite_buffer = 2M\n[mysqlhotcopy]\ninteractive-timeout\n"})})]})}function u(s={}){const{wrapper:e}={...(0,l.R)(),...s.components};return e?(0,r.jsx)(e,{...s,children:(0,r.jsx)(c,{...s})}):c(s)}},28453:(s,e,n)=>{n.d(e,{R:()=>i,x:()=>t});var r=n(96540);const l={},o=r.createContext(l);function i(s){const e=r.useContext(o);return r.useMemo((function(){return"function"==typeof s?s(e):{...e,...s}}),[e,s])}function t(s){let e;return e=s.disableParentContext?"function"==typeof s.components?s.components(l):s.components||l:i(s.components),r.createElement(o.Provider,{value:e},s.children)}}}]);