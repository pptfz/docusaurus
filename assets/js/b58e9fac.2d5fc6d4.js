"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[5228],{53581:(s,e,n)=>{n.r(e),n.d(e,{assets:()=>t,contentTitle:()=>c,default:()=>a,frontMatter:()=>h,metadata:()=>r,toc:()=>d});var i=n(74848),o=n(28453);const h={},c=void 0,r={id:"linux/linux\u670d\u52a1/ssh/ssh\u670d\u52a1",title:"ssh\u670d\u52a1",description:"[toc]",source:"@site/docs/linux/linux\u670d\u52a1/ssh/ssh\u670d\u52a1.md",sourceDirName:"linux/linux\u670d\u52a1/ssh",slug:"/linux/linux\u670d\u52a1/ssh/ssh\u670d\u52a1",permalink:"/docs/linux/linux\u670d\u52a1/ssh/ssh\u670d\u52a1",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"ssh\u5bc6\u94a5",permalink:"/docs/linux/linux\u670d\u52a1/ssh/ssh\u5bc6\u94a5"},next:{title:"ssh\u8fde\u63a5\u62a5\u9519",permalink:"/docs/linux/linux\u670d\u52a1/ssh/ssh\u8fde\u63a5\u62a5\u9519"}},t={},d=[{value:"\u4e00\u3001ssh\u7981\u6b62root\u8fdc\u7a0b\u767b\u9646",id:"\u4e00ssh\u7981\u6b62root\u8fdc\u7a0b\u767b\u9646",level:2},{value:"1.\u7f16\u8f91\u6587\u4ef6<code>/etc/ssh/sshd_config</code>",id:"1\u7f16\u8f91\u6587\u4ef6etcsshsshd_config",level:3},{value:"2.sudo\u514d\u5bc6\u914d\u7f6e\u7b49root\u6743\u9650\u7528\u6237",id:"2sudo\u514d\u5bc6\u914d\u7f6e\u7b49root\u6743\u9650\u7528\u6237",level:3},{value:"3.\u914d\u7f6essh\u5bc6\u94a5",id:"3\u914d\u7f6essh\u5bc6\u94a5",level:3},{value:"4.\u914d\u7f6e\u5b8c\u540e\u9a8c\u8bc1",id:"4\u914d\u7f6e\u5b8c\u540e\u9a8c\u8bc1",level:3},{value:"\u4e8c\u3001ssh\u514d\u4ea4\u4e92\u914d\u7f6e",id:"\u4e8cssh\u514d\u4ea4\u4e92\u914d\u7f6e",level:2},{value:"ssh-keygen\u514d\u4ea4\u4e92\u751f\u6210\u5bc6\u94a5",id:"ssh-keygen\u514d\u4ea4\u4e92\u751f\u6210\u5bc6\u94a5",level:3},{value:"ssh-copy\u514d\u4ea4\u4e92\u63a8\u9001\u5bc6\u94a5",id:"ssh-copy\u514d\u4ea4\u4e92\u63a8\u9001\u5bc6\u94a5",level:3},{value:"\u6279\u91cf\u5206\u53d1\u5bc6\u94a5\u811a\u672c",id:"\u6279\u91cf\u5206\u53d1\u5bc6\u94a5\u811a\u672c",level:3},{value:"\u4e09\u3001ssh\u81ea\u52a8\u65ad\u5f00\u8fdc\u7a0b\u670d\u52a1\u5668\u95ee\u9898",id:"\u4e09ssh\u81ea\u52a8\u65ad\u5f00\u8fdc\u7a0b\u670d\u52a1\u5668\u95ee\u9898",level:2}];function l(s){const e={admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...s.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.p,{children:"[toc]"}),"\n",(0,i.jsx)(e.h2,{id:"\u4e00ssh\u7981\u6b62root\u8fdc\u7a0b\u767b\u9646",children:"\u4e00\u3001ssh\u7981\u6b62root\u8fdc\u7a0b\u767b\u9646"}),"\n",(0,i.jsxs)(e.h3,{id:"1\u7f16\u8f91\u6587\u4ef6etcsshsshd_config",children:["1.\u7f16\u8f91\u6587\u4ef6",(0,i.jsx)(e.code,{children:"/etc/ssh/sshd_config"})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"# \u7981\u6b62root\u8fdc\u7a0b\u767b\u9646\nPermitRootLogin no\n\n# \u7981\u7528\u5bc6\u7801\u9a8c\u8bc1\nPasswordAuthentication no\n\n# \u542f\u7528\u5bc6\u94a5\u9a8c\u8bc1\nRSAAuthentication yes //centos7\u6ca1\u6709\u8fd9\u4e00\u9879\nPubkeyAuthentication yes\n"})}),"\n",(0,i.jsx)(e.h3,{id:"2sudo\u514d\u5bc6\u914d\u7f6e\u7b49root\u6743\u9650\u7528\u6237",children:"2.sudo\u514d\u5bc6\u914d\u7f6e\u7b49root\u6743\u9650\u7528\u6237"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsxs)(e.strong,{children:[(0,i.jsx)(e.code,{children:"visudo"}),"\u6216\u8005\u7f16\u8f91\u6587\u4ef6",(0,i.jsx)(e.code,{children:"/etc/sudoers"})]})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"# \u521b\u5efa\u4e00\u4e2a\u7528\u6237\nuseradd lcc\n\n# visudo\u7f16\u8f91,101\u884c\u5199\u5165\u4ee5\u4e0b\u5185\u5bb9\nlcc     ALL=NOPASSWD :ALL\n\n"})}),"\n",(0,i.jsx)(e.h3,{id:"3\u914d\u7f6essh\u5bc6\u94a5",children:"3.\u914d\u7f6essh\u5bc6\u94a5"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"# \u5207\u6362\u5230lcc\u7528\u6237\nsu - lcc\n\n# \u751f\u6210\u5bc6\u94a5\n$ ssh-keygen \nGenerating public/private rsa key pair.\nEnter file in which to save the key (/home/lcc/.ssh/id_rsa): \nCreated directory '/home/lcc/.ssh'.\nEnter passphrase (empty for no passphrase): \nEnter same passphrase again: \nYour identification has been saved in /home/lcc/.ssh/id_rsa.\nYour public key has been saved in /home/lcc/.ssh/id_rsa.pub.\nThe key fingerprint is:\nSHA256:nSW5jEvQwr8zPZok5CfK+fnrhPJfk2motWOgx1/eNZ4 lcc@experiment\nThe key's randomart image is:\n+---[RSA 2048]----+\n|                 |\n|     . .   .     |\n|      + . o .    |\n|       + + =     |\n|      . S =      |\n|     o.o = o     |\n|    .o=.@ X   o  |\n|   ..=oXo@ + o o |\n|    +o=*Xo. . E  |\n+----[SHA256]-----+\n\n\n# \u5411authorized_keys\u6587\u4ef6\u5199\u5165\u516c\u94a5\ncd .ssh && cat id_rsa.pub >authorized_keys\n\n# \u4fee\u6539authorized_keys\u6587\u4ef6\u6743\u9650\u81f3\u5c11\u4e3a644\uff0c\u9ed8\u8ba4\u4e3a664\uff0c\u65e0\u6cd5\u4f7f\u7528\u5bc6\u94a5\u767b\u9646\nchmod 644 authorized_keys\n"})}),"\n",(0,i.jsx)(e.admonition,{type:"tip",children:(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:(0,i.jsxs)("span",{style:{color:"red"},children:["\u26a0\ufe0fssh\u670d\u52a1\u914d\u7f6e\u6587\u4ef6",(0,i.jsx)(e.code,{children:"/etc/ssh/sshd_config"}),"\u4e2d\u6709\u4e00\u9879\u914d\u7f6e\u662f",(0,i.jsx)(e.code,{children:"AuthorizedKeysFile      .ssh/authorized_keys"}),"\uff0c\u5982\u679c\u60f3\u8981\u4f7f\u7528\u79c1\u94a5\u514d\u5bc6\u767b\u9646\uff0c\u5219\u516c\u94a5\u5fc5\u987b\u5199\u5165\u5230\u6587\u4ef6",(0,i.jsx)(e.code,{children:".ssh/authorized_keys"}),"\u4e2d\uff0c\u5373\u6ce8\u518c\u79c1\u94a5\uff0c\u5426\u5219\u514d\u5bc6\u4f1a\u5931\u8d25\uff01\uff01\uff01"]})})})}),"\n",(0,i.jsx)(e.h3,{id:"4\u914d\u7f6e\u5b8c\u540e\u9a8c\u8bc1",children:"4.\u914d\u7f6e\u5b8c\u540e\u9a8c\u8bc1"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"# root\u65e0\u6cd5\u8fdc\u7a0b\u767b\u9646\nbaixuebingdeMacBook-Pro:~ baixuebing$ ssh root@10.0.0.13\nroot@10.0.0.13: Permission denied (publickey,gssapi-keyex,gssapi-with-mic).\n  \n# \u65e0\u6cd5\u4f7f\u7528\u5bc6\u7801\u767b\u9646\uff0c\u53ea\u80fd\u4f7f\u7528\u5bc6\u94a5\u767b\u9646\nbaixuebingdeMacBook-Pro:~ baixuebing$ ssh lcc@10.0.0.13\nlcc@10.0.0.13: Permission denied (publickey,gssapi-keyex,gssapi-with-mic).\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u4e8cssh\u514d\u4ea4\u4e92\u914d\u7f6e",children:"\u4e8c\u3001ssh\u514d\u4ea4\u4e92\u914d\u7f6e"}),"\n",(0,i.jsx)(e.h3,{id:"ssh-keygen\u514d\u4ea4\u4e92\u751f\u6210\u5bc6\u94a5",children:"ssh-keygen\u514d\u4ea4\u4e92\u751f\u6210\u5bc6\u94a5"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:'# \u514d\u4ea4\u4e92\u751f\u6210\u5bc6\u94a5\nssh-keygen -t rsa -f /root/.ssh/id_dsa -P "" -q\n\n-f filename             \t#\u6307\u5b9a\u5bc6\u94a5\u6587\u4ef6\u7684\u6587\u4ef6\u540d\n-P passphrase           \t#\u63d0\u4f9b\u65e7\u5bc6\u94a5\u53e3\u4ee4\n-q Silence ssh-keygen   \t#\u9759\u9ed8\u8f93\u51fa\n-t key type\t\t\t\t\t\t\t\t#\u5bc6\u94a5\u7c7b\u578b\n\tdsa \n  ecdsa\n  ed25519\n  rsa(\u9ed8\u8ba4)\n  rsa1\n'})}),"\n",(0,i.jsx)(e.admonition,{type:"tip",children:(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:(0,i.jsxs)("span",{style:{color:"red"},children:["\u26a0\ufe0fssh\u670d\u52a1\u914d\u7f6e\u6587\u4ef6",(0,i.jsx)(e.code,{children:"/etc/ssh/sshd_config"}),"\u4e2d\u6709\u4e00\u9879\u914d\u7f6e\u662f",(0,i.jsx)(e.code,{children:"AuthorizedKeysFile      .ssh/authorized_keys"}),"\uff0c\u5982\u679c\u60f3\u8981\u4f7f\u7528\u79c1\u94a5\u514d\u5bc6\u767b\u9646\uff0c\u5219\u516c\u94a5\u5fc5\u987b\u5199\u5165\u5230\u6587\u4ef6",(0,i.jsx)(e.code,{children:".ssh/authorized_keys"}),"\u4e2d\uff0c\u5373\u6ce8\u518c\u79c1\u94a5\uff0c\u5426\u5219\u514d\u5bc6\u4f1a\u5931\u8d25\uff01\uff01\uff01"]})})})}),"\n",(0,i.jsx)(e.h3,{id:"ssh-copy\u514d\u4ea4\u4e92\u63a8\u9001\u5bc6\u94a5",children:"ssh-copy\u514d\u4ea4\u4e92\u63a8\u9001\u5bc6\u94a5"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"sshpass -p1 ssh-copy-id -i ~/.ssh/id_rsa.pub -o StrictHostKeyChecking=no root@IP\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u6279\u91cf\u5206\u53d1\u5bc6\u94a5\u811a\u672c",children:"\u6279\u91cf\u5206\u53d1\u5bc6\u94a5\u811a\u672c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:'#!/bin/bash\n\n# \u751f\u6210\u5bc6\u94a5\n\\rm -f /root/.ssh/id_*\nssh-keygen -t rsa -f /root/.ssh/id_rsa -P "" -q\n\n# \u5206\u53d1\u5bc6\u94a5\nfor ip in IP\ndo\n   echo "=== \u5206\u53d1\u4e3b\u673a 10.0.0.$ip ==="\n   sshpass -p1 ssh-copy-id -i ~/.ssh/id_rsa.pub -o StrictHostKeyChecking=no root@10.0.0.$ip\n   echo "=== \u5206\u53d1ojbk ==="\n   echo ""\ndone\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u4e09ssh\u81ea\u52a8\u65ad\u5f00\u8fdc\u7a0b\u670d\u52a1\u5668\u95ee\u9898",children:"\u4e09\u3001ssh\u81ea\u52a8\u65ad\u5f00\u8fdc\u7a0b\u670d\u52a1\u5668\u95ee\u9898"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsxs)(e.strong,{children:["\u7f16\u8f91ssh\u670d\u52a1\u914d\u7f6e\u6587\u4ef6",(0,i.jsx)(e.code,{children:"/etc/ssh/sshd_config"}),"\u4fee\u6539\u4ee5\u4e0b\u4e24\u9879"]})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"# \u5411\u5ba2\u6237\u7aef\u6bcf30\u79d2\u53d1\u4e00\u6b21\u4fdd\u6301\u8fde\u63a5\u7684\u4fe1\u53f7\nClientAliveInterval 30\n\n# \u5982\u679c\u5ba2\u6237\u7aef30\u6b21\u672a\u54cd\u5e94\u5c31\u65ad\u5f00\u8fde\u63a5\nClientAliveCountMax 30\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u91cd\u542f\u670d\u52a1"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"systemctl restart sshd\n"})})]})}function a(s={}){const{wrapper:e}={...(0,o.R)(),...s.components};return e?(0,i.jsx)(e,{...s,children:(0,i.jsx)(l,{...s})}):l(s)}},28453:(s,e,n)=>{n.d(e,{R:()=>c,x:()=>r});var i=n(96540);const o={},h=i.createContext(o);function c(s){const e=i.useContext(h);return i.useMemo((function(){return"function"==typeof s?s(e):{...e,...s}}),[e,s])}function r(s){let e;return e=s.disableParentContext?"function"==typeof s.components?s.components(o):s.components||o:c(s.components),i.createElement(h.Provider,{value:e},s.children)}}}]);