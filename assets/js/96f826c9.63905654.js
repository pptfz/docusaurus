"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[968],{54295:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>d,toc:()=>l});var s=i(74848),r=i(28453);const t={},c="init\u5bb9\u5668",d={id:"\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/pod/init\u5bb9\u5668",title:"init\u5bb9\u5668",description:"init\u5bb9\u5668\u5b98\u65b9\u6587\u6863",source:"@site/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/pod/init\u5bb9\u5668.md",sourceDirName:"\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/pod",slug:"/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/pod/init\u5bb9\u5668",permalink:"/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/pod/init\u5bb9\u5668",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Downward API",permalink:"/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/pod/Downward API"},next:{title:"pod hook",permalink:"/docs/\u4e91\u539f\u751f/k8s/k8s\u77e5\u8bc6\u70b9/pod/pod hook"}},o={},l=[{value:"Init \u5bb9\u5668\u8bf4\u660e",id:"init-\u5bb9\u5668\u8bf4\u660e",level:2},{value:"\u7406\u89e3 Init \u5bb9\u5668",id:"\u7406\u89e3-init-\u5bb9\u5668",level:2},{value:"\u4e0e\u666e\u901a\u5bb9\u5668\u7684\u4e0d\u540c\u4e4b\u5904",id:"\u4e0e\u666e\u901a\u5bb9\u5668\u7684\u4e0d\u540c\u4e4b\u5904",level:3},{value:"\u4f7f\u7528 Init \u5bb9\u5668",id:"\u4f7f\u7528-init-\u5bb9\u5668",level:2},{value:"\u4f7f\u7528 Init \u5bb9\u5668\u7684\u60c5\u51b5",id:"\u4f7f\u7528-init-\u5bb9\u5668\u7684\u60c5\u51b5",level:3},{value:"\u521b\u5efa\u4e00\u4e2a\u5305\u542b Init \u5bb9\u5668\u7684 Pod",id:"\u521b\u5efa\u4e00\u4e2a\u5305\u542b-init-\u5bb9\u5668\u7684-pod",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"init\u5bb9\u5668",children:"init\u5bb9\u5668"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/init-containers/",children:"init\u5bb9\u5668\u5b98\u65b9\u6587\u6863"})}),"\n",(0,s.jsx)(n.h2,{id:"init-\u5bb9\u5668\u8bf4\u660e",children:"Init \u5bb9\u5668\u8bf4\u660e"}),"\n",(0,s.jsxs)(n.p,{children:["Init \u5bb9\u5668\u662f\u4e00\u79cd\u7279\u6b8a\u5bb9\u5668\uff0c\u5728 ",(0,s.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/",children:"Pod"})," \u5185\u7684\u5e94\u7528\u5bb9\u5668\u542f\u52a8\u4e4b\u524d\u8fd0\u884c\u3002Init \u5bb9\u5668\u53ef\u4ee5\u5305\u62ec\u4e00\u4e9b\u5e94\u7528\u955c\u50cf\u4e2d\u4e0d\u5b58\u5728\u7684\u5b9e\u7528\u5de5\u5177\u548c\u5b89\u88c5\u811a\u672c\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"\u7406\u89e3-init-\u5bb9\u5668",children:"\u7406\u89e3 Init \u5bb9\u5668"}),"\n",(0,s.jsxs)(n.p,{children:["\u6bcf\u4e2a ",(0,s.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/",children:"Pod"})," \u4e2d\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u5bb9\u5668\uff0c \u5e94\u7528\u8fd0\u884c\u5728\u8fd9\u4e9b\u5bb9\u5668\u91cc\u9762\uff0c\u540c\u65f6 Pod \u4e5f\u53ef\u4ee5\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u5148\u4e8e\u5e94\u7528\u5bb9\u5668\u542f\u52a8\u7684 Init \u5bb9\u5668\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"Init \u5bb9\u5668\u4e0e\u666e\u901a\u7684\u5bb9\u5668\u975e\u5e38\u50cf\uff0c\u9664\u4e86\u5982\u4e0b\u4e24\u70b9\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5b83\u4eec\u603b\u662f\u8fd0\u884c\u5230\u5b8c\u6210\u3002"}),"\n",(0,s.jsx)(n.li,{children:"\u6bcf\u4e2a\u90fd\u5fc5\u987b\u5728\u4e0b\u4e00\u4e2a\u542f\u52a8\u4e4b\u524d\u6210\u529f\u5b8c\u6210\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c Pod \u7684 Init \u5bb9\u5668\u5931\u8d25\uff0ckubelet \u4f1a\u4e0d\u65ad\u5730\u91cd\u542f\u8be5 Init \u5bb9\u5668\u76f4\u5230\u8be5\u5bb9\u5668\u6210\u529f\u4e3a\u6b62\u3002 \u7136\u800c\uff0c\u5982\u679c Pod \u5bf9\u5e94\u7684 ",(0,s.jsx)(n.code,{children:"restartPolicy"}),' \u503c\u4e3a "Never"\uff0c\u5e76\u4e14 Pod \u7684 Init \u5bb9\u5668\u5931\u8d25\uff0c \u5219 Kubernetes \u4f1a\u5c06\u6574\u4e2a Pod \u72b6\u6001\u8bbe\u7f6e\u4e3a\u5931\u8d25\u3002']}),"\n",(0,s.jsxs)(n.p,{children:["\u4e3a Pod \u8bbe\u7f6e Init \u5bb9\u5668\u9700\u8981\u5728 ",(0,s.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/reference/kubernetes-api/workload-resources/pod-v1/#PodSpec",children:"Pod \u89c4\u7ea6"}),"\u4e2d\u6dfb\u52a0 ",(0,s.jsx)(n.code,{children:"initContainers"})," \u5b57\u6bb5\uff0c \u8be5\u5b57\u6bb5\u4ee5 ",(0,s.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.25/#container-v1-core",children:"Container"})," \u7c7b\u578b\u5bf9\u8c61\u6570\u7ec4\u7684\u5f62\u5f0f\u7ec4\u7ec7\uff0c\u548c\u5e94\u7528\u7684 ",(0,s.jsx)(n.code,{children:"containers"})," \u6570\u7ec4\u540c\u7ea7\u76f8\u90bb\u3002 \u53c2\u9605 API \u53c2\u8003\u7684",(0,s.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/reference/kubernetes-api/workload-resources/pod-v1/#Container",children:"\u5bb9\u5668"}),"\u7ae0\u8282\u4e86\u89e3\u8be6\u60c5\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["Init \u5bb9\u5668\u7684\u72b6\u6001\u5728 ",(0,s.jsx)(n.code,{children:"status.initContainerStatuses"})," \u5b57\u6bb5\u4e2d\u4ee5\u5bb9\u5668\u72b6\u6001\u6570\u7ec4\u7684\u683c\u5f0f\u8fd4\u56de \uff08\u7c7b\u4f3c ",(0,s.jsx)(n.code,{children:"status.containerStatuses"})," \u5b57\u6bb5\uff09\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"\u4e0e\u666e\u901a\u5bb9\u5668\u7684\u4e0d\u540c\u4e4b\u5904",children:"\u4e0e\u666e\u901a\u5bb9\u5668\u7684\u4e0d\u540c\u4e4b\u5904"}),"\n",(0,s.jsxs)(n.p,{children:["Init \u5bb9\u5668\u652f\u6301\u5e94\u7528\u5bb9\u5668\u7684\u5168\u90e8\u5b57\u6bb5\u548c\u7279\u6027\uff0c\u5305\u62ec\u8d44\u6e90\u9650\u5236\u3001\u6570\u636e\u5377\u548c\u5b89\u5168\u8bbe\u7f6e\u3002 \u7136\u800c\uff0cInit \u5bb9\u5668\u5bf9\u8d44\u6e90\u8bf7\u6c42\u548c\u9650\u5236\u7684\u5904\u7406\u7a0d\u6709\u4e0d\u540c\uff0c\u5728\u4e0b\u9762",(0,s.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/init-containers/#resources",children:"\u8d44\u6e90"}),"\u8282\u6709\u8bf4\u660e\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u540c\u65f6 Init \u5bb9\u5668\u4e0d\u652f\u6301 ",(0,s.jsx)(n.code,{children:"lifecycle"}),"\u3001",(0,s.jsx)(n.code,{children:"livenessProbe"}),"\u3001",(0,s.jsx)(n.code,{children:"readinessProbe"})," \u548c ",(0,s.jsx)(n.code,{children:"startupProbe"}),"\uff0c \u56e0\u4e3a\u5b83\u4eec\u5fc5\u987b\u5728 Pod \u5c31\u7eea\u4e4b\u524d\u8fd0\u884c\u5b8c\u6210\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u679c\u4e3a\u4e00\u4e2a Pod \u6307\u5b9a\u4e86\u591a\u4e2a Init \u5bb9\u5668\uff0c\u8fd9\u4e9b\u5bb9\u5668\u4f1a\u6309\u987a\u5e8f\u9010\u4e2a\u8fd0\u884c\u3002 \u6bcf\u4e2a Init \u5bb9\u5668\u5fc5\u987b\u8fd0\u884c\u6210\u529f\uff0c\u4e0b\u4e00\u4e2a\u624d\u80fd\u591f\u8fd0\u884c\u3002\u5f53\u6240\u6709\u7684 Init \u5bb9\u5668\u8fd0\u884c\u5b8c\u6210\u65f6\uff0c Kubernetes \u624d\u4f1a\u4e3a Pod \u521d\u59cb\u5316\u5e94\u7528\u5bb9\u5668\u5e76\u50cf\u5e73\u5e38\u4e00\u6837\u8fd0\u884c\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u4f7f\u7528-init-\u5bb9\u5668",children:"\u4f7f\u7528 Init \u5bb9\u5668"}),"\n",(0,s.jsx)(n.p,{children:"\u56e0\u4e3a Init \u5bb9\u5668\u5177\u6709\u4e0e\u5e94\u7528\u5bb9\u5668\u5206\u79bb\u7684\u5355\u72ec\u955c\u50cf\uff0c\u5176\u542f\u52a8\u76f8\u5173\u4ee3\u7801\u5177\u6709\u5982\u4e0b\u4f18\u52bf\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Init \u5bb9\u5668\u53ef\u4ee5\u5305\u542b\u4e00\u4e9b\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u5e94\u7528\u5bb9\u5668\u4e2d\u4e0d\u5b58\u5728\u7684\u5b9e\u7528\u5de5\u5177\u6216\u4e2a\u6027\u5316\u4ee3\u7801\u3002 \u4f8b\u5982\uff0c\u6ca1\u6709\u5fc5\u8981\u4ec5\u4e3a\u4e86\u5728\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u7c7b\u4f3c ",(0,s.jsx)(n.code,{children:"sed"}),"\u3001",(0,s.jsx)(n.code,{children:"awk"}),"\u3001",(0,s.jsx)(n.code,{children:"python"})," \u6216 ",(0,s.jsx)(n.code,{children:"dig"})," \u8fd9\u6837\u7684\u5de5\u5177\u800c\u53bb ",(0,s.jsx)(n.code,{children:"FROM"})," \u4e00\u4e2a\u955c\u50cf\u6765\u751f\u6210\u4e00\u4e2a\u65b0\u7684\u955c\u50cf\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u5e94\u7528\u955c\u50cf\u7684\u521b\u5efa\u8005\u548c\u90e8\u7f72\u8005\u53ef\u4ee5\u5404\u81ea\u72ec\u7acb\u5de5\u4f5c\uff0c\u800c\u6ca1\u6709\u5fc5\u8981\u8054\u5408\u6784\u5efa\u4e00\u4e2a\u5355\u72ec\u7684\u5e94\u7528\u955c\u50cf\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u4e0e\u540c\u4e00 Pod \u4e2d\u7684\u591a\u4e2a\u5e94\u7528\u5bb9\u5668\u76f8\u6bd4\uff0cInit \u5bb9\u5668\u80fd\u4ee5\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\u89c6\u56fe\u8fd0\u884c\u3002\u56e0\u6b64\uff0cInit \u5bb9\u5668\u53ef\u4ee5\u88ab\u8d4b\u4e88\u8bbf\u95ee\u5e94\u7528\u5bb9\u5668\u4e0d\u80fd\u8bbf\u95ee\u7684 ",(0,s.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/",children:"Secret"})," \u7684\u6743\u9650\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u7531\u4e8e Init \u5bb9\u5668\u5fc5\u987b\u5728\u5e94\u7528\u5bb9\u5668\u542f\u52a8\u4e4b\u524d\u8fd0\u884c\u5b8c\u6210\uff0c\u56e0\u6b64 Init \u5bb9\u5668\u63d0\u4f9b\u4e86\u4e00\u79cd\u673a\u5236\u6765\u963b\u585e\u6216\u5ef6\u8fdf\u5e94\u7528\u5bb9\u5668\u7684\u542f\u52a8\uff0c\u76f4\u5230\u6ee1\u8db3\u4e86\u4e00\u7ec4\u5148\u51b3\u6761\u4ef6\u3002 \u4e00\u65e6\u524d\u7f6e\u6761\u4ef6\u6ee1\u8db3\uff0cPod \u5185\u7684\u6240\u6709\u7684\u5e94\u7528\u5bb9\u5668\u4f1a\u5e76\u884c\u542f\u52a8\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Init \u5bb9\u5668\u53ef\u4ee5\u5b89\u5168\u5730\u8fd0\u884c\u5b9e\u7528\u7a0b\u5e8f\u6216\u81ea\u5b9a\u4e49\u4ee3\u7801\uff0c\u800c\u5728\u5176\u4ed6\u65b9\u5f0f\u4e0b\u8fd0\u884c\u8fd9\u4e9b\u5b9e\u7528\u7a0b\u5e8f\u6216\u81ea\u5b9a\u4e49\u4ee3\u7801\u53ef\u80fd\u4f1a\u964d\u4f4e\u5e94\u7528\u5bb9\u5668\u955c\u50cf\u7684\u5b89\u5168\u6027\u3002 \u901a\u8fc7\u5c06\u4e0d\u5fc5\u8981\u7684\u5de5\u5177\u5206\u5f00\uff0c\u4f60\u53ef\u4ee5\u9650\u5236\u5e94\u7528\u5bb9\u5668\u955c\u50cf\u7684\u88ab\u653b\u51fb\u8303\u56f4\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528-init-\u5bb9\u5668\u7684\u60c5\u51b5",children:"\u4f7f\u7528 Init \u5bb9\u5668\u7684\u60c5\u51b5"}),"\n",(0,s.jsxs)(n.p,{children:["\u4e0b\u9762\u7684\u4f8b\u5b50\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5177\u6709 2 \u4e2a Init \u5bb9\u5668\u7684\u7b80\u5355 Pod\u3002 \u7b2c\u4e00\u4e2a\u7b49\u5f85 ",(0,s.jsx)(n.code,{children:"myservice"})," \u542f\u52a8\uff0c \u7b2c\u4e8c\u4e2a\u7b49\u5f85 ",(0,s.jsx)(n.code,{children:"mydb"})," \u542f\u52a8\u3002 \u4e00\u65e6\u8fd9\u4e24\u4e2a Init \u5bb9\u5668\u90fd\u542f\u52a8\u5b8c\u6210\uff0cPod \u5c06\u542f\u52a8 ",(0,s.jsx)(n.code,{children:"spec"})," \u8282\u4e2d\u7684\u5e94\u7528\u5bb9\u5668\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u7f16\u8f91yaml\u6587\u4ef6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"cat > myapp-init.yaml << 'EOF'\napiVersion: v1\nkind: Pod\nmetadata:\n  name: myapp-pod\n  labels:\n    app.kubernetes.io/name: MyApp\nspec:\n  containers:\n  - name: myapp-container\n    image: busybox:1.28\n    command: ['sh', '-c', 'echo The app is running! && sleep 3600']\n  initContainers:\n  - name: init-myservice\n    image: busybox:1.28\n    command: ['sh', '-c', \"until nslookup myservice.$(cat /var/run/secrets/kubernetes.io/serviceaccount/namespace).svc.cluster.local; do echo waiting for myservice; sleep 2; done\"]\n  - name: init-mydb\n    image: busybox:1.28\n    command: ['sh', '-c', \"until nslookup mydb.$(cat /var/run/secrets/kubernetes.io/serviceaccount/namespace).svc.cluster.local; do echo waiting for mydb; sleep 2; done\"]\nEOF\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapod"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"kubectl apply -f myapp-init.yaml\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u67e5\u770b\u65e5\u5fd7"}),"\n",(0,s.jsx)(n.p,{children:"\u7b2c\u4e00\u4e2a\u5bb9\u5668"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"$ kubectl logs myapp-pod -c init-myservice\nServer:    10.96.0.10\nAddress 1: 10.96.0.10\n\nnslookup: can't resolve 'myservice.test.svc.cluster.local'\nwaiting for myservice\nServer:    10.96.0.10\nAddress 1: 10.96.0.10\n\nnslookup: can't resolve 'myservice.test.svc.cluster.local'\nwaiting for myservice\nServer:    10.96.0.10\nAddress 1: 10.96.0.10\n\nnslookup: can't resolve 'myservice.test.svc.cluster.local'\nwaiting for myservice\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u7b2c\u4e8c\u4e2a\u5bb9\u5668"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'$ kubectl logs myapp-pod -c init-mydb \nError from server (BadRequest): container "init-mydb" in pod "myapp-pod" is waiting to start: PodInitializing\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u8fd9\u4e00\u523b\uff0cInit \u5bb9\u5668\u5c06\u4f1a\u7b49\u5f85\u81f3\u53d1\u73b0\u540d\u79f0\u4e3a ",(0,s.jsx)(n.code,{children:"mydb"})," \u548c ",(0,s.jsx)(n.code,{children:"myservice"})," \u7684 Service\u3002\u5f53svc\u521b\u5efa\u6210\u529f\u540e\uff0cinit\u5bb9\u5668\u4f1a\u6309\u987a\u5e8f\u6210\u529f\u6267\u884c\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u4e0b\u4e3a\u521b\u5efa\u8fd9\u4e9b Service \u7684\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"cat > myservice-init.yaml << EOF\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: myservice\nspec:\n  ports:\n  - protocol: TCP\n    port: 80\n    targetPort: 9376\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: mydb\nspec:\n  ports:\n  - protocol: TCP\n    port: 80\n    targetPort: 9377\nEOF\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u521b\u5efa ",(0,s.jsx)(n.code,{children:"mydb"})," \u548c ",(0,s.jsx)(n.code,{children:"myservice"})," svc"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f myservice-init.yaml \n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5f53 ",(0,s.jsx)(n.code,{children:"mydb"})," \u548c ",(0,s.jsx)(n.code,{children:"myservice"})," svc\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u518d\u6b21\u67e5\u770bmyapp-pod\u4e2d\u5bb9\u5668\u65e5\u5fd7"]}),"\n",(0,s.jsx)(n.p,{children:"init-myservice\u5bb9\u5668\u65e5\u5fd7"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"$ kubectl logs myapp-pod -c init-myservice\n...\nName:      myservice.test.svc.cluster.local\nAddress 1: 10.101.113.34 myservice.test.svc.cluster.local\n"})}),"\n",(0,s.jsx)(n.p,{children:"init-mydb\u5bb9\u5668\u65e5\u5fd7"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"$ kubectl logs myapp-pod -c init-mydb\nServer:    10.96.0.10\nAddress 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local\n\nName:      mydb.test.svc.cluster.local\nAddress 1: 10.108.52.122 mydb.test.svc.cluster.local\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u53ef\u4ee5\u770b\u5230\uff0c2\u4e2ainit\u5bb9\u5668\u5747\u5df2\u6210\u529f\u8fd0\u884c"}),"\n",(0,s.jsx)(n.h2,{id:"\u521b\u5efa\u4e00\u4e2a\u5305\u542b-init-\u5bb9\u5668\u7684-pod",children:"\u521b\u5efa\u4e00\u4e2a\u5305\u542b Init \u5bb9\u5668\u7684 Pod"}),"\n",(0,s.jsx)(n.p,{children:"\u672c\u4f8b\u4e2d\u4f60\u5c06\u521b\u5efa\u4e00\u4e2a\u5305\u542b\u4e00\u4e2a\u5e94\u7528\u5bb9\u5668\u548c\u4e00\u4e2a Init \u5bb9\u5668\u7684 Pod\u3002Init \u5bb9\u5668\u5728\u5e94\u7528\u5bb9\u5668\u542f\u52a8\u524d\u8fd0\u884c\u5b8c\u6210\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u7f16\u8f91yaml\u6587\u4ef6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'cat > init-containers.yaml << EOF\napiVersion: v1\nkind: Pod\nmetadata:\n  name: init-demo\nspec:\n  containers:\n  - name: nginx\n    image: nginx\n    ports:\n    - containerPort: 80\n    volumeMounts:\n    - name: workdir\n      mountPath: /usr/share/nginx/html\n  # \u8fd9\u4e9b\u5bb9\u5668\u5728 Pod \u521d\u59cb\u5316\u671f\u95f4\u8fd0\u884c\n  initContainers:\n  - name: install\n    image: busybox:1.28\n    command:\n    - wget\n    - "-O"\n    - "/work-dir/index.html"\n    - http://info.cern.ch\n    volumeMounts:\n    - name: workdir\n      mountPath: "/work-dir"\n  dnsPolicy: Default\n  volumes:\n  - name: workdir\n    emptyDir: {}\nEOF\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\u5e94\u7528\u5bb9\u5668\u548c Init \u5bb9\u5668\u5171\u4eab\u4e86\u4e00\u4e2a\u5377\u3002Init \u5bb9\u5668\u5c06\u5171\u4eab\u5377\u6302\u8f7d\u5230\u4e86 ",(0,s.jsx)(n.code,{children:"/work-dir"})," \u76ee\u5f55\uff0c\u5e94\u7528\u5bb9\u5668\u5c06\u5171\u4eab\u5377\u6302\u8f7d\u5230\u4e86 ",(0,s.jsx)(n.code,{children:"/usr/share/nginx/html"})," \u76ee\u5f55\u3002 Init \u5bb9\u5668\u6267\u884c\u5b8c\u4e0b\u9762\u7684\u547d\u4ee4\u5c31\u7ec8\u6b62\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"wget -O /work-dir/index.html http://info.cern.ch\n"})}),"\n",(0,s.jsxs)(n.p,{children:["init \u5bb9\u5668\u5728 nginx \u670d\u52a1\u5668\u7684\u6839\u76ee\u5f55\u5199\u5165 ",(0,s.jsx)(n.code,{children:"index.html"}),"\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efapod"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f init-containers.yaml \n"})}),"\n",(0,s.jsx)(n.p,{children:"\u67e5\u770bpod"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"$ kubectl get pod init-demo \nNAME        READY   STATUS    RESTARTS   AGE\ninit-demo   1/1     Running   0          40s\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u67e5\u770bpod\u4e2d\u7684nginx\u5bb9\u5668\u4e0b ",(0,s.jsx)(n.code,{children:"/usr/share/nginx/html/index.html"})," \u5185\u5bb9"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'$ kubectl exec init-demo -it -- cat /usr/share/nginx/html/index.html\nDefaulted container "nginx" out of: nginx, install (init)\n<html><head></head><body><header>\n<title>http://info.cern.ch</title>\n</header>\n\n<h1>http://info.cern.ch - home of the first website</h1>\n<p>From here you can:</p>\n<ul>\n<li><a href="http://info.cern.ch/hypertext/WWW/TheProject.html">Browse the first website</a></li>\n<li><a href="http://line-mode.cern.ch/www/hypertext/WWW/TheProject.html">Browse the first website using the line-mode browser simulator</a></li>\n<li><a href="http://home.web.cern.ch/topics/birth-web">Learn about the birth of the web</a></li>\n<li><a href="http://home.web.cern.ch/about">Learn about CERN, the physics laboratory where the web was born</a></li>\n</ul>\n</body></html>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u4ee5\u4e0a\u7ed3\u679c\u8bf4\u660einit\u5bb9\u5668\u5728\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u8fd0\u884c\u4e4b\u524d\u8fd0\u884c\uff0cInit \u5bb9\u5668\u5c06\u5171\u4eab\u5377\u6302\u8f7d\u5230\u4e86 ",(0,s.jsx)(n.code,{children:"/work-dir"})," \u76ee\u5f55\uff0c\u5e94\u7528\u5bb9\u5668\u5c06\u5171\u4eab\u5377\u6302\u8f7d\u5230\u4e86 ",(0,s.jsx)(n.code,{children:"/usr/share/nginx/html"})," \u76ee\u5f55"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>d});var s=i(96540);const r={},t=s.createContext(r);function c(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);