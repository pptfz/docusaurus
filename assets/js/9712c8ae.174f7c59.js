"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[6025],{10954:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>c,metadata:()=>d,toc:()=>a});var o=r(74848),t=r(28453);const c={},s="docker\u8de8\u4e3b\u673a\u901a\u4fe1\u4e4boverlay",d={id:"\u4e91\u539f\u751f/\u5bb9\u5668/docker/docker\u8de8\u4e3b\u673a\u901a\u4fe1\u4e4boverlay",title:"docker\u8de8\u4e3b\u673a\u901a\u4fe1\u4e4boverlay",description:"[toc]",source:"@site/docs/\u4e91\u539f\u751f/\u5bb9\u5668/docker/docker\u8de8\u4e3b\u673a\u901a\u4fe1\u4e4boverlay.md",sourceDirName:"\u4e91\u539f\u751f/\u5bb9\u5668/docker",slug:"/\u4e91\u539f\u751f/\u5bb9\u5668/docker/docker\u8de8\u4e3b\u673a\u901a\u4fe1\u4e4boverlay",permalink:"/docs/\u4e91\u539f\u751f/\u5bb9\u5668/docker/docker\u8de8\u4e3b\u673a\u901a\u4fe1\u4e4boverlay",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"docker\u8de8\u4e3b\u673a\u901a\u4fe1\u4e4bmacvlan",permalink:"/docs/\u4e91\u539f\u751f/\u5bb9\u5668/docker/docker\u8de8\u4e3b\u673a\u901a\u4fe1\u4e4bmacvlan"},next:{title:"registry\u79c1\u6709\u4ed3\u5e93",permalink:"/docs/\u4e91\u539f\u751f/\u5bb9\u5668/docker/registry\u79c1\u6709\u4ed3\u5e93"}},l={},a=[{value:"1.overlay\u8bf4\u660e",id:"1overlay\u8bf4\u660e",level:2},{value:"2.overlay\u8de8\u4e3b\u673a\u901a\u4fe1\u793a\u4f8b",id:"2overlay\u8de8\u4e3b\u673a\u901a\u4fe1\u793a\u4f8b",level:2},{value:"2.1 \u5b9e\u9a8c\u73af\u5883",id:"21-\u5b9e\u9a8c\u73af\u5883",level:3},{value:"2.2 docker01\u64cd\u4f5c",id:"22-docker01\u64cd\u4f5c",level:3},{value:"2.2.1 \u542f\u52a8consul\u5bb9\u5668",id:"221-\u542f\u52a8consul\u5bb9\u5668",level:4},{value:"2.2.2 \u67e5\u770b\u5bb9\u5668\uff0c\u5bb9\u5668\u6620\u5c04\u4e86\u597d\u591a\u7aef\u53e3",id:"222-\u67e5\u770b\u5bb9\u5668\u5bb9\u5668\u6620\u5c04\u4e86\u597d\u591a\u7aef\u53e3",level:4},{value:"2.2.3 \u5bb9\u5668\u542f\u52a8\u540e\u53ef\u4ee5\u8bbf\u95ee\u4e00\u4e2aweb\u754c\u9762",id:"223-\u5bb9\u5668\u542f\u52a8\u540e\u53ef\u4ee5\u8bbf\u95ee\u4e00\u4e2aweb\u754c\u9762",level:4},{value:"2.2.4 \u4fee\u6539docker\u914d\u7f6e\u6587\u4ef6 <code>/etc/docker/daemon.json</code>",id:"224-\u4fee\u6539docker\u914d\u7f6e\u6587\u4ef6-etcdockerdaemonjson",level:4},{value:"2.3 docker02\u64cd\u4f5c",id:"23-docker02\u64cd\u4f5c",level:3},{value:"2.3.1 \u542f\u52a8consul\u5bb9\u5668",id:"231-\u542f\u52a8consul\u5bb9\u5668",level:4},{value:"2.3.2 \u67e5\u770b\u5bb9\u5668\uff0c\u5bb9\u5668\u6620\u5c04\u4e86\u597d\u591a\u7aef\u53e3",id:"232-\u67e5\u770b\u5bb9\u5668\u5bb9\u5668\u6620\u5c04\u4e86\u597d\u591a\u7aef\u53e3",level:4},{value:"2.3.3 \u5bb9\u5668\u542f\u52a8\u540e\u53ef\u4ee5\u8bbf\u95ee\u4e00\u4e2aweb\u754c\u9762",id:"233-\u5bb9\u5668\u542f\u52a8\u540e\u53ef\u4ee5\u8bbf\u95ee\u4e00\u4e2aweb\u754c\u9762",level:4},{value:"2.3.4 \u4fee\u6539docker\u914d\u7f6e\u6587\u4ef6 <code>/etc/docker/daemon.json</code>",id:"234-\u4fee\u6539docker\u914d\u7f6e\u6587\u4ef6-etcdockerdaemonjson",level:4},{value:"2.3.5 \u6700\u7ec8\u6548\u679c",id:"235-\u6700\u7ec8\u6548\u679c",level:4},{value:"2.4 \u901a\u4fe1\u6d4b\u8bd5",id:"24-\u901a\u4fe1\u6d4b\u8bd5",level:3},{value:"2.4.1 docker01\u521b\u5efaoverlay\u7f51\u7edc\uff0c\u4f1a\u81ea\u52a8\u540c\u6b65\u5230docker02\uff0c\u56e0\u4e3adocker01\u548cdocker02\u90fd\u5728consul\u96c6\u7fa4\u4e2d",id:"241-docker01\u521b\u5efaoverlay\u7f51\u7edc\u4f1a\u81ea\u52a8\u540c\u6b65\u5230docker02\u56e0\u4e3adocker01\u548cdocker02\u90fd\u5728consul\u96c6\u7fa4\u4e2d",level:4},{value:"2.4.2 docker01\u542f\u52a8\u5bb9\u5668overlay1",id:"242-docker01\u542f\u52a8\u5bb9\u5668overlay1",level:4},{value:"2.4.3 docker02\u542f\u52a8\u5bb9\u5668overlay2",id:"243-docker02\u542f\u52a8\u5bb9\u5668overlay2",level:4},{value:"2.4.4 \u6d4b\u8bd5\u5bb9\u5668\u4e92\u901a\u53ca\u8fde\u63a5\u5916\u7f51",id:"244-\u6d4b\u8bd5\u5bb9\u5668\u4e92\u901a\u53ca\u8fde\u63a5\u5916\u7f51",level:4},{value:"3.overlay\u7f51\u7edc\u7c7b\u578b\u7684\u5bb9\u5668\u7f51\u5361\u95ee\u9898",id:"3overlay\u7f51\u7edc\u7c7b\u578b\u7684\u5bb9\u5668\u7f51\u5361\u95ee\u9898",level:2},{value:"3.1 \u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u7f51\u7edc\u7c7b\u578b\u4e3aoverlay\u7684\u5bb9\u5668\u6709\u4e24\u5757\u7f51\u5361eth0\u3001eth1",id:"31-\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\u540e\u53ef\u4ee5\u770b\u5230\u7f51\u7edc\u7c7b\u578b\u4e3aoverlay\u7684\u5bb9\u5668\u6709\u4e24\u5757\u7f51\u5361eth0eth1",level:3},{value:"4.overlay\u7f51\u7edc\u7c7b\u578b\u7f51\u7edc\u547d\u540d\u7a7a\u95f4",id:"4overlay\u7f51\u7edc\u7c7b\u578b\u7f51\u7edc\u547d\u540d\u7a7a\u95f4",level:2}];function i(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"[toc]"}),"\n",(0,o.jsx)(n.h1,{id:"docker\u8de8\u4e3b\u673a\u901a\u4fe1\u4e4boverlay",children:"docker\u8de8\u4e3b\u673a\u901a\u4fe1\u4e4boverlay"}),"\n",(0,o.jsx)(n.h2,{id:"1overlay\u8bf4\u660e",children:"1.overlay\u8bf4\u660e"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"overlay\u4f18\u70b9"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"\u4f1a\u81ea\u52a8\u5206\u914dIP\u5730\u5740\uff0c\u9700\u8981consul\u6570\u636e\u5e93"})}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"\u7f51\u7edc\u7c7b\u578b\u4e3aoverlay\u7684\u5bb9\u5668\u9ed8\u8ba4\u6709\u4e24\u5757\u7f51\u5361"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"eth0\t\t\u7528\u4e8e\u8de8\u4e3b\u673a\u95f4\u5bb9\u5668\u901a\u4fe1"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"eth1\t\t\u7528\u4e8e\u8fde\u63a5\u5916\u7f51"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"\u7f51\u5173\u9ed8\u8ba4\u4e3a172.18.0.1\uff0c\u662f\u5bbf\u4e3b\u673adocker_gwbridge\u7f51\u5361\u7684IP\u5730\u5740"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"overlay\u7f51\u7edc\u8de8\u4e3b\u673a\u901a\u4fe1\u793a\u610f\u56fe"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-10-15%2014.33.00.png",alt:"iShot2020-10-15 14.33.00"})}),"\n",(0,o.jsx)(n.h2,{id:"2overlay\u8de8\u4e3b\u673a\u901a\u4fe1\u793a\u4f8b",children:"2.overlay\u8de8\u4e3b\u673a\u901a\u4fe1\u793a\u4f8b"}),"\n",(0,o.jsx)(n.h3,{id:"21-\u5b9e\u9a8c\u73af\u5883",children:"2.1 \u5b9e\u9a8c\u73af\u5883"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"\u4e3b\u673a\u540d"}),(0,o.jsx)(n.th,{children:"IP"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"docker01"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"10.0.0.60"})})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"docker02"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"10.0.0.61"})})]})]})]}),"\n",(0,o.jsx)(n.h3,{id:"22-docker01\u64cd\u4f5c",children:"2.2 docker01\u64cd\u4f5c"}),"\n",(0,o.jsx)(n.h4,{id:"221-\u542f\u52a8consul\u5bb9\u5668",children:"2.2.1 \u542f\u52a8consul\u5bb9\u5668"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"[root@docker01 ~]# docker run -d -p 8500:8500 -h consul --name consul --restart=always progrium/consul -server -bootstrap\n"})}),"\n",(0,o.jsx)(n.h4,{id:"222-\u67e5\u770b\u5bb9\u5668\u5bb9\u5668\u6620\u5c04\u4e86\u597d\u591a\u7aef\u53e3",children:"2.2.2 \u67e5\u770b\u5bb9\u5668\uff0c\u5bb9\u5668\u6620\u5c04\u4e86\u597d\u591a\u7aef\u53e3"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'[root@docker01 ~]# docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                                            NAMES\n84c733c42a91        progrium/consul     "/bin/start -server \u2026"   24 seconds ago      Up 23 seconds       53/tcp, 53/udp, 8300-8302/tcp, 8400/tcp, 8301-8302/udp, 0.0.0.0:8500->8500/tcp   consul\n'})}),"\n",(0,o.jsx)(n.h4,{id:"223-\u5bb9\u5668\u542f\u52a8\u540e\u53ef\u4ee5\u8bbf\u95ee\u4e00\u4e2aweb\u754c\u9762",children:"2.2.3 \u5bb9\u5668\u542f\u52a8\u540e\u53ef\u4ee5\u8bbf\u95ee\u4e00\u4e2aweb\u754c\u9762"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"10.0.0.60:8500"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-10-15%2014.37.47.png",alt:"iShot2020-10-15 14.37.47"})}),"\n",(0,o.jsxs)(n.h4,{id:"224-\u4fee\u6539docker\u914d\u7f6e\u6587\u4ef6-etcdockerdaemonjson",children:["2.2.4 \u4fee\u6539docker\u914d\u7f6e\u6587\u4ef6 ",(0,o.jsx)(n.code,{children:"/etc/docker/daemon.json"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'1.\u4fee\u6539\u914d\u7f6e\u6587\u4ef6/etc/docker/daemon.json\uff0c\u52a0\u5165\u4ee5\u4e0b\u4e09\u884c\n"hosts":["tcp://0.0.0.0:2376","unix:///var/run/docker.sock"],\n"cluster-store": "consul://10.0.0.60:8500",\n"cluster-advertise": "10.0.0.60:2376"\n\n\n#\u53c2\u6570\u8bf4\u660e\n"hosts":["tcp://0.0.0.0:2376","unix:///var/run/docker.sock"],                //\u672c\u5730\u76d1\u542ctcp2376\u7aef\u53e3\uff0c\u540c\u65f6\u6307\u5b9asock\u6587\u4ef6\n"cluster-store": "consul://10.0.0.60:8500",                                  //\u96c6\u7fa4\u4fe1\u606f\u5b58\u653e\u4f4d\u7f6e,\u8fd9\u91cc\u4e3adocker01 10.0.0.60\n"cluster-advertise": "10.0.0.60:2376"                                       //\u5ba2\u6237\u673a\u81ea\u8eabIP\u5730\u5740,\u8fd9\u91cc\u4e3adocker01 10.0.0.60\n\n2.\u4fee\u6539docker\u670d\u52a1\u542f\u52a8\u6587\u4ef6\uff0c\u5426\u5219\u540e\u7eed\u91cd\u542fdocker\u4f1a\u62a5\u9519\n[root@docker01 ~]# vim /usr/lib/systemd/system/docker.service \n\u4fee\u6539   ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock\n\u4fee\u6539\u4e3a ExecStart=/usr/bin/dockerd \n\n3.\u91cd\u542fdocker\n[root@docker01 ~]# systemctl daemon-reload && systemctl restart docker\n'})}),"\n",(0,o.jsx)(n.h3,{id:"23-docker02\u64cd\u4f5c",children:"2.3 docker02\u64cd\u4f5c"}),"\n",(0,o.jsx)(n.h4,{id:"231-\u542f\u52a8consul\u5bb9\u5668",children:"2.3.1 \u542f\u52a8consul\u5bb9\u5668"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"[root@docker02 ~]# docker run -d -p 8500:8500 -h consul --name consul --restart=always progrium/consul -server -bootstrap\n"})}),"\n",(0,o.jsx)(n.h4,{id:"232-\u67e5\u770b\u5bb9\u5668\u5bb9\u5668\u6620\u5c04\u4e86\u597d\u591a\u7aef\u53e3",children:"2.3.2 \u67e5\u770b\u5bb9\u5668\uff0c\u5bb9\u5668\u6620\u5c04\u4e86\u597d\u591a\u7aef\u53e3"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'[root@docker02 ~]# docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                                            NAMES\na793cf0b4aed        progrium/consul     "/bin/start -server \u2026"   37 seconds ago      Up 35 seconds       53/tcp, 53/udp, 8300-8302/tcp, 8400/tcp, 8301-8302/udp, 0.0.0.0:8500->8500/tcp   consul\n'})}),"\n",(0,o.jsx)(n.h4,{id:"233-\u5bb9\u5668\u542f\u52a8\u540e\u53ef\u4ee5\u8bbf\u95ee\u4e00\u4e2aweb\u754c\u9762",children:"2.3.3 \u5bb9\u5668\u542f\u52a8\u540e\u53ef\u4ee5\u8bbf\u95ee\u4e00\u4e2aweb\u754c\u9762"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"10.0.0.61:8500"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-10-15%2014.37.47.png",alt:"iShot2020-10-15 14.37.47"})}),"\n",(0,o.jsxs)(n.h4,{id:"234-\u4fee\u6539docker\u914d\u7f6e\u6587\u4ef6-etcdockerdaemonjson",children:["2.3.4 \u4fee\u6539docker\u914d\u7f6e\u6587\u4ef6 ",(0,o.jsx)(n.code,{children:"/etc/docker/daemon.json"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'1.\u4fee\u6539\u914d\u7f6e\u6587\u4ef6/etc/docker/daemon.json\uff0c\u52a0\u5165\u4ee5\u4e0b\u4e09\u884c\n"hosts":["tcp://0.0.0.0:2376","unix:///var/run/docker.sock"],\n"cluster-store": "consul://10.0.0.60:8500",\n"cluster-advertise": "10.0.0.60:2376"\n\n\n#\u53c2\u6570\u8bf4\u660e\n"hosts":["tcp://0.0.0.0:2376","unix:///var/run/docker.sock"],                //\u672c\u5730\u76d1\u542ctcp2376\u7aef\u53e3\uff0c\u540c\u65f6\u6307\u5b9asock\u6587\u4ef6\n"cluster-store": "consul://10.0.0.60:8500",                                  //\u96c6\u7fa4\u4fe1\u606f\u5b58\u653e\u4f4d\u7f6e\uff0c\u8fd9\u91cc\u4e3adocker01 10.0.0.60\n"cluster-advertise": "10.0.0.61:2376"                                       //\u5ba2\u6237\u673a\u81ea\u8eabIP\u5730\u5740\uff0c\u8fd9\u91cc\u4e3adocker02 10.0.0.61\n\n2.\u4fee\u6539docker\u670d\u52a1\u542f\u52a8\u6587\u4ef6\uff0c\u5426\u5219\u540e\u7eed\u91cd\u542fdocker\u4f1a\u62a5\u9519\n[root@docker02 ~]# vim /usr/lib/systemd/system/docker.service \n\u4fee\u6539   ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock\n\u4fee\u6539\u4e3a ExecStart=/usr/bin/dockerd \n\n3.\u91cd\u542fdocker\n[root@docker02 ~]# systemctl daemon-reload && systemctl restart docker\n'})}),"\n",(0,o.jsx)(n.h4,{id:"235-\u6700\u7ec8\u6548\u679c",children:"2.3.5 \u6700\u7ec8\u6548\u679c"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"\u8bbf\u95eedocker1 consul\u7684web\u754c\u9762\tKEY/VALUE--\x3edocker--\x3enodes\t\u6b63\u786e\u60c5\u51b5\u4e3a\u51fa\u73b0\u4e24\u4e2adocker\u8282\u70b9"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-10-15%2014.38.38.png",alt:"iShot2020-10-15 14.38.38"})}),"\n",(0,o.jsx)("span",{style:{color:"red"},children:(0,o.jsx)(n.strong,{children:"\u5230\u6b64\uff0c\u57fa\u7840\u73af\u5883\u914d\u7f6e\u5b8c\u6210\uff01\uff01\uff01"})}),"\n",(0,o.jsx)(n.h3,{id:"24-\u901a\u4fe1\u6d4b\u8bd5",children:"2.4 \u901a\u4fe1\u6d4b\u8bd5"}),"\n",(0,o.jsx)(n.h4,{id:"241-docker01\u521b\u5efaoverlay\u7f51\u7edc\u4f1a\u81ea\u52a8\u540c\u6b65\u5230docker02\u56e0\u4e3adocker01\u548cdocker02\u90fd\u5728consul\u96c6\u7fa4\u4e2d",children:"2.4.1 docker01\u521b\u5efaoverlay\u7f51\u7edc\uff0c\u4f1a\u81ea\u52a8\u540c\u6b65\u5230docker02\uff0c\u56e0\u4e3adocker01\u548cdocker02\u90fd\u5728consul\u96c6\u7fa4\u4e2d"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"1.docker01\u521b\u5efaoverlay\u7f51\u7edc\n[root@docker01 ~]# docker network create -d overlay --subnet 172.16.1.0/24 --gateway 172.16.1.254 overlay1\n7a836393a60d6f87bd0053b2d75198a60960db8a98a34488d145eef1fef35711\n\n2.\u67e5\u770b\u521b\u5efa\u7684\u7f51\u7edc\uff0c\u540d\u79f0\u4e3aoverlay\uff0c\u7c7b\u578b\u4e3aglobal\uff0c\u4e0e\u5176\u4f59\u7f51\u7edc\u7c7b\u578b\u4e0d\u4e00\u6837\n[root@docker01 ~]# docker network ls\nNETWORK ID          NAME                DRIVER              SCOPE\nd25efee562f5        bridge              bridge              local\n1c11b715a65c        host                host                local\nb0ddd6fd07ed        macvlan_1           macvlan             local\n74d6b08c35c5        none                null                local\n7a836393a60d        overlay1            overlay             global\n\n3.docker02\u67e5\u770b\u7f51\u7edc\uff0c\u53ef\u4ee5\u770b\u5230docker01\u521b\u5efa\u7684overlay\u7f51\u7edc\u81ea\u52a8\u540c\u6b65\u5230\u4e86docker02\n[root@docker02 ~]# docker network ls\nNETWORK ID          NAME                DRIVER              SCOPE\n59e0e535367b        bridge              bridge              local\nc464712c8392        host                host                local\n7d9727dd0d2d        macvlan_1           macvlan             local\nbe782cbc19a4        none                null                local\n7a836393a60d        overlay1            overlay             global\n"})}),"\n",(0,o.jsx)(n.h4,{id:"242-docker01\u542f\u52a8\u5bb9\u5668overlay1",children:"2.4.2 docker01\u542f\u52a8\u5bb9\u5668overlay1"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"1.\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\uff0c\u6307\u5b9a\u7f51\u7edc\u4e3a\u4e4b\u524d\u521b\u5efa\u7684overlay1\n[root@docker01 ~]# docker run -it --net overlay1 --name overlay1 busybox:latest /bin/sh\n\n2.\u67e5\u770bIP\u5730\u5740\uff0cIP\u5730\u5740\u4e3a172.16.1.1\uff0c\u56e0\u4e3a\u4e4b\u524d\u521b\u5efaoverlay\u7f51\u7edc\u7684\u65f6\u5019\u6307\u5b9a\u4e86\u7f51\u6bb5\u4e3a172.16.1.0/24\n/ # ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n46: eth0@if47: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1450 qdisc noqueue \n    link/ether 02:42:ac:10:01:01 brd ff:ff:ff:ff:ff:ff\n    inet 172.16.1.1/24 brd 172.16.1.255 scope global eth0\n       valid_lft forever preferred_lft forever\n49: eth1@if50: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1500 qdisc noqueue \n    link/ether 02:42:ac:12:00:02 brd ff:ff:ff:ff:ff:ff\n    inet 172.18.0.2/16 brd 172.18.255.255 scope global eth1\n       valid_lft forever preferred_lft forever\n"})}),"\n",(0,o.jsx)(n.h4,{id:"243-docker02\u542f\u52a8\u5bb9\u5668overlay2",children:"2.4.3 docker02\u542f\u52a8\u5bb9\u5668overlay2"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"1.\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\uff0c\u6307\u5b9a\u7f51\u7edc\u4e3a\u4e4b\u524d\u521b\u5efa\u7684overlay1\n[root@docker02 ~]# docker run -it --net overlay1 --name overlay2 busybox:latest /bin/sh\n\n2.\u67e5\u770bIP\u5730\u5740\uff0cIP\u5730\u5740\u4e3a172.16.1.2\uff0c\u56e0\u4e3a\u4e4b\u524d\u521b\u5efaoverlay\u7f51\u7edc\u7684\u65f6\u5019\u6307\u5b9a\u4e86\u7f51\u6bb5\u4e3a172.16.1.0/24\n/ # ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n12: eth0@if13: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1450 qdisc noqueue \n    link/ether 02:42:ac:10:01:02 brd ff:ff:ff:ff:ff:ff\n    inet 172.16.1.2/24 brd 172.16.1.255 scope global eth0\n       valid_lft forever preferred_lft forever\n15: eth1@if16: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1500 qdisc noqueue \n    link/ether 02:42:ac:12:00:02 brd ff:ff:ff:ff:ff:ff\n    inet 172.18.0.2/16 brd 172.18.255.255 scope global eth1\n       valid_lft forever preferred_lft forever\n"})}),"\n",(0,o.jsx)(n.h4,{id:"244-\u6d4b\u8bd5\u5bb9\u5668\u4e92\u901a\u53ca\u8fde\u63a5\u5916\u7f51",children:"2.4.4 \u6d4b\u8bd5\u5bb9\u5668\u4e92\u901a\u53ca\u8fde\u63a5\u5916\u7f51"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"docker01\u6d4b\u8bd5\n1.ping docker02\u542f\u52a8\u7684\u5bb9\u5668overlay2\n/ # ping -c 2 172.16.1.2\nPING 172.16.1.2 (172.16.1.2): 56 data bytes\n64 bytes from 172.16.1.2: seq=0 ttl=64 time=0.831 ms\n64 bytes from 172.16.1.2: seq=1 ttl=64 time=0.437 ms\n\n--- 172.16.1.2 ping statistics ---\n2 packets transmitted, 2 packets received, 0% packet loss\nround-trip min/avg/max = 0.437/0.634/0.831 ms\n\n2.\u4e5f\u53ef\u4ee5ping\u5bb9\u5668\u540d\u79f0\uff0c\u5bb9\u5668\u540d\u79f0\u5b58\u653e\u4e8econsul\u96c6\u7fa4\u4e2d\n/ # ping -c 2 overlay2\nPING overlay2 (172.16.1.2): 56 data bytes\n64 bytes from 172.16.1.2: seq=0 ttl=64 time=0.704 ms\n64 bytes from 172.16.1.2: seq=1 ttl=64 time=0.453 ms\n\n--- overlay2 ping statistics ---\n2 packets transmitted, 2 packets received, 0% packet loss\nround-trip min/avg/max = 0.453/0.578/0.704 ms\n\n3.\u8fde\u63a5\u5916\u7f51\n/ # ping -c 2 www.baidu.com\nPING www.baidu.com (61.135.169.121): 56 data bytes\n64 bytes from 61.135.169.121: seq=0 ttl=127 time=4.863 ms\n64 bytes from 61.135.169.121: seq=1 ttl=127 time=5.121 ms\n\n--- www.baidu.com ping statistics ---\n2 packets transmitted, 2 packets received, 0% packet loss\nround-trip min/avg/max = 4.863/4.992/5.121 ms\n\n\ndocker02\u6d4b\u8bd5\n1.ping docker01\u542f\u52a8\u7684\u5bb9\u5668overlay1\n/ # ping -c 2 172.16.1.1\nPING 172.16.1.1 (172.16.1.1): 56 data bytes\n64 bytes from 172.16.1.1: seq=0 ttl=64 time=0.755 ms\n64 bytes from 172.16.1.1: seq=1 ttl=64 time=0.660 ms\n\n--- 172.16.1.1 ping statistics ---\n2 packets transmitted, 2 packets received, 0% packet loss\nround-trip min/avg/max = 0.660/0.707/0.755 ms\n\n2.\u4e5f\u53ef\u4ee5ping\u5bb9\u5668\u540d\u79f0\uff0c\u5bb9\u5668\u540d\u79f0\u5b58\u653e\u4e8econsul\u96c6\u7fa4\u4e2d\n/ # ping -c 2 overlay1\nPING overlay1 (172.16.1.1): 56 data bytes\n64 bytes from 172.16.1.1: seq=0 ttl=64 time=0.900 ms\n64 bytes from 172.16.1.1: seq=1 ttl=64 time=0.561 ms\n\n--- overlay1 ping statistics ---\n2 packets transmitted, 2 packets received, 0% packet loss\nround-trip min/avg/max = 0.561/0.730/0.900 ms\n\n\n3.\u8fde\u63a5\u5916\u7f51\n/ # ping -c 2 www.baidu.com\nPING www.baidu.com (61.135.169.125): 56 data bytes\n64 bytes from 61.135.169.125: seq=0 ttl=127 time=5.063 ms\n64 bytes from 61.135.169.125: seq=1 ttl=127 time=4.792 ms\n\n--- www.baidu.com ping statistics ---\n2 packets transmitted, 2 packets received, 0% packet loss\nround-trip min/avg/max = 4.792/4.927/5.063 ms\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:(0,o.jsx)("span",{style:{color:"red"},children:"\u5230\u6b64\uff0c\u8de8\u4e3b\u673a\u95f4\u5bb9\u5668\u901a\u4fe1\u5b8c\u6210\uff01\uff01\uff01"})})}),"\n",(0,o.jsx)(n.h2,{id:"3overlay\u7f51\u7edc\u7c7b\u578b\u7684\u5bb9\u5668\u7f51\u5361\u95ee\u9898",children:"3.overlay\u7f51\u7edc\u7c7b\u578b\u7684\u5bb9\u5668\u7f51\u5361\u95ee\u9898"}),"\n",(0,o.jsx)(n.h3,{id:"31-\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\u540e\u53ef\u4ee5\u770b\u5230\u7f51\u7edc\u7c7b\u578b\u4e3aoverlay\u7684\u5bb9\u5668\u6709\u4e24\u5757\u7f51\u5361eth0eth1",children:"3.1 \u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u7f51\u7edc\u7c7b\u578b\u4e3aoverlay\u7684\u5bb9\u5668\u6709\u4e24\u5757\u7f51\u5361eth0\u3001eth1"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"1.\u67e5\u770b\u5bb9\u5668IP\uff0c\u53d1\u73b0\u6709\u4e24\u5757\u7f51\u5361\neth0\u4e3a172.16.1.1\uff0c\u7528\u4e8e\u8de8\u4e3b\u673a\u5bb9\u5668\u95f4\u901a\u4fe1\neth1\u4e3a172.18.0.2\uff0c\u7528\u4e8e\u8fde\u63a5\u5916\u7f51\n/ # ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n46: eth0@if47: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1450 qdisc noqueue \n    link/ether 02:42:ac:10:01:01 brd ff:ff:ff:ff:ff:ff\n    inet 172.16.1.1/24 brd 172.16.1.255 scope global eth0\n       valid_lft forever preferred_lft forever\n49: eth1@if50: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1500 qdisc noqueue \n    link/ether 02:42:ac:12:00:02 brd ff:ff:ff:ff:ff:ff\n    inet 172.18.0.2/16 brd 172.18.255.255 scope global eth1\n       valid_lft forever preferred_lft forever\n\n\n2.\u67e5\u770b\u5bb9\u5668\u7f51\u5173\uff0c\u53ef\u4ee5\u770b\u5230\u5bb9\u5668\u7f51\u5173\u4e3a172.18.0\u30021\n/ # route -n\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n0.0.0.0         172.18.0.1      0.0.0.0         UG    0      0        0 eth1\n172.16.1.0      0.0.0.0         255.255.255.0   U     0      0        0 eth0\n172.18.0.0      0.0.0.0         255.255.0.0     U     0      0        0 eth1\n\n3.\u67e5\u770b\u5bbf\u4e3b\u673a\u7f51\u5361docker_gwbridge\uff0c\u53ef\u4ee5\u770b\u5230docker_gwbridge\u7684IP\u5730\u5740\u4e3a172.18.0.1\uff0c\u662f\u7f51\u7edc\u7c7b\u578b\u4e3aoverlay\u5bb9\u5668\u7684\u7f51\u5173\u5730\u5740\n[root@docker01 ~]# ifconfig docker_gwbridge\ndocker_gwbridge: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 172.18.0.1  netmask 255.255.0.0  broadcast 172.18.255.255\n        inet6 fe80::42:38ff:fea8:17e  prefixlen 64  scopeid 0x20<link>\n        ether 02:42:38:a8:01:7e  txqueuelen 0  (Ethernet)\n        RX packets 0  bytes 0 (0.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 0  bytes 0 (0.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n"})}),"\n",(0,o.jsx)(n.h2,{id:"4overlay\u7f51\u7edc\u7c7b\u578b\u7f51\u7edc\u547d\u540d\u7a7a\u95f4",children:"4.overlay\u7f51\u7edc\u7c7b\u578b\u7f51\u7edc\u547d\u540d\u7a7a\u95f4"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"namespace\u5b9e\u73b0\u7f51\u7edc\u73af\u5883\u9694\u79bb\uff0c\u7f51\u7edc\u547d\u4ee4\u7a7a\u95f4\u6709\u81ea\u5df1\u7684IP\u5730\u5740"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"1.\u67e5\u770b\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u9ed8\u8ba4\u4e3a\u7a7a\n[root@docker01 ~]# ip netns\n[root@docker01 ~]#  \n\n2.\u521b\u5efa\u76ee\u5f55\u8f6f\u8fde\u63a5\uff0cdocker01\u548cdocker02\u76f8\u540c\u64cd\u4f5c\n\u56e0\u4e3aip netns\u53ea\u80fd\u67e5\u770b\u5230/var/run/netns\u4e0b\u9762\u7684\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\uff0c\u800cdocker\u9ed8\u8ba4\u662f\u653e\u5728/var/run/docker/netns\uff0c\u56e0\u6b64\u9700\u8981\u505a\u76ee\u5f55\u8f6f\u8fde\u63a5\n[root@docker01 ~]# ln -s /var/run/docker/netns/ /var/run/netns\n\n3.\u67e5\u770b\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\uff0c\u53ef\u4ee5\u770b\u5230\u4e24\u4e2a\u5bb9\u5668\u95f4\u6709\u4e00\u4e2a\u76f8\u540c\u7684\u7f51\u7edc\u547d\u540d\u7a7a\u95f4   1-7a836393a6 (id: 1)\n#docker01\n[root@docker01 ~]# ip netns\n7ab4caaffca3 (id: 2)\n1-7a836393a6 (id: 1)\n7c88a1ff4a27 (id: 0)\n\n#docker02\n[root@docker02 ~]# ip netns\nb7bfd18ee204 (id: 2)\n1-7a836393a6 (id: 1)\n5eb2da02b6de (id: 0)\n\n4.\u8fdb\u5165\u5230\u8fd9\u4e2a\u76f8\u540c\u7684\u7f51\u7edc\u547d\u540d\u7a7a\u95f4(\u5982\u679c\u4e0d\u8fdb\u5165\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u5219\u65e0\u6cd5\u67e5\u770bvxlan\u7f51\u5361)\n[root@docker02 ~]# ip netns exec 1-7a836393a6 /bin/bash\n\n#\u67e5\u770bvxlan\u7f51\u5361\uff0c\u53ef\u4ee5\u770b\u5230\u6709br0\u3001lo\u3001veth0\u3001vxlan0\n\u5982\u679c\u542f\u52a8\u591a\u4e2a\u7f51\u7edc\u7c7b\u578b\u4e3aoverlay\u7684\u5bb9\u5668\uff0c\u5219\u4f1a\u6709\u591a\u4e2avethN,N\u4ee3\u8868\u6570\u5b57\n\u4e14br0\u7684IP\u5730\u5740\u4e3a172.16.1.254\uff0c\u5373\u4e3a\u521b\u5efaoverlay\u7f51\u7edc\u6307\u5b9a\u7684\u7f51\u6bb5\u7684\u7f51\u5173\u5730\u5740\n[root@docker02 ~]# ifconfig\nbr0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1450\n        inet 172.16.1.254  netmask 255.255.255.0  broadcast 172.16.1.255\n        ether 76:aa:f3:f4:77:17  txqueuelen 0  (Ethernet)\n        RX packets 1  bytes 28 (28.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 0  bytes 0 (0.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nlo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536\n        inet 127.0.0.1  netmask 255.0.0.0\n        loop  txqueuelen 1000  (Local Loopback)\n        RX packets 0  bytes 0 (0.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 0  bytes 0 (0.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nveth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1450\n        ether 76:aa:f3:f4:77:17  txqueuelen 0  (Ethernet)\n        RX packets 7  bytes 574 (574.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 7  bytes 574 (574.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nvxlan0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1450\n        ether be:5c:12:ff:1d:38  txqueuelen 0  (Ethernet)\n        RX packets 5  bytes 420 (420.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 5  bytes 420 (420.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\n\n#\u67e5\u770bbr0\n[root@docker02 ~]# brctl show\nbridge name\tbridge id\t\tSTP enabled\tinterfaces\nbr0\t\t8000.76aaf3f47717\tno\t\tveth0\n\t\t\t\t\t\t\t        vxlan0\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(i,{...e})}):i(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>d});var o=r(96540);const t={},c=o.createContext(t);function s(e){const n=o.useContext(c);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),o.createElement(c.Provider,{value:n},e.children)}}}]);