"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[9407],{90115:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>c,toc:()=>o});var l=s(74848),r=s(28453);const i={},a="CentOS7\u624b\u52a8\u5b89\u88c5OpenVPN",c={id:"linux/linux\u670d\u52a1/VPN/CentOS7\u624b\u52a8\u5b89\u88c5OpenVPN",title:"CentOS7\u624b\u52a8\u5b89\u88c5OpenVPN",description:"[toc]",source:"@site/docs/linux/linux\u670d\u52a1/VPN/CentOS7\u624b\u52a8\u5b89\u88c5OpenVPN.md",sourceDirName:"linux/linux\u670d\u52a1/VPN",slug:"/linux/linux\u670d\u52a1/VPN/CentOS7\u624b\u52a8\u5b89\u88c5OpenVPN",permalink:"/docs/linux/linux\u670d\u52a1/VPN/CentOS7\u624b\u52a8\u5b89\u88c5OpenVPN",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"CentOS7\u4e00\u952e\u5b89\u88c5OpenVPN",permalink:"/docs/linux/linux\u670d\u52a1/VPN/CentOS7\u4e00\u952e\u5b89\u88c5OpenVPN"},next:{title:"openvpn\u5bf9\u63a5ldap",permalink:"/docs/linux/linux\u670d\u52a1/VPN/openvpn\u5bf9\u63a5ldap"}},t={},o=[{value:"1.\u524d\u671f\u73af\u5883\u51c6\u5907",id:"1\u524d\u671f\u73af\u5883\u51c6\u5907",level:2},{value:"1.1 \u5b9e\u9a8c\u73af\u5883",id:"11-\u5b9e\u9a8c\u73af\u5883",level:3},{value:"1.2 OpenVPN\u673a\u5668\u914d\u7f6e\u5fc5\u8981\u4fee\u6539",id:"12-openvpn\u673a\u5668\u914d\u7f6e\u5fc5\u8981\u4fee\u6539",level:3},{value:"1.2.1 \u5f00\u542f\u8def\u7531\u8f6c\u53d1",id:"121-\u5f00\u542f\u8def\u7531\u8f6c\u53d1",level:4},{value:"1.2.2 iptables\u914d\u7f6e",id:"122-iptables\u914d\u7f6e",level:4},{value:"1.2.3 \u7cfb\u7edf\u65f6\u95f4\u4e0e\u786c\u4ef6\u65f6\u95f4\u540c\u6b65",id:"123-\u7cfb\u7edf\u65f6\u95f4\u4e0e\u786c\u4ef6\u65f6\u95f4\u540c\u6b65",level:4},{value:"2.\u5b89\u88c5\u8fc7\u7a0b",id:"2\u5b89\u88c5\u8fc7\u7a0b",level:2},{value:"2.1 \u5b89\u88c5\u4f9d\u8d56\u5305",id:"21-\u5b89\u88c5\u4f9d\u8d56\u5305",level:3},{value:"2.2 \u7f16\u8bd1\u5b89\u88c5openvpn",id:"22-\u7f16\u8bd1\u5b89\u88c5openvpn",level:3},{value:"2.2.1 \u4e0b\u8f7d\u6e90\u7801\u5305",id:"221-\u4e0b\u8f7d\u6e90\u7801\u5305",level:4},{value:"2.2.2 \u89e3\u538b\u7f29\u5e76\u8fdb\u5165\u6e90\u7801\u76ee\u5f55",id:"222-\u89e3\u538b\u7f29\u5e76\u8fdb\u5165\u6e90\u7801\u76ee\u5f55",level:4},{value:"2.2.3 \u5f00\u59cb\u7f16\u8bd1\u5b89\u88c5",id:"223-\u5f00\u59cb\u7f16\u8bd1\u5b89\u88c5",level:4},{value:"2.2.4 \u505a\u4e00\u4e0bopenvpn\u547d\u4ee4\u7684\u8f6f\u8fde\u63a5",id:"224-\u505a\u4e00\u4e0bopenvpn\u547d\u4ee4\u7684\u8f6f\u8fde\u63a5",level:4},{value:"2.2.5 \u67e5\u770bopenvpn\u7248\u672c",id:"225-\u67e5\u770bopenvpn\u7248\u672c",level:4},{value:"2.2.6 \u4fee\u6539\u542f\u52a8\u914d\u7f6e\u6587\u4ef6",id:"226-\u4fee\u6539\u542f\u52a8\u914d\u7f6e\u6587\u4ef6",level:4},{value:"2.2.7 \u62f7\u8d1dopenvpn systemd\u6587\u4ef6",id:"227-\u62f7\u8d1dopenvpn-systemd\u6587\u4ef6",level:4},{value:"2.3 \u751f\u6210\u8bc1\u4e66",id:"23-\u751f\u6210\u8bc1\u4e66",level:3},{value:"2.3.1 \u4e0b\u8f7d <code>easy-rsa</code> \u5de5\u5177",id:"231-\u4e0b\u8f7d-easy-rsa-\u5de5\u5177",level:4},{value:"2.3.2 \u751f\u6210\u5168\u5c40\u914d\u7f6e\u6587\u4ef6 <code>vars</code>",id:"232-\u751f\u6210\u5168\u5c40\u914d\u7f6e\u6587\u4ef6-vars",level:4},{value:"2.3.3 \u751f\u6210\u670d\u52a1\u7aef\u8bc1\u4e66\u548cCA\u8bc1\u4e66",id:"233-\u751f\u6210\u670d\u52a1\u7aef\u8bc1\u4e66\u548cca\u8bc1\u4e66",level:4},{value:"2.3.3.1 \u521d\u59cb\u5316",id:"2331-\u521d\u59cb\u5316",level:5},{value:"2.3.3.2 \u521b\u5efaCA\u6839\u8bc1\u4e66",id:"2332-\u521b\u5efaca\u6839\u8bc1\u4e66",level:5},{value:"2.3.3.3 \u751f\u6210\u670d\u52a1\u7aef\u8bc1\u4e66",id:"2333-\u751f\u6210\u670d\u52a1\u7aef\u8bc1\u4e66",level:5},{value:"2.3.3.4 \u521b\u5efa <code>Diffie-Hellman</code>",id:"2334-\u521b\u5efa-diffie-hellman",level:5},{value:"2.3.4 \u751f\u6210\u5ba2\u6237\u7aef\u8bc1\u4e66",id:"234-\u751f\u6210\u5ba2\u6237\u7aef\u8bc1\u4e66",level:4},{value:"2.3.4.1 \u751f\u6210\u5ba2\u6237\u7aef\u8bc1\u4e66",id:"2341-\u751f\u6210\u5ba2\u6237\u7aef\u8bc1\u4e66",level:5},{value:"2.3.4.2 \u4e3a\u4e86\u63d0\u9ad8\u5b89\u5168\u6027\uff0c\u751f\u6210ta.key",id:"2342-\u4e3a\u4e86\u63d0\u9ad8\u5b89\u5168\u6027\u751f\u6210takey",level:5},{value:"2.3.5 \u6574\u7406\u670d\u52a1\u7aef\u8bc1\u4e66",id:"235-\u6574\u7406\u670d\u52a1\u7aef\u8bc1\u4e66",level:4},{value:"2.4 \u521b\u5efa\u670d\u52a1\u7aef\u914d\u7f6e\u6587\u4ef6",id:"24-\u521b\u5efa\u670d\u52a1\u7aef\u914d\u7f6e\u6587\u4ef6",level:3},{value:"2.5 \u521b\u5efa\u5ba2\u6237\u7aef\u914d\u7f6e\u6587\u4ef6",id:"25-\u521b\u5efa\u5ba2\u6237\u7aef\u914d\u7f6e\u6587\u4ef6",level:3},{value:"2.6 \u542f\u52a8openvpn",id:"26-\u542f\u52a8openvpn",level:3},{value:"2.7 \u4e0b\u8f7d\u914d\u7f6e\u6587\u4ef6",id:"27-\u4e0b\u8f7d\u914d\u7f6e\u6587\u4ef6",level:3},{value:"2.8 \u8fde\u63a5\u6d4b\u8bd5",id:"28-\u8fde\u63a5\u6d4b\u8bd5",level:3},{value:"2.9 \u5f00\u901a\u3001\u5220\u9664vpn\u6b65\u9aa4",id:"29-\u5f00\u901a\u5220\u9664vpn\u6b65\u9aa4",level:3},{value:"2.9.1 \u5f00\u901avpn\u8d26\u6237",id:"291-\u5f00\u901avpn\u8d26\u6237",level:4},{value:"2.9.2 \u5220\u9664vpn\u8d26\u6237",id:"292-\u5220\u9664vpn\u8d26\u6237",level:4},{value:"2.10 \u6269\u5c55\uff1aopenvpn\u914d\u7f6e\u7528\u6237\u83b7\u53d6\u56fa\u5b9aIP\u5730\u5740",id:"210-\u6269\u5c55openvpn\u914d\u7f6e\u7528\u6237\u83b7\u53d6\u56fa\u5b9aip\u5730\u5740",level:4}];function p(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.p,{children:"[toc]"}),"\n",(0,l.jsx)(n.h1,{id:"centos7\u624b\u52a8\u5b89\u88c5openvpn",children:"CentOS7\u624b\u52a8\u5b89\u88c5OpenVPN"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"http://www.zhangblog.com/2020/05/09/openvpn01/",children:"\u53c2\u8003\u94fe\u63a5"})}),"\n",(0,l.jsx)(n.h2,{id:"1\u524d\u671f\u73af\u5883\u51c6\u5907",children:"1.\u524d\u671f\u73af\u5883\u51c6\u5907"}),"\n",(0,l.jsx)(n.h3,{id:"11-\u5b9e\u9a8c\u73af\u5883",children:"1.1 \u5b9e\u9a8c\u73af\u5883"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"OpenVPN\u8f6f\u4ef6\u7248\u672c 2.4.9"}),"\n"]}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u7cfb\u7edf"}),(0,l.jsx)(n.th,{children:"IP"}),(0,l.jsx)(n.th,{children:"\u516c\u7f51IP"}),(0,l.jsx)(n.th,{children:"\u914d\u7f6e"}),(0,l.jsx)(n.th,{children:"\u5185\u6838"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"CentOS7.9"}),(0,l.jsx)(n.td,{children:"172.16.0.71"}),(0,l.jsx)(n.td,{children:"8.8.8.8"}),(0,l.jsx)(n.td,{children:"1c1g"}),(0,l.jsx)(n.td,{children:"3.10.0-1160.11.1.el7.x86_64"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"mac\u672c\u673a"}),(0,l.jsx)(n.td,{children:"10.0.18.249"}),(0,l.jsx)(n.td,{children:"9.9.9.9"}),(0,l.jsx)(n.td,{children:"-"}),(0,l.jsx)(n.td,{children:"-"})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"12-openvpn\u673a\u5668\u914d\u7f6e\u5fc5\u8981\u4fee\u6539",children:"1.2 OpenVPN\u673a\u5668\u914d\u7f6e\u5fc5\u8981\u4fee\u6539"}),"\n",(0,l.jsx)(n.h4,{id:"121-\u5f00\u542f\u8def\u7531\u8f6c\u53d1",children:"1.2.1 \u5f00\u542f\u8def\u7531\u8f6c\u53d1"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u4e0d\u5b58\u5728\u5219\u914d\u7f6e\u8def\u7531\u8f6c\u53d1\ngrep 'net.ipv4.ip_forward = 1' /etc/sysctl.conf || echo 'net.ipv4.ip_forward = 1' >> /etc/sysctl.conf\n\n# \u4f7f\u914d\u7f6e\u751f\u6548\nsysctl -p\n"})}),"\n",(0,l.jsx)(n.h4,{id:"122-iptables\u914d\u7f6e",children:"1.2.2 iptables\u914d\u7f6e"}),"\n",(0,l.jsx)(n.p,{children:"\u8bbe\u7f6eiptables\u89c4\u5219"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u5ba2\u6237\u7aef\u8fde\u63a5vpn\u540e\uff0c\u9ed8\u8ba4\u5206\u914d 10.8.0.0/24\u7f51\u6bb5\uff0c\u9700\u8981\u8fdb\u884cnat\u8bbe\u7f6e\niptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE\n\n# \u914d\u7f6e\u5f00\u673a\u542f\u52a8\necho 'iptables -t nat -A POSTROUTING -s 10.7.0.0/24 -o eth0 -j MASQUERADE' >> /etc/rc.d/rc.local \n\n# \u7ed9rc.local\u6587\u4ef6\u589e\u52a0\u53ef\u6267\u884c\u6743\u9650\uff0c\u5426\u5219\u5f00\u673a\u4e0d\u4f1a\u6267\u884c\nchmod u+x /etc/rc.d/rc.local \n"})}),"\n",(0,l.jsx)(n.p,{children:"\u9a8c\u8bc1"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u9a8c\u8bc1\n$ iptables -L -n -t nat\nChain PREROUTING (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain POSTROUTING (policy ACCEPT)\ntarget     prot opt source               destination         \nMASQUERADE  all  --  10.8.0.0/24          0.0.0.0/0        \n"})}),"\n",(0,l.jsx)(n.p,{children:"\u5220\u9664\u4e0a\u8ff0iptables\u914d\u7f6e\u4fe1\u606f\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff0c\u53ef\u4ee5\u5bf9\u6bd4\u6b63\u5e38\u548c\u5f02\u5e38\u8bbf\u95ee"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"iptables -t nat -D POSTROUTING 1\n"})}),"\n",(0,l.jsx)(n.h4,{id:"123-\u7cfb\u7edf\u65f6\u95f4\u4e0e\u786c\u4ef6\u65f6\u95f4\u540c\u6b65",children:"1.2.3 \u7cfb\u7edf\u65f6\u95f4\u4e0e\u786c\u4ef6\u65f6\u95f4\u540c\u6b65"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u914d\u7f6e\u65f6\u95f4\u540c\u6b65\n$ crontab -l\n*/10 * * * * /usr/sbin/ntpdate ntp1.aliyun.com >/dev/null 2>&1\n\n# \u7cfb\u7edf\u4f7f\u7528\u4e0a\u6d77\u65f6\u95f4\n$ ll /etc/localtime\nlrwxrwxrwx. 1 root root 35 Mar  7  2019 /etc/localtime -> ../usr/share/zoneinfo/Asia/Shanghai\n\n# \u67e5\u770b\u786c\u4ef6\u65f6\u95f4\n$ hwclock --show \nThu 27 May 2021 02:49:25 PM CST  -0.109431 seconds\n\n# \u7cfb\u7edf\u65f6\u95f4\u540c\u6b65\u5230\u786c\u4ef6\u65f6\u95f4\nhwclock --systohc\n"})}),"\n",(0,l.jsx)(n.h2,{id:"2\u5b89\u88c5\u8fc7\u7a0b",children:"2.\u5b89\u88c5\u8fc7\u7a0b"}),"\n",(0,l.jsx)(n.h3,{id:"21-\u5b89\u88c5\u4f9d\u8d56\u5305",children:"2.1 \u5b89\u88c5\u4f9d\u8d56\u5305"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"yum -y install lz4-devel lzo-devel pam-devel openssl-devel systemd-devel sqlite-devel autoconf automake libtool libtool-ltdl\n"})}),"\n",(0,l.jsx)(n.h3,{id:"22-\u7f16\u8bd1\u5b89\u88c5openvpn",children:"2.2 \u7f16\u8bd1\u5b89\u88c5openvpn"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://github.com/OpenVPN/openvpn",children:"openvpn github\u5730\u5740"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://openvpn.net/",children:"openvpn\u5b98\u7f51"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://openvpn.net/community-downloads/",children:"openvpn\u5b98\u7f51\u6e90\u7801\u5305\u4e0b\u8f7d\u5730\u5740"})}),"\n",(0,l.jsx)(n.h4,{id:"221-\u4e0b\u8f7d\u6e90\u7801\u5305",children:"2.2.1 \u4e0b\u8f7d\u6e90\u7801\u5305"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"wget https://github.com/OpenVPN/openvpn/archive/v2.4.9.tar.gz\n"})}),"\n",(0,l.jsx)(n.h4,{id:"222-\u89e3\u538b\u7f29\u5e76\u8fdb\u5165\u6e90\u7801\u76ee\u5f55",children:"2.2.2 \u89e3\u538b\u7f29\u5e76\u8fdb\u5165\u6e90\u7801\u76ee\u5f55"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"tar xf v2.4.9.tar.gz && cd openvpn-2.4.9\n"})}),"\n",(0,l.jsx)(n.h4,{id:"223-\u5f00\u59cb\u7f16\u8bd1\u5b89\u88c5",children:"2.2.3 \u5f00\u59cb\u7f16\u8bd1\u5b89\u88c5"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"nproc"})," \u547d\u4ee4\u53ef\u4ee5\u76f4\u63a5\u83b7\u53d6\u7cfb\u7edf\u6838\u5fc3\u6570"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u751f\u6210configure\u6587\u4ef6\nautoreconf -i -v -f\n\n# \u7f16\u8bd1\u5b89\u88c5\n./configure --prefix=/usr/local/openvpn --enable-lzo --enable-lz4 --enable-crypto --enable-server --enable-plugins --enable-port-share --enable-iproute2 --enable-pf --enable-plugin-auth-pam --enable-pam-dlopen --enable-systemd\n\nmake -j${nproc} && make install\n"})}),"\n",(0,l.jsx)(n.h4,{id:"224-\u505a\u4e00\u4e0bopenvpn\u547d\u4ee4\u7684\u8f6f\u8fde\u63a5",children:"2.2.4 \u505a\u4e00\u4e0bopenvpn\u547d\u4ee4\u7684\u8f6f\u8fde\u63a5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"ln -s /usr/local/openvpn/sbin/openvpn /usr/local/sbin/openvpn\n"})}),"\n",(0,l.jsx)(n.h4,{id:"225-\u67e5\u770bopenvpn\u7248\u672c",children:"2.2.5 \u67e5\u770bopenvpn\u7248\u672c"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"$ openvpn --version\nOpenVPN 2.4.9 x86_64-unknown-linux-gnu [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [MH/PKTINFO] [AEAD] built on Jul 20 2021\nlibrary versions: OpenSSL 1.0.2k-fips  26 Jan 2017, LZO 2.06\nOriginally developed by James Yonan\nCopyright (C) 2002-2018 OpenVPN Inc <sales@openvpn.net>\nCompile time defines: enable_async_push=no enable_comp_stub=no enable_crypto=yes enable_crypto_ofb_cfb=yes enable_debug=yes enable_def_auth=yes enable_dlopen=unknown enable_dlopen_self=unknown enable_dlopen_self_static=unknown enable_fast_install=yes enable_fragment=yes enable_iproute2=yes enable_libtool_lock=yes enable_lz4=yes enable_lzo=yes enable_management=yes enable_multihome=yes enable_pam_dlopen=yes enable_pedantic=no enable_pf=yes enable_pkcs11=no enable_plugin_auth_pam=yes enable_plugin_down_root=yes enable_plugins=yes enable_port_share=yes enable_selinux=no enable_server=yes enable_shared=yes enable_shared_with_static_runtimes=no enable_small=no enable_static=yes enable_strict=no enable_strict_options=no enable_systemd=yes enable_werror=no enable_win32_dll=yes enable_x509_alt_username=no with_crypto_library=openssl with_gnu_ld=yes with_mem_check=no with_sysroot=no\n"})}),"\n",(0,l.jsx)(n.h4,{id:"226-\u4fee\u6539\u542f\u52a8\u914d\u7f6e\u6587\u4ef6",children:"2.2.6 \u4fee\u6539\u542f\u52a8\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,l.jsx)(n.admonition,{type:"tip",children:(0,l.jsx)(n.p,{children:(0,l.jsxs)(n.strong,{children:[(0,l.jsx)(n.code,{children:"/usr/local/openvpn/lib/systemd/system/"})," \u5728\u6b64\u76ee\u5f55\u4e0b\u5b58\u653e\u7740openvpn\u7684\u5ba2\u6237\u670d\u52a1\u542f\u52a8\u6587\u4ef6\u548copenvpn\u7684\u542f\u52a8\u670d\u52a1\u6587\u4ef6"]})})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"\u7f16\u8f91\u6587\u4ef6 /usr/local/openvpn/lib/systemd/system/openvpn-server@.service\n\n\u4fee\u6539\nExecStart=/usr/local/openvpn/sbin/openvpn --status %t/openvpn-server/status-%i.log --status-version 2 --suppress-timestamps --config %i.conf\n\n\u4fee\u6539\u4e3a\nExecStart=/usr/local/openvpn/sbin/openvpn --config server.conf\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u4fee\u6539"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sed -i.bak '/^ExecStart/cExecStart=\\/usr\\/local\\/openvpn\\/sbin\\/openvpn --config server.conf' /usr/local/openvpn/lib/systemd/system/openvpn-server@.service\n"})}),"\n",(0,l.jsx)(n.h4,{id:"227-\u62f7\u8d1dopenvpn-systemd\u6587\u4ef6",children:"2.2.7 \u62f7\u8d1dopenvpn systemd\u6587\u4ef6"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"cp -a /usr/local/openvpn/lib/systemd/system/openvpn-server@.service /usr/lib/systemd/system/openvpn.service\n"})}),"\n",(0,l.jsx)(n.h3,{id:"23-\u751f\u6210\u8bc1\u4e66",children:"2.3 \u751f\u6210\u8bc1\u4e66"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://github.com/OpenVPN/easy-rsa",children:"easy-rsa github\u5730\u5740"})}),"\n",(0,l.jsxs)(n.h4,{id:"231-\u4e0b\u8f7d-easy-rsa-\u5de5\u5177",children:["2.3.1 \u4e0b\u8f7d ",(0,l.jsx)(n.code,{children:"easy-rsa"})," \u5de5\u5177"]}),"\n",(0,l.jsx)(n.p,{children:"\u4e0b\u8f7d\u5305"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"wget https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.8/EasyRSA-3.0.8.tgz\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u89e3\u538b\u7f29"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"tar xf EasyRSA-3.0.8.tgz && cd EasyRSA-3.0.8/\n"})}),"\n",(0,l.jsxs)(n.h4,{id:"232-\u751f\u6210\u5168\u5c40\u914d\u7f6e\u6587\u4ef6-vars",children:["2.3.2 \u751f\u6210\u5168\u5c40\u914d\u7f6e\u6587\u4ef6 ",(0,l.jsx)(n.code,{children:"vars"})]}),"\n",(0,l.jsxs)(n.p,{children:["\u6839\u636e ",(0,l.jsx)(n.code,{children:"EasyRSA-3.0.8/vars.example"})," \u6587\u4ef6\u751f\u6210\u5168\u5c40\u914d\u7f6e\u6587\u4ef6 ",(0,l.jsx)(n.code,{children:"vars"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u65b0\u5efa\u4e00\u4e2a\u4e13\u95e8\u5b58\u653eeasy-rsa\u76f8\u5173\u6587\u4ef6\u7684\u76ee\u5f55\uff0c\u4ee5\u540e\u6240\u6709\u751f\u6210\u8bc1\u4e66\u7b49\u64cd\u4f5c\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u6267\u884c\nmkdir -p /etc/openvpn/easy-rsa\n\n# \u62f7\u8d1dEasyRSA-3.0.8\u4e0b\u7684\u90e8\u5206\u6587\u4ef6\u5230/etc/openvpn/easy-rsa/\ncp -r easyrsa openssl-easyrsa.cnf x509-types /etc/openvpn/easy-rsa/\n\n# \u62f7\u8d1d\u5168\u5c40\u914d\u7f6e\u6587\u4ef6 vars\ncp vars.example /etc/openvpn/easy-rsa/vars\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u5411 ",(0,l.jsx)(n.code,{children:"vars"})," \u6587\u4ef6\u8ffd\u52a0\u4ee5\u4e0b\u5185\u5bb9"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'cat >> /etc/openvpn/easy-rsa/vars << EOF\n# \u56fd\u5bb6\nset_var EASYRSA_REQ_COUNTRY     "CN"\n\n# \u7701\nset_var EASYRSA_REQ_PROVINCE    "BJ"\n\n# \u57ce\u5e02\nset_var EASYRSA_REQ_CITY        "BeiJing"\n\n# \u7ec4\u7ec7\nset_var EASYRSA_REQ_ORG         "test"\n\n# \u90ae\u7bb1\nset_var EASYRSA_REQ_EMAIL       "test@test.com"\n\n# \u62e5\u6709\u8005\nset_var EASYRSA_REQ_OU          "ZJ"\n\n# \u957f\u5ea6\nset_var EASYRSA_KEY_SIZE        2048\n\n# \u7b97\u6cd5\nset_var EASYRSA_ALGO            rsa\n\n# CA\u8bc1\u4e66\u8fc7\u671f\u65f6\u95f4\uff0c\u5355\u4f4d\u5929\nset_var EASYRSA_CA_EXPIRE      36500\n\n# \u7b7e\u53d1\u8bc1\u4e66\u7684\u6709\u6548\u671f\u662f\u591a\u5c11\u5929\uff0c\u5355\u4f4d\u5929\nset_var EASYRSA_CERT_EXPIRE    36500\nEOF\n'})}),"\n",(0,l.jsx)(n.h4,{id:"233-\u751f\u6210\u670d\u52a1\u7aef\u8bc1\u4e66\u548cca\u8bc1\u4e66",children:"2.3.3 \u751f\u6210\u670d\u52a1\u7aef\u8bc1\u4e66\u548cCA\u8bc1\u4e66"}),"\n",(0,l.jsx)(n.admonition,{type:"tip",children:(0,l.jsx)(n.p,{children:(0,l.jsxs)(n.strong,{children:[(0,l.jsx)(n.code,{children:"./easyrsa"})," \u547d\u4ee4\u751f\u6210\u5404\u7c7b\u8bc1\u4e66\u7684\u65f6\u5019\uff0c\u5982\u679c\u4e0d\u60f3\u8bbe\u7f6e\u5bc6\u7801\uff0c\u53ea\u9700\u8981\u5728\u6700\u540e\u6dfb\u52a0\u53c2\u6570 ",(0,l.jsx)(n.code,{children:"nopass"})," \u5373\u53ef"]})})}),"\n",(0,l.jsx)(n.h5,{id:"2331-\u521d\u59cb\u5316",children:"2.3.3.1 \u521d\u59cb\u5316"}),"\n",(0,l.jsx)(n.admonition,{type:"tip",children:(0,l.jsx)(n.p,{children:(0,l.jsxs)(n.strong,{children:["\u6267\u884c\u547d\u4ee4 ",(0,l.jsx)(n.code,{children:"./easyrsa init-pki"})," \u4f1a\u751f\u6210 ",(0,l.jsx)(n.code,{children:"pki"})," \u76ee\u5f55\uff0c\u7528\u4e8e\u5b58\u50a8\u4e00\u4e9b\u4e2d\u95f4\u53d8\u91cf\u53ca\u6700\u7ec8\u751f\u6210\u7684\u8bc1\u4e66"]})})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u5207\u6362\u76ee\u5f55\ncd /etc/openvpn/easy-rsa\n\n# \u751f\u6210pki\u76ee\u5f55\n$ ./easyrsa init-pki\n\nNote: using Easy-RSA configuration from: /etc/openvpn/easy-rsa/vars\n\ninit-pki complete; you may now create a CA or requests.\nYour newly created PKI dir is: /etc/openvpn/easy-rsa/pki\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"pki"})," \u76ee\u5f55\u5185\u5bb9\u5982\u4e0b"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"-rw------- 1 root root 4616 May 27 17:03 openssl-easyrsa.cnf\ndrwx------ 2 root root 4096 May 27 17:03 private\ndrwx------ 2 root root 4096 May 27 17:03 reqs\n-rw------- 1 root root 4648 May 27 17:03 safessl-easyrsa.cnf\n"})}),"\n",(0,l.jsx)(n.h5,{id:"2332-\u521b\u5efaca\u6839\u8bc1\u4e66",children:"2.3.3.2 \u521b\u5efaCA\u6839\u8bc1\u4e66"}),"\n",(0,l.jsx)(n.admonition,{type:"tip",children:(0,l.jsx)(n.p,{children:(0,l.jsxs)(n.strong,{children:["\u5982\u679c\u4e0d\u60f3\u7ed9CA\u6839\u8bc1\u4e66\u8bbe\u7f6e\u5bc6\u7801\uff0c\u53ef\u4ee5\u6267\u884c\u547d\u4ee4  ",(0,l.jsx)(n.code,{children:"./easyrsa build-ca nopass"})]})})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"$ ./easyrsa build-ca\n\nNote: using Easy-RSA configuration from: /etc/openvpn/easy-rsa/vars\nUsing SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017\n\nEnter New CA Key Passphrase: # \u8fd9\u91cc\u8f93\u5165ca\u6839\u8bc1\u4e66\u7684\u5bc6\u7801\nRe-Enter New CA Key Passphrase: # \u786e\u8ba4\u5bc6\u7801\nGenerating RSA private key, 2048 bit long modulus\n.............+++\n......................................................................................................+++\ne is 65537 (0x10001)\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\n# \u8fd9\u91cc\u8f93\u5165common name\u901a\u7528\u540d\uff0c\u6211\u8fd9\u91cc\u5c31\u76f4\u63a5\u8f93\u5165openvpn\nCommon Name (eg: your user, host, or server name) [Easy-RSA CA]:openvpn\n\nCA creation complete and you may now import and sign cert requests.\nYour new CA certificate file for publishing is at:\n/etc/openvpn/easy-rsa/pki/ca.crt\n"})}),"\n",(0,l.jsx)(n.h5,{id:"2333-\u751f\u6210\u670d\u52a1\u7aef\u8bc1\u4e66",children:"2.3.3.3 \u751f\u6210\u670d\u52a1\u7aef\u8bc1\u4e66"}),"\n",(0,l.jsx)(n.admonition,{type:"tip",children:(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u4e3a\u670d\u52a1\u7aef\u751f\u6210\u8bc1\u4e66\u5bf9\u5e76\u5728\u672c\u5730\u7b7e\u540d\u3002nopass\u53c2\u6570\u751f\u6210\u4e00\u4e2a\u65e0\u5bc6\u7801\u7684\u8bc1\u4e66\uff1b\u5728\u6b64\u8fc7\u7a0b\u4e2d\u4f1a\u8ba9\u4f60\u786e\u8ba4ca\u5bc6\u7801"})})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"$ ./easyrsa build-server-full server nopass\n\nNote: using Easy-RSA configuration from: /etc/openvpn/easy-rsa/vars\nUsing SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017\nGenerating a 2048 bit RSA private key\n..+++\n.......+++\nwriting new private key to '/etc/openvpn/easy-rsa/pki/easy-rsa-10492.BY7Hgo/tmp.W1d5Ju'\n-----\nUsing configuration from /etc/openvpn/easy-rsa/pki/easy-rsa-10492.BY7Hgo/tmp.wO6HgM\nEnter pass phrase for /etc/openvpn/easy-rsa/pki/private/ca.key: # \u8fd9\u91cc\u8f93\u5165\u4e0a\u4e00\u6b65\u521b\u5efaca\u6839\u8bc1\u4e66\u65f6\u8bbe\u7f6e\u7684\u5bc6\u7801\nCheck that the request matches the signature\nSignature ok\nThe Subject's Distinguished Name is as follows\ncommonName            :ASN.1 12:'server'\nCertificate is to be certified until Jun 28 10:00:33 2121 GMT (36500 days)\n\nWrite out database with 1 new entries\nData Base Updated\n"})}),"\n",(0,l.jsxs)(n.h5,{id:"2334-\u521b\u5efa-diffie-hellman",children:["2.3.3.4 \u521b\u5efa ",(0,l.jsx)(n.code,{children:"Diffie-Hellman"})]}),"\n",(0,l.jsx)(n.admonition,{type:"tip",children:(0,l.jsx)(n.p,{children:(0,l.jsxs)(n.strong,{children:["\u786e\u4fddkey\u7a7f\u8d8a\u4e0d\u5b89\u5168\u7f51\u7edc\u7684\u64cd\u4f5c\uff0c\u9700\u8981\u6267\u884c ",(0,l.jsx)(n.code,{children:"./easyrsa gen-dh"})]})})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"$ ./easyrsa gen-dh\n\nNote: using Easy-RSA configuration from: /etc/openvpn/easy-rsa/vars\nUsing SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017\nGenerating DH parameters, 2048 bit long safe prime, generator 2\nThis is going to take a long time\n......................................................................................................+...................................................................+....................................++*++*\nDH parameters of size 2048 created at /etc/openvpn/easy-rsa/pki/dh.pem\n"})}),"\n",(0,l.jsx)(n.h4,{id:"234-\u751f\u6210\u5ba2\u6237\u7aef\u8bc1\u4e66",children:"2.3.4 \u751f\u6210\u5ba2\u6237\u7aef\u8bc1\u4e66"}),"\n",(0,l.jsx)(n.h5,{id:"2341-\u751f\u6210\u5ba2\u6237\u7aef\u8bc1\u4e66",children:"2.3.4.1 \u751f\u6210\u5ba2\u6237\u7aef\u8bc1\u4e66"}),"\n",(0,l.jsx)(n.admonition,{type:"tip",children:(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u8fd9\u91cc\u5ba2\u6237\u7aef\u8bc1\u4e66\u540d\u79f0\u4e3atest"})})}),"\n",(0,l.jsx)(n.p,{children:"\u4e3a\u5ba2\u6237\u7aef\u751f\u6210\u8bc1\u4e66\u5bf9\u5e76\u5728\u672c\u5730\u7b7e\u540d\u3002nopass\u53c2\u6570\u751f\u6210\u4e00\u4e2a\u65e0\u5bc6\u7801\u7684\u8bc1\u4e66\uff1b\u5728\u6b64\u8fc7\u7a0b\u4e2d\u90fd\u4f1a\u8ba9\u4f60\u786e\u8ba4ca\u5bc6\u7801"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"$ ./easyrsa build-client-full test\n\nNote: using Easy-RSA configuration from: /etc/openvpn/easy-rsa/vars\nUsing SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017\nGenerating a 2048 bit RSA private key\n...............................................................................+++\n...........+++\nwriting new private key to '/etc/openvpn/easy-rsa/pki/easy-rsa-10608.RMC1Ry/tmp.0C7VzI'\nEnter PEM pass phrase: # \u8f93\u5165\u5ba2\u6237\u7aef\u8bc1\u4e66\u5bc6\u7801\nVerifying - Enter PEM pass phrase: # \u786e\u8ba4\u5bc6\u7801\n-----\nUsing configuration from /etc/openvpn/easy-rsa/pki/easy-rsa-10608.RMC1Ry/tmp.vzknm6\nEnter pass phrase for /etc/openvpn/easy-rsa/pki/private/ca.key: # \u8fd9\u91cc\u8f93\u5165ca\u6839\u8bc1\u4e66\u7684\u5bc6\u7801\nCheck that the request matches the signature\nSignature ok\nThe Subject's Distinguished Name is as follows\ncommonName            :ASN.1 12:'test'\nCertificate is to be certified until Jun 28 10:04:48 2121 GMT (36500 days)\n\nWrite out database with 1 new entries\nData Base Updated\n"})}),"\n",(0,l.jsx)(n.h5,{id:"2342-\u4e3a\u4e86\u63d0\u9ad8\u5b89\u5168\u6027\u751f\u6210takey",children:"2.3.4.2 \u4e3a\u4e86\u63d0\u9ad8\u5b89\u5168\u6027\uff0c\u751f\u6210ta.key"}),"\n",(0,l.jsx)(n.admonition,{type:"tip",children:(0,l.jsxs)(n.p,{children:["\u52a0\u5f3a\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u9632\u653b\u51fb\u3002\u5982\u679c\u914d\u7f6e\u6587\u4ef6\u4e2d\u542f\u7528\u6b64\u9879(\u9ed8\u8ba4\u662f\u542f\u7528\u7684)\uff0c\u5c31\u9700\u8981\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5e76\u628ata.key\u653e\u5230 ",(0,l.jsx)(n.code,{children:"/etc/openvpn/server"})," \u76ee\u5f55\u3002\u914d\u7f6e\u6587\u4ef6\u4e2d\u670d\u52a1\u7aef\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a0\uff0c\u540c\u65f6\u5ba2\u6237\u7aef\u4e5f\u8981\u6709\u6b64\u6587\u4ef6\uff0c\u4e14 ",(0,l.jsx)(n.code,{children:"client.conf"})," \u4e2d\u6b64\u6307\u4ee4\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u9700\u8981\u4e3a1\u3002\u670d\u52a1\u7aef\u6709\u8be5\u914d\u7f6e\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u4e5f\u5fc5\u987b\u8981\u6709"]})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"openvpn --genkey --secret ta.key\n"})}),"\n",(0,l.jsx)(n.h4,{id:"235-\u6574\u7406\u670d\u52a1\u7aef\u8bc1\u4e66",children:"2.3.5 \u6574\u7406\u670d\u52a1\u7aef\u8bc1\u4e66"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"mkdir -p /etc/openvpn/server\ncp pki/ca.crt /etc/openvpn/server\ncp pki/private/server.key /etc/openvpn/server\ncp pki/issued/server.crt /etc/openvpn/server\ncp pki/dh.pem /etc/openvpn/server\ncp ta.key /etc/openvpn/server\n"})}),"\n",(0,l.jsx)(n.h3,{id:"24-\u521b\u5efa\u670d\u52a1\u7aef\u914d\u7f6e\u6587\u4ef6",children:"2.4 \u521b\u5efa\u670d\u52a1\u7aef\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"server.conf"})," \u793a\u4f8b\u6587\u4ef6\u5728 openvon\u6e90\u7801\u76ee\u5f55\u4e0b\u7684 ",(0,l.jsx)(n.code,{children:"openvpn-2.4.9/sample/sample-config-files/server.conf"})]}),"\n",(0,l.jsxs)(n.p,{children:["\u76f4\u63a5\u521b\u5efa ",(0,l.jsx)(n.code,{children:"server.conf"})," \u6587\u4ef6"]}),"\n",(0,l.jsxs)(n.admonition,{type:"tip",children:[(0,l.jsx)(n.p,{children:(0,l.jsxs)(n.strong,{children:["\u4e00\u5b9a\u8981\u6dfb\u52a0openvpn\u670d\u52a1\u5668\u79c1\u6709\u5730\u5740\uff0c\u6ce8\u610f\u63a9\u7801 ",(0,l.jsx)(n.code,{children:'push "route 10.0.10.0 255.255.255.0"'})]})}),(0,l.jsx)(n.p,{children:(0,l.jsxs)(n.strong,{children:["\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0\xa0",(0,l.jsx)(n.code,{children:"crl-verify /etc/openvpn/easy-rsa/pki/crl.pem"}),"\xa0\u53c2\u6570\uff0c",(0,l.jsx)(n.code,{children:"/etc/openvpn/easy-rsa/pki/crl.pem"}),"\xa0\u662f\u5728\u8fdb\u884c\u5220\u9664vpn\u7528\u6237\u65f6\u6267\u884c\u547d\u4ee4 ",(0,l.jsx)(n.code,{children:"./easyrsa gen-crl"})," \u6240\u4ea7\u751f\u7684\u6587\u4ef6\uff0c\u8fd9\u4e2a ",(0,l.jsx)(n.code,{children:"crl.pem"}),"\xa0\u6587\u4ef6\u662f\u7528\u4e8e\u7ba1\u63a7\u88ab\u5220\u9664\u7528\u6237\u65e0\u6cd5\u8fde\u63a5vpn"]})})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'cat > /etc/openvpn/server/server.conf <<EOF\nlocal 0.0.0.0\nport 1194\nproto tcp\ndev tun\nca /etc/openvpn/server/ca.crt\ncert /etc/openvpn/server/server.crt\nkey /etc/openvpn/server/server.key\ndh /etc/openvpn/server/dh.pem\nserver 10.8.0.0 255.255.255.0\nifconfig-pool-persist ipp.txt\npush "route 172.16.0.0 255.255.255.0"\npush "dhcp-option DNS 223.5.5.5"\nclient-to-client\n;duplicate-cn\nkeepalive 10 120\ntls-auth /etc/openvpn/server/ta.key 0\ncipher AES-256-CBC\ncompress lz4-v2\npush "compress lz4-v2"\n;comp-lzo\nmax-clients 1000\nuser nobody\ngroup nobody\npersist-key\npersist-tun\nstatus openvpn-status.log\nlog  /var/log/openvpn.log\nverb 3\n;explicit-exit-notify 1\ncrl-verify /etc/openvpn/easy-rsa/pki/crl.pem\nEOF\n'})}),"\n",(0,l.jsxs)(n.p,{children:["\u6267\u884c\u5220\u9664vpn\u8d26\u6237\u7684\u6b65\u9aa4\u8bb0\u5f55\uff0c\u5728\u6267\u884c ",(0,l.jsx)(n.code,{children:"./easyrsa revoke \u7528\u6237\u540d"})," \u5220\u9664\u7528\u6237\u540e\u4f1a\u63d0\u793a ",(0,l.jsx)(n.code,{children:"Revocation was successful. You must run gen-crl and upload a CRL to your infrastructure in order to prevent the revoked cert from being accepted."})," \u8fd9\u6837\u4e00\u6bb5\u8bdd\uff0c\u6309\u7167\u63d0\u793a\u6267\u884c ",(0,l.jsx)(n.code,{children:"./easyrsa gen-crl"})," \u540e\u4f1a\u63d0\u793a ",(0,l.jsx)(n.code,{children:"crl.pem"})," \u6587\u4ef6\u6240\u5728\u4f4d\u7f6e ",(0,l.jsx)(n.code,{children:"CRL file: /etc/openvpn/easy-rsa/pki/crl.pem"})," \uff0c\u56e0\u6b64\u9700\u8981\u5728 ",(0,l.jsx)(n.code,{children:"server.conf"})," \u4e2d\u6dfb\u52a0 ",(0,l.jsx)(n.code,{children:"crl-verify /etc/openvpn/easy-rsa/pki/crl.pem"})," \u4e00\u884c\u53c2\u6570\uff0c\u907f\u514d\u5728\u670d\u52a1\u7aef\u5220\u9664\u7528\u6237\u540e\u7528\u6237\u8fd8\u80fd\u767b\u9646\u7684\u60c5\u51b5"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"./easyrsa revoke nima\n\nNote: using Easy-RSA configuration from: /etc/openvpn/easy-rsa/vars\nUsing SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017\n\n\nPlease confirm you wish to revoke the certificate with the following subject:\n\nsubject= \n    commonName                = nima\n\n\nType the word 'yes' to continue, or any other input to abort.\n  Continue with revocation: yes\nUsing configuration from /etc/openvpn/easy-rsa/pki/easy-rsa-28838.yiflJs/tmp.lFsJfm\nEnter pass phrase for /etc/openvpn/easy-rsa/pki/private/ca.key:\nRevoking Certificate 8AB483C2DC76BC3D0E016323D4BF86A9.\nData Base Updated\n\nIMPORTANT!!!\n\nRevocation was successful. You must run gen-crl and upload a CRL to your\ninfrastructure in order to prevent the revoked cert from being accepted.\n\n\n$ ./easyrsa gen-crl\n\nNote: using Easy-RSA configuration from: /etc/openvpn/easy-rsa/vars\nUsing SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017\nUsing configuration from /etc/openvpn/easy-rsa/pki/easy-rsa-28926.C3C2l3/tmp.A4N3ul\nEnter pass phrase for /etc/openvpn/easy-rsa/pki/private/ca.key:\n\nAn updated CRL has been created.\nCRL file: /etc/openvpn/easy-rsa/pki/crl.pem\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"server.conf"})," \u8be6\u7ec6\u914d\u7f6e\u8bf4\u660e"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'# \u8868\u793aopenvpn\u670d\u52a1\u7aef\u7684\u76d1\u542c\u5730\u5740\nlocal 0.0.0.0\n\n# \u76d1\u542c\u7684\u7aef\u53e3\uff0c\u9ed8\u8ba4\u662f1194\nport 1194\n\n# \u4f7f\u7528\u7684\u534f\u8bae\uff0c\u6709udp\u548ctcp\u3002\u5efa\u8bae\u9009\u62e9tcp\nproto tcp\n\n# \u4f7f\u7528\u4e09\u5c42\u8def\u7531IP\u96a7\u9053(tun)\u8fd8\u662f\u4e8c\u5c42\u4ee5\u592a\u7f51\u96a7\u9053(tap)\u3002\u4e00\u822c\u90fd\u4f7f\u7528tun\ndev tun\n\n# ca\u8bc1\u4e66\u3001\u670d\u52a1\u7aef\u8bc1\u4e66\u3001\u670d\u52a1\u7aef\u5bc6\u94a5\u548c\u5bc6\u94a5\u4ea4\u6362\u6587\u4ef6\u3002\u5982\u679c\u5b83\u4eec\u548cserver.conf\u5728\u540c\u4e00\u4e2a\u76ee\u5f55\u4e0b\u5219\u53ef\u4ee5\u4e0d\u5199\u7edd\u5bf9\u8def\u5f84\uff0c\u5426\u5219\u9700\u8981\u5199\u7edd\u5bf9\u8def\u5f84\u8c03\u7528\nca ca.crt\ncert server.crt\nkey server.key\ndh dh2048.pem\n\n# vpn\u670d\u52a1\u7aef\u4e3a\u81ea\u5df1\u548c\u5ba2\u6237\u7aef\u5206\u914dIP\u7684\u5730\u5740\u6c60\u3002\n# \u670d\u52a1\u7aef\u81ea\u5df1\u83b7\u53d6\u7f51\u6bb5\u7684\u7b2c\u4e00\u4e2a\u5730\u5740(\u6b64\u5904\u4e3a10.8.0.1)\uff0c\u540e\u4e3a\u5ba2\u6237\u7aef\u5206\u914d\u5176\u4ed6\u7684\u53ef\u7528\u5730\u5740\u3002\u4ee5\u540e\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u548c10.8.0.1\u8fdb\u884c\u901a\u4fe1\u3002\n# \u6ce8\u610f\uff1a\u8be5\u7f51\u6bb5\u5730\u5740\u6c60\u4e0d\u8981\u548c\u5df2\u6709\u7f51\u6bb5\u51b2\u7a81\u6216\u91cd\u590d\u3002\u5176\u5b9e\u4e00\u822c\u6765\u8bf4\u662f\u4e0d\u7528\u6539\u7684\u3002\u9664\u975e\u5f53\u524d\u5185\u7f51\u4f7f\u7528\u4e8610.8.0.0/24\u7684\u7f51\u6bb5\u3002\nserver 10.8.0.0 255.255.255.0\n\n# \u4f7f\u7528\u4e00\u4e2a\u6587\u4ef6\u8bb0\u5f55\u5df2\u5206\u914d\u865a\u62dfIP\u7684\u5ba2\u6237\u7aef\u548c\u865a\u62dfIP\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u4ee5\u540eopenvpn\u91cd\u542f\u65f6\uff0c\u5c06\u53ef\u4ee5\u6309\u7167\u6b64\u6587\u4ef6\u7ee7\u7eed\u4e3a\u5bf9\u5e94\u7684\u5ba2\u6237\u7aef\u5206\u914d\u6b64\u524d\u76f8\u540c\u7684IP\u3002\u4e5f\u5c31\u662f\u81ea\u52a8\u7eed\u501fIP\u7684\u610f\u601d\u3002\nifconfig-pool-persist ipp.txt\n\n# \u4f7f\u7528tap\u6a21\u5f0f\u7684\u65f6\u5019\u8003\u8651\u6b64\u9009\u9879\u3002\nserver-bridge XXXXXX\n\n# vpn\u670d\u52a1\u7aef\u5411\u5ba2\u6237\u7aef\u63a8\u9001vpn\u670d\u52a1\u7aef\u5185\u7f51\u7f51\u6bb5\u7684\u8def\u7531\u914d\u7f6e\uff0c\u4ee5\u4fbf\u8ba9\u5ba2\u6237\u7aef\u80fd\u591f\u627e\u5230\u670d\u52a1\u7aef\u5185\u7f51\u3002\u591a\u6761\u8def\u7531\u5c31\u5199\u591a\u4e2apush\u6307\u4ee4\npush "route 10.0.10.0 255.255.255.0"\npush "route 192.168.10.0 255.255.255.0"\npush "route 10.206.0.0 255.255.240.0"\n\n# \u914d\u7f6e\u5ba2\u6237\u7aef\u83b7\u53d6\u7684dns\npush "dhcp-option DNS 223.5.5.5"\n\n# \u8ba9vpn\u5ba2\u6237\u7aef\u4e4b\u95f4\u53ef\u4ee5\u4e92\u76f8\u770b\u89c1\u5bf9\u65b9\uff0c\u5373\u80fd\u4e92\u76f8\u901a\u4fe1\u3002\u9ed8\u8ba4\u60c5\u51b5\u5ba2\u6237\u7aef\u53ea\u80fd\u770b\u5230\u670d\u52a1\u7aef\u4e00\u4e2a\u4eba\uff1b\u9ed8\u8ba4\u662f\u6ce8\u91ca\u7684\uff0c\u4e0d\u80fd\u5ba2\u6237\u7aef\u4e4b\u95f4\u76f8\u4e92\u770b\u89c1\nclient-to-client\n\n# \u5141\u8bb8\u591a\u4e2a\u5ba2\u6237\u7aef\u4f7f\u7528\u540c\u4e00\u4e2aVPN\u5e10\u53f7\u8fde\u63a5\u670d\u52a1\u7aef\uff0c\u9ed8\u8ba4\u662f\u6ce8\u91ca\u7684\uff0c\u4e0d\u652f\u6301\u591a\u4e2a\u5ba2\u6237\u767b\u5f55\u4e00\u4e2a\u8d26\u53f7\nduplicate-cn\n\n# \u6bcf10\u79d2ping\u4e00\u6b21\uff0c120\u79d2\u540e\u6ca1\u6536\u5230ping\u5c31\u8bf4\u660e\u5bf9\u65b9\u6302\u4e86\nkeepalive 10 120\n\n# \u52a0\u5f3a\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u9632\u653b\u51fb\u3002\u5982\u679c\u914d\u7f6e\u6587\u4ef6\u4e2d\u542f\u7528\u6b64\u9879(\u9ed8\u8ba4\u662f\u542f\u7528\u7684)\u9700\u8981\u6267\u884copenvpn --genkey --secret ta.key\uff0c\u5e76\u628ata.key\u653e\u5230/etc/openvpn/server\u5f55\uff0c\u670d\u52a1\u7aef\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a0\uff1b\u540c\u65f6\u5ba2\u6237\u7aef\u4e5f\u8981\u6709\u6b64\u6587\u4ef6\uff0c\u4e14client.conf\u4e2d\u6b64\u6307\u4ee4\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u9700\u8981\u4e3a1\ntls-auth ta.key 0\n\n# \u9009\u62e9\u4e00\u4e2a\u5bc6\u7801\u3002\u5982\u679c\u5728\u670d\u52a1\u5668\u4e0a\u4f7f\u7528\u4e86cipher\u9009\u9879\uff0c\u90a3\u4e48\u60a8\u4e5f\u5fc5\u987b\u5728\u8fd9\u91cc\u6307\u5b9a\u5b83\u3002\u6ce8\u610f\uff0cv2.4\u5ba2\u6237\u7aef/\u670d\u52a1\u5668\u5c06\u5728TLS\u6a21\u5f0f\u4e0b\u81ea\u52a8\u534f\u5546AES-256-GCM\u3002\ncipher AES-256-CBC\n\n# openvpn 2.4\u7248\u672c\u7684vpn\u624d\u80fd\u8bbe\u7f6e\u6b64\u9009\u9879\u3002\u8868\u793a\u670d\u52a1\u7aef\u542f\u7528lz4\u7684\u538b\u7f29\u529f\u80fd\uff0c\u4f20\u8f93\u6570\u636e\u7ed9\u5ba2\u6237\u7aef\u65f6\u4f1a\u538b\u7f29\u6570\u636e\u5305\u3002Push\u540e\u5728\u5ba2\u6237\u7aef\u4e5f\u914d\u7f6e\u542f\u7528lz4\u7684\u538b\u7f29\u529f\u80fd\uff0c\u5411\u670d\u52a1\u7aef\u53d1\u6570\u636e\u65f6\u4e5f\u4f1a\u538b\u7f29\u3002\u5982\u679c\u662f2.4\u7248\u672c\u4ee5\u4e0b\u7684\u8001\u7248\u672c\uff0c\u5219\u4f7f\u7528\u7528comp-lzo\u6307\u4ee4\ncompress lz4-v2\npush "compress lz4-v2"\n\n# \u542f\u7528lzo\u6570\u636e\u538b\u7f29\u683c\u5f0f\u3002\u6b64\u6307\u4ee4\u7528\u4e8e\u4f4e\u4e8e2.4\u7248\u672c\u7684\u8001\u7248\u672c\u3002\u4e14\u5982\u679c\u670d\u52a1\u7aef\u914d\u7f6e\u4e86\u8be5\u6307\u4ee4\uff0c\u5ba2\u6237\u7aef\u4e5f\u5fc5\u987b\u8981\u914d\u7f6e\ncomp-lzo\n\n# \u5e76\u53d1\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u6570\nmax-clients 100\n\n# \u901a\u8fc7ping\u5f97\u77e5\u8d85\u65f6\u65f6\uff0c\u5f53\u91cd\u542fvpn\u540e\u5c06\u4f7f\u7528\u540c\u4e00\u4e2a\u5bc6\u94a5\u6587\u4ef6\u4ee5\u53ca\u4fdd\u6301tun\u8fde\u63a5\u72b6\u6001\npersist-key\npersist-tun\n\n# \u5728\u6587\u4ef6\u4e2d\u8f93\u51fa\u5f53\u524d\u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u6bcf\u5206\u949f\u622a\u65ad\u5e76\u91cd\u5199\u4e00\u6b21\u8be5\u6587\u4ef6\nstatus openvpn-status.log\n\n# \u9ed8\u8ba4vpn\u7684\u65e5\u5fd7\u4f1a\u8bb0\u5f55\u5230rsyslog\u4e2d\uff0c\u4f7f\u7528\u8fd9\u4e24\u4e2a\u9009\u9879\u53ef\u4ee5\u6539\u53d8\u3002log\u6307\u4ee4\u8868\u793a\u6bcf\u6b21\u542f\u52a8vpn\u65f6\u8986\u76d6\u5f0f\u8bb0\u5f55\u5230\u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\u4e2d\uff0clog-append\u5219\u8868\u793a\u6bcf\u6b21\u542f\u52a8vpn\u65f6\u8ffd\u52a0\u5f0f\u7684\u8bb0\u5f55\u5230\u6307\u5b9a\u65e5\u5fd7\u4e2d\u3002\u4f46\u4e24\u8005\u53ea\u80fd\u9009\u5176\u4e00\uff0c\u6216\u8005\u4e0d\u9009\u65f6\u8bb0\u5f55\u5230rsyslog\u4e2d\n;log openvpn.log\n;log-append openvpn.log\n\n# \u65e5\u5fd7\u8bb0\u5f55\u7684\u8be6\u7ec6\u7ea7\u522b\u3002\nverb 3\n\n# \u6c89\u9ed8\u7684\u91cd\u590d\u4fe1\u606f\u3002\u6700\u591a20\u6761\u76f8\u540c\u6d88\u606f\u7c7b\u522b\u7684\u8fde\u7eed\u6d88\u606f\u5c06\u8f93\u51fa\u5230\u65e5\u5fd7\u3002\n;mute 20\n\n# \u5f53\u670d\u52a1\u5668\u91cd\u65b0\u542f\u52a8\u65f6\uff0c\u901a\u77e5\u5ba2\u6237\u7aef\uff0c\u4ee5\u4fbf\u5b83\u53ef\u4ee5\u81ea\u52a8\u91cd\u65b0\u8fde\u63a5\u3002\u4ec5\u5728UDP\u534f\u8bae\u662f\u53ef\u7528\nexplicit-exit-notify 1\nEOF\n'})}),"\n",(0,l.jsx)(n.h3,{id:"25-\u521b\u5efa\u5ba2\u6237\u7aef\u914d\u7f6e\u6587\u4ef6",children:"2.5 \u521b\u5efa\u5ba2\u6237\u7aef\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,l.jsxs)(n.p,{children:["\u7f16\u8f91 ",(0,l.jsx)(n.code,{children:"/etc/openvpn/client/client.ovpn"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"mkdir /etc/openvpn/client\ncat > /etc/openvpn/client/client.ovpn <<EOF\nclient\ndev tun   \nproto tcp                                       #\u548cserver\u7aef\u4e00\u81f4(\u53ef\u4ee5\u4f7f\u7528udp\u6bd4tcp\u5feb)\nremote 8.8.8.8 1194                      #\u6307\u5b9a\u670d\u52a1\u7aefIP\u548c\u7aef\u53e3\nresolv-retry infinite\nnobind\npersist-key\npersist-tun\nremote-cert-tls server\nca ca.crt                                        #ca\u8bc1\u4e66\ncert client.crt                                  #\u5ba2\u6237\u7aef\u8bc1\u4e66\nkey client.key                                   #\u5ba2\u6237\u7aef\u5bc6\u94a5\ntls-auth ta.key 1                                #ta\u5bc6\u94a5\ncipher AES-256-CBC\nverb 3  \nEOF\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"client.ovpn"})," \u914d\u7f6e\u6587\u4ef6\u8be6\u7ec6\u8bf4\u660e"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u6807\u8bc6\u8fd9\u662f\u4e2a\u5ba2\u6237\u7aef\nclient\n\n# \u4f7f\u7528\u4e09\u5c42\u8def\u7531IP\u96a7\u9053(tun)\u8fd8\u662f\u4e8c\u5c42\u4ee5\u592a\u7f51\u96a7\u9053(tap)\u3002\u670d\u52a1\u7aef\u662f\u4ec0\u4e48\u5ba2\u6237\u7aef\u5c31\u662f\u4ec0\u4e48\ndev tun\n\n# \u4f7f\u7528\u7684\u534f\u8bae\uff0c\u6709udp\u548ctcp\u3002\u670d\u52a1\u7aef\u662f\u4ec0\u4e48\u5ba2\u6237\u7aef\u5c31\u662f\u4ec0\u4e48\nproto tcp\n\n# \u670d\u52a1\u7aef\u7684\u5730\u5740\u548c\u7aef\u53e3\nremote 8.8.8.8 1194\n\n# \u4e00\u76f4\u5c1d\u8bd5\u89e3\u6790OpenVPN\u670d\u52a1\u5668\u7684\u4e3b\u673a\u540d\u3002\u5728\u673a\u5668\u4e0a\u975e\u5e38\u6709\u7528\uff0c\u4e0d\u662f\u6c38\u4e45\u8fde\u63a5\u5230\u4e92\u8054\u7f51\uff0c\u5982\u7b14\u8bb0\u672c\u7535\u8111\u3002\nresolv-retry infinite\n\n# \u5927\u591a\u6570\u5ba2\u6237\u673a\u4e0d\u9700\u8981\u7ed1\u5b9a\u5230\u7279\u5b9a\u7684\u672c\u5730\u7aef\u53e3\u53f7\u3002\nnobind\n\n# \u521d\u59cb\u5316\u540e\u7684\u964d\u7ea7\u7279\u6743(\u4ec5\u975ewindows)\n;user nobody\n;group nobody\n\n# \u5c1d\u8bd5\u5728\u91cd\u65b0\u542f\u52a8\u65f6\u4fdd\u7559\u67d0\u4e9b\u72b6\u6001\u3002\npersist-key\npersist-tun\n\n# ca\u8bc1\u4e66\u3001\u5ba2\u6237\u7aef\u8bc1\u4e66\u3001\u5ba2\u6237\u7aef\u5bc6\u94a5\uff0c\u5982\u679c\u5b83\u4eec\u548cclient.conf\u6216client.ovpn\u5728\u540c\u4e00\u4e2a\u76ee\u5f55\u4e0b\u5219\u53ef\u4ee5\u4e0d\u5199\u7edd\u5bf9\u8def\u5f84\uff0c\u5426\u5219\u9700\u8981\u5199\u7edd\u5bf9\u8def\u5f84\u8c03\u7528\nca ca.crt\ncert client.crt\nkey client.key\n\n# \u901a\u8fc7\u68c0\u67e5certicate\u662f\u5426\u5177\u6709\u6b63\u786e\u7684\u5bc6\u94a5\u4f7f\u7528\u8bbe\u7f6e\u6765\u9a8c\u8bc1\u670d\u52a1\u5668\u8bc1\u4e66\u3002\nremote-cert-tls server\n\n# \u52a0\u5f3a\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u9632\u653b\u51fb\u3002\u670d\u52a1\u7aef\u6709\u914d\u7f6e\uff0c\u5219\u5ba2\u6237\u7aef\u5fc5\u987b\u6709\ntls-auth ta.key 1\n\n# \u9009\u62e9\u4e00\u4e2a\u5bc6\u7801\u3002\u5982\u679c\u5728\u670d\u52a1\u5668\u4e0a\u4f7f\u7528\u4e86cipher\u9009\u9879\uff0c\u90a3\u4e48\u60a8\u4e5f\u5fc5\u987b\u5728\u8fd9\u91cc\u6307\u5b9a\u5b83\u3002\u6ce8\u610f\uff0cv2.4\u5ba2\u6237\u7aef/\u670d\u52a1\u5668\u5c06\u5728TLS\u6a21\u5f0f\u4e0b\u81ea\u52a8\u534f\u5546AES-256-GCM\u3002\ncipher AES-256-CBC\n\n# \u670d\u52a1\u7aef\u7528\u7684\u4ec0\u4e48\uff0c\u5ba2\u6237\u7aef\u5c31\u7528\u7684\u4ec0\u4e48\uff0c\u8868\u793a\u5ba2\u6237\u7aef\u542f\u7528lz4\u7684\u538b\u7f29\u529f\u80fd\uff0c\u4f20\u8f93\u6570\u636e\u7ed9\u5ba2\u6237\u7aef\u65f6\u4f1a\u538b\u7f29\u6570\u636e\u5305\u3002\ncompress lz4-v2\n\n# \u65e5\u5fd7\u7ea7\u522b\nverb 3\n\n# \u6c89\u9ed8\u7684\u91cd\u590d\u4fe1\u606f\u3002\u6700\u591a20\u6761\u76f8\u540c\u6d88\u606f\u7c7b\u522b\u7684\u8fde\u7eed\u6d88\u606f\u5c06\u8f93\u51fa\u5230\u65e5\u5fd7\u3002\n;mute 20\n"})}),"\n",(0,l.jsx)(n.h3,{id:"26-\u542f\u52a8openvpn",children:"2.6 \u542f\u52a8openvpn"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"systemctl enable openvpn && systemctl start openvpn\n"})}),"\n",(0,l.jsx)(n.h3,{id:"27-\u4e0b\u8f7d\u914d\u7f6e\u6587\u4ef6",children:"2.7 \u4e0b\u8f7d\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,l.jsxs)(n.p,{children:["\u67093\u4e2a\u6587\u4ef6\u662f\u56fa\u5b9a\u7684\uff0c\u5176\u4e2d ",(0,l.jsx)(n.code,{children:"ca.crt"}),"\u3001",(0,l.jsx)(n.code,{children:"ta.key"})," \u662f\u670d\u52a1\u7aef\u6839\u8bc1\u4e66\uff0c",(0,l.jsx)(n.code,{children:"client.ovpn(\u6587\u4ef6\u540d\u53ef\u4efb\u610f\u4fee\u6539)"})," \u662f\u5ba2\u6237\u7aef\u6587\u4ef6\uff0c\u8fd93\u4e2a\u6587\u4ef6\u662f\u56fa\u5b9a\u7684"]}),"\n",(0,l.jsxs)(n.p,{children:["\u518d\u52a0\u4e0a\u6267\u884c\u547d\u4ee4 ",(0,l.jsx)(n.code,{children:"./easyrsa build-client-full \u7528\u6237\u540d"})," \u751f\u6210\u7684 ",(0,l.jsx)(n.code,{children:"\u7528\u6237\u540d.crt"})," \u548c ",(0,l.jsx)(n.code,{children:"\u7528\u6237\u540d.key"})," \u4e00\u51715\u4e2a\u6587\u4ef6 \uff0c\u628a\u8fd95\u4e2a\u6587\u4ef6+\u5bc6\u7801\u7ed9\u5230\u7528\u6237\u5373\u53ef"]}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"ca.crt"}),"\u3001",(0,l.jsx)(n.code,{children:"ta.key"}),"\u3001",(0,l.jsx)(n.code,{children:"client.ovpn"})]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u670d\u52a1\u7aef\u6839\u8bc1\u4e66\n/etc/openvpn/server/ca.crt\n/etc/openvpn/server/ta.key\n\n# \u5ba2\u6237\u7aef\u6587\u4ef6\n/etc/openvpn/client/client.ovpn\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u5728 ",(0,l.jsx)(n.code,{children:"client.ovpn"})," \u6587\u4ef6\u4e2d\uff0c\u6ce8\u610f\u4fee\u6539\u5ba2\u6237\u7aef\u8bc1\u4e66\u548c\u5bc6\u94a5\u7684\u540d\u79f0"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"cert xxx.crt                                  # \u5ba2\u6237\u7aef\u8bc1\u4e66\nkey xxx.key                                   # \u5ba2\u6237\u7aef\u5bc6\u94a5\n"})}),"\n",(0,l.jsx)(n.h3,{id:"28-\u8fde\u63a5\u6d4b\u8bd5",children:"2.8 \u8fde\u63a5\u6d4b\u8bd5"}),"\n",(0,l.jsxs)(n.p,{children:["\u8fde\u63a5\u6210\u529f\u540e\uff0c\u5c31\u4f1a\u5728\u672c\u673a\u751f\u6210\u4e00\u4e2a ",(0,l.jsx)(n.code,{children:"utun1"})," \u7684\u865a\u62df\u7f51\u5361\uff0c\u5e76\u83b7\u53d6openvpn ",(0,l.jsx)(n.code,{children:"server.conf"})," \u4e2d\u8bbe\u7f6e\u7684  ",(0,l.jsx)(n.code,{children:"server 10.8.0.0 255.255.255.0"})," \u7ed9\u5ba2\u6237\u7aef\u5206\u914d\u7684\u7f51\u6bb5\uff0cIP\u5730\u5740\u4ece 10.8.0.2 \u5f00\u59cb\u5206\u914d"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"utun1: flags=8051<UP,POINTOPOINT,RUNNING,MULTICAST> mtu 1500\n\tinet 10.8.0.2 --\x3e 10.8.0.2 netmask 0xffffff00 \n"})}),"\n",(0,l.jsx)(n.p,{children:"\u6b64\u65f6mac\u672c\u673a\u662f\u80fd\u4e0e\u670d\u52a1\u5668\u5185\u7f51\u76f8\u4e92ping\u901a\u7684"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"mac\u672c\u673aping\u670d\u52a1\u5668\u5185\u7f51"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"$ ping -c2 172.16.0.71\nPING 172.16.0.71 (172.16.0.71): 56 data bytes\n64 bytes from 172.16.0.71: icmp_seq=0 ttl=64 time=10.523 ms\n64 bytes from 172.16.0.71: icmp_seq=1 ttl=64 time=6.925 ms\n\n--- 172.16.0.71 ping statistics ---\n2 packets transmitted, 2 packets received, 0.0% packet loss\nround-trip min/avg/max/stddev = 6.925/8.724/10.523/1.799 ms\n\n"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"\u670d\u52a1\u5668ping mac\u672c\u673a"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"$ ping -c2 10.8.0.6\nPING 10.8.0.6 (10.8.0.6) 56(84) bytes of data.\n64 bytes from 10.8.0.6: icmp_seq=1 ttl=64 time=59.1 ms\n64 bytes from 10.8.0.6: icmp_seq=2 ttl=64 time=47.0 ms\n\n--- 10.8.0.6 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 47.014/53.081/59.148/6.067 ms\n"})}),"\n",(0,l.jsx)(n.h3,{id:"29-\u5f00\u901a\u5220\u9664vpn\u6b65\u9aa4",children:"2.9 \u5f00\u901a\u3001\u5220\u9664vpn\u6b65\u9aa4"}),"\n",(0,l.jsx)(n.h4,{id:"291-\u5f00\u901avpn\u8d26\u6237",children:"2.9.1 \u5f00\u901avpn\u8d26\u6237"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"\u8fd9\u91cc\u4ee5\u7ed9\u5c0f\u660e\u5f00\u901avpn\u4e3a\u4f8b"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u6267\u884c\u8fd9\u4e2a\u6b65\u9aa4\u4f1a\u63d0\u793a\u8f93\u51653\u6b21\u5bc6\u7801\uff0c\u524d2\u6b21\u662f\u7528\u6237\u4e2a\u4eba\u5bc6\u7801\uff0c\u6700\u540e\u4e00\u6b21\u662fca\u6839\u8bc1\u4e66\u5bc6\u7801"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"./easyrsa build-client-full xiaoming\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u4e0b\u8f7d\u7528\u6237\u4e2a\u4eba\u8bc1\u4e66\u6587\u4ef6"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'# \u53ea\u9700\u8981\u4e0b\u8f7d crt \u548c key \u6587\u4ef6\u5373\u53ef\nfind / -name "xiaoming*"\n'})}),"\n",(0,l.jsx)(n.h4,{id:"292-\u5220\u9664vpn\u8d26\u6237",children:"2.9.2 \u5220\u9664vpn\u8d26\u6237"}),"\n",(0,l.jsx)(n.p,{children:"\u6267\u884c\u8fd9\u4e2a\u6b65\u9aa4\u9700\u8981\u8f93\u5165ca\u6839\u8bc1\u4e66\u5bc6\u7801"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"./easyrsa revoke xiaoming\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u6267\u884c ",(0,l.jsx)(n.code,{children:"gen-crl"})," \u547d\u4ee4"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"./easyrsa gen-crl\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u91cd\u542fopenvpn"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"systemctl restart openvpn\n"})}),"\n",(0,l.jsx)(n.h4,{id:"210-\u6269\u5c55openvpn\u914d\u7f6e\u7528\u6237\u83b7\u53d6\u56fa\u5b9aip\u5730\u5740",children:"2.10 \u6269\u5c55\uff1aopenvpn\u914d\u7f6e\u7528\u6237\u83b7\u53d6\u56fa\u5b9aIP\u5730\u5740"}),"\n",(0,l.jsxs)(n.p,{children:["\u7f16\u8f91openvpn\u914d\u7f6e\u6587\u4ef6 ",(0,l.jsx)(n.code,{children:"server.conf"})," \uff0c\u589e\u52a0 ",(0,l.jsx)(n.code,{children:"ifconfig-pool-persist"})," \u53c2\u6570"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"ifconfig-pool-persist /etc/openvpn/server/fixed_ip\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u7f16\u8f91 ",(0,l.jsx)(n.code,{children:"/etc/openvpn/server/fixed_ip"})," \u6587\u4ef6\uff0c\u7528\u6237\u540d\u548cIP\u4ee5\u9017\u53f7\u5206\u9694"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"test,10.8.0.250\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u8f91\u5b8c\u6210\u540e\u91cd\u542fopenvpn"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"systemctl restart openvpn\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u9a8c\u8bc1"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"$ ifconfig\nutun2: flags=8051<UP,POINTOPOINT,RUNNING,MULTICAST> mtu 1500\n\tinet 10.8.0.250 --\x3e 10.8.0.249 netmask 0xffffffff \n"})})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(p,{...e})}):p(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>c});var l=s(96540);const r={},i=l.createContext(r);function a(e){const n=l.useContext(i);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),l.createElement(i.Provider,{value:n},e.children)}}}]);