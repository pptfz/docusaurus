"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[5857],{21494:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>i,contentTitle:()=>c,default:()=>g,frontMatter:()=>s,metadata:()=>d,toc:()=>a});var t=n(74848),o=n(28453);const s={},c="registry\u79c1\u6709\u4ed3\u5e93",d={id:"\u4e91\u539f\u751f/\u5bb9\u5668/docker/registry\u79c1\u6709\u4ed3\u5e93",title:"registry\u79c1\u6709\u4ed3\u5e93",description:"[toc]",source:"@site/docs/\u4e91\u539f\u751f/\u5bb9\u5668/docker/registry\u79c1\u6709\u4ed3\u5e93.md",sourceDirName:"\u4e91\u539f\u751f/\u5bb9\u5668/docker",slug:"/\u4e91\u539f\u751f/\u5bb9\u5668/docker/registry\u79c1\u6709\u4ed3\u5e93",permalink:"/docs/\u4e91\u539f\u751f/\u5bb9\u5668/docker/registry\u79c1\u6709\u4ed3\u5e93",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"docker\u8de8\u4e3b\u673a\u901a\u4fe1\u4e4boverlay",permalink:"/docs/\u4e91\u539f\u751f/\u5bb9\u5668/docker/docker\u8de8\u4e3b\u673a\u901a\u4fe1\u4e4boverlay"},next:{title:"\u4fee\u6539docker\u955c\u50cf\u3001\u5bb9\u5668\u9ed8\u8ba4\u5b58\u653e\u4f4d\u7f6e",permalink:"/docs/\u4e91\u539f\u751f/\u5bb9\u5668/docker/\u4fee\u6539docker\u955c\u50cf\u3001\u5bb9\u5668\u9ed8\u8ba4\u5b58\u653e\u4f4d\u7f6e"}},i={},a=[{value:"1.\u666e\u901aregistry",id:"1\u666e\u901aregistry",level:2},{value:"1.1 docker01\u542f\u52a8\u79c1\u6709\u4ed3\u5e93\u5bb9\u5668",id:"11-docker01\u542f\u52a8\u79c1\u6709\u4ed3\u5e93\u5bb9\u5668",level:3},{value:"1.2 docker02\u7ed9\u955c\u50cf\u6253\u6807\u7b7e",id:"12-docker02\u7ed9\u955c\u50cf\u6253\u6807\u7b7e",level:3},{value:"1.3 docker02\u63a8\u9001\u955c\u50cf\u5230\u79c1\u6709\u4ed3\u5e93docker01",id:"13-docker02\u63a8\u9001\u955c\u50cf\u5230\u79c1\u6709\u4ed3\u5e93docker01",level:3},{value:"1.4 docker \u666e\u901aregistry\u7f3a\u70b9",id:"14-docker-\u666e\u901aregistry\u7f3a\u70b9",level:3},{value:"2.\u5e26basic\u8ba4\u8bc1\u7684registry",id:"2\u5e26basic\u8ba4\u8bc1\u7684registry",level:2},{value:"2.1 docker01\u521d\u59cb\u73af\u5883\u51c6\u5907",id:"21-docker01\u521d\u59cb\u73af\u5883\u51c6\u5907",level:3},{value:"2.2 docker01\u542f\u52a8\u5bb9\u5668",id:"22-docker01\u542f\u52a8\u5bb9\u5668",level:3},{value:"2.3 docker02\u76f4\u63a5\u62c9\u53d6\u955c\u50cf",id:"23-docker02\u76f4\u63a5\u62c9\u53d6\u955c\u50cf",level:3},{value:"2.4 \u767b\u9646\u79c1\u6709\u4ed3\u5e93\uff0c\u7136\u540e\u62c9\u53d6\u955c\u50cf",id:"24-\u767b\u9646\u79c1\u6709\u4ed3\u5e93\u7136\u540e\u62c9\u53d6\u955c\u50cf",level:3}];function l(e){const r={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.p,{children:"[toc]"}),"\n",(0,t.jsx)(r.h1,{id:"registry\u79c1\u6709\u4ed3\u5e93",children:"registry\u79c1\u6709\u4ed3\u5e93"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"docker\u79c1\u6709\u4ed3\u5e93registry\u53ea\u9700\u8981\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\u5373\u53ef"})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"\u8bd5\u9a8c\u73af\u5883"})}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"docker01\t\t10.0.0.10"}),"\n",(0,t.jsx)(r.p,{children:"docker02\t\t10.0.0.11"}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"1\u666e\u901aregistry",children:"1.\u666e\u901aregistry"}),"\n",(0,t.jsx)(r.h3,{id:"11-docker01\u542f\u52a8\u79c1\u6709\u4ed3\u5e93\u5bb9\u5668",children:"1.1 docker01\u542f\u52a8\u79c1\u6709\u4ed3\u5e93\u5bb9\u5668"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"[root@docker01 ~]# docker run -d -p 5000:5000 --restart=always --name registry -v \\\n/opt/myregistry:/var/lib/registry  registry\n\n\u53c2\u6570\u89e3\u91ca\t\n-d\t\t\t\t\t\u540e\u53f0\u8fd0\u884c\n-p\t\t\t\t\t\u6620\u5c04\u7aef\u53e3\n--restart=always\t\t\u91cd\u542fdocker\u670d\u52a1\u65f6\u62c9\u8d77\u5bb9\u5668\n--name\t\t\t\t\u540d\u5b57\n-v\t\t\t\t\t\u6302\u8f7d\u5377\uff0c /opt/myregistry:/var/lib/registry\u8868\u793a\u5c06\u5bbf\u4e3b\u673a\u7684/opt/myregistry\u6302\u8f7d\u5230\u5bb9\u5668\u7684/var/lib/registry\n"})}),"\n",(0,t.jsx)(r.h3,{id:"12-docker02\u7ed9\u955c\u50cf\u6253\u6807\u7b7e",children:"1.2 docker02\u7ed9\u955c\u50cf\u6253\u6807\u7b7e"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"1.\u521d\u59cb\u955c\u50cf\n[root@docker02 ~]# docker images\nREPOSITORY              TAG                 IMAGE ID            CREATED             SIZE\ncentos                  6.9                 adf829198a7f        4 months ago        195MB\n\n2.\u7ed9\u955c\u50cf\u6253\u6807\u7b7e\n\u8bed\u6cd5\ndocker tag \u955c\u50cf\u540d\u79f0 \u6807\u7b7e\u540d\u79f0\n[root@docker02 ~]# docker tag centos:6.9 10.0.0.10:5000/centos:6.9\n\n3.\u6253\u5b8c\u6807\u7b7e\u540e\u7684\u955c\u50cf\uff0cid\u76f8\u540c\uff0c\u76f8\u5f53\u4e8e\u786c\u94fe\u63a5\n[root@docker02 ~]# docker images\nREPOSITORY              TAG                 IMAGE ID            CREATED             SIZE\n10.0.0.10:5000/centos   6.9                 adf829198a7f        4 months ago        195MB\ncentos                  6.9                 adf829198a7f        4 months ago        195MB\n"})}),"\n",(0,t.jsx)(r.h3,{id:"13-docker02\u63a8\u9001\u955c\u50cf\u5230\u79c1\u6709\u4ed3\u5e93docker01",children:"1.3 docker02\u63a8\u9001\u955c\u50cf\u5230\u79c1\u6709\u4ed3\u5e93docker01"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:'1.\u9ed8\u8ba4\u63a8\u9001\u662f\u91c7\u7528https\u534f\u8bae\uff0c\u56e0\u6b64\u7b2c\u4e00\u6b21\u63a8\u9001\u4f1a\u62a5\u9519\n[root@docker02 ~]# docker push 10.0.0.10:5000/centos:6.9 \nThe push refers to repository [10.0.0.10:5000/centos] \nGet https://10.0.0.10:5000/v2/: http: server gave HTTP response to HTTPS client\n\n2.\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u4f7f\u63a8\u9001\u4f7f\u7528http\u534f\u8bae\n[root@docker02 ~]# vim /etc/docker/daemon.json\n{\n"insecure-registries": ["10.0.0.10:5000"]\n}\n\n3.\u91cd\u542fdocker\n[root@docker02 ~]# systemctl restart docker\n\n4.\u518d\u6b21\u63a8\u9001\u5373\u53ef\u6210\u529f\n[root@docker02 ~]# docker push 10.0.0.10:5000/centos:6.9\nThe push refers to repository [10.0.0.20:5000/centos]\naaa5621d7c01: Pushed \n6.9: digest: sha256:7e172600dff1903f186061ce5f5295664ec9942ca120e4e5b427ddf01bb2b35b size: 529\n'})}),"\n",(0,t.jsx)(r.h3,{id:"14-docker-\u666e\u901aregistry\u7f3a\u70b9",children:"1.4 docker \u666e\u901aregistry\u7f3a\u70b9"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:(0,t.jsx)("span",{style:{color:"red"},children:"\u6ca1\u6709\u8ba4\u8bc1\uff0c\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u63a8\u9001\u955c\u50cf\u5230\u79c1\u6709\u4ed3\u5e93\uff0c\u4e0d\u5b89\u5168\uff01\uff01\uff01"})})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"1.docker02\u5bfc\u5165\u955c\u50cf\u6216\u8005\u4e0b\u8f7d\u955c\u50cf\n[root@docker02 ~]# docker load -i nginx.tar.gz\n\n2.\u7ed9\u955c\u50cf\u6253\u6807\u7b7e\n[root@docker02 ~]# docker tag nginx:latest 10.0.0.10:5000/nginx:latest\n\n3.\u63a8\u9001\u4efb\u610f\u4e00\u4e2a\u955c\u50cf\u5230\u79c1\u6709\u4ed3\u5e93\n[root@docker02 ~]# docker push 10.0.0.10:5000/nginx:latest\n\n4.\u63a8\u9001\u955c\u50cf\u5b58\u653e\u8def\u5f84\n\u521b\u5efa\u79c1\u6709\u955c\u50cf\u4ed3\u5e93\u65f6\u6307\u5b9a\u7684\u5bbf\u4e3b\u673a\u76ee\u5f55/opt/myregistry\t\t\n-v /opt/myregistry:/var/lib/registry  registry\n[root@docker01 ~]# ls /opt/myregistry/docker/registry/v2/repositories/\ncentos/        centos6.9_ssh/ nginx/   \n"})}),"\n",(0,t.jsx)(r.h2,{id:"2\u5e26basic\u8ba4\u8bc1\u7684registry",children:"2.\u5e26basic\u8ba4\u8bc1\u7684registry"}),"\n",(0,t.jsx)(r.h3,{id:"21-docker01\u521d\u59cb\u73af\u5883\u51c6\u5907",children:"2.1 docker01\u521d\u59cb\u73af\u5883\u51c6\u5907"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"1.\u5b89\u88c5httpd-tools\n[root@docker01 ~]# yum -y install httpd-tools\n\n2.\u521b\u5efa\u5b58\u653e\u5bc6\u7801\u7684\u76ee\u5f55\u5e76\u8bbe\u7f6e\u5bc6\u7801\n[root@docker01 ~]# mkdir -p /opt/registry-var/auth\n[root@docker01 ~]# htpasswd  -Bbn test 123456  >> /opt/registry-var/auth/htpasswd\n"})}),"\n",(0,t.jsx)(r.h3,{id:"22-docker01\u542f\u52a8\u5bb9\u5668",children:"2.2 docker01\u542f\u52a8\u5bb9\u5668"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:'[root@docker01 ~]# docker run -d -p 5000:5000 --name registry --restart=always -v /opt/registry-var/auth/:/auth/ -v \\\n/opt/myregistry:/var/lib/registry -e "REGISTRY_AUTH=htpasswd" -e \\\n"REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm" -e REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd\\\n registry \n'})}),"\n",(0,t.jsx)(r.h3,{id:"23-docker02\u76f4\u63a5\u62c9\u53d6\u955c\u50cf",children:"2.3 docker02\u76f4\u63a5\u62c9\u53d6\u955c\u50cf"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"1.\u76f4\u63a5\u62c9\u53d6\u955c\u50cf\u4f1a\u62a5\u9519\uff0c\u56e0\u4e3a\u6ca1\u6709\u8ba4\u8bc1\n[root@docker02 ~]# docker pull 10.0.0.10:5000/nginx\nUsing default tag: latest\nError response from daemon: Get http://10.0.0.10:5000/v2/nginx/manifests/latest: no basic auth credentials\n"})}),"\n",(0,t.jsx)(r.h3,{id:"24-\u767b\u9646\u79c1\u6709\u4ed3\u5e93\u7136\u540e\u62c9\u53d6\u955c\u50cf",children:"2.4 \u767b\u9646\u79c1\u6709\u4ed3\u5e93\uff0c\u7136\u540e\u62c9\u53d6\u955c\u50cf"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"1.\u767b\u9646\u79c1\u6709\u4ed3\u5e93\n[root@docker02 ~]# docker login 10.0.0.10:5000\nUsername: test\nPassword: \nWARNING! Your password will be stored unencrypted in /root/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/#credentials-store\n\nLogin Succeeded\n\n2.\u62c9\u53d6\u955c\u50cf\n[root@docker02 ~]# docker pull 10.0.0.10:5000/nginx\nUsing default tag: latest\nlatest: Pulling from nginx\nDigest: sha256:278fefc722ffe1c36f6dd64052758258d441dcdb5e1bbbed0670485af2413c9f\nStatus: Image is up to date for 10.0.0.10:5000/nginx:latest\n\n3.\u4e0a\u4f20\u955c\u50cf\uff0c\u5148\u6253\u6807\u7b7e\uff0c\u518d\u4e0a\u4f20\n[root@docker02 ~]# docker tag centos:6.9 10.0.0.10:5000/my-centos\n[root@docker02 ~]# docker push 10.0.0.10:5000/my-centos\n"})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"registry\u955c\u50cf\u5b58\u50a8\u4f4d\u7f6e"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"registry\u955c\u50cf\u5b58\u50a8\u4f4d\u7f6e\u4e3a\n\u6302\u8f7d\u76ee\u5f55/docker/registry/v2/repositories/\u955c\u50cf\u540d\u79f0\n\n\n\u76ee\u5f55\u6302\u8f7d\n/opt/myregistry:/var/lib/registry\n  \n\u955c\u50cf\u5b58\u50a8\u4f4d\u7f6e  \n/opt/myregistry/docker/registry/v2/repositories\n"})})]})}function g(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},28453:(e,r,n)=>{n.d(r,{R:()=>c,x:()=>d});var t=n(96540);const o={},s=t.createContext(o);function c(e){const r=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),t.createElement(s.Provider,{value:r},e.children)}}}]);