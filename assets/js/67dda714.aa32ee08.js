"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[7733],{1805:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>i,default:()=>a,frontMatter:()=>t,metadata:()=>o,toc:()=>d});var r=n(74848),c=n(28453);const t={},i=void 0,o={id:"linux/kvm/\u77e5\u8bc6\u70b9/vncserver\u5b89\u88c5",title:"vncserver\u5b89\u88c5",description:"vncserver\u5b89\u88c5",source:"@site/docs/linux/kvm/\u77e5\u8bc6\u70b9/vncserver\u5b89\u88c5.md",sourceDirName:"linux/kvm/\u77e5\u8bc6\u70b9",slug:"/linux/kvm/\u77e5\u8bc6\u70b9/vncserver\u5b89\u88c5",permalink:"/docs/linux/kvm/\u77e5\u8bc6\u70b9/vncserver\u5b89\u88c5",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"kvm\u865a\u62df\u673a\u7f51\u5361\u6539\u52a8\u65e0\u6cd5\u542f\u52a8\u95ee\u9898",permalink:"/docs/linux/kvm/\u77e5\u8bc6\u70b9/kvm\u865a\u62df\u673a\u7f51\u5361\u6539\u52a8\u65e0\u6cd5\u542f\u52a8\u95ee\u9898"},next:{title:"\u4f7f\u7528 virt-manager \u5b89\u88c5\u865a\u62df\u673a",permalink:"/docs/linux/kvm/\u77e5\u8bc6\u70b9/\u4f7f\u7528virt-manager\u5b89\u88c5\u865a\u62df\u673a"}},l={},d=[{value:"vncserver\u5b89\u88c5",id:"vncserver\u5b89\u88c5",level:2},{value:"1.\u5b89\u88c5\u5305",id:"1\u5b89\u88c5\u5305",level:2},{value:"2.\u914d\u7f6esystemd\u7ba1\u7406vncserver",id:"2\u914d\u7f6esystemd\u7ba1\u7406vncserver",level:2},{value:"3.vncserver\u4e00\u4e9b\u64cd\u4f5c\u8bf4\u660e",id:"3vncserver\u4e00\u4e9b\u64cd\u4f5c\u8bf4\u660e",level:2},{value:"3.1 \u542f\u52a8\u3001\u5173\u95ed",id:"31-\u542f\u52a8\u5173\u95ed",level:3},{value:"3.2 \u4fee\u6539vncserver\u7a97\u53e3\u5206\u8fa8\u7387",id:"32-\u4fee\u6539vncserver\u7a97\u53e3\u5206\u8fa8\u7387",level:3}];function v(e){const s={admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",strong:"strong",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h2,{id:"vncserver\u5b89\u88c5",children:"vncserver\u5b89\u88c5"}),"\n",(0,r.jsx)(s.h2,{id:"1\u5b89\u88c5\u5305",children:"1.\u5b89\u88c5\u5305"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"yum -y install tigervnc tigervnc-server\n"})}),"\n",(0,r.jsx)(s.h2,{id:"2\u914d\u7f6esystemd\u7ba1\u7406vncserver",children:"2.\u914d\u7f6esystemd\u7ba1\u7406vncserver"}),"\n",(0,r.jsxs)(s.p,{children:["\u5b89\u88c5\u5b8c\u5305\u540e\u4f1a\u751f\u4ea7\u4e00\u4e2a\u6587\u4ef6 ",(0,r.jsx)(s.code,{children:"/usr/lib/systemd/system/vncserver@.service"})]}),"\n",(0,r.jsx)(s.p,{children:"\u6587\u4ef6\u4e2d\u5df2\u7ecf\u8bf4\u7684\u975e\u5e38\u6e05\u695a\u4e86"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"# Quick HowTo:\n# 1. Copy this file to /etc/systemd/system/vncserver@.service\n# 2. Replace <USER> with the actual user name and edit vncserver\n#    parameters in the wrapper script located in /usr/bin/vncserver_wrapper\n# 3. Run `systemctl daemon-reload`\n# 4. Run `systemctl enable vncserver@:<display>.service`\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u6309\u7167\u8bf4\u660e\u914d\u7f6e\u4e00\u4e0b\u5c31\u53ef\u4ee5"}),"\n",(0,r.jsx)(s.p,{children:"\u7b2c\u4e00\u6b65\u3001\u62f7\u8d1d\u6587\u4ef6"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"cp /usr/lib/systemd/system/vncserver@.service /etc/systemd/system/\n"})}),"\n",(0,r.jsxs)(s.p,{children:["\u7b2c\u4e8c\u6b65\u3001\u66ff\u6362\u6587\u4ef6\u4e2d\u7684 ",(0,r.jsx)(s.code,{children:"<USER>"})," \u4e3a\u5177\u4f53\u7684\u7528\u6237"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"sed -i 's/<USER>/root/' /etc/systemd/system/vncserver@.service\n"})}),"\n",(0,r.jsxs)(s.p,{children:["\u7b2c\u4e09\u6b65\u3001\u8fd0\u884c\u547d\u4ee4 ",(0,r.jsx)(s.code,{children:"systemctl daemon-reload"})]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"systemctl daemon-reload\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u7b2c\u56db\u6b65\u3001\u8bbe\u7f6evnc\u5bc6\u7801"}),"\n",(0,r.jsx)(s.admonition,{type:"tip",children:(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"\u5fc5\u987b\u5728\u542f\u52a8vnc\u524d\u8bbe\u7f6e\u5bc6\u7801\uff0c\u5426\u5219\u542f\u52a8\u4f1a\u5931\u8d25"})})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"# \u8f93\u51652\u6b21\u5bc6\u7801\n$ vncpasswd \nPassword:\nVerify:\nWould you like to enter a view-only password (y/n)? n\nA view-only password is not used\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u7b2c\u56db\u6b65\u3001\u542f\u52a8vncserver"}),"\n",(0,r.jsx)(s.admonition,{type:"tip",children:(0,r.jsx)(s.p,{children:(0,r.jsxs)(s.strong,{children:["\u4f7f\u7528\u547d\u4ee4 ",(0,r.jsx)(s.code,{children:"systemctl enable vncserver@:<display>.service"})," \u628a\u60f3\u8981\u5f00\u542f\u7684vnc\u7a97\u53e3\u52a0\u5165\u5f00\u673a\u81ea\u542f\uff0c\u5176\u4e2d ",(0,r.jsx)(s.code,{children:"<display>"})," \u4e3a\u5177\u4f53\u7684\u7a97\u53e3\u53f7"]})})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"systemctl start vncserver@:1.service\nsystemctl enable vncserver@:1.service\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u67e5\u770b\u542f\u52a8"}),"\n",(0,r.jsxs)(s.admonition,{type:"tip",children:[(0,r.jsx)(s.p,{children:(0,r.jsxs)(s.strong,{children:["\u9ed8\u8ba4\u7684\u542f\u52a8\u811a\u672c\u8def\u5f84 ",(0,r.jsx)(s.code,{children:"/root/.vnc/xstartup"})]})}),(0,r.jsx)(s.p,{children:(0,r.jsxs)(s.strong,{children:["\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6\u8def\u5f84 ",(0,r.jsx)(s.code,{children:"/root/.vnc/config"})]})}),(0,r.jsx)(s.p,{children:(0,r.jsxs)(s.strong,{children:["\u9ed8\u8ba4\u7684\u65e5\u5fd7\u6587\u4ef6\u8def\u5f84 ",(0,r.jsx)(s.code,{children:"/root/.vnc/devops01:1.log"})," \u5176\u4e2d ",(0,r.jsx)(s.code,{children:"devops01"})," \u662f\u4e3b\u673a\u540d"]})})]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"$ systemctl status vncserver@:1\n\u25cf vncserver@:1.service - Remote desktop service (VNC)\n   Loaded: loaded (/etc/systemd/system/vncserver@.service; enabled; vendor preset: disabled)\n   Active: active (running) since Wed 2021-12-01 10:37:10 CST; 23s ago\n  Process: 9480 ExecStartPre=/bin/sh -c /usr/bin/vncserver -kill %i > /dev/null 2>&1 || : (code=exited, status=0/SUCCESS)\n Main PID: 9483 (vncserver_wrapp)\n   CGroup: /system.slice/system-vncserver.slice/vncserver@:1.service\n           \u251c\u25009483 /bin/sh /usr/bin/vncserver_wrapper root :1\n           \u2514\u25009675 sleep 5\n\nDec 01 10:37:10 devops01 systemd[1]: Starting Remote desktop service (VNC)...\nDec 01 10:37:10 devops01 systemd[1]: Started Remote desktop service (VNC).\nDec 01 10:37:10 devops01 vncserver_wrapper[9483]: xauth:  file /root/.Xauthority does not exist\nDec 01 10:37:13 devops01 vncserver_wrapper[9483]: New 'devops01:1 (root)' desktop is devops01:1\nDec 01 10:37:13 devops01 vncserver_wrapper[9483]: Creating default startup script /root/.vnc/xstartup\nDec 01 10:37:13 devops01 vncserver_wrapper[9483]: Creating default config /root/.vnc/config\nDec 01 10:37:13 devops01 vncserver_wrapper[9483]: Starting applications specified in /root/.vnc/xstartup\nDec 01 10:37:13 devops01 vncserver_wrapper[9483]: Log file is /root/.vnc/devops01:1.log\nDec 01 10:37:19 devops01 vncserver_wrapper[9483]: 'vncserver :1' has PID 9544, waiting until it exits ...\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u67e5\u770b\u8fdb\u7a0b"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"$ ps aux|grep [X]vnc\nroot      9544  0.0  2.3 194016 24140 ?        Sl   10:37   0:00 /usr/bin/Xvnc :1 -auth /root/.Xauthority -desktop devops01:1 (root) -fp catalogue:/etc/X11/fontpath.d -geometry 1024x768 -pn -rfbauth /root/.vnc/passwd -rfbport 5901 -rfbwait 30000\n"})}),"\n",(0,r.jsx)(s.h2,{id:"3vncserver\u4e00\u4e9b\u64cd\u4f5c\u8bf4\u660e",children:"3.vncserver\u4e00\u4e9b\u64cd\u4f5c\u8bf4\u660e"}),"\n",(0,r.jsx)(s.h3,{id:"31-\u542f\u52a8\u5173\u95ed",children:"3.1 \u542f\u52a8\u3001\u5173\u95ed"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"\u542f\u52a8"})}),"\n",(0,r.jsx)(s.p,{children:"\u65b9\u5f0f\u4e00\uff1asystemd\u7ba1\u7406"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"systemctl start vncserver@:1.service\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u65b9\u5f0f\u4e8c\uff1avncserver\u547d\u4ee4"}),"\n",(0,r.jsxs)(s.p,{children:["\u76f4\u63a5\u8fd0\u884c ",(0,r.jsx)(s.code,{children:"vncserver :\u6570\u5b57"})," \u542f\u52a8"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"$ vncserver :1\n\nNew 'devops01:1 (root)' desktop is devops01:1\n\nStarting applications specified in /root/.vnc/xstartup\nLog file is /root/.vnc/devops01:1.log\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"\u5173\u95ed"})}),"\n",(0,r.jsx)(s.p,{children:"\u65b9\u5f0f\u4e00\uff1asystemd\u7ba1\u7406"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"systemctl stop vncserver@:1.service\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u65b9\u5f0f\u4e8c\uff1avncserver\u547d\u4ee4"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"$ vncserver -kill :1\nKilling Xvnc process ID 16654\n"})}),"\n",(0,r.jsx)(s.h3,{id:"32-\u4fee\u6539vncserver\u7a97\u53e3\u5206\u8fa8\u7387",children:"3.2 \u4fee\u6539vncserver\u7a97\u53e3\u5206\u8fa8\u7387"}),"\n",(0,r.jsxs)(s.p,{children:["\u901a\u8fc7\u67e5\u770bvnc\u8fdb\u7a0b\u53ef\u4ee5\u770b\u5230\uff0cvncserver\u9ed8\u8ba4\u7684\u7a97\u53e3\u5206\u8fa8\u7387\u662f ",(0,r.jsx)(s.code,{children:"1024x768"})]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"$ ps aux|grep [X]vnc\nroot      9544  0.0  2.3 194016 24140 ?        Sl   10:37   0:00 /usr/bin/Xvnc :1 -auth /root/.Xauthority -desktop devops01:1 (root) -fp catalogue:/etc/X11/fontpath.d -geometry 1024x768 -pn -rfbauth /root/.vnc/passwd -rfbport 5901 -rfbwait 30000\n"})}),"\n",(0,r.jsxs)(s.p,{children:["\u5982\u679c\u60f3\u8981\u4fee\u6539vncserver\u542f\u52a8\u7a97\u53e3\u7684\u9ed8\u8ba4\u5206\u8fa8\u7387\uff0c\u9700\u8981\u4fee\u6539 ",(0,r.jsx)(s.code,{children:".vnc/config "})," \u6587\u4ef6\u4e2d ",(0,r.jsx)(s.code,{children:"geometry="})," \u53c2\u6570\uff0c\u9ed8\u8ba4\u662f\u6ce8\u91ca\u7684"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"$ cat ~/.vnc/config \n## Supported server options to pass to vncserver upon invocation can be listed\n## in this file. See the following manpages for more: vncserver(1) Xvnc(1).\n## Several common ones are shown below. Uncomment and modify to your liking.\n##\n# securitytypes=vncauth,tlsvnc\n# desktop=sandbox\n# geometry=2000x1200\n# localhost\n# alwaysshared\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u4fee\u6539\u4e3a\u60f3\u8981\u7684\u5206\u8fa8\u7387\uff0c\u7136\u540e\u91cd\u542f\u8fdb\u7a0b"}),"\n",(0,r.jsx)(s.p,{children:":::caution\u6ce8\u610f"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsxs)(s.strong,{children:["\u91cd\u542fvncserver\u8fdb\u7a0b\u4e0d\u80fd\u4f7f\u7528 ",(0,r.jsx)(s.code,{children:"system"})," \u547d\u4ee4\uff0c\u91cd\u542f\u4f1a\u4e0d\u751f\u6548\u5e76\u4e14\u62a5\u9519"]})}),"\n",(0,r.jsx)(s.p,{children:":::"}),"\n",(0,r.jsxs)(s.p,{children:["\u4f7f\u7528 ",(0,r.jsx)(s.code,{children:"systemctl"})," \u547d\u4ee4\u91cd\u542fvncserver"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"systemctl restart vncserver@:1\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u7136\u540e\u67e5\u770b\u8fdb\u7a0b"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"$ ps aux|grep [X]vnc\nroot     16693  0.0  2.2 192504 22640 pts/0    Sl   18:44   0:00 /usr/bin/Xvnc :1 -auth /root/.Xauthority -desktop devops01:1 (root) -fp catalogue:/etc/X11/fontpath.d -geometry 1024x768 -pn -rfbauth /root/.vnc/passwd -rfbport 5901 -rfbwait 30000\n"})}),"\n",(0,r.jsxs)(s.p,{children:["\u67e5\u770b\u8fdb\u7a0b\u72b6\u6001\uff0c\u53d1\u73b0\u62a5\u9519 ",(0,r.jsx)(s.code,{children:"A VNC server is already running as :1"})," \u5e76\u4e14\u5206\u8fa8\u7387\u6ca1\u6709\u4fee\u6539"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"$ systemctl status  vncserver@:1\n\u25cf vncserver@:1.service - Remote desktop service (VNC)\n   Loaded: loaded (/etc/systemd/system/vncserver@.service; enabled; vendor preset: disabled)\n   Active: failed (Result: exit-code) since Wed 2021-12-01 18:57:41 CST; 12s ago\n  Process: 16631 ExecStop=/bin/sh -c /usr/bin/vncserver -kill %i > /dev/null 2>&1 || : (code=exited, status=0/SUCCESS)\n  Process: 16765 ExecStart=/usr/bin/vncserver_wrapper root %i (code=exited, status=2)\n  Process: 16762 ExecStartPre=/bin/sh -c /usr/bin/vncserver -kill %i > /dev/null 2>&1 || : (code=exited, status=0/SUCCESS)\n Main PID: 16765 (code=exited, status=2)\n\nDec 01 18:57:41 devops01 systemd[1]: Starting Remote desktop service (VNC)...\nDec 01 18:57:41 devops01 systemd[1]: Started Remote desktop service (VNC).\nDec 01 18:57:41 devops01 vncserver_wrapper[16765]: A VNC server is already running as :1\nDec 01 18:57:41 devops01 vncserver_wrapper[16765]: FATAL: 'runuser -l root' failed!\nDec 01 18:57:41 devops01 systemd[1]: vncserver@:1.service: main process exited, code=exited, status=2/INVALIDARGUMENT\nDec 01 18:57:41 devops01 systemd[1]: Unit vncserver@:1.service entered failed state.\nDec 01 18:57:41 devops01 systemd[1]: vncserver@:1.service failed.\n"})}),"\n",(0,r.jsxs)(s.p,{children:["\u4f7f\u7528 ",(0,r.jsx)(s.code,{children:"vncserver -kill :1"})," kill\u6389\u8fdb\u7a0b"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"$ vncserver -kill :1\nKilling Xvnc process ID 16693\n[root@devops01 ~]# vncserver :1\n\nNew 'devops01:1 (root)' desktop is devops01:1\n\nStarting applications specified in /root/.vnc/xstartup\nLog file is /root/.vnc/devops01:1.log\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u7136\u540e\u518d\u6b21\u67e5\u770b\u8fdb\u7a0b\uff0c\u53ef\u4ee5\u770b\u5230\u5206\u8fa8\u7387\u5df2\u7ecf\u4fee\u6539"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"$ ps aux|grep [X]vnc\nroot     16842  0.3  2.8 198808 28936 pts/0    Sl   18:58   0:00 /usr/bin/Xvnc :1 -geometry 2000x1200 -auth /root/.Xauthority -desktop devops01:1 (root) -fp catalogue:/etc/X11/fontpath.d -pn -rfbauth /root/.vnc/passwd -rfbport 5901 -rfbwait 30000\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2021-12-01%2019.05.10.png",alt:"iShot2021-12-01 19.05.10"})})]})}function a(e={}){const{wrapper:s}={...(0,c.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(v,{...e})}):v(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>o});var r=n(96540);const c={},t=r.createContext(c);function i(e){const s=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);