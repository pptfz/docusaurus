"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[5861],{90461:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>s,default:()=>x,frontMatter:()=>c,metadata:()=>o,toc:()=>d});var r=i(74848),t=i(28453);const c={},s="nginx\u8bbf\u95ee\u63a7\u5236",o={id:"linux/linux\u670d\u52a1/nginx/nginx\u8bbf\u95ee\u63a7\u5236",title:"nginx\u8bbf\u95ee\u63a7\u5236",description:"[toc]",source:"@site/docs/linux/linux\u670d\u52a1/nginx/4.nginx\u8bbf\u95ee\u63a7\u5236.md",sourceDirName:"linux/linux\u670d\u52a1/nginx",slug:"/linux/linux\u670d\u52a1/nginx/nginx\u8bbf\u95ee\u63a7\u5236",permalink:"/docs/linux/linux\u670d\u52a1/nginx/nginx\u8bbf\u95ee\u63a7\u5236",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"nginx\u57fa\u7840\u5e94\u7528",permalink:"/docs/linux/linux\u670d\u52a1/nginx/nginx\u57fa\u7840\u5e94\u7528"},next:{title:"nginx\u65e5\u5fd7",permalink:"/docs/linux/linux\u670d\u52a1/nginx/nginx\u65e5\u5fd7"}},l={},d=[{value:"1.1 \u57fa\u4e8eIP\u7684\u8bbf\u95ee\u63a7\u5236",id:"11-\u57fa\u4e8eip\u7684\u8bbf\u95ee\u63a7\u5236",level:2},{value:"1.1.1 \u8bbf\u95ee\u63a7\u5236\u914d\u7f6e\u793a\u4f8b1\uff0c \u62d2\u7edd\u6307\u5b9a\u7684IP\uff0c\u5176\u4ed6\u5168\u90e8\u5141\u8bb8",id:"111-\u8bbf\u95ee\u63a7\u5236\u914d\u7f6e\u793a\u4f8b1-\u62d2\u7edd\u6307\u5b9a\u7684ip\u5176\u4ed6\u5168\u90e8\u5141\u8bb8",level:3},{value:"1.1.2 \u8bbf\u95ee\u63a7\u5236\u914d\u7f6e\u793a\u4f8b2\uff0c\u53ea\u5141\u8bb8\u8c01\u80fd\u8bbf\u95ee\uff0c\u5176\u5b83\u5168\u90e8\u62d2\u7edd",id:"112-\u8bbf\u95ee\u63a7\u5236\u914d\u7f6e\u793a\u4f8b2\u53ea\u5141\u8bb8\u8c01\u80fd\u8bbf\u95ee\u5176\u5b83\u5168\u90e8\u62d2\u7edd",level:3},{value:"<code>http_access_module</code>\u5c40\u9650\u6027",id:"http_access_module\u5c40\u9650\u6027",level:3},{value:"1.2 \u57fa\u4e8e\u7528\u6237\u767b\u9646\u8ba4\u8bc1\u7684\u8bbf\u95ee\u63a7\u5236",id:"12-\u57fa\u4e8e\u7528\u6237\u767b\u9646\u8ba4\u8bc1\u7684\u8bbf\u95ee\u63a7\u5236",level:2},{value:"1.3 \u57fa\u4e8e\u914d\u7f6e\u53c2\u6570\u7684\u8bbf\u95ee\u63a7\u5236",id:"13-\u57fa\u4e8e\u914d\u7f6e\u53c2\u6570\u7684\u8bbf\u95ee\u63a7\u5236",level:2},{value:"1.3.1 nginx\u8fde\u63a5\u9650\u5236\u914d\u7f6e\t<code>limit_conn_module</code>",id:"131-nginx\u8fde\u63a5\u9650\u5236\u914d\u7f6elimit_conn_module",level:3},{value:"1.3.2 nginx\u8bf7\u6c42\u9650\u5236\u914d\u7f6e\t<code>limit_req_module</code>",id:"132-nginx\u8bf7\u6c42\u9650\u5236\u914d\u7f6elimit_req_module",level:3}];function a(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.p,{children:"[toc]"}),"\n",(0,r.jsx)(e.h1,{id:"nginx\u8bbf\u95ee\u63a7\u5236",children:"nginx\u8bbf\u95ee\u63a7\u5236"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u8bbf\u95ee\u63a7\u5236\u7c7b\u522b"})}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsxs)(e.strong,{children:["\u57fa\u4e8eIP\u7684\u8bbf\u95ee\u63a7\u5236\t",(0,r.jsx)(e.code,{children:"http_access_module"})]})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsxs)(e.strong,{children:["\u57fa\u4e8e\u7528\u6237\u767b\u9646\u8ba4\u8bc1\u7684\u8bbf\u95ee\u63a7\u5236\t",(0,r.jsx)(e.code,{children:"http_auth_basic_module"})]})}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"11-\u57fa\u4e8eip\u7684\u8bbf\u95ee\u63a7\u5236",children:"1.1 \u57fa\u4e8eIP\u7684\u8bbf\u95ee\u63a7\u5236"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u8bed\u6cd5\uff1a"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"allow|deny\taddress"})}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"111-\u8bbf\u95ee\u63a7\u5236\u914d\u7f6e\u793a\u4f8b1-\u62d2\u7edd\u6307\u5b9a\u7684ip\u5176\u4ed6\u5168\u90e8\u5141\u8bb8",children:"1.1.1 \u8bbf\u95ee\u63a7\u5236\u914d\u7f6e\u793a\u4f8b1\uff0c \u62d2\u7edd\u6307\u5b9a\u7684IP\uff0c\u5176\u4ed6\u5168\u90e8\u5141\u8bb8"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-nginx",children:"location /nginx_status {\n    stub_status;\n    access_log off;\n    deny 10.0.0.51;\n    allow all;\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"10.0.0.51\u8bbf\u95ee\uff0c\u6743\u9650\u62d2\u7edd"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"$ curl www.abc.com/nginx_status\n<html>\n<head><title>403 Forbidden</title></head>\n<body>\n<center><h1>403 Forbidden</h1></center>\n<hr><center>nginx/1.18.0</center>\n</body>\n</html>\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"10.0.0.52\u8bbf\u95ee\uff0c\u53ef\u4ee5\u8bbf\u95ee"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"$ curl www.abc.com/nginx_status\nActive connections: 1 \nserver accepts handled requests\n 26 26 31 \nReading: 0 Writing: 1 Waiting: 0 \n"})}),"\n",(0,r.jsx)(e.h3,{id:"112-\u8bbf\u95ee\u63a7\u5236\u914d\u7f6e\u793a\u4f8b2\u53ea\u5141\u8bb8\u8c01\u80fd\u8bbf\u95ee\u5176\u5b83\u5168\u90e8\u62d2\u7edd",children:"1.1.2 \u8bbf\u95ee\u63a7\u5236\u914d\u7f6e\u793a\u4f8b2\uff0c\u53ea\u5141\u8bb8\u8c01\u80fd\u8bbf\u95ee\uff0c\u5176\u5b83\u5168\u90e8\u62d2\u7edd"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-nginx",children:"location / {\n    root /website;\n    index index.php index.html index.htm;\n    allow 192.168.9.0/24;\n    allow 10.0.0.51;\n    deny  all;\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"10.0.0.51\u8bbf\u95ee\uff0c\u53ef\u4ee5\u8bbf\u95ee"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"$ curl www.abc.com\nwww.abc.com \u7684\u7f51\u7ad9\u6839\u76ee\u5f55\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"10.0.0.52\u8bbf\u95ee\uff0c\u6743\u9650\u62d2\u7edd"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"$ curl www.abc.com\n<html>\n<head><title>403 Forbidden</title></head>\n<body>\n<center><h1>403 Forbidden</h1></center>\n<hr><center>nginx/1.18.0</center>\n</body>\n</html>\n"})}),"\n",(0,r.jsxs)(e.h3,{id:"http_access_module\u5c40\u9650\u6027",children:[(0,r.jsx)(e.code,{children:"http_access_module"}),"\u5c40\u9650\u6027"]}),"\n",(0,r.jsxs)(e.p,{children:["\u5f53\u5ba2\u6237\u7aef\u901a\u8fc7\u4ee3\u7406\u670d\u52a1\u5668\u8bbf\u95ee\u771f\u5b9e\u7684\u540e\u7aef\u670d\u52a1\u5668\u65f6\uff0c\u901a\u8fc7",(0,r.jsx)(e.code,{children:"remote_addr"}),"\u80fd\u83b7\u53d6\u5230\u4ee3\u7406\u670d\u52a1\u5668\u7684IP\u5730\u5740\uff0c\u4f46\u662f\u65e0\u6cd5\u83b7\u53d6\u5ba2\u6237\u7aef\u7684IP\u5730\u5740"]}),"\n",(0,r.jsxs)(e.p,{children:["\u5728nginx\u4e3b\u914d\u7f6e\u6587\u4ef6",(0,r.jsx)(e.code,{children:"/etc/nginx/nginx.conf"}),"\u4e2d\u8bbf\u95ee\u65e5\u5fd7\u683c\u5f0f\u6709\u5982\u4e0b\u5b9a\u4e49"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-nginx",children:'log_format  main  \'$remote_addr - $remote_user [$time_local] "$request" \'\n                      \'$status $body_bytes_sent "$http_referer" \'\n                      \'"$http_user_agent" "$http_x_forwarded_for"\';\n'})}),"\n",(0,r.jsxs)(e.p,{children:["nginx\u8bbf\u95ee\u65e5\u5fd7",(0,r.jsx)(e.code,{children:"/var/log/nginx/access.log"}),"\u4e2d\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230\u4f7f\u7528",(0,r.jsx)(e.code,{children:"$remote_addr"}),"\u53ef\u4ee5\u83b7\u53d6\u76f4\u63a5\u8bbf\u95ee\u540e\u7aef\u771f\u5b9eweb\u7684\u4ee3\u7406\u670d\u52a1\u5668\u7684IP\uff0c\u4f46\u662f\u6700\u540e\u8fb9\u7684",(0,r.jsx)(e.code,{children:'"-"'}),"\u8868\u660e\u65e0\u6cd5\u83b7\u53d6\u771f\u5b9e\u5ba2\u6237\u7aef\u7684IP"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-nginx",children:'10.0.0.51 - - [16/Jun/2020:00:27:30 +0800] "GET / HTTP/1.0" 200 10 "-" "curl/7.29.0" "-"\n'})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-06-1611.32.42.png",alt:"iShot2020-06-1523.54.57"})}),"\n",(0,r.jsxs)(e.p,{children:["\u73b0\u5728\u5728\u4ee3\u7406\u670d\u52a1\u5668\u548c\u540e\u7aef\u771f\u5b9eweb\u4e2d\u7684nginx\u5934\u6587\u4ef6",(0,r.jsx)(e.code,{children:"proxy_params"}),"\u4e2d\u52a0\u4e0a\u53c2\u6570",(0,r.jsx)(e.code,{children:"X-Forwarded-For"}),"\u4ee5\u83b7\u53d6\u5ba2\u6237\u7aef\u771f\u5b9eIP\uff0c\u7136\u540e\u6a21\u62df\u8bbf\u95ee\u8fc7\u7a0b\u5982\u4e0b"]}),"\n",(0,r.jsx)(e.p,{children:"\u5ba2\u6237\u7aef10.0.0.10--\x3e\u901a\u8fc7\u4ee3\u7406\u670d\u52a1\u566810.0.0.51--\x3e\u8bbf\u95ee\u540e\u7aef\u771f\u5b9eweb 10.0.0.52"}),"\n",(0,r.jsx)(e.p,{children:"\u4ee3\u7406\u670d\u52a1\u566810.0.0.51 nginx\u914d\u7f6e"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-nginx",children:"#\u7f16\u8f91nginx\u53cd\u5411\u4ee3\u7406\u914d\u7f6e\u6587\u4ef6\ncat > /etc/nginx/conf.d/www.abc.com.conf <<EOF\nserver {\n    listen 80;\n    server_name www.abc.com;\n    index index.html index.htm;\n\n    location / {\n        proxy_pass http://10.0.0.52;\n        include proxy_params;\n    }\n}\nEOF\n\n#\u7f16\u8f91nginx\u5934\u6587\u4ef6\uff0c\u52a0\u4e0a\u53c2\u6570X-Forwarded-For\ncat > /etc/nginx/proxy_params <<'EOF'\nproxy_set_header Host $http_host;\nproxy_set_header X-Real-IP $remote_addr;\nproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\nproxy_connect_timeout 30;\nproxy_send_timeout 60;\nproxy_read_timeout 60;\n\nproxy_buffering on;\nproxy_buffer_size 32k;\nproxy_buffers 4 128k;\nEOF\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u540e\u7aef\u771f\u5b9eweb 10.0.0.52\u64cd\u4f5c"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-nginx",children:"#\u7f16\u8f91nginx\u914d\u7f6e\u6587\u4ef6\ncat > /etc/nginx/conf.d/www.abc.com.conf <<EOF\nserver {\n    listen 80;\n    server_name www.abc.com;\n\n    location / {\n        root /website;\n        index index.html index.htm;\n        include proxy_params;\n    }\n}\nEOF\n\n#\u7f16\u8f91nginx\u5934\u6587\u4ef6\uff0c\u52a0\u4e0a\u53c2\u6570X-Forwarded-For\ncat > /etc/nginx/proxy_params <<'EOF'\nproxy_set_header Host $http_host;\nproxy_set_header X-Real-IP $remote_addr;\nproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\nproxy_connect_timeout 30;\nproxy_send_timeout 60;\nproxy_read_timeout 60;\n\nproxy_buffering on;\nproxy_buffer_size 32k;\nproxy_buffers 4 128k;\nEOF\n\n#\u521b\u5efa\u7f51\u7ad9\u6839\u76ee\u5f55\nmkdir /website && echo '10.0.0.52' >/website/index.html\n"})}),"\n",(0,r.jsxs)(e.p,{children:["\u52a0\u4e0a",(0,r.jsx)(e.code,{children:"X-Forwarded-For "}),"\u53c2\u6570\u540e\uff0cnginx\u7684\u8bbf\u95ee\u65e5\u5fd7\u4e2d\u5c31\u53ef\u4ee5\u83b7\u53d6\u5230\u5ba2\u6237\u7aef\u7684\u771f\u5b9eIP\u5730\u5740\u4e86"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-nginx",children:'10.0.0.51 - - [16/Jun/2020:10:35:12 +0800] "GET / HTTP/1.0" 200 10 "-" "curl/7.29.0" "10.0.0.10"\n'})}),"\n",(0,r.jsx)(e.h2,{id:"12-\u57fa\u4e8e\u7528\u6237\u767b\u9646\u8ba4\u8bc1\u7684\u8bbf\u95ee\u63a7\u5236",children:"1.2 \u57fa\u4e8e\u7528\u6237\u767b\u9646\u8ba4\u8bc1\u7684\u8bbf\u95ee\u63a7\u5236"}),"\n",(0,r.jsxs)(e.p,{children:["\u53ef\u5728",(0,r.jsx)(e.code,{children:"http"}),"\u3001",(0,r.jsx)(e.code,{children:"server"}),"\u3001",(0,r.jsx)(e.code,{children:"location"}),"\u4e0b\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\u5373\u53ef"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-nginx",children:'auth_basic "Auth access down Input your Passwd!";\nauth_basic_user_file /etc/nginx/auth_file;\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u914d\u7f6e\u793a\u4f8b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'#\u5b89\u88c5\u5305\nyum -y install httpd-tools\n\n#\u521b\u5efa\u4e00\u4e2a\u7528\u6237\u540d\u4e3atest\u5bc6\u7801\u4e3a123\u7684\u767b\u9646\u8ba4\u8bc1\u7528\u6237\uff0c\u540c\u65f6\u5c06\u5bc6\u7801\u5b58\u653e\u4e8e/etc/nginx/auth_conf\nhtpasswd -b -c /etc/nginx/auth_file test 123\n\n#\u7f16\u8f91nginx\u914d\u7f6e\u6587\u4ef6\nlocation / {\n        root /website;\n        auth_basic "Auth access down Input your Passwd!";\n        auth_basic_user_file /etc/nginx/auth_file;\n        autoindex on;\n        autoindex_exact_size off;\n        autoindex_localtime on;\n        charset utf-8,gbk;\n        index index.php index.html index.htm;\n    }\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u6d4f\u89c8\u5668\u8bbf\u95ee\u63d0\u793a\u9700\u8981\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-06-1523.54.57.png",alt:"iShot2020-06-1611.32.42"})}),"\n",(0,r.jsx)(e.h2,{id:"13-\u57fa\u4e8e\u914d\u7f6e\u53c2\u6570\u7684\u8bbf\u95ee\u63a7\u5236",children:"1.3 \u57fa\u4e8e\u914d\u7f6e\u53c2\u6570\u7684\u8bbf\u95ee\u63a7\u5236"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.a,{href:"https://docs.nginx.com/nginx/admin-guide/security-controls/controlling-access-proxied-http/",children:"\u9650\u5236\u5bf9http\u8d44\u6e90\u8bbf\u95ee\u7684\u5b98\u65b9\u6587\u6863"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"ngx_http_limit_conn_module"}),"\u6a21\u5757\u53ef\u4ee5\u6839\u636e\u5b9a\u4e49\u7684key\u6765\u9650\u5236\u6bcf\u4e2a\u952e\u503c\u7684\u8fde\u63a5\u6570"]}),"\n",(0,r.jsxs)(e.p,{children:["\u56e0\u4e3a",(0,r.jsx)(e.strong,{children:"\u4e00\u6b21tcp\u8fde\u63a5\u53ef\u4ee5\u5efa\u7acb\u591a\u6b21http\u8bf7\u6c42\u8fde\u63a5"}),"\uff0c\u56e0\u6b64http\u8bf7\u6c42\u8fde\u63a5\u8981\u6bd4tcp\u8fde\u63a5\u9650\u5236\u66f4\u51c6\u786e"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"limit_conn_module\t\t\u8fde\u63a5\u9891\u7387\u9650\u5236\uff0cTCP\u8fde\u63a5"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"limit_req_module           \u8bf7\u6c42\u9891\u7387\u9650\u5236\uff0chttp\u8bf7\u6c42\u8fde\u63a5"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"http\u534f\u8bae\u7684\u8fde\u63a5\u4e0e\u8bf7\u6c42"})}),"\n",(0,r.jsx)(e.p,{children:"HTTP\u662f\u5efa\u7acb\u5728TCP\u8fde\u63a5\u4e4b\u4e0a, \u5728\u5b8c\u6210HTTP\u8bf7\u6c42\u9700\u8981\u5148\u5efa\u7acbTCP\u4e09\u6b21\u63e1\u624b\uff08\u79f0\u4e3aTCP\u8fde\u63a5\uff09,\u5728\u8fde\u63a5\u7684\u57fa\u7840\u4e0a\u518d\u53d1\u8d77HTTP\u8bf7\u6c42\u3002"}),"\n",(0,r.jsx)(e.p,{children:"HTTP\u8bf7\u6c42\u5efa\u7acb\u5728\u4e00\u6b21TCP\u8fde\u63a5\u57fa\u7840\u4e0a\uff0c\u4e00\u6b21TCP\u8bf7\u6c42\u81f3\u5c11\u4ea7\u751f\u4e00\u6b21HTTP\u8bf7\u6c42"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-06-1611.58.29.png",alt:"iShot2020-06-1611.58.29"})}),"\n",(0,r.jsxs)(e.h3,{id:"131-nginx\u8fde\u63a5\u9650\u5236\u914d\u7f6elimit_conn_module",children:["1.3.1 nginx\u8fde\u63a5\u9650\u5236\u914d\u7f6e\t",(0,r.jsx)(e.code,{children:"limit_conn_module"})]}),"\n",(0,r.jsx)(e.p,{children:"\u914d\u7f6e\u793a\u4f8b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-nginx",children:"# \u5728nginx\u4e3b\u914d\u7f6e\u6587\u4ef6nginx.con\u4e2dhttp\u6a21\u5757\u4e0b\u52a0\u5165 limit_conn_zone\nhttp {\n    # http\u6bb5\u914d\u7f6e\u8fde\u63a5\u9650\u5236, \u540c\u4e00\u65f6\u523b\u53ea\u5141\u8bb8\u4e00\u4e2a\u5ba2\u6237\u7aefIP\u8fde\u63a5\n    # \u5b9a\u4e49\u4e00\u4e2a\u540d\u4e3a conn_zone \u7684limit_conn\u7528\u6765\u5b58\u50a8session\uff0c\u5927\u5c0f\u662f10M\u5185\u5b58\uff0c\u4ee5$binary_remote_addr\u4e3akey\n    limit_conn_zone $binary_remote_addr zone=conn_zone:10m;\n}\n\n# \u5728xxx.conf\u4e2d\u52a0\u5165limit_conn\nserver { \n    location / {\n    # \u540c\u4e00\u65f6\u523b\u53ea\u5141\u8bb810\u4e2a\u5ba2\u6237\u7aefIP\u8fde\u63a5\n        limit_conn conn_zone 10;\n    }\n}  \n"})}),"\n",(0,r.jsxs)(e.h3,{id:"132-nginx\u8bf7\u6c42\u9650\u5236\u914d\u7f6elimit_req_module",children:["1.3.2 nginx\u8bf7\u6c42\u9650\u5236\u914d\u7f6e\t",(0,r.jsx)(e.code,{children:"limit_req_module"})]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u5982\u4f55\u8bbe\u7f6e\u80fd\u9650\u5236\u67d0\u4e2aIP\u67d0\u4e00\u65f6\u95f4\u6bb5\u7684\u8bbf\u95ee\u6b21\u6570\u662f\u4e00\u4e2a\u8ba9\u4eba\u5934\u75bc\u7684\u95ee\u9898\uff0c\u7279\u522b\u9762\u5bf9\u6076\u610f\u7684ddos\u653b\u51fb\u7684\u65f6\u5019\u3002\u5176\u4e2dCC\u653b\u51fb\uff08Challenge Collapsar\uff09\u662fDDOS\uff08\u5206\u5e03\u5f0f\u62d2\u7edd\u670d\u52a1\uff09\u7684\u4e00\u79cd\uff0c\u4e5f\u662f\u4e00\u79cd\u5e38\u89c1\u7684\u7f51\u7ad9\u653b\u51fb\u65b9\u6cd5\uff0c\u653b\u51fb\u8005\u901a\u8fc7\u4ee3\u7406\u670d\u52a1\u5668\u6216\u8005\u8089\u9e21\u5411\u5411\u53d7\u5bb3\u4e3b\u673a\u4e0d\u505c\u5730\u53d1\u5927\u91cf\u6570\u636e\u5305\uff0c\u9020\u6210\u5bf9\u65b9\u670d\u52a1\u5668\u8d44\u6e90\u8017\u5c3d\uff0c\u4e00\u76f4\u5230\u5b95\u673a\u5d29\u6e83\u3002"}),"\n",(0,r.jsxs)(e.p,{children:["cc\u653b\u51fb\u4e00\u822c\u5c31\u662f\u4f7f\u7528\u6709\u9650\u7684ip\u6570\u5bf9\u670d\u52a1\u5668\u9891\u7e41\u53d1\u9001\u6570\u636e\u6765\u8fbe\u5230\u653b\u51fb\u7684\u76ee\u7684\uff0cnginx\u53ef\u4ee5\u901a\u8fc7",(0,r.jsx)(e.code,{children:"HttpLimitReqModul"})," \u548c ",(0,r.jsx)(e.code,{children:"HttpLimitZoneModule"})," \u914d\u7f6e\u6765\u9650\u5236ip\u5728\u540c\u4e00\u65f6\u95f4\u6bb5\u7684\u8bbf\u95ee\u6b21\u6570\u6765\u9632cc\u653b\u51fb\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"HttpLimitReqModul"})," \u7528\u6765\u9650\u5236\u8fde\u5355\u4f4d\u65f6\u95f4\u5185\u8fde\u63a5\u6570\u7684\u6a21\u5757\uff0c\u4f7f\u7528 ",(0,r.jsx)(e.code,{children:"limit_req_zone"})," \u548c",(0,r.jsx)(e.code,{children:"limit_req"})," \u6307\u4ee4\u914d\u5408\u4f7f\u7528\u6765\u8fbe\u5230\u9650\u5236\u3002\u4e00\u65e6\u5e76\u53d1\u8fde\u63a5\u8d85\u8fc7\u6307\u5b9a\u6570\u91cf\uff0c\u5c31\u4f1a\u8fd4\u56de503\u9519\u8bef\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"HttpLimitConnModul"})," \u7528\u6765\u9650\u5236\u5355\u4e2aip\u7684\u5e76\u53d1\u8fde\u63a5\u6570\uff0c\u4f7f\u7528 ",(0,r.jsx)(e.code,{children:"limit_zone"})," \u548c ",(0,r.jsx)(e.code,{children:"limit_conn"})," \u6307\u4ee4"]}),"\n",(0,r.jsx)(e.p,{children:"\u8fd9\u4e24\u4e2a\u6a21\u5757\u7684\u533a\u522b\u524d\u4e00\u4e2a\u662f\u5bf9\u4e00\u6bb5\u65f6\u95f4\u5185\u7684\u8fde\u63a5\u6570\u9650\u5236\uff0c\u540e\u8005\u662f\u5bf9\u540c\u4e00\u65f6\u523b\u7684\u8fde\u63a5\u6570\u9650\u5236"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u914d\u7f6e\u793a\u4f8b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-nginx",children:"# \u5728nginx\u4e3b\u914d\u7f6e\u6587\u4ef6nginx.con\u4e2dhttp\u6a21\u5757\u4e0b\u52a0\u5165 limit_req_module\nhttp {\n    # http\u6bb5\u914d\u7f6e\u8fde\u63a5\u9650\u5236, 1r/s\u53ea\u63a5\u6536\u4e00\u4e2a\u8bf7\u6c42,\u5176\u4f59\u8bf7\u6c42\u62d2\u7edd\u5904\u7406\u5e76\u8fd4\u56de\u9519\u8bef\u7801\u7ed9\u5ba2\u6237\u7aef\n    # \u5b9a\u4e49\u4e00\u4e2a\u540d\u4e3areq_zone\u7684limit_req_zone\u7528\u6765\u5b58\u50a8session\uff0c\u5927\u5c0f\u662f10M\u5185\u5b58\uff0c\u4ee5$binary_remote_addr\u4e3akey\uff0c\u9650\u5236\u5e73\u5747\u6bcf\u79d2\u7684\u8bf7\u6c42\u6570\u4e3a20\u4e2a\n    # 1M\u80fd\u5b58\u50a816000\u4e2a\u72b6\u6001\uff0crate\u7684\u503c\u5fc5\u987b\u4e3a\u6574\u6570\n    # \u5982\u679c\u9650\u52362\u79d2\u4e00\u4e2a\u8bf7\u6c42\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u621030r/m\n    limit_req_zone $binary_remote_addr zone=req_zone:10m rate=20r/s;\n}\n\n# \u5728xxx.conf\u4e2d\u52a0\u5165 limit_req\nserver { \n    location / {\n        # \u9650\u5236ip\u6bcf\u79d2\u4e0d\u8d85\u8fc720\u4e2a\u8bf7\u6c42\uff0c\u6f0f\u6876\u6570burst\u4e3a5\uff0cburst\u7684\u610f\u601d\u5c31\u662f\uff0c\u5982\u679c\u7b2c1\u79d2\u30012\u30013\u30014\u79d2\u8bf7\u6c42\u4e3a19\u4e2a\uff0c\u7b2c5\u79d2\u7684\u8bf7\u6c42\u4e3a25\u4e2a\u662f\u88ab\u5141\u8bb8\u7684\uff0c\u4f46\u662f\u5982\u679c\u7b2c1\u79d2\u5c31\u670925\u4e2a\u8bf7\u6c42\uff0c\u5219\u7b2c2\u79d2\u8d85\u8fc720\u7684\u8bf7\u6c42\u8fd4\u56de503\n        # nodelay\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u8be5\u9009\u9879\uff0c\u5219\u4e25\u683c\u4f7f\u7528\u5e73\u5747\u901f\u7387\u9650\u5236\u8bf7\u6c42\u6570\uff0c\u7b2c1\u79d2\u4e3a25\u4e2a\u8bf7\u6c42\uff0c5\u4e2a\u8bf7\u6c42\u4f1a\u88ab\u653e\u5230\u7b2c2\u79d2\u6267\u884c\uff1b\u5982\u679c\u8bbe\u7f6e\u4e86nodelay\uff0c\u521925\u4e2a\u8bf7\u6c42\u5728\u7b2c1\u79d2\u6267\u884c\n        limit_req zone=req_zone burst=5 nodelay;\n    }\n}  \n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5728\u7ec8\u7aef\u4e2d\u5feb\u901f\u91cd\u590d\u8bbf\u95ee\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u6709503\u7684\u62a5\u9519"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"[root@test1 ~]# curl www.abc.com\nwww.abc.com \u7684\u7f51\u7ad9\u6839\u76ee\u5f55\n[root@test1 ~]# curl www.abc.com\nwww.abc.com \u7684\u7f51\u7ad9\u6839\u76ee\u5f55\n[root@test1 ~]# curl www.abc.com\n<html>\n<head><title>503 Service Temporarily Unavailable</title></head>\n<body>\n<center><h1>503 Service Temporarily Unavailable</h1></center>\n<hr><center>nginx/1.18.0</center>\n</body>\n</html>\nwww.abc.com \u7684\u7f51\u7ad9\u6839\u76ee\u5f55\n"})}),"\n",(0,r.jsxs)(e.p,{children:["\u4e5f\u53ef\u4ee5\u7528",(0,r.jsx)(e.code,{children:"ab"}),"\u7b80\u5355\u538b\u6d4b\u4e00\u4e0b"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"-n\t\u6307\u5b9a\u6570\u91cf"}),"\n",(0,r.jsx)(e.p,{children:"-c\t\u6307\u5b9a\u5e76\u53d1\u6570"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u53ef\u4ee5\u770b\u5230\u8bf7\u6c42\u6570\u662f50\uff0c\u5931\u8d25\u7684\u6570\u91cf\u662f46\uff0c\u56e0\u4e3a\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bf7\u6c42\u9650\u5236\u4e3a1r/s\uff0cburst=3\uff0c\u56e0\u6b64\u6210\u529f\u6570\u91cf\u662f4"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"$ ab -n 50 -c 10 www.abc.com/index.html\nThis is ApacheBench, Version 2.3 <$Revision: 1430300 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking www.abc.com (be patient).....done\n\n\nServer Software:        nginx/1.18.0\nServer Hostname:        www.abc.com\nServer Port:            80\n\nDocument Path:          /index.html\nDocument Length:        31 bytes\n\nConcurrency Level:      10\nTime taken for tests:   0.005 seconds\nComplete requests:      50\nFailed requests:        46\n   (Connect: 0, Receive: 0, Length: 46, Exceptions: 0)\nWrite errors:           0\nNon-2xx responses:      46\nTotal transferred:      18972 bytes\nHTML transferred:       9186 bytes\nRequests per second:    10066.44 [#/sec] (mean)\nTime per request:       0.993 [ms] (mean)\nTime per request:       0.099 [ms] (mean, across all concurrent requests)\nTransfer rate:          3730.09 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:        0    0   0.1      0       0\nProcessing:     0    1   0.1      1       1\nWaiting:        0    0   0.1      0       1\nTotal:          1    1   0.1      1       1\n\nPercentage of the requests served within a certain time (ms)\n  50%      1\n  66%      1\n  75%      1\n  80%      1\n  90%      1\n  95%      1\n  98%      1\n  99%      1\n 100%      1 (longest request)\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u8fde\u63a5\u9650\u5236\u6ca1\u6709\u8bf7\u6c42\u9650\u5236\u6709\u6548?"})}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"http\u591a\u4e2a\u8bf7\u6c42\u53ef\u4ee5\u5efa\u7acb\u5728\u4e00\u6b21TCP\u8fde\u63a5\u4e4b\u4e0a, \u90a3\u4e48\u6211\u4eec\u5bf9\u8bf7\u6c42\u7684\u7cbe\u5ea6\u9650\u5236\uff0c\u8981\u6bd4\u5bf9\u4e00\u4e2a\u8fde\u63a5\u7684\u9650\u5236\u4f1a\u66f4\u52a0\u7684\u6709\u6548\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u56e0\u4e3a\u540c\u4e00\u65f6\u523b\u53ea\u5141\u8bb8\u4e00\u4e2a\u8fde\u63a5\u8bf7\u6c42\u8fdb\u5165\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u4f46\u662f\u540c\u4e00\u65f6\u523b\u591a\u4e2a\u8bf7\u6c42\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u8fde\u63a5\u8fdb\u5165\u3002"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u6240\u4ee5\u8bf7\u6c42\u9650\u5236\u624d\u662f\u6bd4\u8f83\u4f18\u7684\u89e3\u51b3\u65b9\u6848\u3002"})}),"\n"]})]})}function x(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(a,{...n})}):a(n)}},28453:(n,e,i)=>{i.d(e,{R:()=>s,x:()=>o});var r=i(96540);const t={},c=r.createContext(t);function s(n){const e=r.useContext(c);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:s(n.components),r.createElement(c.Provider,{value:e},n.children)}}}]);