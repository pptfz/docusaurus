"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[3291],{26178:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>a});var i=s(74848),t=s(28453);const l={},r="ECS\u8fd0\u7ef4\u6307\u5357\u4e4bLinux\u7cfb\u7edf\u8bca\u65ad",c={id:"linux/\u963f\u91cc\u4e91\u5f00\u53d1\u8005\u793e\u533a\u4f18\u79c0\u6587\u7ae0/\u6392\u9519\u5b9d\u5178/ECS\u8fd0\u7ef4\u6307\u5357\u4e4bLinux\u7cfb\u7edf\u8bca\u65ad",title:"ECS\u8fd0\u7ef4\u6307\u5357\u4e4bLinux\u7cfb\u7edf\u8bca\u65ad",description:"[toc]",source:"@site/docs/linux/\u963f\u91cc\u4e91\u5f00\u53d1\u8005\u793e\u533a\u4f18\u79c0\u6587\u7ae0/\u6392\u9519\u5b9d\u5178/ECS\u8fd0\u7ef4\u6307\u5357\u4e4bLinux\u7cfb\u7edf\u8bca\u65ad.md",sourceDirName:"linux/\u963f\u91cc\u4e91\u5f00\u53d1\u8005\u793e\u533a\u4f18\u79c0\u6587\u7ae0/\u6392\u9519\u5b9d\u5178",slug:"/linux/\u963f\u91cc\u4e91\u5f00\u53d1\u8005\u793e\u533a\u4f18\u79c0\u6587\u7ae0/\u6392\u9519\u5b9d\u5178/ECS\u8fd0\u7ef4\u6307\u5357\u4e4bLinux\u7cfb\u7edf\u8bca\u65ad",permalink:"/docs/linux/\u963f\u91cc\u4e91\u5f00\u53d1\u8005\u793e\u533a\u4f18\u79c0\u6587\u7ae0/\u6392\u9519\u5b9d\u5178/ECS\u8fd0\u7ef4\u6307\u5357\u4e4bLinux\u7cfb\u7edf\u8bca\u65ad",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"shell\u811a\u672c\u901f\u67e5\u624b\u518c",permalink:"/docs/linux/\u963f\u91cc\u4e91\u5f00\u53d1\u8005\u793e\u533a\u4f18\u79c0\u6587\u7ae0/shell\u811a\u672c/shell\u811a\u672c\u901f\u67e5\u624b\u518c"},next:{title:"brew\u5b89\u88c5",permalink:"/docs/mac\u4e13\u533a/brew\u5b89\u88c5"}},d={},a=[{value:"1.Linux\u542f\u52a8\u4e0e\u767b\u9646\u95ee\u9898",id:"1linux\u542f\u52a8\u4e0e\u767b\u9646\u95ee\u9898",level:2},{value:"1.1 \u8d85\u8be6\u7ec6\u7cfb\u7edf\u542f\u52a8\u4e0e\u767b\u9646\u5f02\u5e38\u6392\u67e5\u70b9",id:"11-\u8d85\u8be6\u7ec6\u7cfb\u7edf\u542f\u52a8\u4e0e\u767b\u9646\u5f02\u5e38\u6392\u67e5\u70b9",level:3},{value:"1.1.1 \u7cfb\u7edf\u542f\u52a8\u5f02\u5e38",id:"111-\u7cfb\u7edf\u542f\u52a8\u5f02\u5e38",level:4},{value:"1.1.2 root \u767b\u9646\u5f02\u5e38",id:"112-root-\u767b\u9646\u5f02\u5e38",level:4},{value:"1.1.3 \u7cfb\u7edf\u767b\u9646\u4e0d\u8fdb\u53bb\u4e86\uff0c\u4e0d\u6302\u76d8\u7684\u60c5\u51b5\u4e0b\u600e\u4e48\u64cd\u4f5c\uff1f",id:"113-\u7cfb\u7edf\u767b\u9646\u4e0d\u8fdb\u53bb\u4e86\u4e0d\u6302\u76d8\u7684\u60c5\u51b5\u4e0b\u600e\u4e48\u64cd\u4f5c",level:4},{value:"1.1.4 \u573a\u666f\u8986\u76d6",id:"114-\u573a\u666f\u8986\u76d6",level:4},{value:"1.1.4.1 Linux \u7cfb\u7edf\u5e38\u89c1\u95ee\u9898\u8bca\u65ad\u8986\u76d6\u4ee5\u4e0b\u573a\u666f",id:"1141-linux-\u7cfb\u7edf\u5e38\u89c1\u95ee\u9898\u8bca\u65ad\u8986\u76d6\u4ee5\u4e0b\u573a\u666f",level:5},{value:"1.1.4.2 Linux \u7cfb\u7edf\u5e38\u89c1\u542f\u52a8\u95ee\u9898\u4fee\u590d\u8986\u76d6\u4ee5\u4e0b\u573a\u666f",id:"1142-linux-\u7cfb\u7edf\u5e38\u89c1\u542f\u52a8\u95ee\u9898\u4fee\u590d\u8986\u76d6\u4ee5\u4e0b\u573a\u666f",level:5},{value:"1.1.5 \u5404\u79cd\u811a\u672c",id:"115-\u5404\u79cd\u811a\u672c",level:4},{value:"1.2 grub.conf \u6587\u4ef6\u5185\u5bb9\u88ab\u6e05\u7a7a\u4e86\u600e\u4e48\u529e",id:"12-grubconf-\u6587\u4ef6\u5185\u5bb9\u88ab\u6e05\u7a7a\u4e86\u600e\u4e48\u529e",level:3},{value:"1.3 \u5de7\u5999\u5229\u7528 strace \u67e5\u627e\u4e22\u5931\u7684\u6587\u4ef6",id:"13-\u5de7\u5999\u5229\u7528-strace-\u67e5\u627e\u4e22\u5931\u7684\u6587\u4ef6",level:3},{value:"1.4 \u5c0f\u5fc3 PAM \u4e0d\u8ba9\u4f60\u767b\u9646",id:"14-\u5c0f\u5fc3-pam-\u4e0d\u8ba9\u4f60\u767b\u9646",level:3},{value:"1.5 CentOS \u767b\u9646\u5361\u4f4f\u7684\u539f\u56e0\u88ab\u6211\u627e\u5230\u4e86",id:"15-centos-\u767b\u9646\u5361\u4f4f\u7684\u539f\u56e0\u88ab\u6211\u627e\u5230\u4e86",level:3},{value:"2.Linux \u6027\u80fd\u95ee\u9898",id:"2linux-\u6027\u80fd\u95ee\u9898",level:2},{value:"2.1 \u627e\u5230 Linux \u865a\u673a Load \u9ad8\u7684&quot;\u5143\u51f6&quot;",id:"21-\u627e\u5230-linux-\u865a\u673a-load-\u9ad8\u7684\u5143\u51f6",level:3},{value:"2.1.1 Load average \u7684\u503c\u4ece\u4f55\u800c\u6765",id:"211-load-average-\u7684\u503c\u4ece\u4f55\u800c\u6765",level:4},{value:"2.1.2 \u5982\u4f55\u627e\u51fa\u7cfb\u7edf\u4e2d load \u9ad8\u65f6\u5904\u4e8e\u8fd0\u884c\u961f\u5217\u7684\u8fdb\u7a0b",id:"212-\u5982\u4f55\u627e\u51fa\u7cfb\u7edf\u4e2d-load-\u9ad8\u65f6\u5904\u4e8e\u8fd0\u884c\u961f\u5217\u7684\u8fdb\u7a0b",level:4},{value:"2.2 OOM killer \u662f\u88ab\u8c01\u89e6\u53d1\u7684",id:"22-oom-killer-\u662f\u88ab\u8c01\u89e6\u53d1\u7684",level:3},{value:"2.2.1 \u95ee\u9898\u63cf\u8ff0",id:"221-\u95ee\u9898\u63cf\u8ff0",level:4},{value:"2.2.2 \u77e5\u8bc6\u70b9\u68b3\u7406",id:"222-\u77e5\u8bc6\u70b9\u68b3\u7406",level:4},{value:"2.2.2.1 \u9884\u5907\u77e5\u8bc6",id:"2221-\u9884\u5907\u77e5\u8bc6",level:5},{value:"2.2.2.1.1 \u51e0\u4e2a\u57fa\u672c\u7684\u6982\u5ff5",id:"22211-\u51e0\u4e2a\u57fa\u672c\u7684\u6982\u5ff5",level:6},{value:"2.2.2.1.2 \u5185\u6838\u5206\u914d\u5185\u5b58\u7684\u51fd\u6570",id:"22212-\u5185\u6838\u5206\u914d\u5185\u5b58\u7684\u51fd\u6570",level:6},{value:"2.2.2.2 \u65e5\u5fd7\u89e3\u8bfb",id:"2222-\u65e5\u5fd7\u89e3\u8bfb",level:5},{value:"2.3 \u6211\u7684\u670d\u52a1\u5668\u5185\u5b58\u53bb\u54ea\u513f\u4e86",id:"23-\u6211\u7684\u670d\u52a1\u5668\u5185\u5b58\u53bb\u54ea\u513f\u4e86",level:3},{value:"2.4 CPU \u5360\u7528\u4e0d\u9ad8\u4f46\u7f51\u7edc\u6027\u80fd\u5f88\u5dee\u7684\u4e00\u4e2a\u539f\u56e0",id:"24-cpu-\u5360\u7528\u4e0d\u9ad8\u4f46\u7f51\u7edc\u6027\u80fd\u5f88\u5dee\u7684\u4e00\u4e2a\u539f\u56e0",level:3},{value:"2.4.1 \u4ec0\u4e48\u662f\u4e2d\u65ad\uff1f",id:"241-\u4ec0\u4e48\u662f\u4e2d\u65ad",level:4},{value:"2.4.2 \u4ec0\u4e48\u662f RPS/RFS",id:"242-\u4ec0\u4e48\u662f-rpsrfs",level:4},{value:"2.4.3 \u5982\u4f55\u67e5\u770b\u7f51\u5361\u7684\u961f\u5217\u6570",id:"243-\u5982\u4f55\u67e5\u770b\u7f51\u5361\u7684\u961f\u5217\u6570",level:4},{value:"2.5 \u4e00\u6b21 IO \u5f02\u5e38\u6355\u83b7\u8fc7\u7a0b",id:"25-\u4e00\u6b21-io-\u5f02\u5e38\u6355\u83b7\u8fc7\u7a0b",level:3},{value:"2.5.1 \u91c7\u96c6\u7cfb\u7edf IO\uff0c\u786e\u8ba4 IO \u5f02\u5e38\u53d1\u751f\u5728\u7cfb\u7edf\u76d8\uff0c\u8fd8\u662f\u6570\u636e\u76d8\uff0c\u4f7f\u7528\u7cfb\u7edf\u81ea\u5e26\u7684 iostat \u5373\u53ef\u91c7\u96c6",id:"251-\u91c7\u96c6\u7cfb\u7edf-io\u786e\u8ba4-io-\u5f02\u5e38\u53d1\u751f\u5728\u7cfb\u7edf\u76d8\u8fd8\u662f\u6570\u636e\u76d8\u4f7f\u7528\u7cfb\u7edf\u81ea\u5e26\u7684-iostat-\u5373\u53ef\u91c7\u96c6",level:4},{value:"2.5.2 \u786e\u8ba4\u54ea\u5757\u76d8\u53d1\u751f\u4e86 IO \u8fd8\u4e0d\u591f\uff0c\u518d\u6293\u4e00\u4e0b\u53d1\u751f IO \u7684\u8fdb\u7a0b\uff0c\u9700\u8981\u5b89\u88c5 iotop \u8fdb\u884c\u6355\u83b7",id:"252-\u786e\u8ba4\u54ea\u5757\u76d8\u53d1\u751f\u4e86-io-\u8fd8\u4e0d\u591f\u518d\u6293\u4e00\u4e0b\u53d1\u751f-io-\u7684\u8fdb\u7a0b\u9700\u8981\u5b89\u88c5-iotop-\u8fdb\u884c\u6355\u83b7",level:4},{value:"2.5.3 \u4f7f\u7528 fio \u8fdb\u884c IO \u538b\u6d4b\uff0c\u5177\u4f53\u53c2\u6570\u53ef\u4ee5\u53c2\u8003\u5757\u5b58\u50a8\u6027\u80fd",id:"253-\u4f7f\u7528-fio-\u8fdb\u884c-io-\u538b\u6d4b\u5177\u4f53\u53c2\u6570\u53ef\u4ee5\u53c2\u8003\u5757\u5b58\u50a8\u6027\u80fd",level:4},{value:"3.Linux \u4e3b\u673a\u7f51\u7edc\u95ee\u9898",id:"3linux-\u4e3b\u673a\u7f51\u7edc\u95ee\u9898",level:2},{value:"3.1 ifdown ifup \u547d\u4ee4\u4e22\u5931\u5904\u7406",id:"31-ifdown-ifup-\u547d\u4ee4\u4e22\u5931\u5904\u7406",level:3},{value:"3.2 \u7f51\u7edc\u4e0d\u901a\uff1f strace \u4e8c\u5ea6\u51fa\u624b",id:"32-\u7f51\u7edc\u4e0d\u901a-strace-\u4e8c\u5ea6\u51fa\u624b",level:3},{value:"3.3 TIME_WAIT &amp; CLOSE_WAIT \u7684\u8ba8\u8bba\u603b\u7ed3",id:"33-time_wait--close_wait-\u7684\u8ba8\u8bba\u603b\u7ed3",level:3},{value:"3.3.1 \u4e3a\u4ec0\u4e48\u9700\u8981 TIME_WAIT \uff1f",id:"331-\u4e3a\u4ec0\u4e48\u9700\u8981-time_wait-",level:4},{value:"3.3.2 TIME_WAIT \u4f1a\u5bfc\u81f4\u4ec0\u4e48\u95ee\u9898",id:"332-time_wait-\u4f1a\u5bfc\u81f4\u4ec0\u4e48\u95ee\u9898",level:4},{value:"3.3.3 \u5982\u4f55\u89e3\u51b3 time_wait?",id:"333-\u5982\u4f55\u89e3\u51b3-time_wait",level:4},{value:"3.3.4 \u5982\u679c tw \u6ee1\u4e86\u4f1a\u600e\u4e48\u6837",id:"334-\u5982\u679c-tw-\u6ee1\u4e86\u4f1a\u600e\u4e48\u6837",level:4},{value:"3.3.5 tw \u7684\u5f00\u9500\u662f\u4ec0\u4e48",id:"335-tw-\u7684\u5f00\u9500\u662f\u4ec0\u4e48",level:4},{value:"3.3.6 tw \u653e\u5927\u7684\u597d\u4e0e\u574f",id:"336-tw-\u653e\u5927\u7684\u597d\u4e0e\u574f",level:4},{value:"3.3.7 \u5173\u4e8eCLOSE_WAIT",id:"337-\u5173\u4e8eclose_wait",level:4},{value:"3.4 \u4e00\u6b21\u7f51\u7edc\u6296\u52a8\u7ecf\u5178\u6848\u4f8b\u5206\u6790",id:"34-\u4e00\u6b21\u7f51\u7edc\u6296\u52a8\u7ecf\u5178\u6848\u4f8b\u5206\u6790",level:3},{value:"4.Linux \u7cfb\u7edf\u670d\u52a1\u4e0e\u53c2\u6570\u95ee\u9898",id:"4linux-\u7cfb\u7edf\u670d\u52a1\u4e0e\u53c2\u6570\u95ee\u9898",level:2},{value:"4.1 4 \u4e2a limits \u751f\u6548\u7684\u95ee\u9898",id:"41-4-\u4e2a-limits-\u751f\u6548\u7684\u95ee\u9898",level:3},{value:"4.1.1 \u7b2c\u4e00\u4e2a\u95ee\u9898",id:"411-\u7b2c\u4e00\u4e2a\u95ee\u9898",level:4},{value:"4.1.2 \u7b2c\u4e8c\u4e2a\u95ee\u9898",id:"412-\u7b2c\u4e8c\u4e2a\u95ee\u9898",level:4},{value:"4.1.3 \u7b2c\u4e09\u4e2a\u95ee\u9898",id:"413-\u7b2c\u4e09\u4e2a\u95ee\u9898",level:4},{value:"4.1.4 \u7b2c\u56db\u4e2a\u95ee\u9898",id:"414-\u7b2c\u56db\u4e2a\u95ee\u9898",level:4},{value:"4.2 \u516d\u6b65\u6392\u67e5 ss &amp; netstat \u7edf\u8ba1\u7ed3\u679c\u4e0d\u4e00\u6837\u7684\u539f\u56e0",id:"42-\u516d\u6b65\u6392\u67e5-ss--netstat-\u7edf\u8ba1\u7ed3\u679c\u4e0d\u4e00\u6837\u7684\u539f\u56e0",level:3},{value:"4.3 \u4e3a\u4ec0\u4e48\u660e\u660e\u5185\u5b58\u5f88\u5145\u8db3\u4f46\u662f java \u7a0b\u5e8f\u4ecd\u7533\u8bf7\u4e0d\u5230\u5185\u5b58",id:"43-\u4e3a\u4ec0\u4e48\u660e\u660e\u5185\u5b58\u5f88\u5145\u8db3\u4f46\u662f-java-\u7a0b\u5e8f\u4ecd\u7533\u8bf7\u4e0d\u5230\u5185\u5b58",level:3},{value:"4.4 \u8bf7\u4e0d\u8981\u5ffd\u7565 min_free_kbytes \u7684\u8bbe\u7f6e",id:"44-\u8bf7\u4e0d\u8981\u5ffd\u7565-min_free_kbytes-\u7684\u8bbe\u7f6e",level:3},{value:"5.\u6700\u540e\u7684\u5f69\u86cb",id:"5\u6700\u540e\u7684\u5f69\u86cb",level:2},{value:"\u67d0\u5730\u533a\u53e3\u7f69\u9879\u76ee\u67b6\u6784\u6f14\u8fdb\u53ca\u4f18\u5316\u7ecf\u9a8c",id:"\u67d0\u5730\u533a\u53e3\u7f69\u9879\u76ee\u67b6\u6784\u6f14\u8fdb\u53ca\u4f18\u5316\u7ecf\u9a8c",level:3}];function o(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.p,{children:"[toc]"}),"\n",(0,i.jsx)(e.h1,{id:"ecs\u8fd0\u7ef4\u6307\u5357\u4e4blinux\u7cfb\u7edf\u8bca\u65ad",children:"ECS\u8fd0\u7ef4\u6307\u5357\u4e4bLinux\u7cfb\u7edf\u8bca\u65ad"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"https://developer.aliyun.com/topic/ebook",children:"\u6587\u6863\u6284\u88ad\u4e8e\u963f\u91cc\u4e91\u5f00\u53d1\u8005\u793e\u533a"})}),"\n",(0,i.jsx)(e.h1,{id:"\u76ee\u5f55",children:"\u76ee\u5f55"}),"\n",(0,i.jsx)(e.p,{children:"Linux\u542f\u52a8\u4e0e\u767b\u9646\u95ee\u9898"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u8d85\u8be6\u7ec6\u7cfb\u7edf\u542f\u52a8\u4e0e\u767b\u9646\u5f02\u5e38\u6392\u67e5\u70b9"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"grub.conf \u6587\u4ef6\u5185\u5bb9\u88ab\u6e05\u7a7a\u4e86\u600e\u4e48\u529e"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u5de7\u5999\u5229\u7528 strace \u67e5\u627e\u4e22\u5931\u7684\u6587\u4ef6"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u5c0f\u5fc3 PAM \u4e0d\u8ba9\u4f60\u767b\u5f55"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"CentOS \u767b\u5f55\u5361\u4f4f\u7684\u539f\u56e0\u88ab\u6211\u627e\u5230\u4e86"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"Linux \u6027\u80fd\u95ee\u9898"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:'\u627e\u5230 Linux \u865a\u673a Load \u9ad8\u7684"\u5143\u51f6"'}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"OOM killer \u662f\u88ab\u8c01\u89e6\u53d1\u7684"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u6211\u7684\u670d\u52a1\u5668\u5185\u5b58\u53bb\u54ea\u513f\u4e86"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"CPU \u5360\u7528\u4e0d\u9ad8\u4f46\u7f51\u7edc\u6027\u80fd\u5f88\u5dee\u7684\u4e00\u4e2a\u539f\u56e0"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u4e00\u6b21 IO \u5f02\u5e38\u6355\u83b7\u8fc7\u7a0b"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"Linux \u4e3b\u673a\u7f51\u7edc\u95ee\u9898"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"ifdown ifup \u547d\u4ee4\u4e22\u5931\u5904\u7406"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u7f51\u7edc\u4e0d\u901a\uff1f strace \u4e8c\u5ea6\u51fa\u624b"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"TIME_WAIT & CLOSE_WAIT \u7684\u8ba8\u8bba\u603b\u7ed3"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u4e00\u6b21\u7f51\u7edc\u6296\u52a8\u7ecf\u5178\u6848\u4f8b\u5206\u6790"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"Linux \u7cfb\u7edf\u670d\u52a1\u4e0e\u53c2\u6570\u95ee\u9898"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"4 \u4e2a limits \u751f\u6548\u7684\u95ee\u9898"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"6 \u6b65\u6392\u67e5 ss& netstat \u7edf\u8ba1\u7ed3\u679c\u4e0d\u4e00\u6837\u7684\u539f\u56e0"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u4e3a\u4ec0\u4e48\u660e\u660e\u5185\u5b58\u5f88\u5145\u8db3\u4f46\u662f java \u7a0b\u5e8f\u4ecd\u7533\u8bf7\u4e0d\u5230\u5185\u5b58"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u8bf7\u4e0d\u8981\u5ffd\u7565 min_free_kbytes \u7684\u8bbe\u7f6e"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u6700\u540e\u7684\u5f69\u86cb"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u67d0\u5730\u533a\u53e3\u7f69\u9879\u76ee\u67b6\u6784\u6f14\u8fdb\u53ca\u4f18\u5316\u7ecf\u9a8c"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"1linux\u542f\u52a8\u4e0e\u767b\u9646\u95ee\u9898",children:"1.Linux\u542f\u52a8\u4e0e\u767b\u9646\u95ee\u9898"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u8bf4\u660e"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Linux \u542f\u52a8\u4e0e\u767b\u5f55\u95ee\u9898\u662f ECS \u7684\u9ad8\u9891\u95ee\u9898\uff0c\u800c\u5f80\u5f80\u5904\u7406\u4e0d\u53ca\u65f6\u4f1a\u76f4\u63a5\u5f71\u54cd\u5230\u7528\u6237\u4e1a\u52a1\u7684\u6b63\u5e38\u53ef\u6301\u7eed\u8fd0\u884c\uff0c\u56e0\u6b64\u4e5f\u53d8\u6210\u4e86\u6211\u4eec\u5904\u7406\u95ee\u9898\u4f18\u5148\u7ea7\u7684\u91cd\u4e2d\u4e4b\u91cd\u3002 \u5728\u4e91\u73af\u5883\u4e0a\u5f71\u54cd ECS \u542f\u52a8\u4e0e\u767b\u5f55\u7684\u56e0\u7d20\u975e\u5e38\u591a\uff0c\u955c\u50cf\u3001\u7ba1\u63a7\u3001\u865a\u62df\u5316\u3001\u5e95\u5c42\u786c\u4ef6\u3001\u7cfb\u7edf\u4e0e\u6587\u4ef6\u5f02\u5e38\u7b49\u7b49\uff0c\u672c\u6587\u4ec5\u4ece\u7cfb\u7edf\u4e0e\u6587\u4ef6\u672c\u8eab\u89d2\u5ea6\uff0c\u5728\u5927\u91cf\u5904\u7406\u7ecf\u9a8c\u7684\u57fa\u7840\u4e0a\uff0c\u5f52\u7eb3\u603b\u7ed3\u4e86\u4e00\u4e9b\u53ef\u80fd\u4f1a\u5f15\u8d77\u7cfb\u7edf\u542f\u52a8\u4e0e\u767b\u5f55\u95ee\u9898\u7684\u6392\u67e5\u70b9\uff0c\u5e76\u7ed9\u51fa\u51e0\u4e2a\u6bd4\u8f83\u5e38\u89c1\u7684\u5178\u578b\u6848\u4f8b\u6765\u5177\u4f53\u5c55\u793a\u548c\u8bf4\u660e\u3002"})}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"11-\u8d85\u8be6\u7ec6\u7cfb\u7edf\u542f\u52a8\u4e0e\u767b\u9646\u5f02\u5e38\u6392\u67e5\u70b9",children:"1.1 \u8d85\u8be6\u7ec6\u7cfb\u7edf\u542f\u52a8\u4e0e\u767b\u9646\u5f02\u5e38\u6392\u67e5\u70b9"}),"\n",(0,i.jsx)(e.h4,{id:"111-\u7cfb\u7edf\u542f\u52a8\u5f02\u5e38",children:"1.1.1 \u7cfb\u7edf\u542f\u52a8\u5f02\u5e38"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u90e8\u5206 CentOS \u7cfb\u7edf\u542f\u52a8\u9ed1\u5c4f\uff0c\u65e0\u5f02\u5e38\u62a5\u9519\u7684\u573a\u666f\uff0c\u53ef\u4ee5 fsck \u4e00\u4e0b\u7cfb\u7edf\u76d8\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u6839\u5206\u533a\u7a7a\u95f4\u6ee1\uff0c\u4ee5\u53ca inode \u6570\u91cf\u8017\u5c3d\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u5347\u7ea7\u5185\u6838\u6216\u8005\u4ece\u8001\u7684\u5171\u4eab\u5b9e\u4f8b\u8fc1\u79fb\u5230\u72ec\u4eab\u89c4\u683c\u5bfc\u81f4\u7684\u542f\u52a8\u5f02\u5e38\u3002"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u624b\u52a8\u6ce8\u5165\u9a71\u52a8 (mkinitrd virtio \u76f8\u5173\u9a71\u52a8 )\u3002"}),"\n",(0,i.jsx)(e.li,{children:"\u4fee\u6539 grub \u7684\u542f\u52a8\u987a\u5e8f\uff0c\u4f18\u5148\u5c1d\u8bd5\u4f7f\u7528\u8001\u5185\u6838\u542f\u52a8\u3002"}),"\n",(0,i.jsx)(e.li,{children:"/boot \u76ee\u5f55\u4e0b\u9762\u5185\u6838\u7684\u5173\u8054\u6587\u4ef6\u662f\u5426\u5168\uff08\u4e0b\u9762\u4ec5\u4e3a demo\uff0c\u4e0d\u540c\u7cfb\u7edf\u5185\u6838\u7248 \u672c\u6587\u4ef6\u4e0d\u4e00\u81f4\uff0c\u90e8\u5206\u5185\u6838\u7248\u672c boot \u4e0b\u7684 i386 \u76ee\u5f55\u4e5f\u662f\u6709\u7528\u7684\uff09\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"config-4.9.0-7-amd64\ninitrd.img-4.9.0-7-amd64\nSystem.map-4.9.0-7-amd64\nvmlinuz-4.9.0-7-amd64\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"/boot/grub/device.map"})," \u91cc\u9762\u7684 hda \u6539\u6210 vda\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"fstab/grub"})," \u4e2d\u7684 uuid \u4e0d\u5bf9\uff0c\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539\u4e3a ",(0,i.jsx)(e.code,{children:"/dev/vda1"})," \u8fd9\u79cd\u5f62\u5f0f\u5c1d\u8bd5\u3002 \u6570\u636e\u76d8\u5206\u533a\u5f02\u5e38\u52a0\u8f7d\u8d77\u4e0d\u6765\u7684\u573a\u666f\uff0c\u53ef\u4ee5\u53bb\u6ce8\u91ca fstab \u6240\u6709\u7684\u884c\uff0c\u6dfb\u52a0\u7c7b\u4f3c\u4e0b\u9762\u7684\u542f\u52a8\u9879\u5c1d\u8bd5\uff0c \u4e5f\u9002\u7528\u4e8e\u7cfb\u7edf\u76d8\u5feb\u7167\u521b\u5efa\u4e91\u76d8\u6302\u8f7d\u540e\uff0cuuid \u4e00\u81f4\u5bfc\u81f4\u7684\u542f\u52a8\u5f02 \u5e38\uff0c\u6539\u6210\u975e UUID \u7684\u6302\u8f7d\u5373\u53ef\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"/dev/vda1 / ext4 defaults 1 1\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6839\u76ee\u5f55\u6743\u9650 777\uff08\u90e8\u5206\u76ee\u5f55 777\uff09\u4e5f\u4f1a\u5bfc\u81f4\u542f\u52a8\u5f02\u5e38\uff0c\u6216\u8005 ssh \u767b\u9646\u5f02\u5e38\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"https://yq.aliyun.com/articles/761371",children:"\u53ef\u53c2\u8003\u6b64\u6587\u7ae0\u6743\u9650\u4fee\u590d\u5c1d\u8bd5"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5e38\u89c1\u7684\u5173\u952e\u76ee\u5f55\u7f3a\u5931\uff0c\u6709\u7684\u662f\u8f6f\u94fe\uff0c\u4e5f\u53ef\u4ee5\u770b\u770b\u5bf9\u5e94\u76ee\u5f55\u4e0b\u9762\u7684\u6587\u4ef6\u6570\u91cf\uff08\u6587\u4ef6\u6570\u91cf\u8981\u8ddf\u540c\u5185\u6838\u7248\u672c\u6216\u8005\u76f8\u5dee\u4e0d\u5927\u7684\u7248\u672c\u5bf9\u6bd4\uff09\uff0c\u7b80\u5355\u5224\u65ad\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"/bin /sbin /lib /lib32 /lib64 /etc /boot /usr/bin /usr/sbin /usr/lib / usr/lib64 \u7b49\u76ee\u5f55\u6216\u6587\u4ef6\u7f3a\u5931\n\nfor i in /bin /sbin /lib /lib32 /lib64 /etc /boot /usr/bin /usr/sbin / usr/lib /usr/lib64 ;do ls -l $i |wc -l ;done\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u5f71\u54cd\u542f\u52a8\u7684\u53c2\u6570\u3002 \u5982\u679c\u53c2\u6570\u8bbe\u7f6e\u4e0d\u5f53\uff0c\u662f\u4f1a\u5bfc\u81f4\u542f\u52a8\u5f02\u5e38\u7684\uff0c\u5982 ",(0,i.jsx)(e.code,{children:"/etc/sysctl.conf"})," \u4ee5\u53ca\u68c0\u67e5 ",(0,i.jsx)(e.code,{children:"rc.local"})," \u7684\u914d\u7f6e\uff0c",(0,i.jsx)(e.code,{children:"profile"})," \u7684\u68c0\u67e5\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"vm.nr_hugepages\nvm.min_free_kbytes\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"CentOS \u7684 selinux \u9700\u8981\u5173\u95ed\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"# This file controls the state of SELinux on the system.\n# SELINUX= can take one of these three values:\n#     enforcing - SELinux security policy is enforced.\n#     permissive - SELinux prints warnings instead of enforcing.\n#     disabled - No SELinux policy is loaded.\nSELINUX=disabled\n# SELINUXTYPE= can take one of three two values:\n#     targeted - Targeted processes are protected,\n#     minimum - Modification of targeted policy. Only selected processes are protected. \n#     mls - Multi Level Security protection.\nSELINUXTYPE=targeted\n"})}),"\n",(0,i.jsx)(e.h4,{id:"112-root-\u767b\u9646\u5f02\u5e38",children:"1.1.2 root \u767b\u9646\u5f02\u5e38"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"/etc/passwd"}),"\u3001",(0,i.jsx)(e.code,{children:"/etc/shadow"})," ( \u7528\u6237\u540d root polikt dbus \u7b49\u5173\u952e\u7528\u6237\u5b58\u5728\u4e0e\u5426\uff0c\u6587 \u4ef6\u4e3a\u7a7a\uff0c\u683c\u5f0f\u4e71\uff08dos2unix)\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"/etc/pam.d"})," \u76ee\u5f55\u4e0b\u662f\u5426\u6709\u4e3a\u7a7a\u7684\u6587\u4ef6\u53ca\u53c2\u6570\u8bbe\u7f6e\u662f\u5426\u6b63\u5e38\uff0c \u5982\u5e38\u89c1\u7684 ",(0,i.jsx)(e.code,{children:"system-auth passwd"}),"\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"/etc/pam.d"})," \u4e0b\u9762\u6240\u6709\u6587\u4ef6\u91cc\u9762\u6d89\u53ca\u7684 so \u6587\u4ef6\uff0c\u770b\u770b\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u662f\u5426\u4e3a\u7a7a ",(0,i.jsx)(e.code,{children:"/ usr/lib64/security"}),"\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["\u67e5 ",(0,i.jsx)(e.code,{children:"/etc /lib64"}),"\u3001 ",(0,i.jsx)(e.code,{children:"/bin"}),"\u3001 ",(0,i.jsx)(e.code,{children:"/sbin"}),"\u3001",(0,i.jsx)(e.code,{children:"/usr/bin"}),"\u3001 ",(0,i.jsx)(e.code,{children:"/usr/sbin"})," \u7b49\u76ee\u5f55\u6709\u6ca1\u6709 size \u4e3a 0 \u7684\u6587\u4ef6\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"/etc/profile"}),"\u3001",(0,i.jsx)(e.code,{children:"/etc/profile.d"}),"( \u6253 \u5370 \u5217 \u8868 )\u3001 ",(0,i.jsx)(e.code,{children:"/etc/bashrc"}),"\u3001 ",(0,i.jsx)(e.code,{children:"/root/.bash_profile"}),"\u3001",(0,i.jsx)(e.code,{children:"/root/.bashrc"})," \u7b49\u6d89\u53ca\u767b\u9646\u73af\u5883\u8bbe\u7f6e\u7684\u6587\u4ef6\u662f\u5426\u5f02\u5e38\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u6ce8\u610f\u5185\u6838\u7248\u672c\uff0c\u662f\u5426\u5b58\u5728\u65b0\u8001\u5185\u6838\uff0c\u591a\u66f4\u6362\u51e0\u4e2a\u5185\u6838\u8bd5\u4e0b\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u7cfb\u7edf\u65e5\u5fd7\u4e5f\u662f\u4e00\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u68c0\u67e5\u9879\uff08\u540e\u9762\u4f1a\u4ecb\u7ecd\u65e0\u6cd5\u767b\u9646\u600e\u4e48\u68c0\u67e5\uff09\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["Ubuntu 12.04 \u767b\u9646\u5f02\u5e38\u5728 ",(0,i.jsx)(e.code,{children:"/etc/login.defs"})," \u91cc\u9762\u914d\u7f6e\u4e86\u9519\u8bef\u7684 ",(0,i.jsx)(e.code,{children:"ERASECHAR"})," \u5bfc\u81f4\uff0c\u6062\u590d\u9ed8\u8ba4 0177 \u5373\u53ef\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"configuration error - cannot parse erasechar value\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u8f93\u5165 root \u540e\u76f4\u63a5 login \u5931\u8d25\u4e09\u8fde\uff0c\u65e5\u5fd7\u5982\u4e0b\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"Feb 12 18:18:03 iZbp1cabe6lyx26ikmjie2Z login: FAILED LOGIN 1 FROM tty1 FOR root, Authentication failure\n\nFeb 12 18:18:03 iZbp1cabe6lyx26ikmjie2Z login: FAILED LOGIN 2 FROM tty1 FOR (unknown), Authentication failure\n\nFeb 12 18:18:03 iZbp1cabe6lyx26ikmjieZZ login: FAILED LOGIN SESSION FROM tty1 FOR (unknown), Authentication failure\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u627e\u4e2a\u540c\u5185\u6838\u7248\u672c\u7684\u673a\u5668\u5bf9\u6bd4\u53d1\u73b0\u6ca1\u6709 ",(0,i.jsx)(e.code,{children:"/etc/pam.d/login"}),"\u3002"]}),"\n",(0,i.jsx)(e.p,{children:"rpm \u5305\u6821\u9a8c\u4e00\u4e0b\uff0c\u786e\u8ba4 login \u6587\u4ef6\u6ca1\u4e86\uff0c\u624b\u52a8\u521b\u5efa\u4e00\u4e2a\uff0c\u5185\u5bb9\u62f7\u8d1d\u8fc7\u6765\uff0c\u597d\u4e86\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:'[root@iZbp1cabe6lyx26ikmjie2Z pam.d]# rpm -V util-linux \nmissing c /etc/pam.d/login\n\n[root@iZbp1cabe6lyx26ikmjie2Z pam.d]# rpm -ql util-linux|egrep -vi "gz|mo|share"\n/etc/mtab\n/etc/pam.d/chfn\n/etc/pam.d/chsh\n/etc/pam.d/login\n/etc/pam.d/runuser\n/etc/pam.d/runuser-l\n/etc/pam.d/su\n/etc/pam.d/su-l\n'})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"/etc/ssh/sshd_config"})," \u76f8\u5173\u53c2\u6570\u5982 ",(0,i.jsx)(e.code,{children:"LoginGraceTime/Allowusers/PermitRootLogin"}),"\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["\u95ee\u9898\u4e0d\u597d\u786e\u8ba4\u7684\u65f6\u5019\uff0c \u53ef\u4ee5\u5c06 shadow \u5bc6\u7801\u5b57\u6bb5\u6e05\u7a7a\uff0c \u770b\u770b\u767b\u9646\u662f\u5426\u6b63\u5e38\uff0c \u53ef\u4ee5\u5224\u65ad\u662f\u5426\u5230\u5bc6\u7801\u9a8c\u8bc1\u9636\u6bb5\u4e86\u3002 \u4e4b\u524d\u6709\u8fc7\u4e00\u7bc7\u5173\u4e8e ssh \u95ee\u9898\u6392\u67e5\u7684\u6587\u6863\uff0c\u53ef\u53c2\u8003\uff1a",(0,i.jsx)(e.a,{href:"https://yq.aliyun.com/articles/540769",children:"ssh\u95ee\u9898\u6392\u67e5\u6307\u5357"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"113-\u7cfb\u7edf\u767b\u9646\u4e0d\u8fdb\u53bb\u4e86\u4e0d\u6302\u76d8\u7684\u60c5\u51b5\u4e0b\u600e\u4e48\u64cd\u4f5c",children:"1.1.3 \u7cfb\u7edf\u767b\u9646\u4e0d\u8fdb\u53bb\u4e86\uff0c\u4e0d\u6302\u76d8\u7684\u60c5\u51b5\u4e0b\u600e\u4e48\u64cd\u4f5c\uff1f"}),"\n",(0,i.jsx)(e.p,{children:"\u4e0a\u9762\u7684\u68c0\u67e5\u70b9\u5f88\u591a\u662f\u9700\u8981\u5207\u6362\u5230\u53e6\u5916\u7684\u7cfb\u7edf\u73af\u5883\u4e0b\u53bb\u505a\u68c0\u67e5\uff0c\u6bd4\u5982\u6302\u8f7d LiveCD \u6216\u8005 chroot \u5207\u6362\uff1b\u4f46\u5bf9\u4e8e\u4f7f\u7528 ECS \u7684\u7528\u6237\u6765\u8bf4\uff0c\u963f\u91cc\u4e91\u6682\u8fd8\u672a\u63d0\u4f9b\u5b9e\u4f8b\u6302\u8f7d ISO \u955c\u50cf\u7684\u529f\u80fd\uff0c\u90a3\u4e48\u5982\u4f55\u8fdb\u884c\u4e0a\u9762\u7684\u64cd\u4f5c\u5462\uff1f\u53ef\u4ee5\u501f\u52a9\u963f\u91cc\u4e91\u65b0\u63a8\u51fa\u7684\u5378\u8f7d\u7cfb\u7edf\u76d8\u529f\u80fd\uff0c\u53ef\u4ee5\u628a\u7cfb\u7edf\u76d8\u5378\u8f7d\u6389\uff0c\u4f5c\u4e3a\u6570\u636e\u76d8\u6302\u8f7d\u5230\u4e00\u4e2a\u65b0\u7684\u673a\u5668\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u6267\u884c\u4e0a\u9762\u7684\u68c0\u67e5\u4e86\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"https://help.aliyun.com/document_detail/146752.html",children:"\u5e2e\u52a9\u6587\u6863"})}),"\n",(0,i.jsx)(e.h4,{id:"114-\u573a\u666f\u8986\u76d6",children:"1.1.4 \u573a\u666f\u8986\u76d6"}),"\n",(0,i.jsx)(e.h5,{id:"1141-linux-\u7cfb\u7edf\u5e38\u89c1\u95ee\u9898\u8bca\u65ad\u8986\u76d6\u4ee5\u4e0b\u573a\u666f",children:"1.1.4.1 Linux \u7cfb\u7edf\u5e38\u89c1\u95ee\u9898\u8bca\u65ad\u8986\u76d6\u4ee5\u4e0b\u573a\u666f"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5e38\u7528\u7aef\u53e3\u662f\u5426\u6b63\u786e\u76d1\u542c\uff08\u5305\u62ecssh\u7aef\u53e3\u300180\u3001443)"}),"\n",(0,i.jsx)(e.li,{children:"\u5e38\u7528\u7aef\u53e3\u5b89\u5168\u7ec4\u68c0\u6d4b\uff08\u5305\u62ecssh\u7aef\u53e3\u300180\u3001443)"}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"tcp_timestamps&tcp_tw_recycle"}),"\u53c2\u6570\u68c0\u6d4b"]}),"\n",(0,i.jsx)(e.li,{children:"cpu\u5360\u7528\u9ad8\u5206\u6790"}),"\n",(0,i.jsx)(e.li,{children:"fstab\u914d\u7f6e\u95ee\u9898"}),"\n",(0,i.jsx)(e.li,{children:"\u8f6f\u94fe\u63a5\u7f3a\u5931"}),"\n",(0,i.jsx)(e.li,{children:"ssh\u76f8\u5173\u6587\u4ef6\u6743\u9650\u5f02\u5e38\uff08\u6bd4\u5982\u6587\u4ef6\u6743\u9650777)"}),"\n",(0,i.jsx)(e.li,{children:"selinux\u542f\u7528\u68c0\u6d4b"}),"\n",(0,i.jsx)(e.li,{children:"hugepage\u53c2\u6570\u68c0\u6d4b"}),"\n",(0,i.jsx)(e.li,{children:"iptables\u542f\u7528\u68c0\u6d4b"}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"/etc/security/limits.conf"}),"\u914d\u7f6e\u68c0\u67e5"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"/etc/passwd"}),"\u7b49\u6587\u4ef6\u683c\u5f0f\u6821\u9a8c"]}),"\n"]}),"\n",(0,i.jsx)(e.h5,{id:"1142-linux-\u7cfb\u7edf\u5e38\u89c1\u542f\u52a8\u95ee\u9898\u4fee\u590d\u8986\u76d6\u4ee5\u4e0b\u573a\u666f",children:"1.1.4.2 Linux \u7cfb\u7edf\u5e38\u89c1\u542f\u52a8\u95ee\u9898\u4fee\u590d\u8986\u76d6\u4ee5\u4e0b\u573a\u666f"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7cfb\u7edf\u542f\u52a8-fsck\u68c0\u6d4b\u4fee\u590d"}),"\n",(0,i.jsx)(e.li,{children:"\u7cfb\u7edf\u542f\u52a8-\u78c1\u76d8/inode\u5360\u6ee1"}),"\n",(0,i.jsx)(e.li,{children:"\u7cfb\u7edf\u542f\u52a8-\u7cfb\u7edf\u6587\u4ef6/\u8f6f\u94fe\u63a5\u68c0\u6d4b"}),"\n",(0,i.jsx)(e.li,{children:"\u7cfb\u7edf\u542f\u52a8-\u6839\u76ee\u5f55/ssh\u76ee\u5f55777"}),"\n",(0,i.jsx)(e.li,{children:"\u7cfb\u7edf\u542f\u52a8-fstab/grub\u6821\u9a8c"}),"\n",(0,i.jsx)(e.li,{children:"\u7cfb\u7edf\u542f\u52a8-selinux\u68c0\u6d4b"}),"\n",(0,i.jsx)(e.li,{children:"\u7cfb\u7edf\u542f\u52a8-sysctl\u5185\u6838\u53c2\u6570hugepage&minfree\u68c0\u6d4b"}),"\n",(0,i.jsx)(e.li,{children:"vnc\u767b\u9646-sshdconfig\u914d\u7f6e\u68c0\u6d4b"}),"\n",(0,i.jsx)(e.li,{children:"vnc\u767b\u9646-passwd/shadow\u6587\u4ef6\u683c\u5f0f&\u7528\u6237\u68c0\u6d4b"}),"\n",(0,i.jsx)(e.li,{children:"vnc\u767b\u9646-pam.d\u6587\u4ef6&\u914d\u7f6e\u68c0\u6d4b"}),"\n",(0,i.jsx)(e.li,{children:"vnc\u767b\u9646-\u76f8\u5173\u76ee\u5f550size\u6587\u4ef6\u68c0\u6d4b"}),"\n",(0,i.jsx)(e.li,{children:"vnc\u767b\u9646-profile/bashrc\u68c0\u6d4b"}),"\n",(0,i.jsx)(e.li,{children:"vnc\u767b\u9646-\u591a\u5185\u6838\u68c0\u6d4b"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"115-\u5404\u79cd\u811a\u672c",children:"1.1.5 \u5404\u79cd\u811a\u672c"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"https://public-beijing.oss-cn-beijing.aliyuncs.com/oos/caiji.sh",children:"OS\u53c2\u6570\u6536\u96c6\u811a\u672c"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"https://github.com/huigher/os-performance-optimization",children:"OS\u4f18\u5316\u811a\u672c github\u94fe\u63a5"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"https://xiaoling-public.oss-cn-hangzhou.aliyuncs.com/os_performance_optimization.py",children:"OS\u4f18\u5316\u811a\u672cOSS\u94fe\u63a5"})}),"\n",(0,i.jsxs)(e.p,{children:["[OS\u79bb\u7ebf\u4fee\u590d\u811a\u672c](",(0,i.jsx)(e.a,{href:"https://public-beijing.oss-cn-beijing.aliyuncs.com/oo",children:"https://public-beijing.oss-cn-beijing.aliyuncs.com/oo"})," oos_noak.sh)"]}),"\n",(0,i.jsx)(e.h3,{id:"12-grubconf-\u6587\u4ef6\u5185\u5bb9\u88ab\u6e05\u7a7a\u4e86\u600e\u4e48\u529e",children:"1.2 grub.conf \u6587\u4ef6\u5185\u5bb9\u88ab\u6e05\u7a7a\u4e86\u600e\u4e48\u529e"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7b80\u4ecb"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"/boot/grub/grub.conf \u88ab\u6e05\u7a7a\uff0c\u7cfb\u7edf\u542f\u52a8\u5c31\u8fdb\u5165 grub \u72b6\u6001\uff08CentOS 6.8\uff09\u3002"})}),"\n"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"find /boot/grub/stage1"}),"\u3002 \u663e\u793a\u4e3a\uff08hd0,0\uff09\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["\u786e\u8ba4\u4e00\u4e0b\u5185\u6838\u7684\u5177\u4f53\u7248\u672c ",(0,i.jsx)(e.code,{children:"ls -l /boot"})]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u624b\u52a8\u8bbe\u7f6e grub \u5177\u4f53\u6b65\u9aa4\u5982\u4e0b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"grub> root (hd0,0) # \u662f\u8bf4\u8ddf\u5206\u533a\u5728\u7b2c\u4e00\u5757\u786c\u76d8\u7684\u7b2c 1 \u4e2a\u5206\u533a \u5b9e\u9645\u5bf9\u4e8e\u524d\u9762\u7684 find \u51fa\u6765\u7684\u90a3\u4e2a\u6587\u4ef6\n\ngrub> kernel /boot/vmlinuz-2.6.32-696.3.2.el6.x86_64 ro root=/dev/vda1 # \u6307\u660e\u5185\u6838\u8def\u5f84\u548c\u6839\u5206\u533a\uff0c\u6ce8\u610f ro \u662f\u53ea\u8bfb\n\ngrub> initrd /boot/initramfs-2.6.32-696.3.2.el6.x86_64.img # \u6307\u660e initramfs \u8def\u5f84\u542f\u52a8\u7cfb\u7edf\u52a0\u8f7d\u9a71\u52a8\n\ngrub> boot # \u542f\u52a8\u4e0a\u9762\u6307\u5b9a\u7684\u7cfb\u7edf\uff0c\u5982\u679c\u662f reboot \u5c31\u7b49\u4e8e\u91cd\u542f\u6574\u4e2a\u7cfb\u7edf\u4e86\uff0c\u521a\u624d\u7684\u8bbe\u7f6e\u5c31\u5931\u6548\u4e86\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5982\u679c\u6ca1\u6709\u62a5\u9519\u7684\u8bdd\uff0c\u5373\u53ef\u6210\u529f\u542f\u52a8\uff0c\u8fdb\u5165\u5230\u7cfb\u7edf\u5185\u90e8\u540e\u9700\u8981\u7ee7\u7eed\u652f\u6301\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"mount -e remount,rw /"})," \u91cd\u65b0\u6302\u8f7d\u5206\u533a\u4e3a\u8bfb\u5199\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"service network restart"}),"\u3002 \u5982\u679c\u63d0\u793a eth0 eth1 \u5931\u8d25\uff0cifconfig \u770b\u4e0d\u5230\u7f51\u5361\u7684\u8bdd\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"lsmod |grep net"}),"\u3002 \u770b\u4e0b virtio_net \u8fd9\u4e2a\u9a71\u52a8\u6709\u6ca1\u6709\uff0c\u5982\u679c\u6ca1\u6709\u7684\u8bdd\uff08\u7f51\u5361\u62a5\u9519\u57fa\u672c\u90fd\u4e0d\u4f1a\u6709\uff09\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"insmod /lib/modules/2.6.32-696.3.2.el6.x86_64/kernel/drivers/net/virtio_ net.ko"}),"\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u91cd\u542f\u7f51\u7edc\u670d\u52a1\uff0c\u55e8 ~ \u7f51\u901a\u4e86\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["\u767b\u9646 ssh\uff0c \u627e\u4e2a\u540c\u7248\u672c\u7cfb\u7edf\u7684 grub.conf\uff0c\u62f7\u8d1d\u4e00\u4efd\u8fc7\u6765\uff0c \u4e0d\u7136\u91cd\u542f\u4e4b\u540e\u53c8\u8fdb grub \u4e86\u3002",(0,i.jsx)(e.a,{href:"https://yq.aliyun.com/articles/203048",children:"\u53c2\u8003\u6587\u7ae0"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"13-\u5de7\u5999\u5229\u7528-strace-\u67e5\u627e\u4e22\u5931\u7684\u6587\u4ef6",children:"1.3 \u5de7\u5999\u5229\u7528 strace \u67e5\u627e\u4e22\u5931\u7684\u6587\u4ef6"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u95ee\u9898\u63cf\u8ff0"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5ba2\u6237\u53cd\u9988\u7cfb\u7edf\u65e0\u6cd5\u8fdc\u7a0b\u767b\u9646\uff0c\u5b9e\u9645\u7cfb\u7edf\u542f\u52a8\u672c\u8eab\u5c31\u6709\u95ee\u9898\u3002"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0412.07.21.png",alt:"iShot2020-08-0412.07.21"})}),"\n",(0,i.jsx)(e.p,{children:"\u6839\u636e\u62a5\u9519\u4fe1\u606f\u6765\u770b\uff0c\u662f\u7cfb\u7edf\u5185\u8bfb\u53d6 user \u6709\u95ee\u9898\uff0c\u9700\u8981\u6302\u76d8\u67e5\u770b\u3002"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["\u6302\u76d8\u540e chroot \u5982\u4e0b ",(0,i.jsx)(e.code,{children:"ihave no name"}),"\uff0c\u8fd9\u91cc\u672c\u8eab\u5c31\u662f\u6709\u95ee\u9898\u4e86\uff0c\u8bf4\u660e\u7cfb\u7edf\u5185\u7f3a\u5c11\u4e86\u4ec0\u4e48\u6587\u4ef6\u5bfc\u81f4\u5f02\u5e38\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"root@debian:~# chroot/mnt\n[ I have no name !@debian / ] #\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"strace \u8ddf\u8e2a\u4e00\u4e0b chroot \u7684\u8fc7\u7a0b\uff0c\u770b\u4e0b\u4e22\u5931\u7684\u6587\u4ef6\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:'strace -F -ff -t -tt -s 256 -o ch.out chroot /mnt\ngrep -i "no such" ch.out.pid |grep "so"\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0412.09.49.png",alt:"iShot2020-08-0412.09.49"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u67e5\u770b\u5bf9\u5e94\u6587\u4ef6\u7684\u5173\u7cfb\uff08\u6d4b\u8bd5\u673a\u8865\u56fe\uff09\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0412.10.23.png",alt:"iShot2020-08-0412.10.23"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["\u786e\u8ba4\u7cfb\u7edf\u4e0a\u4e22\u4e86\u6700\u7ec8\u7684",(0,i.jsx)(e.code,{children:"libnss_files-2.12.so"}),"\uff0c\u5c1d\u8bd5\u62f7\u8d1d\u4e00\u4e2a\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"ifconfig eth1 < \u7f51\u5361 IP> netmask < \u63a9\u7801\u5730\u5740 >\nroute add default gw < \u7f51\u5173 IP>\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0412.11.11.png",alt:"iShot2020-08-0412.11.11"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u6b64\u65f6\u5df2\u7ecf\u53ef\u4ee5\u4e0a\u7f51\u4e86\uff0c\u53bb\u62f7\u8d1d\u4e00\u4e2a\u540c\u7248\u672c\u7684\u6587\u4ef6\u8bd5\u8bd5\u5427\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0412.12.44.png",alt:"iShot2020-08-0412.12.44"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"14-\u5c0f\u5fc3-pam-\u4e0d\u8ba9\u4f60\u767b\u9646",children:"1.4 \u5c0f\u5fc3 PAM \u4e0d\u8ba9\u4f60\u767b\u9646"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u95ee\u9898\u63cf\u8ff0"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"ssh \u53ef\u4ee5\u767b\u9646\uff0c\u7ba1\u7406\u7ec8\u7aef\u65e0\u6cd5\u767b\u9646 root\uff0c\u63d0\u793a login in..."})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u5148\u901a\u8fc7 ssh \u65b9\u5f0f\u767b\u5f55\u7cfb\u7edf\uff0c\u67e5\u770b\u767b\u5f55\u65e5\u5fd7\u662f\u5426\u6709\u5f02\u5e38\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"$ cat /var/log/secure\nJun 2 09:26:48 iZbp1begsz1x269nxhtip4Z login: FAILED LOGIN 1 FROM tty1 FOR root\uff0cAuthentication failure\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u4f3c\u4e4e\u662f login \u9a8c\u8bc1\u6a21\u5757\u7684\u95ee\u9898\u8fdb\u4e00\u6b65\u67e5\u770b\u5bf9\u5e94\u7684\u914d\u7f6e\u6587\u4ef6 ",(0,i.jsx)(e.code,{children:"/etc/pam.d/login"}),"\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"$ cat /etc/pam.d/login\n#%PAM-1.0\nauth required pam_succeed_if.so user != root quiet\nauth [user_unknown=ignore success=ok ignore=ignore default=bad] pam_ securetty.so\nauth substack system-auth\nauth include postlogin\naccount required pam_nologin.so\naccount include system-auth\npassword include system-auth\n# pam_selinux.so close should be the first session rule\nsession required pam_selinux.so close\nsession required pam_loginuid.so\nsession optional pam_console.so\n# pam_selinux.so open should only be followed by sessions to be executed in the user context\nsession required pam_selinux.so open\nsession required pam_namespace.so\nsession optional pam_keyinit.so force revoke\nsession include system-auth\nsession include postlogin\n-session optional pam_ck_connector.so\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5176\u4e2d\u4e00\u884c\u7684\u4f5c\u7528\u4e3a\u7981\u6b62\u672c\u5730\u767b\u5f55\uff0c\u53ef\u4ee5\u5c06\u5176\u6ce8\u91ca\u6389\u5373\u53ef\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"auth required pam_succeed_if.so user != root quiet\n"})}),"\n",(0,i.jsx)(e.h3,{id:"15-centos-\u767b\u9646\u5361\u4f4f\u7684\u539f\u56e0\u88ab\u6211\u627e\u5230\u4e86",children:"1.5 CentOS \u767b\u9646\u5361\u4f4f\u7684\u539f\u56e0\u88ab\u6211\u627e\u5230\u4e86"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u95ee\u9898\u63cf\u8ff0"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7cfb\u7edf\u767b\u9646\u5361\u4f4f\uff0c\u9700\u8981 ctrl +c \u624d\u80fd\u8fdb\u53bb\uff0c\u5982\u56fe\u3002"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0412.21.52.png",alt:"iShot2020-08-0412.21.52"})}),"\n",(0,i.jsx)(e.p,{children:"\u5982\u679c\u4e00\u76f4\u7b49\u7684\u8bdd\uff0c\u4f1a\u63d0\u793a\u5982\u4e0b\u622a\u56fe\uff1a"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0412.22.25.png",alt:"iShot2020-08-0412.22.25"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u539f\u56e0"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"/etc/profile \u91cc\u9762\u6709 source /etc/profile \u5f15\u8d77\u6b7b\u5faa\u73af\uff0c\u6ce8\u91ca\u5373\u53ef\u3002"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0412.23.10.png",alt:"iShot2020-08-0412.23.10"})}),"\n",(0,i.jsx)(e.h2,{id:"2linux-\u6027\u80fd\u95ee\u9898",children:"2.Linux \u6027\u80fd\u95ee\u9898"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u8bf4\u660e"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:'Linux \u6027\u80fd\u95ee\u9898\u7684\u6392\u67e5\u548c\u5904\u7406\u4e00\u76f4\u662f\u7cfb\u7edf\u7ba1\u7406\u548c\u8fd0\u7ef4\u4eba\u5458\u7684"\u5fc3\u5934\u4e4b\u60a3"\uff0c CPU \u8d1f\u8f7d\u9ad8\u4f46\u627e\u4e0d\u5230\u6d88\u8017\u5927\u7684\u8fdb\u7a0b\uff1b\u7cfb\u7edf\u51fa\u73b0 OOM\uff08Out of Memory\uff09\u53ea\u4f1a\u4e00\u5473\u5730\u589e\u5927\u5185\u5b58\u5bb9\u91cf\uff0c\u800c\u6ca1\u6709\u5f88\u597d\u5730\u7406\u89e3\u548c\u5206\u6790\u95ee\u9898\u80cc\u540e\u4ea7\u751f\u7684\u6839\u56e0\u3002\u800c\u8fd9\u4e9b\u90fd\u5bf9\u7ebf\u4e0a\u4e1a\u52a1\u7684\u53ef\u9760\u548c\u7a33\u5b9a\u6027\u63d0\u51fa\u4e86\u6311\u6218\u3002\u672c\u6587\u5c06\u963f\u91cc\u4e91\u552e\u540e\u9047\u5230\u7684\u8f83\u4e3a\u5e38\u89c1\u7684\u51e0\u4e2a\u7cfb\u7edf\u6027\u80fd\u95ee\u9898\u8fdb\u884c\u5c55\u5f00\u5206\u6790\uff0c\u5e76\u7ed9\u51fa\u4e00\u4e9b\u5408\u7406\u7684\u6539\u8fdb\u548c\u4f18\u5316\u65b9\u6848\u3002'})}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"21-\u627e\u5230-linux-\u865a\u673a-load-\u9ad8\u7684\u5143\u51f6",children:'2.1 \u627e\u5230 Linux \u865a\u673a Load \u9ad8\u7684"\u5143\u51f6"'}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u95ee\u9898\u63cf\u8ff0"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6709\u5ba2\u6237\u53cd\u9988\u4ed6\u4eec\u7684\u4e00\u53f0 ECS \u5468\u671f\u6027\u5730 load \u5347\u9ad8\uff0c\u4ed6\u4eec\u7684\u4e1a\u52a1\u6d41\u91cf\u5e76\u6ca1\u6709\u4e0a\u5347\uff0c\u9700\u8981 \u6211\u4eec\u6392\u67e5\u662f\u4ec0\u4e48\u539f\u56e0\u9020\u6210\u7684\uff0c\u662f\u5426\u56e0\u4e3a\u5e95\u5c42\u5f02\u5e38\uff1f"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u8981\u5f04\u6e05 Linux \u865a\u673a load \u9ad8\uff0c\u6211\u4eec\u8981\u641e\u6e05\u695a Linux top \u547d\u4ee4\u4e2d Load \u7684\u542b\u4e49\u3002"})}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"211-load-average-\u7684\u503c\u4ece\u4f55\u800c\u6765",children:"2.1.1 Load average \u7684\u503c\u4ece\u4f55\u800c\u6765"}),"\n",(0,i.jsxs)(e.p,{children:["\u5728\u4f7f\u7528 top \u547d\u4ee4\u68c0\u67e5\u7cfb\u7edf\u8d1f\u8f7d\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u770b\u5230 ",(0,i.jsx)(e.code,{children:"Load averages"})," \u5b57\u6bb5\uff0c\u4f46\u662f\u8fd9\u4e2a\u5b57\u6bb5\u5e76\u4e0d\u662f\u8868\u793a CPU \u7684\u7e41\u5fd9\u7a0b\u5ea6\uff0c\u800c\u662f\u5ea6\u91cf\u7cfb\u7edf\u6574\u4f53\u8d1f\u8f7d\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["Load averages \u91c7\u6837\u662f\u4ece ",(0,i.jsx)(e.code,{children:"/proc/loadavg"})," \u4e2d\u83b7\u53d6\u7684\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"0.00 0.01 0.05 1/161 29703\n\n\u6bcf\u4e2a\u503c\u7684\u542b\u4e49\u4f9d\u6b21\u4e3a\uff1a\n\tlavg_1 (0.00) 1- \u5206\u949f\u5e73\u5747\u8d1f\u8f7d\n\tlavg_5 (0.01) 5- \u5206\u949f\u5e73\u5747\u8d1f\u8f7d\n\tlavg_15(0.05) 15- \u5206\u949f\u5e73\u5747\u8d1f\u8f7d\n\nnr_running (1) \n\t\u5728\u91c7\u6837\u65f6\u523b\uff0c\u8fd0\u884c\u961f\u5217\u7684\u4efb\u52a1\u7684\u6570\u76ee\uff0c\u4e0e /proc/stat \u7684 procs_running \u8868\u793a\u76f8\u540c\u610f\u601d\uff0c\t\t\u8fd9\u4e2a\u6570\u503c\u662f\u5f53\u524d\u53ef\u8fd0\u884c\u7684\u5185\u6838\u8c03\u5ea6\u5bf9\u8c61\uff08\u8fdb\u7a0b\uff0c\u7ebf\u7a0b\uff09\u3002\n\nnr_threads (161) \n\t\u5728\u91c7\u6837\u65f6\u523b\uff0c\u7cfb\u7edf\u4e2d\u6d3b\u8dc3\u7684\u4efb\u52a1\u7684\u4e2a\u6570\uff08\u4e0d\u5305\u62ec\u8fd0\u884c\u5df2\u7ecf\u7ed3\u675f\u7684\u4efb\u52a1\uff09\uff0c\u5373\u8fd9\u4e2a\u6570\u503c\u8868\u793a\u5f53\u524d\u5b58\t\u5728\u7cfb\u7edf\u4e2d\u7684\u5185\u6838\u53ef\u8c03\u5ea6\u5bf9\u8c61\u7684\u6570\u91cf\u3002\n\nlast_pid(29703)\n\t\u7cfb\u7edf\u6700\u8fd1\u521b\u5efa\u7684\u8fdb\u7a0b\u7684 PID\uff0c\u5305\u62ec\u8f7b\u91cf\u7ea7\u8fdb\u7a0b\uff0c\u5373\u7ebf\u7a0b\u3002\n\n\u5047\u8bbe\u5f53\u524d\u6709\u4e24\u4e2a CPU\uff0c\u5219\u6bcf\u4e2a CPU \u7684\u5f53\u524d\u4efb\u52a1\u6570\u4e3a 0.00/2=0.00\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5982\u679c\u4f60\u770b\u5230 load average \u6570\u503c\u662f 10\uff0c \u5219\u8868\u660e\u5e73\u5747\u6709 10 \u4e2a\u8fdb\u7a0b\u5728\u8fd0\u884c\u6216\u7b49\u5f85\u72b6\u6001\u3002 \u6709\u53ef\u80fd\u7cfb\u7edf\u6709\u5f88\u9ad8\u7684\u8d1f\u8f7d\u4f46\u662f CPU \u4f7f\u7528\u7387\u5374\u5f88\u4f4e\uff0c\u6216\u8005\u8d1f\u8f7d\u5f88\u4f4e\u800c CPU \u5229\u7528\u7387\u5f88\u9ad8\uff0c\u56e0\u4e3a\u8fd9\u4e24\u8005\u6ca1\u6709\u76f4\u63a5\u5173\u7cfb\u3002\u6e90\u7801\u4e2d\u5bf9\u4e8e\u8fd9\u4e00\u5757\u7684\u8bf4\u660e"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:'static int loadavg_proc_show(struct seq_file *m\uff0cvoid *v) \n{\n\tunsigned long avnrun[3];\n\tget_avenrun(avnrun\uff0cFIXED_1/200\uff0c0);\n\tseq_printf(m\uff0c"%lu.%02lu %lu.%02lu %lu.%02lu %ld/%d %d\\n",\n\t\tLOAD_INT(avnrun[0])\uff0cLOAD_FRAC(avnrun[0]),\n\t\tLOAD_INT(avnrun[1])\uff0cLOAD_FRAC(avnrun[1]),\n\t\tLOAD_INT(avnrun[2])\uff0cLOAD_FRAC(avnrun[2]),\n\t\tnr_running()\uff0cnr_threads,\n\t\ttask_active_pid_ns(current)->last_pid);\n\treturn 0;\n}\n\nLoad \u7684\u8ba1\u7b97\u51fd\u6570\uff1a\nstatic unsigned long\ncalc_load(unsigned long load\uff0cunsigned long exp\uff0cunsigned long active) \n{\n\tload *= exp;\n\tload += active * (FIXED_1 - exp);\n\treturn load >> FSHIFT;\n}\n/*\n* calc_load - update the avenrun load estimates 10 ticks after the\n* CPUs have updated calc_load_tasks.\n*/\nvoid calc_global_load(void) \n{\n\tunsigned long upd = calc_load_update + 10;\n\tlong active;\n  \n\tif (time_before(jiffies\uff0cupd))\n\t\treturn;\n\tactive = atomic_long_read(&calc_load_tasks);\n\tactive = active > 0 ? active * FIXED_1 : 0;\n\t\n  avenrun[0] = calc_load(avenrun[0]\uff0cEXP_1\uff0cactive);\n\tavenrun[1] = calc_load(avenrun[1]\uff0cEXP_5\uff0cactive);\n\tavenrun[2] = calc_load(avenrun[2]\uff0cEXP_15\uff0cactive);\n  \n\tcalc_load_update += LOAD_FREQ;\n}\n/*\n* These are the constant used to fake the fixed-point load-average\n* counting. Some notes:\n*\t- 11 bit fractions expand to 22 bits by the multiplies: this gives\n*\ta load-average precision of 10 bits integer + 11 bits fractional\n*\t- if you want to count load-averages more often\uff0cyou need more\n*\tprecision\uff0cor rounding will get you. With 2-second counting freq,\n*\tthe EXP_n values would be 1981\uff0c2034 and 2043 if still using only\n*\t11 bit fractions.\n*/\nextern unsigned long avenrun[];\t/* Load averages */\nextern void get_avenrun(unsigned long *loads\uff0cunsigned long offset\uff0cint shift);\n#define FSHIFT\t11\t/* nr of bits of precision */\n#define FIXED_1\t(1<<FSHIFT)\t/* 1.0 as fixed-point */\n#define LOAD_FREQ\t(5*HZ+1)\t/* 5 sec intervals */\n#define EXP_1\t\t1884\t/* 1/exp(5sec/1min) as fixed-point */\n#define EXP_5\t\t2014\t/* 1/exp(5sec/5min) */\n#define EXP_15\t2037\t/* 1/exp(5sec/15min) */\n#define CALC_LOAD(load,exp,n) \\\n\tload *= exp; \\\n\tload += n*(FIXED_1-exp); \\\n\tload >>= FSHIFT;\n'})}),"\n",(0,i.jsxs)(e.p,{children:["\u4ece\u8fd9\u4e2a\u51fd\u6570\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c \u5185\u6838\u8ba1\u7b97 load \u91c7\u7528\u7684\u662f\u4e00\u79cd\u5e73\u6ed1\u79fb\u52a8\u7684\u7b97\u6cd5\uff0cLinux \u7684\u7cfb\u7edf\u8d1f\u8f7d\u6307\u8fd0\u884c\u961f\u5217\u7684\u5e73\u5747\u957f\u5ea6\uff0c \u9700\u8981\u6ce8\u610f\u7684\u662f\uff1a\u53ef\u8fd0\u884c\u7684\u8fdb\u7a0b\u662f\u6307\u5904\u4e8e\u8fd0\u884c\u961f\u5217\u7684\u8fdb\u7a0b\uff0c \u4e0d\u662f\u6307\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\u3002 \u5373\u8fdb\u7a0b\u7684\u72b6\u6001\u662f ",(0,i.jsx)(e.code,{children:"TASK_RUNNING"})," \u6216\u8005 ",(0,i.jsx)(e.code,{children:"TASK_ UNINTERRUPTIBLE"}),"\u3002"]}),"\n",(0,i.jsx)(e.p,{children:"Linux \u5185\u6838\u5b9a\u4e49\u4e00\u4e2a\u957f\u5ea6\u4e3a3\u7684\u53cc\u5b57\u6570\u7ec4 avenrun\uff0c\u53cc\u5b57\u7684\u4f4e 11 \u4f4d\u7528\u4e8e\u5b58\u653e\u8d1f\u8f7d\u7684\u5c0f\u6570\u90e8\u5206\uff0c\u9ad8 21 \u4f4d\u7528\u4e8e\u5b58\u653e\u6574\u6570\u90e8\u5206\u3002\u5f53\u8fdb\u7a0b\u6240\u8017\u7684 CPU \u65f6\u95f4\u7247\u6570\u8d85\u8fc7 CPU \u57285\u79d2\u5185\u80fd\u591f\u63d0\u4f9b\u7684\u65f6\u95f4\u7247\u6570\u65f6\uff0c\u5185\u6838\u8ba1\u7b97\u4e0a\u8ff0\u7684\u4e09\u4e2a\u8d1f\u8f7d\uff0c\u8d1f\u8f7d\u521d\u59cb\u5316\u4e3a 0\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u5047\u8bbe\u6700\u8fd1 1\u30015\u300115 \u5206\u949f\u5185\u7684\u5e73\u5747\u8d1f\u8f7d\u5206\u522b\u4e3a load1\u3001load5 \u548c load15\uff0c\u90a3\u4e48\u4e0b\u4e00\u4e2a\u8ba1\u7b97\u65f6\u523b\u5230\u6765\u65f6\uff0c\u5185\u6838\u901a\u8fc7\u4e0b\u9762\u7684\u7b97\u5f0f\u8ba1\u7b97\u8d1f\u8f7d\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"load1 -= load1 - exp(-5 / 60) -+ n (1 - exp(-5 / 60 )) \nload5 -= load5 - exp(-5 / 300) + n (1 - exp(-5 / 300)) \nload15 = load15 exp(-5 / 900) + n (1 - exp(-5 / 900))\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5176\u4e2d\uff0cexp(x) \u4e3a e \u7684 x \u6b21\u5e42\uff0cn \u4e3a\u5f53\u524d\u8fd0\u884c\u961f\u5217\u7684\u957f\u5ea6\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"212-\u5982\u4f55\u627e\u51fa\u7cfb\u7edf\u4e2d-load-\u9ad8\u65f6\u5904\u4e8e\u8fd0\u884c\u961f\u5217\u7684\u8fdb\u7a0b",children:"2.1.2 \u5982\u4f55\u627e\u51fa\u7cfb\u7edf\u4e2d load \u9ad8\u65f6\u5904\u4e8e\u8fd0\u884c\u961f\u5217\u7684\u8fdb\u7a0b"}),"\n",(0,i.jsx)(e.p,{children:"\u901a\u8fc7\u524d\u9762\u7684\u8bb2\u89e3\uff0c \u6211\u4eec\u5df2\u7ecf\u660e\u767d\u6709\u53ef\u80fd\u7cfb\u7edf\u6709\u5f88\u9ad8\u7684\u8d1f\u8f7d\u4f46\u662f CPU \u4f7f\u7528\u7387\u5374\u5f88\u4f4e\uff0c \u6216\u8005\u8d1f\u8f7d\u5f88\u4f4e\u800c CPU \u5229\u7528\u7387\u5f88\u9ad8\uff0c\u8fd9\u4e24\u8005\u6ca1\u6709\u76f4\u63a5\u5173\u7cfb\uff0c\u5982\u4f55\u7528\u811a\u672c\u7edf\u8ba1\u51fa\u6765\u5904\u4e8e\u8fd0\u884c\u961f\u5217\u7684\u8fdb\u7a0b\u5462\uff1f"}),"\n",(0,i.jsx)(e.p,{children:"\u6bcf\u9694 1s \u7edf\u8ba1\u4e00\u6b21\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"#!/bin/bash\nLANG=C\nPATH=/sbin:/usr/sbin:/bin:/usr/bin\ninterval=1\nlength=86400\n\nfor i in $(seq 1 $(expr ${length} / ${interval}));do\ndate\n\tLANG=C ps -eTo stat,pid,tid,ppid,comm --no-header | sed -e 's/^ \\*//' | \tperl -nE 'chomp;say if (m!^\\S*[RD]+\\S*!)'\n\tdate\n\tcat /proc/loadavg\n\techo -e \"\\n\"\n\tsleep ${interval}\ndone\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u4ece\u7edf\u8ba1\u51fa\u6765\u7684\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"at Jan 20 15:54:12 CST 2018\nD 958 958 957 nginx\nD 959 959 957 nginx\nD 960 960 957 nginx\nD 961 961 957 nginx\nR 962 962 957 nginx\nD 963 963 957 nginx\nD 964 964 957 nginx\nD 965 965 957 nginx\nD 966 966 957 nginx\nD 967 967 957 nginx\nD 968 968 957 nginx\nD 969 969 957 nginx\nD 970 970 957 nginx\nD 971 971 957 nginx\nD 972 972 957 nginx\nD 973 973 957 nginx\nD 974 974 957 nginx\nR 975 975 957 nginx\nD 976 976 957 nginx\nD 977 977 957 nginx\nD 978 978 957 nginx\nD 979 979 957 nginx\nR 980 980 957 nginx\nD 983 983 957 nginx\nD 984 984 957 nginx\nD 985 985 957 nginx\nD 986 986 957 nginx\nD 987 987 957 nginx\nD 988 988 957 nginx\nD 989 989 957 nginx\nR 11908 11908 18870 ps\nSat Jan 20 15:54:12 CST 2018\n25.76 20.60 19.00 12/404 11912\n\u6ce8\uff1aR \u4ee3\u8868\u8fd0\u884c\u4e2d\u7684\u961f\u5217\uff0cD \u662f\u4e0d\u53ef\u4e2d\u65ad\u7684\u7761\u7720\u8fdb\u7a0b\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5728 load \u6bd4\u8f83\u9ad8\u7684\u65f6\u5019\uff0c\u6709\u5927\u91cf\u7684 nginx \u5904\u4e8e R \u6216\u8005 D \u72b6\u6001\uff0c\u4ed6\u4eec\u624d\u662f\u9020\u6210 load \u4e0a\u5347\u7684\u5143\u51f6\uff0c\u548c\u6211\u4eec\u5e95\u5c42\u7684\u8d1f\u8f7d\u786e\u5b9e\u662f\u6ca1\u6709\u5173\u7cfb\u7684\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u6700\u540e\u4e5f\u7ed9\u5927\u5bb6 share \u4e00\u4e0b\u67e5 CPU \u4f7f\u7528\u7387\u6bd4\u8f83\u9ad8\u7684\u7ebf\u7a0b\u5c0f\u811a\u672c\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"#!/bin/bash\nLANG=C\nPATH=/sbin:/usr/sbin:/bin:/usr/bin\ninterval=1\nlength=86400\n\nfor i in $(seq 1 $(expr ${length} / ${interval}));do\n\tdate\n\tLANG=C ps -eT -o%cpu,pid,tid,ppid,comm | grep -v CPU | sort -n -r | head -20\n\tdate\n\tLANG=C cat /proc/loadavg\n\t{ LANG=C ps -eT -o%cpu,pid,tid,ppid,comm | sed -e 's/^ *//' | tr -s ' ' | grep -v CPU | sort -n -r | cut -d ' ' -f 1 | xargs -I{} echo -n \"{} + \" && echo '0'; } | bc -l\n\tsleep ${interval}\ndone\n\nfuser -k $0\n"})}),"\n",(0,i.jsx)(e.h3,{id:"22-oom-killer-\u662f\u88ab\u8c01\u89e6\u53d1\u7684",children:"2.2 OOM killer \u662f\u88ab\u8c01\u89e6\u53d1\u7684"}),"\n",(0,i.jsx)(e.h4,{id:"221-\u95ee\u9898\u63cf\u8ff0",children:"2.2.1 \u95ee\u9898\u63cf\u8ff0"}),"\n",(0,i.jsx)(e.p,{children:"\u7528\u6237\u53d1\u73b0\u81ea\u5df1\u7684\u670d\u52a1\u5668 CPU \u5728\u67d0\u4e00\u65f6\u523b\u9661\u7136\u5347\u9ad8\uff0c\u4f46\u4ece\u76d1\u63a7\u4e0a\u770b\uff0c\u540c\u4e00\u65f6\u523b\u7684\u4e1a\u52a1\u91cf\u5374\u5e76\u4e0d\u9ad8\uff0c\u5ba2\u6237\u6000\u7591\u662f\u4e91\u670d\u52a1\u5668\u6709\u95ee\u9898\uff0c\u5e0c\u671b\u6280\u672f\u652f\u6301\u56e2\u961f\u4e88\u4ee5\u89e3\u51b3\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u7ecf\u8fc7\u6211\u4eec\u7684\u6392\u67e5\uff0c \u53d1\u73b0 cpu \u7684\u4e24\u6b21\u95f4\u6b47\u98d9\u9ad8\u662f\u7531\u4e8e\u5ba2\u6237\u7cfb\u7edf\u5f53\u65f6\u53d1\u751f\u4e86 OOM\uff08out of memory\uff09\u7684\u60c5\u51b5\uff0c \u5e76\u89e6\u53d1\u4e86 oom-killer \u9020\u6210\u7684\u3002 \u4f46\u5ba2\u6237\u5e76\u4e0d\u63a5\u53d7\u8fd9\u4e2a\u7ed3\u8bba\uff0c \u8ba4\u4e3a\u662f\u4e91\u670d\u52a1\u5668\u7684\u5f02\u5e38\u5bfc\u81f4\u4e86 cpu \u98d9\u9ad8\uff0c\u800c cpu \u7684\u5347\u9ad8\u53c8\u5bfc\u81f4\u4e86 oom \u60c5\u51b5\u7684\u53d1\u751f\u3002\u4e5f\u5c31\u662f\u5bf9\u4e8e cpu \u5347\u9ad8\u548c oom \u8c01\u4e3a\u56e0\u679c\u8fd9\u4ef6\u4e8b\u4e0a\uff0c\u5ba2\u6237\u548c\u6211\u4eec\u6301\u5b8c\u5168\u76f8\u53cd\u7684\u6001\u5ea6\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u4e0b\u9762\u6211\u4eec\u5c06\u901a\u8fc7\u5bf9 oom \u65f6\u7cfb\u7edf\u65e5\u5fd7\u7684\u89e3\u8bfb\u6765\u8bf4\u660e cpu \u5347\u9ad8\u548c oom \u4e4b\u95f4\u7684\u56e0\u679c\u5173\u7cfb\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"222-\u77e5\u8bc6\u70b9\u68b3\u7406",children:"2.2.2 \u77e5\u8bc6\u70b9\u68b3\u7406"}),"\n",(0,i.jsx)(e.h5,{id:"2221-\u9884\u5907\u77e5\u8bc6",children:"2.2.2.1 \u9884\u5907\u77e5\u8bc6"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5728\u89e3\u8bfb\u65e5\u5fd7\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u56de\u987e\u4e00\u4e0b linux \u5185\u6838\u7684\u5185\u5b58\u7ba1\u7406\u3002"})}),"\n"]}),"\n",(0,i.jsx)(e.h6,{id:"22211-\u51e0\u4e2a\u57fa\u672c\u7684\u6982\u5ff5",children:"2.2.2.1.1 \u51e0\u4e2a\u57fa\u672c\u7684\u6982\u5ff5"}),"\n",(0,i.jsx)(e.p,{children:"(1) Page \u9875\t\u5904\u7406\u5668\u7684\u6700\u5c0f '\u5bfb\u5740\u5355\u5143' \u662f\u5b57\u8282\u6216\u8005\u5b57\uff0c\u800c\u9875\u662f\u5185\u5b58\u7684 '\u7ba1\u7406\u5355\u5143'\u3002"}),"\n",(0,i.jsx)(e.p,{children:"(2) Zone \u533a"}),"\n",(0,i.jsx)(e.p,{children:"(a) \u533a\u5b58\u5728\u7684\u539f\u56e0\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u6709\u4e9b\u786c\u4ef6\u8bbe\u5907\u53ea\u80fd\u5bf9\u7279\u5b9a\u7684\u5185\u5b58\u5730\u5740\u6267\u884c DMA\uff08direct memory access\uff09 \u64cd\u4f5c\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u5728\u4e00\u4e9b\u67b6\u6784\u4e2d\uff0c\u5b9e\u9645\u7269\u7406\u5185\u5b58\u662f\u6bd4\u7cfb\u7edf\u53ef\u5bfb\u5740\u7684\u865a\u62df\u5185\u5b58\u8981\u5927\u7684\uff0c\u8fd9\u5c31\u5bfc\u81f4\u6709\u4e9b\u7269\u7406\u5185\u5b58\u6ca1\u6709\u529e\u6cd5\u88ab\u6c38\u4e45\u7684\u6620\u5c04\u5728\u5185\u6838\u7684\u5730\u5740\u7a7a\u95f4\u4e2d\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u533a\u7684\u5212\u5206\u4e5f\u662f\u76f4\u63a5\u4ee5\u4e0a\u9762\u4e24\u4e2a\u539f\u56e0\u4e3a\u4f9d\u636e\u7684\u3002"}),"\n",(0,i.jsx)(e.p,{children:"(b) \u533a\u7684\u79cd\u7c7b"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"ZONE_DMA"}),"\t\u8fd9\u4e2a\u533a\u5305\u542b\u7684 page \u53ef\u4ee5\u6267\u884c DMA \u64cd\u4f5c\u3002\u8fd9\u90e8\u5206\u533a\u57df\u7684\u5927\u5c0f\u548c CPU \u67b6\u6784\u6709\u5173\uff0c\u5728 x86 \u67b6\u6784\u4e2d\uff0c\u8be5\u90e8\u5206\u533a\u57df\u5927\u5c0f\u9650\u5236\u4e3a 16MB\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"ZONE_DMA32"}),"    \u7c7b\u4f3c\u4e8e ",(0,i.jsx)(e.code,{children:"ZOME_DMA"}),"\uff0c \u8fd9\u4e2a\u533a\u4e5f\u5305\u542b\u53ef\u4ee5\u6267\u884c DMA \u64cd\u4f5c\u7684page\u3002\u8be5\u533a\u57df\u53ea\u5b58\u5728\u4e8e64\u4f4d\u7cfb\u7edf\u4e2d\uff0c\u9002\u540832\u4f4d\u7684\u8bbe\u5907\u8bbf\u95ee\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"ZONE_NORMAL"}),"    \u8fd9\u4e2a\u533a\u5305\u542b\u53ef\u4ee5\u6b63\u5e38\u6620\u5c04\u5230\u5730\u5740\u7a7a\u95f4\u4e2d\u7684 page\uff0c\u6216\u8005\u8bf4\u8fd9\u4e2a\u533a\u5305\u542b\u4e86\u9664\u4e86 DMA \u548c HIGHMEM \u4ee5\u5916\u7684\u5185\u5b58\u3002 \u8bb8\u591a\u5185\u6838\u64cd\u4f5c\u90fd\u4ec5\u5728\u8fd9\u4e2a\u533a\u57df\u8fdb\u884c\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"ZONE_HIGHMEM"}),"    \u8fd9\u4e2a\u533a\u5305\u542b\u7684\u662f high memory\uff0c\u4e5f\u5c31\u662f\u90a3\u4e9b\u4e0d\u80fd\u88ab\u6c38\u4e45\u6620\u5c04\u5230\u5185\u6838\u5730\u5740\u7a7a\u95f4\u7684\u9875\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["32\u4f4d\u7684 x86 \u67b6\u6784\u4e2d\u5b58\u5728\u4e09\u79cd\u5185\u5b58\u533a\u57df\uff0c",(0,i.jsx)(e.code,{children:"ZONE_DMA"}),"\uff0c",(0,i.jsx)(e.code,{children:"ZONE_NORMAL"}),"\uff0c ",(0,i.jsx)(e.code,{children:"ZONE_HIGHMEM"}),"\u3002\u6839\u636e\u5730\u5740\u7a7a\u95f4\u5212\u5206\u7684\u4e0d\u540c\uff0c\u4e09\u4e2a\u533a\u57df\u7684\u5927\u5c0f\u4e0d\u4e00\u6837\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"1G \u5185\u6838\u7a7a\u95f4 /3G \u7528\u6237\u7a7a\u95f4"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:(0,i.jsx)(e.strong,{children:"\u533a\u57df"})}),(0,i.jsx)(e.th,{children:(0,i.jsx)(e.strong,{children:"\u5185\u5b58\u8303\u56f4"})})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"ZONE_DMA"})}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"< 16M"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"ZONE_NORMAL"})}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"16M ~ 896M"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"ZONE_HIGHMEM"})}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"> 896M"})})]})]})]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"4G \u5185\u6838\u7a7a\u95f4 /4G \u7528\u6237\u7a7a\u95f4"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:(0,i.jsx)(e.strong,{children:"\u533a\u57df"})}),(0,i.jsx)(e.th,{children:(0,i.jsx)(e.strong,{children:"\u5185\u5b58\u8303\u56f4"})})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"ZONE_DMA"})}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"< 16M"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"ZONE_NORMAL"})}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"16M ~ 3968M"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"ZONE_HIGHMEM"})}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"> 3968M"})})]})]})]}),"\n",(0,i.jsx)(e.p,{children:"64\u4f4d\u7684\u7cfb\u7edf\u7531\u4e8e\u5bfb\u5740\u80fd\u529b\u7684\u63d0\u9ad8\uff0c \u4e0d\u5b58\u5728 highmem \u533a\uff0c \u6240\u4ee564\u4f4d\u7cfb\u7edf\u4e2d\u5b58\u5728\u7684\u533a\u6709 DMA\uff0cDMA32 \u548c NORMAL \u4e09\u4e2a\u533a\u3002"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:(0,i.jsx)(e.strong,{children:"\u533a\u57df"})}),(0,i.jsx)(e.th,{children:(0,i.jsx)(e.strong,{children:"\u5185\u5b58\u8303\u56f4"})})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"ZONE_DMA"})}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"< 16M"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"ZONE_DMA32"})}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"16M ~ 4G"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"ZONE_NORMAL"})}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"> 4G"})})]})]})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h6,{id:"22212-\u5185\u6838\u5206\u914d\u5185\u5b58\u7684\u51fd\u6570",children:"2.2.2.1.2 \u5185\u6838\u5206\u914d\u5185\u5b58\u7684\u51fd\u6570"}),"\n",(0,i.jsx)(e.p,{children:"\u4e0b\u9762\u662f\u5185\u6838\u5206\u914d\u5185\u5b58\u7684\u6838\u5fc3\u51fd\u6570\u4e4b\u4e00\uff0c\u5b83\u4f1a\u5206\u914d2\u7684 order \u6b21\u65b9\u4e2a\u8fde\u7eed\u7684\u7269\u7406\u9875\u5185\u5b58\uff0c\u5e76\u5c06\u7b2c\u4e00\u9875\u7684\u903b\u8f91\u5730\u5740\u8fd4\u56de\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"unsigned long __get_free_pages(gfp_t gfp_mask\uff0cunsigned int order)\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u5185\u6838\u7a7a\u95f4\u7684\u5185\u5b58\u5206\u914d\u51fd\u6570\u548c\u7528\u6237\u7a7a\u95f4\u6700\u5927\u7684\u4e0d\u540c\u5c31\u662f\u6bcf\u4e2a\u51fd\u6570\u4f1a\u6709\u4e00\u4e2a ",(0,i.jsx)(e.code,{children:"gfp_ mask"})," \u53c2\u6570\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u5176\u4e2d gfp \u4ee3\u8868\u7684\u5c31\u662f\u6211\u4eec\u4e0a\u9762\u7684\u5185\u5b58\u5206\u914d\u51fd\u6570",(0,i.jsx)(e.code,{children:" __get_free_pages()"}),"\u3002"]}),"\n",(0,i.jsx)(e.p,{children:"gfp_mask \u53ef\u4ee5\u5206\u6210\u4e09\u79cd\uff1a\u884c\u4e3a\u4fee\u9970\u7b26\uff08action modifier\uff09, \u533a\u4fee\u9970\u7b26\uff08zone modifier\uff09\u548c\u7c7b\u578b\uff08type\uff09\u3002"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u884c\u4e3a\u4fee\u9970\u7b26"}),"\u662f\u7528\u6765\u6307\u5b9a\u5185\u6838\u8be5\u5982\u4f55\u5206\u914d\u5185\u5b58\u7684\u3002 \u6bd4\u5982\u5206\u914d\u5185\u5b58\u65f6\u662f\u5426\u53ef \u4ee5\u8fdb\u884c\u78c1\u76d8 io\uff0c\u662f\u5426\u53ef\u4ee5\u8fdb\u884c\u6587\u4ef6\u7cfb\u7edf\u64cd\u4f5c\uff0c\u5185\u6838\u662f\u5426\u53ef\u4ee5\u7761\u7720\uff08sleep\uff09 \u7b49\u7b49\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u533a\u4fee\u9970\u7b26"}),"\u6307\u5b9a\u5185\u5b58\u9700\u8981\u4ece\u54ea\u4e2a\u533a\u6765\u5206\u914d\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7c7b\u578b"}),"\u662f\u884c\u4e3a\u4fee\u9970\u7b26\u548c\u533a\u4fee\u9970\u7b26\u7ed3\u5408\u4e4b\u540e\u7684\u4ea7\u7269\u3002\u5728\u4e00\u4e9b\u7279\u5b9a\u7684\u5185\u5b58\u5206\u914d\u573a \u5408\u4e0b\uff0c \u6211\u4eec\u53ef\u80fd\u9700\u8981\u540c\u65f6\u6307\u5b9a\u591a\u4e2a\u884c\u4e3a\u4fee\u9970\u7b26\u548c\u533a\u4fee\u9970\u7b26\uff0c \u800c type \u5c31\u662f \u9488\u5bf9\u8fd9\u4e9b\u56fa\u5b9a\u7684\u573a\u5408\uff0c\u5c06\u6240\u9700\u8981\u7684\u884c\u4e3a\u4fee\u9970\u7b26\u548c\u533a\u4fee\u9970\u7b26\u90fd\u6574\u5408\u5230\u4e86\u4e00\u8d77\uff0c \u8fd9\u6837\u4f7f\u7528\u8005\u53ea\u8981\u6307\u5b9a\u4e00\u4e2a type \u5c31\u53ef\u4ee5\u4e86\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u4e0d\u540c type \u6240\u4ee3\u8868\u7684\u542b\u4e49\u53ef\u4ee5\u53c2\u770b\u4e0b\u9762\u7684\u8868\u683c\uff1a"}),"\n",(0,i.jsx)(e.h5,{id:"2222-\u65e5\u5fd7\u89e3\u8bfb",children:"2.2.2.2 \u65e5\u5fd7\u89e3\u8bfb"}),"\n",(0,i.jsx)(e.p,{children:"\u4e0b\u9762\u662f\u4ece oom killer \u88ab\u89e6\u53d1\u5230\u8fdb\u7a0b\u5230\u88ab\u6740\u6389\u7684\u4e00\u4e2a\u5927\u6982\u8fc7\u7a0b\uff0c \u6211\u4eec\u6765\u5177\u4f53\u770b \u4e00\u4e0b\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"nginx invoked oom-killer: gfp_mask=0x200da\uff0corder=0\uff0coom_score_adj=0\nnginx cpuset=6011a7f12bac1c4592ce41407bb41d49836197001a0e355f5a1d9589e4001e42 mems_allowed=0\nCPU: 1 PID: 10242 Comm: nginx Not tainted 3.13.0-86-generic #130-Ubuntu\nHardware name: Xen HVM domU\uff0cBIOS 4.0.1 12/16/2014\n\t0000000000000000 ffff880070611a00 ffffffff8172a3b4 ffff88012af6c800\n\t0000000000000000 ffff880070611a88 ffffffff8172495d ffffffff81069b76\n\tffff880070611a60 ffffffff810ca5ac ffff88020fff7e38 0000000000000000\nNode 0 DMA free:15908kB min:128kB low:160kB high:192kB active_anon:0kB inactive_anon:0kB active_file:0kB inactive_file:0kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:15992kB managed:15908kB mlocked:0kB dirty:0kB writeback:0kB mapped:0kB shmem:0kB slab_ reclaimable:0kB slab_unreclaimable:0kB kernel_stack:0kB pagetables:0kB unstable:0kB bounce:0kB free_cma:0kB writeback_tmp:0kB pages_scanned:0 all_ unreclaimable? yes\nlowmem_reserve[]: 0 3746 7968 7968\nNode 0 DMA32 free:48516kB min:31704kB low:39628kB high:47556kB active_ anon:3619272kB inactive_anon:216kB active_file:556kB inactive_file:1516kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:3915776kB managed:3836724kB mlocked:0kB dirty:4kB writeback:0kB mapped:324kB shmem:1008kB slab_reclaimable:67136kB slab_unreclaimable:67488kB kernel_ stack:1792kB pagetables:14540kB unstable:0kB bounce:0kB free_cma:0kB writeback_tmp:0kB pages_scanned:7365 all_unreclaimable? yes\nlowmem_reserve[]: 0 0 4221 4221\nNode 0 Normal free:35640kB min:35748kB low:44684kB high:53620kB active_ anon:4019124kB inactive_anon:292kB active_file:1292kB inactive_file:2972kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:4456448kB managed:4322984kB mlocked:0kB dirty:24kB writeback:4kB mapped:1296kB shmem:1324kB slab_reclaimable:81196kB slab_unreclaimable:83432kB kernel_ stack:3392kB pagetables:20252kB unstable:0kB bounce:0kB free_cma:0kB writeback_tmp:0kB pages_scanned: 7874 all_unreclaimable? yes\nlowmem_reserve[]: 0 0 0 0\nNode 0 DMA: 1*4kB (U) 0*8kB 0*16kB 1*32kB (U) 2*64kB (U) 1*128kB (U) 1*256kB (U) 0*512kB 1*1024kB (U) 1*2048kB (R) 3*4096kB (M) = 15908kB Node 0 DMA32: 1101*4kB (UE) 745*8kB (UEM) 475*16kB (UEM) 263*32kB (EM) 88*64kB (UEM) 25*128kB (E)12*256kB (EM) 6*512kB (E) 7*1024kB (EM) 0*2048kB 0*4096kB = 48524kB\nNode 0 Normal: 5769*4kB (EM) 1495*8kB (EM) 24*16kB (UE) 0*32kB 0*64kB 0*128kB 0*256kB 0*512kB 0*1024kB 0*2048kB 0*4096kB = 35420kB\nNode 0 hugepages_total=0 hugepages_free=0 hugepages_surp=0 hugepages_ size=2048kB\n2273 total pagecache pages\n0 pages in swap cache\nSwap cache stats: add 0\uff0cdelete 0\uff0cfind 0/0\nFree swap = 0kB\nTotal swap = 0kB\n2097054 pages RAM\n0 pages HighMem/MovableOnly\n33366 pages reserved\n[ pid ] uid tgid total_vm rss nr_ptes swapents oom_score_adj name\n[ 355]   0   355   4868    66   13       0            0\nupstart-udev-br\n[ 361]   0   361   12881   145  28       0            -1000\nsystemd-udevd  \n[ 499]   0   499   3814    60   13       0            0\nupstart-socket-  \n[ 562]   0   562   5855    79   15       0            0\nrpcbind  \n[ 644]   106 644   5398    142  16       0            0 rpc.\nstatd\n[ 775]   0   775   3818    58   12       0            0\nupstart-file-br\n...\uff08\u6b64\u5904\u6709\u7701\u7565\uff09\n[10396] 104  10396 21140  12367 44      0            0 nginx\n[10397] 104  10397 21140  12324 44      0            0 nginx\n[10398] 104  10398 21140  12324 44      0            0 nginx\n[10399] 104  10399 21140  12367 44      0            0 nginx\nOut of memory: Kill process 10366 (nginx) score 6 or sacrifice child\nKilled process 10366 (nginx) total-vm:84784kB\uff0canon-rss:49156kB\uff0cfilerss:520kB  \n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5148\u6765\u770b\u4e00\u4e0b\u7b2c\u4e00\u884c\uff0c\u5b83\u7ed9\u51fa\u4e86 oom killer \u662f\u7531\u8c01\u89e6\u53d1\u7684\u4fe1\u606f\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"nginx invoked oom-killer: gfp_mask=0x200da\uff0corder=0\uff0coom_score_adj=0\n"})}),"\n",(0,i.jsx)(e.p,{children:"order=0 \u544a\u8bc9\u6211\u4eec\u6240\u8bf7\u6c42\u7684\u5185\u5b58\u7684\u5927\u5c0f\u662f\u591a\u5c11\uff0c \u5373 nginx \u8bf7\u6c42\u4e862\u76840\u6b21\u65b9\u8fd9\u4e48\u591a\u4e2a page \u7684\u5185\u5b58\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a page\uff0c\u6216\u8005\u8bf4\u662f 4KB\u3002 gfp_mask \u7684\u6700\u540e\u4e24\u4e2a bit \u4ee3\u8868\u7684\u662f zone mask\uff0c\u4e5f\u5c31\u662f\u8bf4\u5b83\u6307\u660e\u5185\u5b58\u5e94\u8be5\u4ece\u54ea\u4e2a\u533a\u6765\u5206\u914d\u3002"}),"\n",(0,i.jsx)(e.p,{children:"Flag value Description"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"0x00u\t\t\t0 implicitly means allocate from ZONE_NORMAL\n"})}),"\n",(0,i.jsx)(e.p,{children:"__GFP_DMA 0x01u Allocate from ZONE_DMA if possible"}),"\n",(0,i.jsx)(e.p,{children:"__GFP_HIGHMEM 0x02u Allocate from ZONE_HIGHMEM if possible"}),"\n",(0,i.jsx)(e.p,{children:"(\u8fd9\u91cc\u6709\u4e00\u70b9\u9700\u8981\u6ce8\u610f\uff0c\u5728 64 \u4f4d\u7684 x86 \u7cfb\u7edf\u4e2d\uff0c\u662f\u6ca1\u6709 highmem \u533a\u7684\uff0c64 \u4f4d\u7cfb\u7edf\u4e2d\u7684 normal \u533a\u5c31\u5bf9\u5e94\u4e0a\u8868\u4e2d\u7684 highmem \u533a\u3002\uff09"}),"\n",(0,i.jsx)(e.p,{children:"\u5728\u672c\u6848\u4f8b\u4e2d\uff0czonemask\u662f2\uff0c\u4e5f\u5c31\u662f\u8bf4 nginx \u6b63\u5728\u4ece zone \uff0d normal\uff0864 \u4f4d \u7cfb\u7edf\uff09\u4e2d\u8bf7\u6c42\u5185\u5b58\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u5176\u4ed6\u6807\u5fd7\u4f4d\u7684\u542b\u4e49\u5982\u4e0b\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"#define __GFP_WAIT\t0x10u\t/* Can wait and reschedule? */\n#define __GFP_HIGH\t0x20u\t/* Should access emergency pools? */\n#define __GFP_IO\t\t0x40u\t/* Can start physical IO? */\n#define __GFP_FS\t\t0x80u\t/* Can call down to low-level FS? */\n#define __GFP_COLD\t0x100u\t/* Cache-cold page required */\n#define __GFP_NOWARN */\t0x200u\t/* Suppress page allocation failure warning */\n#define __GFP_REPEAT\t0x400u\t/* Retry the allocation. Might fail */\n#define __GFP_NOFAIL\t0x800u\t/* Retry for ever.\tCannot fail */\n#define __GFP_NORETRY\t0x1000u /* Do not retry.\tMight fail */\n#define __GFP_NO_GROW\t0x2000u /* Slab internal usage */\n#define __GFP_COMP\t0x4000u /* Add compound page metadata */\n#define __GFP_ZERO\t0x8000u /* Return zeroed page on success */\n#define __GFP_NOMEMALLOC 0x10000u /* Don\u2019t use emergency reserves */\n#define __GFP_NORECLAIM allocation 0x20000u /* No realy zone reclaim during */\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u6240\u4ee5\u6211\u4eec\u5f53\u524d\u8fd9\u4e2a\u5185\u5b58\u8bf7\u6c42\u5e26\u6709\u8fd9\u51e0\u4e2a\u6807\u5fd7\uff1a",(0,i.jsx)(e.code,{children:"GFP_NORECLAIM"}),"\uff0c",(0,i.jsx)(e.code,{children:"GFP_FS"}),"\uff0c ",(0,i.jsx)(e.code,{children:"GFP_IO"}),"\uff0c",(0,i.jsx)(e.code,{children:"GFP_WAIT"}),"\uff0c\u90fd\u662f\u6bd4\u8f83\u6b63\u5e38\u7684\u51e0\u4e2a\u6807\u5fd7\uff0c\u90a3\u4e48\u6211\u4eec\u8fd9\u4e2a\u8bf7\u6c42\u4e3a\u4ec0\u4e48 \u4f1a\u6709\u95ee\u9898\u5462\uff1f\u7ee7\u7eed\u5f80\u4e0b\u770b\uff0c\u53ef\u4ee5\u770b\u5230\u4e0b\u9762\u7684\u4fe1\u606f\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"Node 0 Normal free:35640kB min:35748kB low:44684kB high:53620kB active_ anon:4019124kB inactive_anon:292kB active_file:1292kB inactive_file:2972kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:4456448kB managed:4322984kB mlocked:0kB dirty:24kB writeback:4kB mapped:1296kB shmem:1324kB slab_reclaimable:81196kB slab_unreclaimable:83432kB kernel_ stack:3392kB pagetables:20252kB unstable:0kB bounce:0kB free_cma:0kB writeback_tmp:0kB pages_scanned: 7874 all_unreclaimable? yes\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u53ef\u4ee5\u770b\u5230 normal \u533a free \u7684\u5185\u5b58\u53ea\u6709 35640KB\uff0c\u6bd4\u7cfb\u7edf\u5141\u8bb8\u7684\u6700\u5c0f\u503c\uff08min\uff09\u8fd8\u8981\u4f4e\uff0c\u8fd9\u610f\u5473\u7740 application \u5df2\u7ecf\u65e0\u6cd5\u518d\u4ece\u7cfb\u7edf\u4e2d\u7533\u8bf7\u5230\u5185\u5b58\u4e86\uff0c\u5e76\u4e14\u7cfb\u7edf\u4f1a\u5f00\u59cb\u542f\u52a8 oom killer \u6765\u7f13\u89e3\u7cfb\u7edf\u5185\u5b58\u538b\u529b\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u91cc\u6211\u4eec\u8bf4\u4e00\u4e0b\u4e00\u4e2a\u5e38\u89c1\u7684\u8bef\u533a\uff0c\u5c31\u662f\u6709\u4eba\u4f1a\u8ba4\u4e3a\u89e6\u53d1\u4e86 oom killer \u7684\u8fdb\u7a0b\u5c31\u662f\u95ee\u9898\u7684\u7f6a\u9b41\u7978\u9996\uff0c\u6bd4\u5982\u6211\u4eec\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u7684\u8fd9\u4e2a nginx \u8fdb\u7a0b\u3002\u5176\u5b9e\u65e5\u5fd7\u4e2d invoke oom killer \u7684\u8fd9\u4e2a\u8fdb\u7a0b\u6709\u65f6\u5019\u53ef\u80fd\u53ea\u662f\u4e00\u4e2a\u53d7\u5bb3\u8005\uff0c \u56e0\u4e3a\u5176\u4ed6\u5e94\u7528\uff0f\u8fdb\u7a0b\u5df2\u5c06\u7cfb\u7edf\u5185\u5b58\u7528\u5c3d\uff0c \u800c\u8fd9\u4e2a invoke oomkiller \u7684\u8fdb\u7a0b\u6070\u597d\u5728\u6b64\u65f6\u53d1\u8d77\u4e86\u4e00\u4e2a\u5206\u914d\u5185\u5b58\u7684\u8bf7\u6c42\u800c\u5df2\u3002 \u5728\u7cfb\u7edf\u5185\u5b58\u5df2\u7ecf\u4e0d\u8db3\u7684\u60c5\u51b5\u4e0b\uff0c \u4efb\u4f55\u4e00\u4e2a\u5185\u5b58\u8bf7\u6c42\u90fd\u53ef\u80fd\u89e6\u53d1 oom killer \u7684\u542f\u52a8\u3002"}),"\n",(0,i.jsx)(e.p,{children:"oom killer \u7684\u542f\u52a8\u4f1a\u4f7f\u7cfb\u7edf\u4ece\u7528\u6237\u7a7a\u95f4\u8f6c\u6362\u5230\u5185\u6838\u7a7a\u95f4\u3002\u5185\u6838\u4f1a\u5728\u77ed\u65f6\u95f4\u5185\u8fdb\u884c\u5927\u91cf\u7684\u5de5\u4f5c\uff0c \u6bd4\u5982\u8ba1\u7b97\u6bcf\u4e2a\u8fdb\u7a0b\u7684 oom \u5206\u503c\uff0c \u4ece\u800c\u7b5b\u9009\u51fa\u6700\u9002\u5408\u6740\u6389\u7684\u8fdb\u7a0b\u3002 \u6211\u4eec\u4ece\u65e5\u5fd7\u4e2d\u4e5f\u53ef\u4ee5\u770b\u5230\u8fd9\u4e00\u7b5b\u9009\u8fc7\u7a0b\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"[ pid ] uid tgid total_vm   rss nr_ptes swapents oom_score_adj name\n[ 355]    0  355     4868   66  13             0             0\nupstart-udev-br\n[ 361]    0  361     12881 145  28             0         -1000\nsystemd-udevd  \n[ 499]    0  499     3814   60  13             0             0\nupstart-socket-\n[ 562]    0  562     5855   79  15             0             0\nrpcbind\n[ 644]  106  644     5398  142  16             0             0 rpc.\nstatd\n[ 775]    0  775     3818   58  12             0             0\nupstart-file-br\n...\n[10396]  104 10396   21140 12367 44            0             0 nginx\n[10397]  104 10397   21140 12324 44            0             0 nginx\n[10398]  104 10398   21140 12324 44            0             0 nginx\n[10399]  104 10399   21140 12367 44            0             0 nginx  \n"})}),"\n",(0,i.jsx)(e.p,{children:"\u672c\u4f8b\u4e2d\uff0c\u4e00\u4e2a nginx \u8fdb\u7a0b\u88ab\u9009\u4e2d\u4f5c\u4e3a\u7f13\u89e3\u5185\u5b58\u538b\u529b\u7684\u727a\u7272\u8fdb\u7a0b\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"Out of memory: Kill process 10366 (nginx) score 6 or sacrifice child\nKilled process 10366 (nginx) total-vm:84784kB\uff0canon-rss:49156kB\uff0c file-rss:520kB\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u6574\u4e2a\u8fc7\u7a0b\u8fdb\u884c\u7684\u65f6\u95f4\u5f88\u77ed\uff0c\u53ea\u6709\u6beb\u79d2\u7ea7\u522b\uff0c\u4f46\u662f\u5de5\u4f5c\u91cf\uff0f\u8ba1\u7b97\u91cf\u5f88\u5927\uff0c\u8fd9\u5c31\u5bfc\u81f4\u4e86 cpu \u77ed\u65f6\u95f4\u5185\u8fc5\u901f\u98d9\u5347\uff0c \u51fa\u73b0\u5cf0\u503c\u3002 \u4f46\u8fd9\u4e00\u5207\u5de5\u4f5c\u90fd\u7531\u5185\u6838\u5728\u5185\u6838\u7a7a\u95f4\u4e2d\u5b8c\u6210\uff0c\u6240\u4ee5\u7528\u6237\u5728\u81ea\u5df1\u7684\u4e1a\u52a1\u76d1\u63a7\u6570\u636e\u4e0a\u5e76\u4e0d\u4f1a\u770b\u5230\u4e1a\u52a1\u91cf\u7684\u5f02\u5e38\u3002\u8fd9\u4e9b\u77ed\u65f6\u95f4\u5347\u9ad8\u7684 cpu \u662f\u5185\u6838\u4f7f\u7528\u7684\uff0c\u800c\u4e0d\u662f\u7528\u6237\u7684\u4e1a\u52a1\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u672c\u4f8b\u4e2d\u5ba2\u6237\u53ea\u662f\u5076\u5c14\u770b\u5230\u8fd9\u4e2a\u73b0\u8c61\uff0c\u4e14\u4e1a\u52a1\u5e76\u6ca1\u6709\u53d7\u5230\u5f71\u54cd\u3002\u6211\u4eec\u7ed9\u5ba2\u6237\u7684\u5efa\u8bae\u662f\u5206\u6790\u4e1a\u52a1\u5185\u5b58\u9700\u6c42\u91cf\u6700\u5927\u503c\uff0c\u5982\u679c\u7cfb\u7edf\u5df2\u7ecf\u6ca1\u6709\u529e\u6cd5\u6ee1\u8db3\u7279\u5b9a\u65f6\u6bb5\u4e1a\u52a1\u7684\u5185\u5b58\u9700\u6c42\uff0c \u5efa\u8bae\u7528\u6237\u5347\u7ea7\u5185\u5b58\u6765\u907f\u514d oom \u7684\u60c5\u51b5\u53d1\u751f\uff0c \u56e0\u4e3a\u4e25\u91cd\u7684 oom \u60c5\u51b5\u662f\u53ef\u80fd\u5f15\u53d1\u7cfb\u7edf\u5d29\u6e83\u7684\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"23-\u6211\u7684\u670d\u52a1\u5668\u5185\u5b58\u53bb\u54ea\u513f\u4e86",children:"2.3 \u6211\u7684\u670d\u52a1\u5668\u5185\u5b58\u53bb\u54ea\u513f\u4e86"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u80cc\u666f"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6536\u5230\u62a5\u8b66\uff0c\u7cfb\u7edf\u7684\u5185\u5b58\u4f7f\u7528\u7387\u89e6\u53d1\u9608\u503c\uff08\u90e8\u5206\u56fe\u662f\u540e\u8865\u7684\uff09\u3002"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0510.02.30.png",alt:"iShot2020-08-0510.02.30"})}),"\n",(0,i.jsx)(e.p,{children:"\u767b\u9646\u7cfb\u7edf\uff0c\u4f7f\u7528\u547d\u4ee4(top \u6309M)\u67e5\u770b\u5185\u5b58\u5206\u914d\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0510.04.33.png",alt:"iShot2020-08-0510.04.33"})}),"\n",(0,i.jsxs)(e.p,{children:["\u4f7f\u7528\u547d\u4ee4",(0,i.jsx)(e.code,{children:"free -m"}),"\u67e5\u770b\u5185\u5b58\u4f7f\u7528\u60c5\u51b5"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0510.05.17.png",alt:"iShot2020-08-0510.05.17"})}),"\n",(0,i.jsxs)(e.p,{children:["\u4f7f\u7528\u547d\u4ee4",(0,i.jsx)(e.code,{children:"atop"}),"\u770b\u4e0b\u5185\u5b58\u5206\u914d\uff08cat /proc/meminfo \u4e5f\u53ef\u4ee5\u770b\u5230\u4e00\u4e9b\u7ec6\u5316\u7684\u5185\u5b58\u4f7f\u7528\u4fe1\u606f\uff09\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0510.06.49.png",alt:"iShot2020-08-0510.06.49"})}),"\n",(0,i.jsxs)(e.p,{children:["\u53d1\u73b0 cache \u624d 1.7G\uff0cslab \u975e\u5e38\u9ad8\uff0c4.4G\uff0c",(0,i.jsx)(e.strong,{children:(0,i.jsx)("span",{style:{color:"red"},children:"slab \u5185\u5b58\u7b80\u5355\u7406\u89e3\u4e3a\u662f\u7cfb\u7edf\u5360\u7528\u7684"})}),"\u3002 \u4f7f\u7528 slabtop \u7ee7\u7eed\u5206\u6790\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0510.10.52.png",alt:"iShot2020-08-0510.10.52"})}),"\n",(0,i.jsxs)(e.p,{children:["\u770b\u5230 ",(0,i.jsx)(e.code,{children:"proc_inode_cache"})," \u4f7f\u7528\u7684\u6700\u591a\uff0c \u8fd9\u4e2a\u4ee3\u8868\u662f proc \u6587\u4ef6\u7cfb\u7edf\u7684 inode \u5360\u7528\u7684\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u4f7f\u7528\u547d\u4ee4",(0,i.jsx)(e.code,{children:"ps -eLf"}),"\u67e5\u8fdb\u7a0b\uff0c\u4f46\u662f\u8fdb\u7a0b\u4e0d\u591a\uff0c\u518d\u67e5\u7ebf\u7a0b\uff0c\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u68c0\u67e5\u3002\u5f97\u5230\u5982\u4e0b\u7684\u7ed3\u679c\uff1a( \u539f\u56fe\u7f3a\u5931\uff0c\u4f7f\u7528\u6d4b\u8bd5\u673a\u67e5\u770b\u5230\u7684\u622a\u56fe\u6765\u8865\u5145\u8bf4\u660e )"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0510.11.49.png",alt:"iShot2020-08-0510.11.49"})}),"\n",(0,i.jsx)(e.p,{children:"\u8ba1\u7b97 socket"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"$ ll /proc/22360/task/*/fd/ |grep socket |wc -l\n140\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u8ba1\u7b97\u4e00\u4e0b\u6709\u591a\u5c11fd"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"$ ll /proc/22360/task/*/fd/ | wc -l\n335\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u6bcf\u4e2a socket \u7684 inode \u4e5f\u4e0d\u4e00\u6837\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0510.17.07.png",alt:"iShot2020-08-0510.17.07"})}),"\n",(0,i.jsx)(e.p,{children:"\u5f53\u65f6\u770b\u5230\u7684\u73b0\u573a\u6709\u51e0\u4e07\u4e2a fd\uff0c \u57fa\u672c\u5168\u662f socket\uff0c \u6bcf\u4e2a inode \u90fd\u662f\u5360\u7528\u7a7a\u95f4\u7684\uff0c \u4e14 proc \u6587\u4ef6\u7cfb\u7edf\u662f\u5168\u5185\u5b58\u7684\u3002 \u6240\u4ee5\u6211\u4eec\u624d\u4f1a\u770b\u5230 slab \u4e2d proc_inode_cache \u5185\u5b58\u5360\u7528\u9ad8\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5efa\u8bae"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5efa\u8bae\u7528\u6237\u9700\u8981\u4ece\u7a0b\u5e8f\u4e0a\u4f18\u5316\u76f8\u5173\u7684 server \u7aef ~"})}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"24-cpu-\u5360\u7528\u4e0d\u9ad8\u4f46\u7f51\u7edc\u6027\u80fd\u5f88\u5dee\u7684\u4e00\u4e2a\u539f\u56e0",children:"2.4 CPU \u5360\u7528\u4e0d\u9ad8\u4f46\u7f51\u7edc\u6027\u80fd\u5f88\u5dee\u7684\u4e00\u4e2a\u539f\u56e0"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7b80\u4ecb"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6211\u4eec\u7ecf\u5e38\u78b0\u5230\u6574\u4f53 cpu \u4e0d\u9ad8\uff0c\u4f46\u662f\u6027\u80fd\u4e0d\u4f73\u7684\u6848\u4f8b\uff0c\u8fd9\u79cd\u6848\u4f8b\u5f80\u5f80\u8ddf CPU \u5904\u7406\u4e2d\u65ad\u7684\u6838\u5fc3\u8dd1\u6ee1\u6709\u5173\u7cfb\uff0c\u8bdd\u4e0d\u591a\u8bf4\uff0c\u6211\u4eec\u6765\u770b\u770b\u4e2d\u65ad\u76f8\u5173\u7684\u6848\u4f8b\u3002"})}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"241-\u4ec0\u4e48\u662f\u4e2d\u65ad",children:"2.4.1 \u4ec0\u4e48\u662f\u4e2d\u65ad\uff1f"}),"\n",(0,i.jsx)(e.p,{children:"\u5f53\u4e00\u4e2a\u786c\u4ef6 ( \u5982\u78c1\u76d8\u63a7\u5236\u5668\u6216\u8005\u4ee5\u592a\u7f51\u5361 )\uff0c\u9700\u8981\u6253\u65ad CPU \u7684\u5de5\u4f5c\u65f6\uff0c\u5b83\u5c31\u89e6\u53d1\u4e00\u4e2a\u4e2d\u65ad\u3002\u8be5\u4e2d\u65ad\u901a\u77e5 CPU \u53d1\u751f\u4e86\u67d0\u4e9b\u4e8b\u60c5\u5e76\u4e14 CPU \u5e94\u8be5\u653e\u4e0b\u5f53\u524d\u7684\u5de5\u4f5c\u53bb\u5904\u7406\u8fd9\u4e2a\u4e8b\u60c5\u3002\u4e3a\u4e86\u9632\u6b62\u591a\u4e2a\u8bbe\u7f6e\u53d1\u9001\u76f8\u540c\u7684\u4e2d\u65ad\uff0cLinux \u8bbe\u8ba1\u4e86\u4e00\u5957\u4e2d\u65ad\u8bf7\u6c42\u7cfb\u7edf\uff0c\u4f7f\u5f97\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\u7684\u6bcf\u4e2a\u8bbe\u5907\u88ab\u5206\u914d\u4e86\u5404\u81ea\u7684\u4e2d\u65ad\u53f7\uff0c\u4ee5\u786e\u4fdd\u5b83\u7684\u4e2d\u65ad\u8bf7\u6c42\u7684\u552f\u4e00\u6027\u3002"}),"\n",(0,i.jsxs)(e.p,{children:["\u4ece 2.4 \u5185\u6838\u5f00\u59cb\uff0cLinux \u6539\u8fdb\u4e86\u5206\u914d\u7279\u5b9a\u4e2d\u65ad\u5230\u6307\u5b9a\u7684\u5904\u7406\u5668 ( \u6216\u5904\u7406\u5668\u7ec4 ) \u7684\u529f\u80fd\u3002 \u8fd9\u88ab\u79f0\u4e3a ",(0,i.jsx)(e.code,{children:"SMP IRQ affinity"}),"\uff0c\u5b83\u53ef\u4ee5\u63a7\u5236\u7cfb\u7edf\u5982\u4f55\u54cd\u5e94\u5404\u79cd\u786c\u4ef6\u4e8b\u4ef6\u3002\u5141\u8bb8\u4f60\u9650\u5236\u6216\u8005\u91cd\u65b0\u5206\u914d\u670d\u52a1\u5668\u7684\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u4ece\u800c\u8ba9\u670d\u52a1\u5668\u66f4\u6709\u6548\u7684\u5de5\u4f5c\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:(0,i.jsxs)("span",{style:{color:"red"},children:["\u4ee5\u7f51\u5361\u4e2d\u65ad\u4e3a\u4f8b\uff0c\u5728\u6ca1\u6709\u8bbe\u7f6e ",(0,i.jsx)(e.code,{children:"SMP IRQ affinity"})," \u65f6\uff0c\u6240\u6709\u7f51\u5361\u4e2d\u65ad\u90fd\u5173\u8054\u5230 CPU0\uff0c \u8fd9\u5bfc\u81f4\u4e86 CPU0 \u8d1f\u8f7d\u8fc7\u9ad8\uff0c\u800c\u65e0\u6cd5\u6709\u6548\u5feb\u901f\u7684\u5904\u7406\u7f51\u7edc\u6570\u636e\u5305\uff0c\u5bfc\u81f4\u4e86\u74f6\u9888\u3002"]})})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:(0,i.jsxs)("span",{style:{color:"blue"},children:["\u901a\u8fc7 ",(0,i.jsx)(e.code,{children:"SMP IRQ affinity"}),"\uff0c\u628a\u7f51\u5361\u591a\u4e2a\u4e2d\u65ad\u5206\u914d\u5230\u591a\u4e2a CPU \u4e0a\uff0c\u53ef\u4ee5\u5206\u6563 CPU \u538b\u529b\uff0c \u63d0\u9ad8\u6570\u636e\u5904\u7406\u901f\u5ea6\u3002 \u4f46\u662f ",(0,i.jsx)(e.code,{children:"smp_affinity"})," \u8981\u6c42\u7f51\u5361\u652f\u6301\u591a\u961f\u5217\uff0c \u5982\u679c\u7f51\u5361\u652f\u6301\u591a\u961f\u5217\u5219\u8bbe\u7f6e\u624d\u6709\u4f5c\u7528\uff0c\u7f51\u5361\u6709\u591a\u961f\u5217\uff0c\u624d\u4f1a\u6709\u591a\u4e2a\u4e2d\u65ad\u53f7\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u628a\u4e0d\u540c\u7684\u4e2d\u65ad\u53f7\u5206\u914d\u5230\u4e0d\u540c CPU \u4e0a\uff0c\u8fd9\u6837\u4e2d\u65ad\u53f7\u5c31\u80fd\u76f8\u5bf9\u5747\u5300\u7684\u5206\u914d\u5230\u4e0d\u540c\u7684 CPU \u4e0a\u3002"]})})}),"\n",(0,i.jsx)(e.p,{children:"\u800c\u5355\u961f\u5217\u7684\u7f51\u5361\u53ef\u4ee5\u901a\u8fc7 RPS/RFS \u6765\u6a21\u62df\u591a\u961f\u5217\u7684\u60c5\u51b5\uff0c\u4f46\u662f\u8be5\u6548\u679c\u5e76\u4e0d\u5982\u7f51\u5361\u672c\u8eab\u591a\u961f\u5217 + \u5f00\u542f RPSRFS \u6765\u7684\u6709\u6548\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"242-\u4ec0\u4e48\u662f-rpsrfs",children:"2.4.2 \u4ec0\u4e48\u662f RPS/RFS"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"RPS\uff08Receive Packet Steering\uff09\u4e3b\u8981\u662f\u628a\u8f6f\u4e2d\u65ad\u7684\u8d1f\u8f7d\u5747\u8861\u5230\u5404\u4e2a cpu"}),"\uff0c\u7b80\u5355\u6765\u8bf4\uff0c\u662f\u7f51\u5361\u9a71\u52a8\u5bf9\u6bcf\u4e2a\u6d41\u751f\u6210\u4e00\u4e2a hash \u6807\u8bc6\uff0c \u8fd9\u4e2a HASH \u503c\u5f97\u8ba1\u7b97\u53ef\u4ee5\u901a\u8fc7\u56db\u5143\u7ec4\u6765\u8ba1\u7b97\uff08SIP\uff0cSPORT\uff0cDIP\uff0cDPORT\uff09\uff0c\u7136\u540e\u7531\u4e2d\u65ad\u5904\u7406\u7684\u5730\u65b9\u6839\u636e\u8fd9\u4e2a hash \u6807\u8bc6\u5206\u914d\u5230\u76f8\u5e94\u7684 CPU \u4e0a\u53bb\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u6bd4\u8f83\u5145\u5206\u7684\u53d1\u6325\u591a\u6838\u7684\u80fd\u529b\u4e86\u3002\u901a\u4fd7\u70b9\u8bf4\u5c31\u662f\u5728\u8f6f\u4ef6\u5c42\u9762\u6a21\u62df\u5b9e\u73b0\u786c\u4ef6\u7684\u591a\u961f\u5217\u7f51\u5361\u529f\u80fd\uff0c",(0,i.jsx)(e.strong,{children:"\u5982\u679c\u7f51\u5361\u672c\u8eab\u652f\u6301\u591a\u961f\u5217\u529f\u80fd\u7684\u8bdd RPS \u5c31\u4e0d\u4f1a\u6709\u4efb\u4f55\u7684\u4f5c\u7528"}),"\u3002",(0,i.jsx)(e.strong,{children:"\u8be5\u529f\u80fd\u4e3b\u8981\u9488\u5bf9\u5355\u961f\u5217\u7f51\u5361\u591a CPU \u73af\u5883"}),"\uff0c\u5982\u7f51\u5361\u652f\u6301\u591a\u961f\u5217\u5219\u53ef\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"SMP irq affinity"})," \u76f4\u63a5\u7ed1\u5b9a\u786c\u4e2d\u65ad\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0510.21.08.png",alt:"iShot2020-08-0510.21.08"})}),"\n",(0,i.jsx)(e.p,{children:"\u7531\u4e8e RPS \u53ea\u662f\u5355\u7eaf\u628a\u6570\u636e\u5305\u5747\u8861\u5230\u4e0d\u540c\u7684 cpu\uff0c\u8fd9\u4e2a\u65f6\u5019\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u6240\u5728\u7684 cpu \u548c\u8f6f\u4e2d\u65ad\u5904\u7406\u7684 cpu \u4e0d\u662f\u540c\u4e00\u4e2a\uff0c \u6b64\u65f6\u5bf9\u4e8e cpu cache \u7684\u5f71\u54cd\u4f1a\u5f88\u5927\uff0c \u90a3\u4e48 RFS \uff08Receive flow steering\uff09\u786e\u4fdd\u5e94\u7528\u7a0b\u5e8f\u5904\u7406\u7684 cpu \u8ddf\u8f6f\u4e2d\u65ad\u5904\u7406\u7684 cpu \u662f\u540c\u4e00\u4e2a\uff0c\u8fd9\u6837\u5c31\u5145\u5206\u5229\u7528 cpu \u7684 cache\uff0c\u8fd9\u4e24\u4e2a\u8865\u4e01\u5f80\u5f80\u90fd\u662f\u4e00\u8d77\u8bbe\u7f6e\uff0c\u6765\u8fbe\u5230\u6700\u597d\u7684\u4f18\u5316\u6548\u679c\uff0c\u4e3b\u8981\u662f\u9488\u5bf9\u5355\u961f\u5217\u7f51\u5361\u591a CPU \u73af\u5883\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0510.21.46.png",alt:"iShot2020-08-0510.21.46"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"rps_flow_cnt"}),"\uff0c",(0,i.jsx)(e.code,{children:"rps_sock_flow_entries"}),"\uff0c \u53c2\u6570\u7684\u503c\u4f1a\u88ab\u8fdb\u4f4d\u5230\u6700\u8fd1\u76842\u7684\u5e42\u6b21\u65b9\u503c\uff0c\u5bf9\u4e8e\u5355\u961f\u5217\u8bbe\u5907\uff0c \u5355\u961f\u5217\u7684 ",(0,i.jsx)(e.code,{children:"rps_flow_cnt"})," \u503c\u88ab\u914d\u7f6e\u6210\u4e0e",(0,i.jsx)(e.code,{children:"rps_sock_flow_ entries"})," \u76f8\u540c\u3002"]}),"\n",(0,i.jsx)(e.p,{children:"RFS \u4f9d\u9760 RPS \u7684\u673a\u5236\u63d2\u5165\u6570\u636e\u5305\u5230\u6307\u5b9a CPU \u7684 backlog \u961f\u5217\uff0c\u5e76\u5524\u9192\u90a3\u4e2a CPU \u6765\u6267\u884c\u3002"}),"\n",(0,i.jsxs)(e.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f00\u542f ",(0,i.jsx)(e.code,{children:"irqbalance"})," \u662f\u8db3\u591f\u7528\u7684\uff0c\u4f46\u662f\u5bf9\u4e8e\u4e00\u4e9b\u5bf9\u7f51\u7edc\u6027\u80fd\u8981\u6c42\u6bd4\u8f83\u9ad8\u7684\u573a\u666f\uff0c\u624b\u52a8\u7ed1\u5b9a\u4e2d\u65ad\u78e8\u5408\u662f\u6bd4\u8f83\u597d\u7684\u9009\u62e9\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"\u5f00\u542f irqbalance\uff0c\u4f1a\u5b58\u5728\u4e00\u4e9b\u95ee\u9898\uff0c\u6bd4\u5982\uff1a\na) \u6709\u65f6\u5019\u8ba1\u7b97\u51fa\u6765\u7684\u503c\u4e0d\u5408\u7406\uff0c\u5bfc\u81f4 CPU \u4f7f\u7528\u8fd8\u662f\u4e0d\u5747\u8861\u3002\nb) \u5728\u7cfb\u7edf\u6bd4\u8f83\u7a7a\u95f2 IRQ \u5904\u4e8e Power-save mode \u65f6\uff0cirqbalance \u4f1a\u5c06\u4e2d\u65ad\u96c6\u4e2d\u5206\u914d\u7ed9\u7b2c\u4e00\u4e2a CPU\uff0c\n\n\u4ee5\u4fdd\u8bc1\u5176\u5b83\u7a7a\u95f2 CPU \u7684\u7761\u7720\u65f6\u95f4\uff0c\u964d\u4f4e\u80fd\u8017\u3002\u5982\u679c\u538b\u529b\u7a81\u7136\u4e0a\u5347\uff0c\u53ef\u80fd\u4f1a\u7531\u4e8e\u8c03\u6574\u7684\u6ede\u540e\u6027\u5e26\u6765\u6027\u80fd \u95ee\u9898\u3002\nc) \u5904\u7406\u4e2d\u65ad\u7684 CPU \u603b\u662f\u4f1a\u53d8\uff0c\u5bfc\u81f4\u4e86\u66f4\u591a\u7684 context switch\u3002\nd\uff09\u4e5f\u5b58\u5728\u4e00\u4e9b\u60c5\u51b5\uff0c\u542f\u52a8\u4e86 irqbalance\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u751f\u6548\uff0c\u6ca1\u6709\u771f\u6b63\u53bb\u8bbe\u7f6e\u5904\u7406\u4e2d\u65ad\u7684cpu\u3002\n"})}),"\n",(0,i.jsx)(e.h4,{id:"243-\u5982\u4f55\u67e5\u770b\u7f51\u5361\u7684\u961f\u5217\u6570",children:"2.4.3 \u5982\u4f55\u67e5\u770b\u7f51\u5361\u7684\u961f\u5217\u6570"}),"\n",(0,i.jsx)(e.p,{children:"Combined \u4ee3\u8868\u961f\u5217\u4e2a\u6570\uff0c\u8bf4\u660e\u6211\u7684\u6d4b\u8bd5\u673a\u6709 4 \u4e2a\u961f\u5217\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"# ethtool -l eth0\nChannel parameters for eth0:\nPre-set maximums:\nRX:\t\t0\nTX:\t\t0\nOther:\t0\nCombined:\t4\nCurrent hardware settings:\nRX:\t0\nTX:\t0\nOther:\t0\nCombined:\t4\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u4ee5 CentOS7.6 \u4e3a\u4f8b\uff0c\u7cfb\u7edf\u5904\u7406\u4e2d\u65ad\u7684\u8bb0\u5f55\u5728 ",(0,i.jsx)(e.code,{children:"/proc/interrupts"})," \u6587\u4ef6\u91cc\u9762\uff0c\u9ed8\u8ba4\u8fd9\u4e2a\u6587\u4ef6\u8bb0\u5f55\u6bd4\u8f83\u591a\uff0c\u5f71\u54cd\u67e5\u770b\uff0c\u540c\u65f6\u5982\u679c cpu \u6838\u5fc3\u4e5f\u975e\u5e38\u591a\u7684\u8bdd\uff0c \u5bf9\u4e8e\u9605\u8bfb\u7684\u5f71\u54cd\u975e\u5e38\u5927\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"# cat /proc/interrupts\n\t\t\t\t\t\tCPU0\t\tCPU1\t\tCPU2\t\tCPU3\n  0:\t\t\t\t 141\t\t\t0       0       0\t\tIO-APIC-edge\ttimer\t\t\n  1:          10      0       0       0   IO-APIC-edge  i8042 \n  4:         807      0       0       0   IO-APIC-edge  serial\n  6:           3      0       0       0   IO-APIC-edge  floppy\n  8:           0      0       0       0   IO-APIC-edge  rtc0\n  9:           0      0       0       0   IO-APIC-fasteoi acpi\n  10:          0      0       0       0   IO-APIC-fasteoi virtio3\n  11:         22      0       0       0   IO-APIC-fasteoi hcd:usb1\n  12:         15      0       0       0   IO-APIC-edge\ti8042\n  14:          0      0       0       0   IO-APIC-edge\tata_piix\n  15:          0      0       0       0   IO-APIC-edge\tata_piix\n  24:          0      0       0       0   PCI-MSI-edge\tvirtio1-config\n\t\u3002\u3002\u3002\n  27:       1913      0       0       0   PCI-MSI-edge\tvirtio2-input.0\n  28:          3    834       0       0   PCI-MSI-edge\tvirtio2-output.0\n\n    \ninput0 \u8bf4\u660e\u662f cpu0\uff08\u7b2c 1 \u4e2a CPU\uff09\u5904\u7406\u7684\u7f51\u7edc\u4e2d\u65ad\n\n\u963f\u91cc\u4e91 ecs \u7f51\u7edc\u4e2d\u65ad\uff0c\u5982\u679c\u662f\u591a\u4e2a\u4e2d\u65ad\u7684\u8bdd\uff0c\u8fd8\u6709 input.1 input.2 input.3 \u8fd9\u79cd\u5f62\u5f0f\t\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5982\u679c ecs \u7684 cpu \u6838\u5fc3\u975e\u5e38\u591a\uff0c\u90a3\u8fd9\u4e2a\u6587\u4ef6\u770b\u8d77\u6765\u5c31\u4f1a\u6bd4\u8f83\u8d39\u52b2\u4e86\uff0c\u53ef\u4f7f\u7528\u4e0b\u9762 \u7684\u547d\u4ee4\u67e5\u770b\u5904\u7406\u4e2d\u65ad\u7684\u6838\u5fc3\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:'\u4f7f\u7528\u4e0b\u9762\u8fd9\u4e2a\u547d\u4ee4\uff0c\u5373\u53ef\u5c06\u963f\u91cc\u4e91 ecs \u5904\u7406\u4e2d\u65ad\u7684 cpu \u627e\u51fa\u6765\u4e86\uff08\u4e0b\u9762\u8fd9\u4e2a\u6f14\u793a\u662f 8c4\u4e2a\u961f\u5217\uff09\n\n# for i in $(egrep "\\-input." /proc/interrupts |awk -F ":" \'{print $1}\');do cat /proc/irq/$i/smp_affinity_list;done\n5\n7\n1\n3\n\u5904\u7406\u4e00\u4e0b sar \u62f7\u8d1d\u7528\n# for i in $(egrep "\\-input." /proc/interrupts |awk -F ":" \'{print $1}\');do cat /proc/irq/$i/smp_affinity_list;done |tr -s \'\\n\' \',\'\n5,7,1,3,\n\n# sar -P 5,7,1,3 1 \u6bcf\u79d2\u5237\u65b0\u4e00\u6b21 cpu \u5e8f\u53f7\u4e3a 5,7,1,3 \u6838\u5fc3\u7684 cpu \u4f7f\u7528\u7387\n# sar -P ALL 1 \u6bcf\u79d2\u5237\u65b0\u6240\u6709\u6838\u5fc3\uff0c\u7528\u4e8e\u5c11\u91cf CPU \u6838\u5fc3\u7684\u76d1\u63a7\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u77e5\u9053\u5904\u7406\u6162\u7684\u539f\u56e0\u662f\u4e0d\u662f\u56e0\u4e3a\u961f\u5217\u4e0d\u591f\u5bfc\u81f4\u7684\u4e86\nLinux 3.10.0-957.5.1.el7.x86_64 (iZwz98aynkjcxvtra0f375Z) x86_64_ (4 CPU)\n05:10:06 PM\t\tCPU\t\t%user\t\t%nice\t\t%system\t\t%iowait\t\t%steal\t%idle\n05:10:07 PM\t\tall\t\t5.63\t\t0.00\t\t3.58\t\t\t1.02\t\t\t0.00\t\t89.77\n05:10:07 PM\t\t0\t\t\t6.12\t\t0.00\t\t3.06\t\t\t1.02\t\t\t0.00\t\t89.90\n05:10:07 PM\t\t1\t\t\t5.10\t\t0.00\t\t5.10\t\t\t0.00\t\t\t0.00\t\t89.80\n05:10:07 PM\t\t2\t\t\t5.10\t\t0.00\t\t3.06\t\t\t2.04\t\t\t0.00\t\t89.80\n05:10:07 PM\t\t3\t\t\t5.10\t\t0.00\t\t4.08\t\t\t1.02\t\t\t0.00\t\t89.80\n05:10:07 PM\t\tCPU\t\t%user\t\t%nice\t\t%system\t\t%iowait\t\t%steal\t%idle\n05:10:08 PM   all\t\t8.78\t\t0.00\t\t15.01\t\t\t0.69\t\t\t0.00\t\t75.52\t\t\n05:10:08 PM \t0\t\t\t10.00\t\t0.00\t\t16.36\t\t\t0.91\t\t\t0.00\t\t75.73\n05:10:08 PM\t\t1\t\t\t4.81\t\t0.00\t\t13.46\t\t\t1.92\t\t\t0.00\t\t79.81\n05:10:08 PM\t\t2\t\t\t10.91\t\t0.00\t\t15.45\t\t\t0.91\t\t\t0.00\t\t72.73\n05:10:08 PM\t\t3\t\t\t9.09\t\t0.00\t\t14.55\t\t\t0.00\t\t\t0.00\t\t76.36\n\nsar \u5c0f\u6280\u5de7\n\u6253\u5370 idle \u5c0f\u4e8e 10 \u7684\u6838\u5fc3\nsar -P 1,3,5,7 1 |tail -n+3|awk \'$NF<10 {print $0}\'\n\n\u770b\u6240\u6709\u6838\u5fc3\u662f\u5426\u6709\u5355\u6838\u6253\u6ee1\u7684\u628a 1357 \u6362\u6210 ALL \u5373\u53ef\nsar -P ALL 1 |tail -n+3|awk \'$NF<10 {print $0}\'\n\n\u518d\u8d34\u4e00\u4e2a 4c8g \u89c4\u683c\u7684\u914d\u7f6e\uff08ecs.c6.xlarge\uff09\uff0c\u53ef\u4ee5\u770b\u5230 4c \u4e5f\u7ed9\u4e86\u56db\u4e2a\u961f\u5217\uff0c\u4f46\u662f\u9ed8\u8ba4\u8bbe\u7f6e\u7684\u662f\u5728 cpu0 \u548c 2 \u4e0a\u5904\u7406\u4e2d\u65ad\n# grep -i "input" /proc/interrupts\n27: \t1932\t\t0\t\t0\t\t0\t\t\tPCI-MSI-edge\t\tvirtio2-input.0\n29:\t\t2\t\t\t\t0\t\t0\t\t1627\tPCI-MSI-edge\t\tvirtio2-input.1\n32:\t\t1974\t\t0\t\t0\t\t0\t\t\tPCI-MSI-edge\t\tvirtio2-input.2\n35:\t\t3\t\t\t\t0\t\t284\t0\t\t\tPCI-MSI-edge\t\tvirtio2-input.3\n\n# for i in $(egrep "\\-input." /proc/interrupts |awk -F ":" \'{print $1}\');do cat /proc/irq/$i/smp_affinity_list;done\n1\n3\n1\n3\n\n\u539f\u56e0\u662f cpu \u662f\u8d85\u7ebf\u7a0b\u7684\uff0c"\u6bcf\u4e2a vCPU \u7ed1\u5b9a\u5230\u4e00\u4e2a\u7269\u7406 CPU \u8d85\u7ebf\u7a0b", \u6240\u4ee5\u5373\u4f7f\u662f4\u4e2a\u961f\u5217\u9ed8\u8ba4\u4e5f\u57282\u4e2a cpu \u6838\u5fc3\u4e0a\n\n# lscpu\nArchitecture:\t\t\tx86_64\nCPU op-mode(s):\t\t\t32-bit\uff0c64-bit\nByte Order:\t\t\tLittle Endian\nCPU(s):\t\t\t4\nOn-line CPU(s) list:\t\t\t0-3\nThread(s) per core:\t\t\t2\nCore(s) per socket:\t\t\t2\nSocket(s):\t\t\t1\nNUMA node(s):\t\t\t1\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5173\u95ed IRQbalance\u3002"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"# service irqbalance status\nRedirecting to /bin/systemctl status irqbalance.service\n\u25cf irqbalance.service - irqbalance daemon\n\tLoaded: loaded (/usr/lib/systemd/system/irqbalance.service; enabled; vendor preset: enabled)\n\tActive: inactive (dead) since Wed 2020-05-27 14:39:28 CST; 2s ago\n\tProcess: 1832 ExecStart=/usr/sbin/irqbalance --foreground $IRQBALANCE_ ARGS (code=exited\uff0cstatus=0/SUCCESS)\n\tMain PID: 1832 (code=exited\uff0cstatus=0/SUCCESS)\n\tMay 27 14:11:40 iZbp1ee4vpiy3w4b8y2m8qZ systemd[1]: Started irqbalance daemon.\n\tMay 27 14:39:28 iZbp1ee4vpiy3w4b8y2m8qZ systemd[1]: Stopping irqbalance daemon...\n\tMay 27 14:39:28 iZbp1ee4vpiy3w4b8y2m8qZ systemd[1]: Stopped irqbalance daemon.\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u624b\u52a8\u8bbe\u7f6e RPS\u3002"})}),"\n",(0,i.jsx)(e.p,{children:"\u624b\u52a8\u8bbe\u7f6e\u4e4b\u524d\u6211\u4eec\u9700\u8981\u5148\u4e86\u89e3\u4e0b\u9762\u7684\u6587\u4ef6\uff08IRQ_number \u5c31\u662f\u524d\u9762 grep input \u62ff\u5230\u7684\u5e8f\u53f7\uff09\u3002"}),"\n",(0,i.jsxs)(e.p,{children:["\u8fdb\u5165 ",(0,i.jsx)(e.code,{children:"/proc/irq/${IRQ_number}/"}),"\uff0c \u5173\u6ce8\u4e24\u4e2a\u6587\u4ef6\uff1a",(0,i.jsx)(e.code,{children:"smp_affinity"})," \u548c ",(0,i.jsx)(e.code,{children:"smp_ affinity_list"}),"\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"smp_affinity"})," \u662f bitmask+16 \u8fdb\u5236\uff0c"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"smp_affinity_list"}),"\uff1a\u8fd9\u4e2a\u6587\u4ef6\u66f4\u597d\u7406\u89e3\uff0c\u91c7\u7528\u7684\u662f 10 \u8fdb\u5236\uff0c\u53ef\u8bfb\u6027\u9ad8\u3002"]}),"\n",(0,i.jsx)(e.p,{children:"\u6539\u8fd9\u4e24\u4e2a\u4efb\u610f\u4e00\u4e2a\u6587\u4ef6\uff0c\u53e6\u4e00\u4e2a\u6587\u4ef6\u4f1a\u540c\u6b65\u66f4\u6539\u3002"}),"\n",(0,i.jsxs)(e.p,{children:["\u4e3a\u4e86\u65b9\u4fbf\u7406\u89e3\uff0c\u54b1\u4eec\u76f4\u63a5\u770b\u5341\u8fdb\u5236\u7684\u6587\u4ef6 ",(0,i.jsx)(e.code,{children:"smp_affinity_list"})," \u5373\u53ef\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:'\u5982\u679c\u8fd9\u4e00\u6b65\u6ca1\u770b\u660e\u767d\uff0c\u6ce8\u610f\u524d\u9762\u7684 /proc/interrupts \u7684\u8f93\u51fa\n# for i in $(egrep "\\-input." /proc/interrupts |awk -F ":" \'{print $1}\'); do cat /proc/irq/$i/smp_affinity_list;done\n1\n3\n1\n3\n\n\u624b\u52a8\u8bbe\u7f6e\u5904\u7406\u4e2d\u65ad\u7684 CPU \u53f7\u7801\u53ef\u4ee5\u76f4\u63a5 echo \u4fee\u6539\uff0c\u4e0b\u9762\u5c31\u662f\u5c06\u5e8f\u53f7 27 \u7684\u4e2d\u65ad\u653e\u5230 cpu0 \u4e0a\u5904\u7406\uff0c\u4e00\u822c\u5efa\u8bae\u53ef\u4ee5\u628a cpu0 \u7a7a\u51fa\u6765\n# echo 0 >> /proc/irq/27/smp_affinity_list\n# cat /proc/irq/27/smp_affinity_list\n0\n\n\u5173\u4e8e bitmas\n"f" \u662f\u5341\u516d\u8fdb\u5236\u7684\u503c\u5bf9\u5e94\u7684 \u4e8c\u8fdb\u5236\u662f "1111"\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a 4c \u7684\u914d\u7f6e\u8bbe\u7f6e\u4e3a f \u7684\u8bdd\uff0c\u6240\u6709\u7684 cpu \u53c2\u4e0e\u5904\u7406\u4e2d\u65ad\uff09\n\u4e8c\u8fdb\u5236\u4e2d\u7684\u6bcf\u4e2a\u4f4d\u4ee3\u8868\u4e86\u670d\u52a1\u5668\u4e0a\u7684\u6bcf\u4e2a CPU. \u4e00\u4e2a\u7b80\u5355\u7684 demo\nCPU\u5e8f\u53f7\t\t\u4e8c\u8fdb\u5236\t\t\u5341\u516d\u8fdb\u5236\nCPU 0\t\t\t0001\t\t1\nCPU 1\t\t\t0010\t\t2\nCPU 2\t\t\t0100\t\t4\nCPU 3\t\t\t1000\t\t8\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u9700\u8981\u5bf9\u6bcf\u5757\u7f51\u5361\u6bcf\u4e2a\u961f\u5217\u5206\u522b\u8fdb\u884c\u8bbe\u7f6e\u3002\u5982\u5bf9 eth0 \u7684 0 \u53f7\u961f\u5217\u8bbe\u7f6e\uff1a"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"echo ff > /sys/class/net/eth0/queues/rx-0/rps_cpus\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u91cc\u7684\u8bbe\u7f6e\u65b9\u5f0f\u548c\u4e2d\u65ad\u4eb2\u548c\u529b\u8bbe\u7f6e\u7684\u65b9\u6cd5\u662f\u7c7b\u4f3c\u7684\u3002\u91c7\u7528\u7684\u662f\u63a9\u7801\u7684\u65b9\u5f0f\uff0c\u4f46\u662f\u8fd9\u91cc\u901a\u5e38\u8981\u5c06\u6240\u6709\u7684 CPU \u8bbe\u7f6e\u8fdb\u5165\uff0c\u5982\uff1a"}),"\n",(0,i.jsx)(e.p,{children:"4core\uff0cf"}),"\n",(0,i.jsx)(e.p,{children:"8core\uff0cff"}),"\n",(0,i.jsx)(e.p,{children:"16core\uff0cffff"}),"\n",(0,i.jsx)(e.p,{children:"32core\uff0cffffffff"}),"\n",(0,i.jsx)(e.p,{children:"\u9ed8\u8ba4\u5728 0 \u53f7 cpu \u4e0a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"# cat /sys/class/net/eth0/queues/rx-0/rps_cpus\n0\n\n# echo f >>/sys/class/net/eth0/queues/rx-0/rps_cpus\n\n# cat /sys/class/net/eth0/queues/rx-0/rps_cpus\nf\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u8bbe\u7f6e RFS \u7684\u65b9\u5f0f\u3002"})}),"\n",(0,i.jsx)(e.p,{children:"\u9700\u8981\u8bbe\u7f6e\u4e24\u4e2a\u5730\u65b9\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["\u5168\u5c40\u8868",(0,i.jsx)(e.code,{children:"rps_sock_flow_table"})," \u7684\u6761\u76ee\u6570\u91cf\u3002\u901a\u8fc7\u4e00\u4e2a\u5185\u6838\u53c2\u6570\u63a7\u5236\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"# sysctl -a |grep net.core.rps_sock_flow_entries\nnet.core.rps_sock_flow_entries = 0\n\n# sysctl -w net.core.rps_sock_flow_entries=1024\nnet.core.rps_sock_flow_entries = 1024\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u6bcf\u4e2a\u7f51\u5361\u961f\u5217 hash \u8868\u7684\u6761\u76ee\u6570\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"# cat /sys/class/net/eth0/queues/rx-0/rps_flow_cnt\n0\n\n# echo 256 >> /sys/class/net/eth0/queues/rx-0/rps_flow_cnt\n\n# cat /sys/class/net/eth0/queues/rx-0/rps_flow_cnt\n256\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["\u9700\u8981\u542f\u52a8 RFS\uff0c\u4e24\u8005\u90fd\u9700\u8981\u8bbe\u7f6e\u3002 \u5efa\u8bae\u673a\u5668\u4e0a\u6240\u6709\u7684\u7f51\u5361\u961f\u5217\u8bbe\u7f6e\u7684 ",(0,i.jsx)(e.code,{children:"rps_flow_cnt"})," \u76f8\u52a0\u5e94\u8be5\u5c0f\u4e8e\u6216\u8005\u7b49\u4e8e ",(0,i.jsx)(e.code,{children:"rps_sock_flow_entries"}),"\u3002 \u56e0\u4e3a\u662f4\u4e2a\u961f\u5217\uff0c \u56e0\u6b64\u6bcf\u4e2a\u961f\u5217\u8bbe\u7f6e 256\uff0c \u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u589e\u5927\u3002"]}),"\n",(0,i.jsx)(e.h3,{id:"25-\u4e00\u6b21-io-\u5f02\u5e38\u6355\u83b7\u8fc7\u7a0b",children:"2.5 \u4e00\u6b21 IO \u5f02\u5e38\u6355\u83b7\u8fc7\u7a0b"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7b80\u4ecb"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u9047\u5230\u4e00\u4e2a IO \u5f02\u5e38\u98d9\u5347\u7684\u95ee\u9898\uff0cIO \u8d77\u98de\u540e\u7cfb\u7edf\u54cd\u5e94\u5f02\u5e38\u7f13\u6162\uff0c\u770b\u4e0d\u5230\u73b0\u573a\u4e00\u76f4\u65e0\u6cd5\u5b9a\u4f4d\u95ee\u9898\uff0c \u68c0\u67e5\u5bf9\u5e94\u65f6\u95f4\u70b9\u5e94\u7528\u65e5\u5fd7\u4e5f\u6ca1\u6709\u53d1\u73b0\u5f02\u5e38\u7684\u8bbf\u95ee\uff0c \u8fd9\u79cd\u95ee\u9898\u600e\u4e48\u529e\u5462\uff1f"})}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"251-\u91c7\u96c6\u7cfb\u7edf-io\u786e\u8ba4-io-\u5f02\u5e38\u53d1\u751f\u5728\u7cfb\u7edf\u76d8\u8fd8\u662f\u6570\u636e\u76d8\u4f7f\u7528\u7cfb\u7edf\u81ea\u5e26\u7684-iostat-\u5373\u53ef\u91c7\u96c6",children:"2.5.1 \u91c7\u96c6\u7cfb\u7edf IO\uff0c\u786e\u8ba4 IO \u5f02\u5e38\u53d1\u751f\u5728\u7cfb\u7edf\u76d8\uff0c\u8fd8\u662f\u6570\u636e\u76d8\uff0c\u4f7f\u7528\u7cfb\u7edf\u81ea\u5e26\u7684 iostat \u5373\u53ef\u91c7\u96c6"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"# iostat -d 3 -k -x -t 30\nLinux 3.10.0-957.21.3.el7.x86_64 (tencent) \t08/05/2020 \t_x86_64_\t(1 CPU)\n\n06/12/2018 11:51:49 AM\nDevice:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util\nvda               0.12    12.66    4.59    8.55   127.03   143.35    41.16     0.07    7.91   15.92    3.61   0.65   0.85\nscd0              0.00     0.00    0.00    0.00     0.00     0.00     7.10     0.00    1.03    1.03    0.00   1.02   0.00\n\n06/12/2018 11:51:52 AM\nDevice:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util\nvda               0.00    27.61   10.44   69.70   247.81   397.31    16.10     0.99   15.57    1.71   17.65   0.16   1.28\nscd0              0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u6bcf\u9694 3 \u79d2\u91c7\u96c6\u4e00\u6b21\u78c1\u76d8 io\uff0c\u8f93\u51fa\u65f6\u95f4\uff0c\u4e00\u5171\u91c7\u96c6 30 \u6b21\uff0c\u60f3\u4e00\u76f4\u6293\u7684\u8bdd\u628a 30 \u53bb\u6389\u5373\u53ef\uff0c\u6ce8\u610f\u78c1\u76d8\u7a7a\u4f59\u91cf\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"\u901a\u8fc7\u8fd9\u4e2a\u547d\u4ee4\u6211\u4eec\u53ef\u4ee5\u786e\u8ba4\u5982\u4e0b\u4fe1\u606f\uff1a\n\n- \u95ee\u9898\u53d1\u751f\u7684\u65f6\u95f4\n- \u54ea\u5757\u76d8\u53d1\u751f\u7684 io\n- \u78c1\u76d8\u7684 IOPS\uff08 r/s\tw/s\uff09\u4ee5\u53ca\u541e\u5410\u91cf\uff08 rkB/s\twkB/s \uff09\n"})}),"\n",(0,i.jsx)(e.h4,{id:"252-\u786e\u8ba4\u54ea\u5757\u76d8\u53d1\u751f\u4e86-io-\u8fd8\u4e0d\u591f\u518d\u6293\u4e00\u4e0b\u53d1\u751f-io-\u7684\u8fdb\u7a0b\u9700\u8981\u5b89\u88c5-iotop-\u8fdb\u884c\u6355\u83b7",children:"2.5.2 \u786e\u8ba4\u54ea\u5757\u76d8\u53d1\u751f\u4e86 IO \u8fd8\u4e0d\u591f\uff0c\u518d\u6293\u4e00\u4e0b\u53d1\u751f IO \u7684\u8fdb\u7a0b\uff0c\u9700\u8981\u5b89\u88c5 iotop \u8fdb\u884c\u6355\u83b7"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"# iotop -b -o -d 3 -t -qqq -n 30\n10:18:41 7024 be/4 root 0.00 B/s 2.64 M/s 0.00 % 93.18 % fio\n-direct=1 -iodepth=128 -rw=randwrite -ioengine=libaio -bs=1k -size=1G\n-numjobs=1 -runtime=1000 -group_reporting -filename=iotest -name=Rand_ Write_Testing\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"\u6bcf\u9694 3 \u79d2\u91c7\u96c6\u4e00\u6b21\uff0c\u4e00\u5171\u91c7\u96c6 30 \u6b21\uff0c\u9759\u9ed8\u6a21\u5f0f\uff0c\u53ea\u663e\u793a\u6709 io \u53d1\u751f\u7684\u8fdb\u7a0b\n\n\u901a\u8fc7\u8fd9\u4e2a\u547d\u4ee4\u6211\u4eec\u53ef\u4ee5\u786e\u8ba4\u5982\u4e0b\u4fe1\u606f\uff1a\n- \u95ee\u9898\u53d1\u751f\u7684\u65f6\u95f4\n- \u4ea7\u751f IO \u7684\u8fdb\u7a0b id \u4ee5\u53ca\u8fdb\u7a0b\u53c2\u6570\uff08command\uff09\n- \u8fdb\u7a0b\u4ea7\u751f\u7684\u541e\u5410\u91cf\uff08\u5982\u679c\u6709\u591a\u4e2a\u53ef\u4ee5\u628a qqq \u53bb\u6389\u53ef\u663e\u793a\u603b\u91cf\uff09\n- \u8fdb\u7a0b\u5360\u7528\u5f53\u524d IO \u7684\u767e\u5206\u6bd4\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u4fd7\u8bdd\u8bf4\u5f97\u597d\uff0c\u5149\u8bf4\u4e0d\u7ec3\u5047\u628a\u5f0f\uff0c\u6211\u4eec\u5b9e\u64cd\u6765\u770b\u4e00\u4e0b ( \u6d89\u53ca\u7528\u6237\u8fdb\u7a0b\u4fe1\u606f , \u6ca1\u6709\u5f97\u5230\u5ba2\u6237\u6388\u6743\u56e0\u6b64\u4ee5 fio \u4e3a\u6f14\u793a )\u3002"}),"\n",(0,i.jsxs)(e.h4,{id:"253-\u4f7f\u7528-fio-\u8fdb\u884c-io-\u538b\u6d4b\u5177\u4f53\u53c2\u6570\u53ef\u4ee5\u53c2\u8003\u5757\u5b58\u50a8\u6027\u80fd",children:["2.5.3 \u4f7f\u7528 fio \u8fdb\u884c IO \u538b\u6d4b\uff0c\u5177\u4f53\u53c2\u6570\u53ef\u4ee5\u53c2\u8003",(0,i.jsx)(e.a,{href:"https://help.aliyun.com/document_detail/25382.html?spm=a2c4e.11153940.0.0.23263337ldOT1e",children:"\u5757\u5b58\u50a8\u6027\u80fd"})]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u538b\u6d4b\u7a97\u53e3\uff1a"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"fio -direct=1 -iodepth=128 -rw=randwrite -ioengine=libaio -bs=1k -size=1G -numjobs=1 -runtime=1000 -group_reporting -filename=iotest -name=Rand_ Write_Testing\nRand_Write_Testing: (g=0): rw=randwrite\uff0cbs=1K-1K/1K-1K/1K-1K\uff0c ioengine=libaio\uff0ciodepth=128\nfio-2.0.13\nStarting 1 process\n^Cbs: 1 (f=1): [w] [8.5% done] [0K/2722K/0K /s] [0 /2722 /0 iops] [eta 05m:53s]\nfio: terminating on signal 2\n\nRand_Write_Testing: (groupid=0\uff0cjobs=1): err= 0: pid=11974: Tue Jun 12 10:36:30 2018\n\twrite: io=88797KB\uff0cbw=2722.8KB/s\uff0ciops=2722 \uff0crunt= 32613msec\n\t......\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"iotop \u7a97\u53e3\uff1a"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"# iotop -n 10 -b -o -d 3 -t -qqq\n10:36:03 11974 be/4 root 0.00 B/s 2.63 M/s 0.00 % 93.95 % fio\n-direct=1 -iodepth=128 -rw=randwrite -ioengine=libaio -bs=1k -size=1G\n-numjobs=1 -runtime=1000 -group_reporting -filename=iotest -name=Rand_ Write_Testing\n10:36:06 11974 be/4 root 0.00 B/s 2.64 M/s 0.00 % 92.68 % fio\n-direct=1 -iodepth=128 -rw=randwrite -ioengine=libaio -bs=1k -size=1G\n-numjobs=1 -runtime=1000 -group_reporting -filename=iotest -name=Rand_ Write_Testing\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"iostat \u7a97\u53e3\uff1a"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"# iostat -d 3 -k -x -t 10\nLinux 3.10.0-957.21.3.el7.x86_64 (tencent) \t08/05/2020 \t_x86_64_\t(1 CPU)\n\n06/12/2018 12:26:41 PM\nDevice:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util\nvda               0.12    12.66    4.59    8.56   127.09   143.47    41.16     0.07    7.91   15.91    3.61   0.65   0.85\nscd0              0.00     0.00    0.00    0.00     0.00     0.00     7.10     0.00    1.03    1.03    0.00   1.02   0.00\n\n06/12/2018 12:26:44 PM\nDevice:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util\nvda               0.00    81.14   32.66   84.18  1202.69  2488.89    63.19     0.31    2.75    3.00    2.66   0.34   3.97\nscd0              0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u901a\u8fc7\u8f93\u51fa\u7ed3\u679c\u7684\u65f6\u95f4\u70b9\u8fdb\u884c\u5bf9\u6bd4\u5206\u6790\uff0c \u76f8\u5bf9\u4e8e fio \u7684 IOPS\uff0c \u541e\u5410\u91cf\u8ddf iotop \u4ee5\u53ca iostat \u76d1\u63a7\u5230\u7684\u6570\u636e\u662f\u4e00\u81f4\u3002\u56e0\u6b64\uff0c\u770b\u5230\u8fd9\uff0c\u60a8\u5df2\u7ecf\u5b66\u4f1a\u600e\u4e48\u67e5\u6d88\u8017 IO \u7684\u8fdb\u7a0b\u4e86\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u26a0\ufe0f\u4e3a\u4e86\u538b\u6d4b\u7684\u6162\u4e00\u4e9b\u7279\u610f\u628a bs \u8bbe\u7f6e\u4e3a 1k\uff0c\u8fd9\u6837\u6267\u884c\u7684\u65f6\u95f4\u4f1a\u6bd4\u8f83\u4e45\uff0cfio \u538b \u6d4b\u8be6\u89c1\u524d\u9762\u7684\u5757\u5b58\u50a8\u6027\u80fd\u3002"})}),"\n",(0,i.jsx)(e.p,{children:"\u5fc3\u7ec6\u7684\u540c\u5b66\u53ef\u80fd\u53d1\u73b0 iotop \u8f93\u51fa\u4e0d\u5e26\u5e74\u6708\u65e5\uff0c\u5982\u679c\u6293\u65e5\u5fd7\u7684\u65f6\u95f4\u8d85\u8fc7 24 \u5c0f\u65f6\uff0c\u65f6\u95f4\u91cd\u590d\u600e\u4e48\u529e\uff1f"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:'# iotop -b -o -d 1 -qqq |awk \'{ print $0"\\t" strftime("%Y-%m-%d-%H:%M:%S", systime()) } \'\n 1252 be/3 root        0.00 B/s   22.83 K/s  0.00 %  1.12 % [jbd2/vda1-8]       2018-06-12:28:19\n16374 be/4 root       76.12 K/s    0.00 B/s  0.00 %  0.33 % YDService   2018-06-12:28:19\n21495 be/4 mysql       0.00 B/s  121.79 K/s  0.00 %  0.15 % mysqld --defaults-file=/etc/my.cnf  2018-06-12:28:19\n21493 be/4 mysql       0.00 B/s    0.00 B/s  0.00 %  0.11 % mysqld --defaults-file=/etc/my.cnf  2018-06-12:28:19\n21500 be/4 mysql       0.00 B/s    3.81 K/s  0.00 %  0.11 % mysqld --defaults-file=/etc/my.cnf  2018-06-12:28:19\n13377 be/4 mysql       0.00 B/s    3.81 K/s  0.00 %  0.09 % mysqld --defaults-file=/etc/my.cnf  2018-06-12:28:19\n18071 be/4 mysql       0.00 B/s    3.81 K/s  0.00 %  0.09 % mysqld --defaults-file=/etc/my.cnf  2018-06-12:28:19\n32718 be/4 root        0.00 B/s    0.00 B/s  0.00 %  0.01 % [kworker/0:2]       2018-06-12:28:19\n10641 be/4 root        0.00 B/s   11.42 K/s  0.00 %  0.00 % java -server -Xms1024m -Xmx1024m -jar ./kooteam.jar 2018-06-12:28:19\n30019 be/4 polkitd     0.00 B/s   19.03 K/s  0.00 %  0.00 % postgres: stats collector process   2018-06-12:28:19\n 1252 be/3 root        0.00 B/s    0.00 B/s  0.00 %  0.71 % [jbd2/vda1-8]       2018-06-12:28:20\n16374 be/4 root       90.77 K/s    0.00 B/s  0.00 %  0.47 % YDService   2018-06-12:28:20\n21494 be/4 mysql       0.00 B/s    0.00 B/s  0.00 %  0.33 % mysqld --defaults-file=/etc/my.cnf  2018-06-12:28:20\n21495 be/4 mysql       0.00 B/s   90.77 K/s  0.00 %  0.14 % mysqld --defaults-file=/etc/my.cnf  2018-06-12:28:20\n 3922 be/4 mysql       0.00 B/s    3.78 K/s  0.00 %  0.11 % mysqld --defaults-file=/etc/my.cnf  2018-06-12:28:20\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u8be6\u7ec6\u53c2\u6570\u5c31\u4e0d\u8bb2\u4e86\uff0c\u5927\u5bb6\u53ef\u4ee5\u770b\u4e0b\u8f93\u51fa\u7ed3\u679c\u884c\u6700\u540e\u4e00\u5217\u662f\u5e74\u6708\u65e5\u65f6\u5206\u79d2\uff0c\u90a3\u4e48 IO \u6d88\u8017\u7684\u59cb\u4f5c\u4fd1\u8005\u4f1a\u67e5\u4e86\u5417\uff1f"}),"\n",(0,i.jsx)(e.h2,{id:"3linux-\u4e3b\u673a\u7f51\u7edc\u95ee\u9898",children:"3.Linux \u4e3b\u673a\u7f51\u7edc\u95ee\u9898"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u8bf4\u660e"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:'\u4ece\u552e\u540e\u5904\u7406\u89d2\u5ea6\uff0c\u963f\u91cc\u4e91\u7528\u6237\u4e1a\u52a1\u7cfb\u7edf\u642d\u5efa\u5728 ECS \u4e91\u670d\u52a1\u5668\u53cd\u9988\u6700\u591a\u7684\u5f71\u54cd\u4e1a\u52a1\u53ef\u7528\u6027\u95ee\u9898\uff1a\u4e00\u4e2a\u662f\u524d\u9762\u5df2\u7ecf\u8ba8\u8bba\u8fc7\u7684\u7cfb\u7edf\u542f\u505c\u95ee\u9898\uff0c\u53e6\u4e00\u4e2a\u5c31\u662f\u7f51\u7edc\u8fde\u901a\u6027\u95ee\u9898\u3002\u7f51\u7edc\u4f5c\u4e3a\u4e1a\u52a1\u7cfb\u7edf\u6570\u636e\u4ea4\u4e92\u548c\u8f6c\u53d1\u7684 "\u901a\u9053"\uff0c\u5f71\u54cd\u7740 IT \u7cfb\u7edf\u7684\u5404\u4e2a\u65b9\u9762\u3002\u7f51\u7edc\u95ee\u9898\u6db5\u76d6\u7684\u56e0\u7d20\u7b80\u5316\u6765\u8bb2\u4e00\u822c\u6d89\u53ca\u5230\u6536\u53d1\u8282\u70b9\uff0c\u8f6c\u53d1\u8282\u70b9\uff0c\u6d41\u91cf\u94fe\u8def\u7b49\u65b9\u9762\uff0c\u7531\u4e8e\u672c\u6587\u4e3b\u8981\u5206\u4eab\u7cfb\u7edf\u8bca\u65ad\u76f8\u5173\u7684\u5904\u7406\u7ecf\u9a8c\uff0c\u56e0\u6b64\u6211\u4eec\u4e5f\u66f4\u5173\u6ce8\u4e0e ECS \u4e3b\u673a\u5c42\u9762\u76f8\u5173\u7684\u7f51\u7edc\u5f71\u54cd\uff0c\u5e0c\u671b\u80fd\u5e26\u7ed9\u4e00\u4e9b\u5904\u7406\u4e3b\u673a\u5c42\u9762\u7f51\u7edc\u95ee\u9898\u7684\u70b9\u62e8\u3002'})}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"31-ifdown-ifup-\u547d\u4ee4\u4e22\u5931\u5904\u7406",children:"3.1 ifdown ifup \u547d\u4ee4\u4e22\u5931\u5904\u7406"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u95ee\u9898\u73b0\u8c61"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4e3b\u673a\u7f51\u7edc\u4e0d\u901a\uff0c\u767b\u5f55\u4e3b\u673a\u770b\u7f51\u5361\u6ca1\u6709\u6b63\u786e\u914d\u7f6e\u3002"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0512.31.17.png",alt:"iShot2020-08-0512.31.17"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6cd5"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5c1d\u8bd5\u91cd\u542f\u7f51\u5361\uff0c\u53d1\u73b0 ifdown ifup \u547d\u4ee4\u4e0d\u5b58\u5728\uff1a"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0512.32.06.png",alt:"iShot2020-08-0512.32.06"})}),"\n",(0,i.jsxs)(e.p,{children:["\u901a\u8fc7 ",(0,i.jsx)(e.code,{children:"ifconfig"})," \u914d\u7f6e IP \u4fe1\u606f"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"ifconfig <\u7f51\u5361>\t<IP>\tnetmask <\u63a9\u7801>\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u7136\u540e\u6dfb\u52a0\u8def\u7531"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"route add -net 0.0.0.0/0\tgw\t<\u516c\u7f51\u7f51\u5173>\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5982\u679c\u662f\u7ecf\u5178\u7f51\u7edc\u9700\u8981\u914d\u7f6e\u4e0a\u5185\u5916\u7f51\u5361 ip \u548c\u8def\u7531\uff0c\u8def\u7531\u547d\u4ee4"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"route add -net 10.0.0.0/8 gw\t<\u5185\u7f51\u7f51\u5173>\nroute add -net 100.64.0.0/10 gw\t<\u5185\u7f51\u7f51\u5173>\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u7f51\u7edc\u901a\u4e86\u540e\u8fd0\u884c\u547d\u4ee4"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"yum -y install initscripts\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5b89\u88c5\u4e0a ifup ifdown \u76f8\u5173\u7684\u5305"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0512.34.15.png",alt:"iShot2020-08-0512.34.15"})}),"\n",(0,i.jsx)(e.h3,{id:"32-\u7f51\u7edc\u4e0d\u901a-strace-\u4e8c\u5ea6\u51fa\u624b",children:"3.2 \u7f51\u7edc\u4e0d\u901a\uff1f strace \u4e8c\u5ea6\u51fa\u624b"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u95ee\u9898\u73b0\u8c61"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4e3b\u673a\u7f51\u7edc\u4e0d\u901a\uff0c\u8def\u7531\u4e0d\u6b63\u786e\uff0c0.0.0.0 \u6307\u5411\u4e86 eth0\u3002"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0512.35.25-6602152.png",alt:"iShot2020-08-0512.35.25-6602152"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u95ee\u9898\u5206\u6790"})}),"\n",(0,i.jsx)(e.p,{children:"\u5c1d\u8bd5\u91cd\u542f network \u670d\u52a1\uff0c\u53d1\u73b0\u4e0d\u884c\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0512.36.33.png",alt:"iShot2020-08-0512.36.33"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0512.37.12.png",alt:"iShot2020-08-0512.37.12"})}),"\n",(0,i.jsxs)(e.p,{children:["\u5c1d\u8bd5\u505c\u6b62\u7f51\u7edc\u670d\u52a1\uff0c\u7136\u540e\u901a\u8fc7 ",(0,i.jsx)(e.code,{children:"ifup eth1"})," \u53d1\u73b0\u8def\u7531\u662f\u6b63\u5e38\u7684\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0512.39.08.png",alt:"iShot2020-08-0512.39.08"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0512.39.39.png",alt:"iShot2020-08-0512.39.39"})}),"\n",(0,i.jsxs)(e.p,{children:["\u7136\u540e ",(0,i.jsx)(e.code,{children:"ifup eth0"})," \u53d1\u73b0\u8def\u7531\u5c31\u5f02\u5e38\u4e86\uff0c\u57fa\u672c\u5b9a\u4f4d\u5728\u542f\u52a8 eth0 \u7f51\u5361\u7684\u65f6\u5019\u51fa\u73b0\u4e86\u5f02\u5e38\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0512.40.15.png",alt:"iShot2020-08-0512.40.15"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0512.40.43.png",alt:"iShot2020-08-0512.40.43"})}),"\n",(0,i.jsxs)(e.p,{children:["\u7528 ",(0,i.jsx)(e.code,{children:"strace -f -e open ifup eth0|more"})," \u8ffd\u8e2a\u4e00\u4e0b\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0512.41.30.png",alt:"iShot2020-08-0512.41.30"})}),"\n",(0,i.jsxs)(e.p,{children:["\u8fd0\u6c14\u52a0\u773c\u795e\u6bd4\u8f83\u597d\uff0c\u53d1\u73b0\u8c03\u7528\u4e86 ",(0,i.jsx)(e.code,{children:"/etc/sysconfig/network"})," \u6587\u4ef6\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0512.42.03.png",alt:"iShot2020-08-0512.42.03"})}),"\n",(0,i.jsxs)(e.p,{children:["\u6253\u5f00 ",(0,i.jsx)(e.code,{children:"/etc/sysconfig/network"})," \u6587\u4ef6\uff0c\u53d1\u73b0\u591a\u4e86\u4e00\u884c ",(0,i.jsx)(e.code,{children:"GATEWAYDEV=eth0"}),"\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848"})}),"\n",(0,i.jsxs)(e.p,{children:["\u6ce8\u91ca ",(0,i.jsx)(e.code,{children:"/etc/sysconfig/network"})," \u6587\u4ef6\u7684 ",(0,i.jsx)(e.code,{children:"GATEWAYDEV=eth0"}),"\uff0c\u91cd\u542f\u7f51\u7edc\u670d\u52a1\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0512.43.23.png",alt:"iShot2020-08-0512.43.23"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0512.43.48.png",alt:"iShot2020-08-0512.43.48"})}),"\n",(0,i.jsx)(e.h3,{id:"33-time_wait--close_wait-\u7684\u8ba8\u8bba\u603b\u7ed3",children:"3.3 TIME_WAIT & CLOSE_WAIT \u7684\u8ba8\u8bba\u603b\u7ed3"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0512.44.23.png",alt:"iShot2020-08-0512.44.23"})}),"\n",(0,i.jsx)(e.p,{children:"TIME_WAIT \u662f TCP \u8fde\u63a5\u5173\u95ed\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e2a\u72b6\u6001\uff0c\u5177\u4f53\u662f\u8fd9\u4e48\u5f62\u6210\u7684\uff1a"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u4e3b\u52a8\u5173\u95ed\u7aef A\uff1a\u53d1 FIN\uff0c\u8fdb\u5165 FIN-WAIT-1 \u72b6\u6001\uff0c\u5e76\u7b49\u5f85 ......"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u88ab\u52a8\u5173\u95ed\u7aef P\uff1a\u6536\u5230 FIN \u540e\u5fc5\u987b\u7acb\u5373\u53d1 ACK\uff0c\u8fdb\u5165 CLOSE_WAIT \u72b6\u6001\uff0c\u5e76\u7b49 \u5f85 ......"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u4e3b\u52a8\u5173\u95ed\u7aef A\uff1a\u6536\u5230 ACK \u540e\u8fdb\u5165 FIN-WAIT-2 \u72b6\u6001\uff0c\u5e76\u7b49\u5f85 ......"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u88ab\u52a8\u5173\u95ed\u7aef P\uff1a\u53d1 FIN\uff0c\u8fdb\u5165 LAST_ACK \u72b6\u6001\uff0c\u5e76\u7b49\u5f85 ......"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u4e3b\u52a8\u5173\u95ed\u7aef A\uff1a\u6536\u5230 FIN \u540e\u5fc5\u987b\u7acb\u5373\u53d1 ACK\uff0c \u8fdb\u5165 TIME_WAIT \u72b6\u6001\uff0c \u7b49\u5f85 2MSL \u540e\u7ed3\u675f Socket\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u88ab\u52a8\u5173\u95ed\u7aef P\uff1a\u6536\u5230 ACK \u540e\u7ed3\u675f Socket\u3002 58\u3000\u3000>\u3000TIME_WAIT & CLOSE_WAIT \u7684\u8ba8\u8bba\u603b\u7ed3"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u56e0\u6b64\uff0cTIME_WAIT \u72b6\u6001\u662f\u51fa\u73b0\u5728\u4e3b\u52a8\u53d1\u8d77\u8fde\u63a5\u5173\u95ed\u7684\u4e00\u70b9\uff0c \u548c\u662f\u8c01\u53d1\u8d77\u7684\u8fde\u63a5\u65e0\u5173\uff0c\u53ef\u4ee5\u662f client \u7aef\uff0c\u4e5f\u53ef\u4ee5\u662f server \u7aef\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u800c\u4ece TIME_WAIT \u72b6\u6001\u5230 CLOSED \u72b6 \u6001\uff0c \u6709\u4e00\u4e2a\u8d85\u65f6\u8bbe\u7f6e\uff0c \u8fd9\u4e2a\u8d85\u65f6\u8bbe\u7f6e\u662f 2*MSL\uff08RFC793 \u5b9a\u4e49\u4e86 MSL \u4e3a 2 \u5206\u949f\uff0cLinux \u8bbe\u7f6e\u6210\u4e86 30s\uff09\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"331-\u4e3a\u4ec0\u4e48\u9700\u8981-time_wait-",children:"3.3.1 \u4e3a\u4ec0\u4e48\u9700\u8981 TIME_WAIT \uff1f"}),"\n",(0,i.jsx)(e.p,{children:"\u4e3b\u8981\u6709\u4e24\u4e2a\u539f\u56e0\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u4e3a\u4e86\u786e\u4fdd\u4e24\u7aef\u80fd\u5b8c\u5168\u5173\u95ed\u8fde\u63a5\u3002","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5047\u8bbe A \u670d\u52a1\u5668\u662f\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\u65b9\uff0cB \u670d\u52a1\u5668\u662f\u88ab\u52a8\u65b9\u3002 \u5982\u679c\u6ca1\u6709 TIME_WAIT \u72b6\u6001\uff0cA \u670d\u52a1\u5668\u53d1\u51fa\u6700\u540e\u4e00\u4e2a ACK \u5c31\u8fdb\u5165\u5173\u95ed\u72b6\u6001\uff0c \u5982\u679c\u8fd9\u4e2a ACK \u5bf9\u7aef\u6ca1\u6709\u6536\u5230\uff0c\u5bf9\u7aef\u5c31\u4e0d\u80fd\u5b8c\u6210\u5173\u95ed\u3002\u5bf9\u7aef\u6ca1\u6709\u6536\u5230 ACK\uff0c\u4f1a\u91cd\u53d1 FIN\uff0c\u6b64\u65f6\u8fde\u63a5\u5173\u95ed\uff0c\u8fd9\u4e2a FIN \u4e5f\u5f97\u4e0d\u5230 ACK\uff0c \u800c\u6709 TIME_WAIT\uff0c \u5219\u4f1a\u91cd\u53d1\u8fd9\u4e2a ACK\uff0c \u786e\u4fdd\u5bf9\u7aef\u80fd\u6b63\u5e38\u5173\u95ed\u8fde\u63a5\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u4e3a\u4e86\u786e\u4fdd\u540e\u7eed\u7684\u8fde\u63a5\u4e0d\u4f1a\u6536\u5230\u201c\u810f\u6570\u636e\u201d\u3002","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u521a\u624d\u63d0\u5230\u4e3b\u52a8\u7aef\u8fdb\u5165 TIME_WAIT \u540e\uff0c \u7b49\u5f85 2MSL \u540e CLOSE\uff0c \u8fd9\u91cc\u7684 MSL \u662f\u6307\uff08maximum segment lifetime\uff0c \u6211\u4eec\u5185\u6838\u4e00\u822c\u662f 30s\uff0c2MSL \u5c31\u662f1\u5206\u949f\uff09\uff0c \u7f51\u7edc\u4e0a\u6570\u636e\u5305\u6700\u5927\u7684\u751f\u547d\u5468\u671f\u3002 \u8fd9\u662f\u4e3a\u4e86\u4f7f\u7f51\u7edc\u4e0a\u7531\u4e8e\u91cd\u4f20\u51fa\u73b0\u7684 old duplicate segment \u90fd\u6d88\u5931\u540e\uff0c\u624d\u80fd\u521b\u5efa\u53c2\u6570\uff08\u56db\u5143\u7ec4\uff0c\u6e90 IP/PORT\uff0c\u76ee\u6807 IP/ PORT\uff09\u76f8\u540c\u7684\u8fde\u63a5\uff0c\u5982\u679c\u7b49\u5f85\u65f6\u95f4\u4e0d\u591f\u957f\uff0c\u53c8\u521b\u5efa\u597d\u4e86\u4e00\u6837\u7684\u8fde\u63a5\uff0c\u518d\u6536\u5230 old duplicate segment\uff0c\u6570\u636e\u5c31\u9519\u4e71\u4e86\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"332-time_wait-\u4f1a\u5bfc\u81f4\u4ec0\u4e48\u95ee\u9898",children:"3.3.2 TIME_WAIT \u4f1a\u5bfc\u81f4\u4ec0\u4e48\u95ee\u9898"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u65b0\u5efa\u8fde\u63a5\u5931\u8d25\u3002"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"TIME_WAIT \u5230 CLOSED\uff0c\u9700\u8981 2MSL=60s \u7684\u65f6\u95f4\u3002\u8fd9\u4e2a\u65f6\u95f4\u975e\u5e38\u957f\u3002\u6bcf\u4e2a\u8fde\u63a5\u5728\u4e1a\u52a1\u7ed3\u675f\u4e4b\u540e\uff0c\u9700\u8981 60s \u7684\u65f6\u95f4\u624d\u80fd\u5b8c\u5168\u91ca\u653e\u3002 \u5982\u679c\u4e1a\u52a1\u4e0a\u91c7\u7528\u7684\u662f\u77ed\u8fde\u63a5\u7684\u65b9\u5f0f\uff0c\u4f1a\u5bfc\u81f4\u975e\u5e38\u591a\u7684 TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\uff0c\u4f1a\u5360\u7528\u4e00\u4e9b\u8d44\u6e90\uff0c\u4e3b\u8981\u662f\u672c\u5730\u7aef\u53e3\u8d44\u6e90\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u4e00\u53f0\u670d\u52a1\u5668\u7684\u672c\u5730\u53ef\u7528\u7aef\u53e3\u662f\u6709\u9650\u7684\uff0c\u4e5f\u5c31\u51e0\u4e07\u4e2a\u7aef\u53e3\uff0c\u7531\u8fd9\u4e2a\u53c2\u6570\u63a7\u5236\uff1a"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.code,{children:"sysctl net.ipv4.ip_local_port_range"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"net.ipv4.ip_local_port_range = 32768 61000\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u5f53\u670d\u52a1\u5668\u5b58\u5728\u975e\u5e38\u591a\u7684 TIME_WAIT \u8fde\u63a5\uff0c \u5c06\u672c\u5730\u7aef\u53e3\u90fd\u5360\u7528\u4e86\uff0c \u5c31\u4e0d\u80fd\u4e3b\u52a8\u53d1\u8d77\u65b0\u7684\u8fde\u63a5\u53bb\u8fde\u5176\u4ed6\u670d\u52a1\u5668\u4e86\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\uff0c\u662f\u4e3b\u52a8\u53d1\u8d77\u8fde\u63a5\uff0c\u53c8\u662f\u4e3b\u52a8\u53d1\u8d77\u5173\u95ed\u7684\u4e00\u65b9\u624d\u4f1a\u9047\u5230\u8fd9\u4e2a\u95ee\u9898\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u5982\u679c\u662f server \u7aef\u4e3b\u52a8\u5173\u95ed client \u7aef\u5efa\u7acb\u7684\u8fde\u63a5\u4ea7\u751f\u4e86\u5927\u91cf\u7684 TIME_WAIT \u8fde\u63a5\uff0c\u8fd9\u662f\u4e0d\u4f1a\u51fa\u73b0\u8fd9\u4e2a\u95ee\u9898\u7684\u3002\u9664\u975e\u662f\u5176\u4e2d\u6d89\u53ca\u5230\u7684\u67d0\u4e2a\u5ba2\u6237\u7aef\u7684 TIME_WAIT \u8fde\u63a5\u90fd\u6709\u597d\u51e0\u4e07\u4e2a\u4e86\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"TIME_WAIT \u6761\u76ee\u8d85\u51fa\u9650\u5236\u3002"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u8fd9\u4e2a\u9650\u5236\uff0c\u662f\u7531\u4e00\u4e2a\u5185\u6838\u53c2\u6570\u63a7\u5236\u7684\uff1a"}),"\n",(0,i.jsx)(e.p,{children:"sysctl net.ipv4.tcp_max_tw_buckets"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"net.ipv4.tcp_max_tw_buckets = 5000\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u8d85\u51fa\u4e86\u8fd9\u4e2a\u9650\u5236\u4f1a\u62a5\u4e00\u6761 INFO \u7ea7\u522b\u7684\u5185\u6838\u65e5\u5fd7\uff0c\u7136\u540e\u7ee7\u7eed\u5173\u95ed\u6389\u8fde\u63a5\u3002\u5e76\u6ca1\u6709\u4ec0\u4e48\u7279\u522b\u5927\u7684\u5f71\u54cd\uff0c\u53ea\u662f\u589e\u52a0\u4e86\u521a\u624d\u63d0\u5230\u7684\u6536\u5230\u810f\u6570\u636e\u7684\u98ce\u9669\u800c\u5df2\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u53e6\u5916\u7684\u98ce\u9669\u5c31\u662f\uff0c\u5173\u95ed\u6389 TIME_WAIT \u8fde\u63a5\u540e\uff0c\u521a\u521a\u53d1\u51fa\u7684 ACK \u5982\u679c\u5bf9\u7aef\u6ca1\u6709\u6536\u5230\uff0c \u91cd\u53d1 FIN \u5305\u51fa\u6765\u65f6\uff0c\u4e0d\u80fd\u6b63\u786e\u56de\u590d ACK\uff0c\u53ea\u662f\u56de\u590d\u4e00\u4e2a RST \u5305\uff0c \u5bfc\u81f4\u5bf9\u7aef\u7a0b\u5e8f\u62a5\u9519\uff0c\u8bf4 connection reset\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u56e0\u6b64 net.ipv4.tcp_max_tw_buckets \u8fd9\u4e2a\u53c2\u6570\u662f\u5efa\u8bae\u4e0d\u8981\u6539\u5c0f\u7684\uff0c\u6539\u5c0f\u4f1a\u5e26\u6765\u98ce\u9669\uff0c\u6ca1\u6709\u4ec0\u4e48\u6536\u76ca\uff0c\u53ea\u662f\u8868\u9762\u4e0a\u901a\u8fc7 netstat \u770b\u5230\u7684 TIME_WAIT \u5c11\u4e86\u4e9b\u800c\u5df2\uff0c\u6709\u5565\u7528\u5462\uff1f\u5e76\u4e14\uff0c\u5efa\u8bae\u662f\u5f53\u9047\u5230\u6761\u76ee\u4e0d\u591f\uff0c\u589e\u52a0\u8fd9\u4e2a\u503c\uff0c\u4ec5\u4ec5\u662f\u6d6a\u8d39\u4e00\u70b9\u70b9\u5185\u5b58\u800c\u5df2\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"333-\u5982\u4f55\u89e3\u51b3-time_wait",children:"3.3.3 \u5982\u4f55\u89e3\u51b3 time_wait?"}),"\n",(0,i.jsx)(e.p,{children:"1\uff09\u6700\u4f73\u65b9\u6848\u662f\u5e94\u7528\u6539\u9020\u957f\u8fde\u63a5\uff0c\u4f46\u662f\u4e00\u822c\u4e0d\u592a\u9002\u7528\u3002"}),"\n",(0,i.jsx)(e.p,{children:"2\uff09\u4fee\u6539\u7cfb\u7edf\u56de\u6536\u53c2\u6570\u3002\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"net.ipv4.tcp_timestamps = 1\nnet.ipv4.tcp_tw_recycle = 1\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u8bbe\u7f6e\u8be5\u53c2\u6570\u4f1a\u5e26\u6765\u4ec0\u4e48\u95ee\u9898\uff1f"}),"\n",(0,i.jsx)(e.p,{children:"\u5982\u679c\u8fd9\u4e24\u4e2a\u53c2\u6570\u540c\u65f6\u5f00\u542f\uff0c \u4f1a\u6821\u9a8c\u6e90 ip \u8fc7\u6765\u7684\u5305\u643a\u5e26\u7684 timestamp \u662f\u5426\u9012\u589e\uff0c \u5982\u679c\u4e0d\u662f\u9012\u589e\u7684\u8bdd\uff0c\u5219\u4f1a\u5bfc\u81f4\u4e09\u6b21\u63e1\u624b\u5efa\u8054\u4e0d\u6210\u529f\uff0c\u5177\u4f53\u8868\u73b0\u4e3a\u6293\u5305\u7684\u65f6\u5019\u770b\u5230 syn \u53d1\u51fa\uff0cserver \u7aef\u4e0d\u54cd\u5e94 syn ack\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u901a\u4fd7\u4e00\u4e9b\u6765\u8bb2\u5c31\u662f\uff0c\u4e00\u4e2a\u5c40\u57df\u7f51\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u8bbf\u95ee\u60a8\uff0c\u5982\u679c\u6709\u5ba2\u6237\u7aef\u7684\u65f6\u95f4\u6bd4\u522b\u7684\u5ba2\u6237\u7aef\u65f6\u95f4\u6162\uff0c\u5c31\u4f1a\u5efa\u8054\u4e0d\u6210\u529f\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u6cbb\u6807\u4e0d\u6cbb\u672c\u7684\u65b9\u5f0f\uff1a"}),"\n",(0,i.jsx)(e.p,{children:"\u653e\u5927\u7aef\u53e3\u8303\u56f4\u3002 sysctl net.ipv4.ip_local_port_range"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"net.ipv4.ip_local_port_range = 32768 61000\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u653e\u5927 time_wait \u7684 buckets"}),"\n",(0,i.jsx)(e.p,{children:"sysctl net.ipv4.tcp_max_tw_buckets"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"net.ipv4.tcp_max_tw_buckets = 180000\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5173\u4e8e net.ipv4.tcp_max_tw_buckets \u5230\u5e95\u8981\u4e0d\u8981\u653e\u5927\uff0c\u76ee\u524d\u4e91\u4e0a ecs \u591a\u6570\u662f\u8bbe\u7f6e\u4e86 5000\uff0c\u5728\u5f88\u591a\u573a\u666f\u4e0b\u53ef\u80fd\u662f\u4e0d\u591f\u7684\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0512.54.07.png",alt:"iShot2020-08-0512.54.07"})}),"\n",(0,i.jsx)(e.p,{children:'\u7b80\u5355\u6765\u8bf4 net.ipv4.tcp_max_tw_buckets \u7684\u4f5c\u7528\u662f\u4e3a\u4e86 "\u4f18\u96c5" \u7684\u5173\u95ed\u8fde\u63a5\u3002'}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u5b8c\u6574\u7684\u5173\u95ed\u8fde\u63a5\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u907f\u514d\u6709\u6570\u636e\u5305\u91cd\u590d\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"334-\u5982\u679c-tw-\u6ee1\u4e86\u4f1a\u600e\u4e48\u6837",children:"3.3.4 \u5982\u679c tw \u6ee1\u4e86\u4f1a\u600e\u4e48\u6837"}),"\n",(0,i.jsx)(e.p,{children:"TCP: time wait bucket table overflow\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u65b0\u5185\u6838"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"tw_bucket \u6ee1\u4e86\u7684\u8bdd\uff0c \u4f1a\u5f71\u54cd established \u72b6\u6001\u7684\u8fde\u63a5\u5728 finack \u7684\u65f6\u5019\u76f4\u63a5\u8fdb\u5165 closed \u72b6\u6001\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u8001\u5185\u6838"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"tw_bucket \u6ee1\u4e86\u7684\u8bdd\uff0c\u4f1a\u5c06 tw_bucket \u91cc\u9762\u7684 time_wait \u6309\u7167\u4e00\u5b9a\u7684\u89c4\u5219\uff08\u5982 LRU\uff09\uff0c\u5c06\u4e00\u6279 time_Wait \u76f4\u63a5\u8fdb\u5165 closed \u72b6\u6001 \uff0c\u7136\u540e established \u72b6\u6001\u53d1\u9001 finack \u540e\u8fdb \u5165 time_wait\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"335-tw-\u7684\u5f00\u9500\u662f\u4ec0\u4e48",children:"3.3.5 tw \u7684\u5f00\u9500\u662f\u4ec0\u4e48"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u7279\u522b\u5c11\u91cf\u7684\u5185\u5b58\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u5360\u7528\u672c\u5730\u7aef\u53e3\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"336-tw-\u653e\u5927\u7684\u597d\u4e0e\u574f",children:"3.3.6 tw \u653e\u5927\u7684\u597d\u4e0e\u574f"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u653e\u5927\u7684\u8bdd\u9700\u8981\u66f4\u591a\u7684\u5185\u5b58\u5f00\u9500\uff0c\u4f46\u662f\u51e0\u4e4e\u53ef\u4ee5\u5ffd\u7565\u4e0d\u8ba1\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u5360\u7528\u66f4\u591a\u7684\u672c\u5730\u7aef\u53e3\uff0c\u9700\u8981\u9002\u5f53\u7684\u653e\u5927\u672c\u5730\u7aef\u53e3\u8303\u56f4\uff0c \u7aef\u53e3\u8303\u56f4\u7ecf\u8fc7\u7b80\u5355\u7684\u6d4b\u8bd5\uff0c\u5efa\u8bae\u8bbe\u7f6e\u4e3a tw \u7684 1.5 \u500d\u3002net.ipv4.ip_local_port_range"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"netstat \u5927\u91cf\u7684\u626b\u63cf socket \u7684\u65f6\u5019\uff08ss \u4e0d\u4f1a\u626b\u63cf\uff0c \u4f46\u662f ss \u5728 slab \u5185\u5b58\u7279\u522b\u9ad8 \u7684\u65f6\u5019\uff0c\u4e5f\u6709\u53ef\u80fd\u4f1a\u5f15\u8d77\u6296\u52a8\uff09\uff0c\u6781\u7aef\u60c5\u51b5\u4e0b\u53ef\u80fd\u4f1a\u5f15\u8d77\u6027\u80fd\u6296\u52a8\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"tw \u653e\u5927\uff0clocal_port_range \u653e\u5927\uff0c\u8fd8\u53ef\u4ee5\u914d\u7f6e\u590d\u7528\u4ee5\u53ca\u5feb\u901f\u56de\u6536\u7b49\u53c2\u6570\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u4f7f\u7528\u5feb\u901f\u56de\u6536\u53ef\u80fd\u4f1a\u5bfc\u81f4 snat \u65f6\u95f4\u6233\u9012\u589e\u6821\u9a8c\u95ee\u9898\uff0c\u4e0d\u9012\u589e\u7684\u8bdd syn \u4e0d\u54cd\u5e94\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u7279\u6b8a\u573a\u666f\u7684\u65f6\u5019\uff08\u672c\u673a\u4f1a\u53d1\u8d77\u5927\u91cf\u77ed\u94fe\u63a5\u7684\u65f6\u5019\uff09\u3002"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"nginx \u7ed3\u5408 php-fpm \u9700\u8981\u672c\u5730\u8d77\u7aef\u53e3\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"nginx \u53cd\u4ee3\u5982\uff08java\uff0c\u5bb9\u5668\u7b49\uff09\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"tcp_tw_reuse \u53c2\u6570\u9700\u8981\u7ed3\u5408 net.ipv4.tcp_timestamps = 1 \u4e00\u8d77\u6765\u7528\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u5373\u670d\u52a1\u5668\u5373\u505a\u5ba2\u6237\u7aef\uff0c\u4e5f\u505a server \u7aef\u7684\u65f6\u5019\u3002"}),"\n",(0,i.jsx)(e.p,{children:"tcp_tw_reuse \u53c2\u6570\u7528\u6765\u8bbe\u7f6e\u662f\u5426\u53ef\u4ee5\u5728\u65b0\u7684\u8fde\u63a5\u4e2d\u91cd\u7528 TIME_WAIT \u72b6\u6001\u7684\u5957\u63a5\u5b57\u3002 \u6ce8\u610f\uff0c \u91cd\u7528\u7684\u662f TIME_WAIT \u5957\u63a5\u5b57\u5360\u7528\u7684\u7aef\u53e3\u53f7\uff0c \u800c\u4e0d\u662f TIME_WAIT \u5957\u63a5\u5b57\u7684\u5185\u5b58\u7b49\u3002\u8fd9\u4e2a\u53c2\u6570\u5bf9\u5ba2\u6237\u7aef\u6709\u610f\u4e49\uff0c\u5728\u4e3b\u52a8\u53d1\u8d77\u8fde\u63a5\u7684\u65f6\u5019\u4f1a\u5728\u8c03\u7528\u7684 inet_ hash_connect() \u4e2d\u4f1a\u68c0\u67e5\u662f\u5426\u53ef\u4ee5\u91cd\u7528 TIME_WAIT \u72b6\u6001\u7684\u5957\u63a5\u5b57\u3002\u5982\u679c\u4f60\u5728\u670d\u52a1\u5668\u6bb5\u8bbe\u7f6e\u8fd9\u4e2a\u53c2\u6570\u7684\u8bdd\uff0c\u5219\u6ca1\u6709\u4ec0\u4e48\u4f5c\u7528\uff0c\u56e0\u4e3a\u670d\u52a1\u5668\u7aef ESTABLISHED \u72b6\u6001\u7684\u5957 \u63a5\u5b57\u548c\u76d1\u542c\u5957\u63a5\u5b57\u7684\u672c\u5730 IP\u3001\u7aef\u53e3\u53f7\u662f\u76f8\u540c\u7684\uff0c\u6ca1\u6709\u91cd\u7528\u7684\u6982\u5ff5\u3002\u4f46\u5e76\u4e0d\u662f\u8bf4\u670d\u52a1\u5668\u7aef\u5c31\u6ca1\u6709 TIME_WAIT \u72b6\u6001\u5957\u63a5\u5b57\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u56e0\u6b64\u8be5\u7c7b\u573a\u666f\u6700\u7ec8\u5efa\u8bae\u662f\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"net.ipv4.tcp_tw_recycle = 0 \u5173\u6389\u5feb\u901f\u56de\u6536\nnet.ipv4.tcp_tw_reuse = 1\t\u5f00\u542f tw \u72b6\u6001\u7684\u7aef\u53e3\u590d\u7528\uff08\u5ba2\u6237\u7aef\u89d2\u8272\uff09\nnet.ipv4.tcp_timestamps = 1 \u590d\u7528\u9700\u8981 timestamp \u6821\u9a8c\u4e3a 1\nnet.ipv4.tcp_max_tw_buckets = 30000 \u653e\u5927 bucket\nnet.ipv4.ip_local_port_range = 15000 65000 \u653e\u5927\u672c\u5730\u7aef\u53e3\u8303\u56f4\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5185\u5b58\u5f00\u9500\u6d4b\u8bd5\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"# ss -s\nTotal: 15254 (kernel 15288)\nTCP: 15169 (estab 5\uff0cclosed 15158\uff0corphaned 0\uff0csynrecv 0\uff0ctimewait 3/0)\uff0cports 0\nTransport Total\t\tIP\t\tIPv6\n*\t\t\t\t\t15288\t\t-\t\t\t-\nRAW\t\t\t\t0\t\t\t\t0\t\t\t0\nUDP\t\t\t\t5\t\t\t\t4\t\t\t1\nTCP\t\t\t\t11\t\t\t11\t\t0\nINET\t\t\t16\t\t\t15\t\t1\nFRAG\t\t\t0\t\t\t\t0\t\t\t0\n15000\u4e2asocket\u6d88\u801730\u591am\u5185\u5b58\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0519.43.59.png",alt:"iShot2020-08-0519.43.59"})}),"\n",(0,i.jsx)(e.h4,{id:"337-\u5173\u4e8eclose_wait",children:"3.3.7 \u5173\u4e8eCLOSE_WAIT"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0519.44.48.png",alt:"iShot2020-08-0519.44.48"})}),"\n",(0,i.jsx)(e.p,{children:"\u5982\u4e0a\u6240\u793a\uff0cCLOSE_WAIT \u7684\u72b6\u6001\u662f \u670d\u52a1\u5668\u7aef / \u5ba2\u6237\u7aef\u7a0b\u5e8f\u6536\u5230\u5916\u90e8\u8fc7\u6765\u7684 FIN \u4e4b \u540e\uff0c\u54cd\u5e94\u4e86 ACK \u5305\uff0c\u4e4b\u540e\u5c31\u8fdb\u5165\u4e86 CLOSE_WAIT \u72b6\u6001\u3002 \u4e00\u822c\u6765\u8bf4\uff0c\u5982\u679c\u4e00\u5207\u6b63\u5e38\uff0c\u7a0d\u540e\u670d\u52a1\u5668\u7aef / \u5ba2\u6237\u7aef\u7a0b\u5e8f\u9700\u8981\u53d1\u51fa FIN \u5305\uff0c\u8fdb\u800c\u8fc1\u79fb\u5230 LAST_ACK \u72b6\u6001\uff0c\u6536\u5230\u5bf9\u7aef\u8fc7\u6765\u7684 ACK \u540e\uff0c\u5b8c\u6210 TCP \u8fde\u63a5\u5173\u95ed\u7684\u6574\u4e2a\u8fc7\u7a0b\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u26a0\ufe0f\u4e0d\u7ba1\u662f\u670d\u52a1\u5668\u8fd8\u662f\u5ba2\u6237\u7aef\uff0c \u53ea\u8981\u662f\u88ab\u52a8\u63a5\u6536\u7b2c\u4e00\u4e2a FIN \u7684\u90a3\u4e00\u65b9\u624d\u4f1a\u8fdb\u5165 CLOSE_WAIT \u72b6\u6001\u3002"})}),"\n",(0,i.jsx)(e.h3,{id:"34-\u4e00\u6b21\u7f51\u7edc\u6296\u52a8\u7ecf\u5178\u6848\u4f8b\u5206\u6790",children:"3.4 \u4e00\u6b21\u7f51\u7edc\u6296\u52a8\u7ecf\u5178\u6848\u4f8b\u5206\u6790"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7b80\u4ecb\uff1a"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u672c\u6587\u8bb0\u5f55\u7684\u662f\u4e00\u6b21\u591a\u56e2\u961f\u534f\u4f5c\u5904\u7406\u7684\u6296\u52a8\u95ee\u9898\u7684\u8fc7\u7a0b\uff0c\u7531\u4e8e\u7528\u6237\u7684\u6267\u7740\uff0c\u4e5f\u5f97\u6211\u4eec\u5728\u8fd9\u4e2a\u6848\u4f8b\u5206\u6790\u5f97\u8f83\u4e3a\u6df1\u5165\uff0c\u5e0c\u671b\u5bf9\u5927\u5bb6\u4eca\u540e\u7684\u6b64\u7c7b\u6848\u4f8b\u7684\u5904\u7406\u6709\u6240\u542f\u53d1\u3002"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u89c6\u9891\u5b66\u4e60"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"https://yq.aliyun.com/live/1037",children:"\u6027\u80fd\u6296\u52a8\u5256\u6790(\u4e00)"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"https://yq.aliyun.com/live/1038",children:"\u6027\u80fd\u6296\u52a8\u5256\u6790(\u4e8c)"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"https://yq.aliyun.com/live/1078?spm=a2c6h.12873639.0.0.4a7f428cMLnIqV",children:"\u6027\u80fd\u6296\u52a8\u5256\u6790(\u4e09)"})}),"\n",(0,i.jsx)(e.p,{children:"\u7f51\u7edc\u6296\u52a8\u6848\u4f8b\u662f\u4e00\u7c7b\u5904\u7406\u96be\u5ea6\u8f83\u5927\u7684\u95ee\u9898\uff0c\u539f\u56e0\u4e3b\u8981\u662f\u5f88\u591a\u6296\u52a8\u53d1\u751f\u7684\u9891\u7387\u4e0d\u9ad8\uff0c\u4e14\u6301\u7eed\u65f6\u95f4\u975e\u5e38\u77ed\u6781\u9650\u60c5\u51b5\u53ef\u80fd\u4ec5\u6709 100ms \u4ee5\u4e0b\uff0c\u800c\u5f88\u591a\u7528\u6237\u7684\u4e1a\u52a1\u5e94\u7528\u5bf9\u5b9e\u65f6\u6027\u8981\u6c42\u975e\u5e38\u9ad8\uff0c\u56e0\u6b64\u5bf9\u6b64\u7c7b\u5728\u767e\u6beb\u79d2\u7684\u5ef6\u8fdf\u4e5f\u4f1a\u975e\u5e38\u654f\u611f\u3002\u672c\u6587\u8bb0\u5f55\u7684\u662f\u4e00\u6b21\u591a\u56e2\u961f\u534f\u4f5c\u5904\u7406\u7684\u6296\u52a8\u95ee\u9898\u7684\u8fc7\u7a0b\uff0c\u7531\u4e8e\u7528\u6237\u7684\u6267\u7740\uff0c\u4e5f\u4f7f\u5f97\u6211\u4eec\u5728\u8fd9\u4e2a\u6848\u4f8b\u5206\u6790\u5f97\u8f83\u4e3a\u6df1\u5165\uff0c\u5e0c\u671b\u5bf9\u5927\u5bb6\u4eca\u540e\u7684\u6b64\u7c7b\u6848\u4f8b\u7684\u5904\u7406\u6709\u6240\u542f\u53d1\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u95ee\u9898\u73b0\u8c61"})}),"\n",(0,i.jsx)(e.p,{children:"\u8ba9\u6211\u4eec\u5148\u6765\u770b\u770b\u95ee\u9898\u73b0\u8c61\u5427\uff0c\u7528\u6237\u7684\u5e94\u7528\u65e5\u5fd7\u8bb0\u5f55\u4e86\u767e\u6beb\u79d2\u751a\u81f3 1-2 \u79d2\u7ea7\u522b\u7684\u5ef6\u8fdf\uff0c \u800c\u4e14\u53d1\u751f\u8f83\u4e3a\u9891\u7e41\uff0c\u7531\u4e8e\u4e1a\u52a1\u7684\u5b9e\u65f6\u6027\u8981\u6c42\u8f83\u9ad8\uff0c\u56e0\u6b64\u5bf9\u4e1a\u52a1\u7684\u5f71\u54cd\u8f83\u5927\uff0c\u5f53\u7136\u5176\u4e2d\u4e5f\u5f71\u54cd\u5230\u4e86\u7528\u6237\u5bf9\u8fc1\u4e91\u7684\u4fe1\u5fc3\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u521d\u6b65\u6392\u67e5"})}),"\n",(0,i.jsx)(e.p,{children:"\u5728\u7528\u6237\u901a\u8fc7\u5e94\u7528\u5c42\u9762\u7684\u6392\u67e5\u6000\u7591\u95ee\u9898\u6765\u6e90\u4e8e\u865a\u62df\u7f51\u7edc\u73af\u5883\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u505a\u7684\u7b2c\u4e00 \u4ef6\u4e8b\u5c31\u662f\u9996\u5148\u8981\u5c06\u95ee\u9898\u7b80\u5355\u5316\u3002\u8fd9\u4e00\u6b65\u662f\u975e\u5e38\u5fc5\u8981\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u5bf9\u7528\u6237\u7684\u5e94\u7528\u4e0d\u53ef\u80fd\u6709\u975e\u5e38\u6df1\u5165\u7684\u4e86\u89e3\uff0c\u6240\u4ee5\u7528\u6237\u7684\u5e94\u7528\u65e5\u5fd7\u5177\u4f53\u542b\u4e49\u548c\u8bb0\u5f55\u65b9\u5f0f\u5bf9\u6211\u4eec\u6765\u8bf4\u66f4\u50cf\u9ed1\u76d2\u3002 \u6211\u4eec\u6240\u8981\u505a\u7684\u662f\u5c06\u95ee\u9898\u73b0\u8c61\u8f6c\u79fb\u5230\u6211\u4eec\u5e38\u89c1\u7684\u7cfb\u7edf\u7ec4\u4ef6\u4e0a\u6765\uff0c\u6bd4\u5982\u7b80\u5355\u5230 ping\u3002\u6240\u4ee5\u6211\u4eec\u7b2c\u4e00\u4ef6\u6240\u505a\u7684\u4e8b\u60c5\u5c31\u662f\u7f16\u5199\u811a\u672c\u8fdb\u884c\u4e24\u53f0\u673a\u5668\u7684\u5185\u7f51\u4e92 ping\uff0c\u5e76\u5c06\u6bcf\u6b21 ping \u7684\u5ef6\u8fdf\u8bb0\u5f55\u5230\u6587\u4ef6\u3002\u9009\u62e9 ping \u5f53\u7136\u4e5f\u662f\u7531\u4e8e ping \u7684\u95f4\u9694\u662f\u53ef\u4ee5\u8bbe\u7f6e\u5230\u767e\u6beb\u79d2\u7684\uff0c\u6bd4\u8f83\u5bb9\u6613\u8bf4\u660e\u95ee\u9898\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u5728\u4e92 ping \u7684\u6d4b\u8bd5\u4e2d\u6211\u4eec\u786e\u5b9e\u53d1\u73b0\u6709\u767e\u6beb\u79d2\u4ee5\u4e0a\u7684\u5ef6\u8fdf\uff0c\u90a3\u4e48\u968f\u540e\u6211\u4eec\u4e3a\u4e86\u6392\u9664\u7269\u7406\u7f51\u7edc\u7684\u5f71\u54cd\uff0c\u9009\u62e9\u4e00\u53f0\u673a\u5668\u8fdb\u884c\u5bf9\u7f51\u5173\u7684 ping \u6d4b\u8bd5\uff0c\u540c\u6837\u53d1\u73b0\u4e86\u7c7b\u4f3c\u7684\u5ef6\u8fdf\uff1a"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0519.49.49.png",alt:"iShot2020-08-0519.49.49"})}),"\n",(0,i.jsx)(e.p,{children:"\u6765\u770b\u770b\u4e0a\u9762\u7684 ping \u6d4b\u8bd5\u7ed3\u679c\u5427\uff0c\u521d\u770b\u4e5f\u4ec5\u4ec5\u662f\u4e00\u4e9b\u767e\u6beb\u79d2\u5ef6\u8fdf\u7684\u96c6\u4e2d\u53d1\u751f\u800c\u5df2\uff0c\u4f46\u662f\u4ed4\u7ec6\u89c2\u5bdf\u5c31\u4f1a\u53d1\u73b0\u6bcf\u6b21\u53d1\u751f\u90fd\u6709\u8fd9\u6837\u7684\u60c5\u51b5\uff0c\u5c31\u662f\u5ef6\u8fdf\u5728\u4e00\u7ec4\u8fde\u7eed\u7684 ping \u4e0a\u53d1\u751f\u7684\uff0c\u5e76\u4e14\u5ef6\u8fdf\u662f\u5012\u5e8f\u6392\u5217\u7684\u3002\u90a3\u4e48\u8fd9\u610f\u5473\u7740\u4ec0\u4e48\u5462\uff1f"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5206\u6790\u4e00"})}),"\n",(0,i.jsx)(e.p,{children:"\u901a\u8fc7\u4ee5\u4e0a\u7684 ping \u6d4b\u8bd5\u6211\u4eec\u628a\u95ee\u9898\u7b80\u5355\u5316\u5230\u4e86 ping \u7f51\u5173\u5ef6\u8fdf\u4e0a\uff0c\u4f46\u662f\u4e0a\u9762\u5982\u6b64\u89c4\u5f8b\u7684\u6d4b\u8bd5\u7ed3\u679c\u7684\u5177\u4f53\u542b\u4e49\u662f\u4ec0\u4e48\u3002\u9996\u5148\u4ed6\u610f\u5473\u7740\u5e76\u6ca1\u6709\u4e22\u5305\u53d1\u751f\uff0c\u6240\u4ee5\u7684 ICMP \u8bf7\u6c42\u90fd\u88ab\u7cfb\u7edf\u53d1\u51fa\u5e76\u4e14\u6536\u5230\u56de\u590d\uff0c\u4f46\u662f\u8fd9\u6837\u7684\u5012\u5e8f\u6392\u5217\uff0c\u66f4\u50cf\u662f\u5728\u95ee\u9898\u65f6\u95f4\u6bb5\u5185\u6240\u6709\u7684\u56de\u590d\u90fd\u6ca1\u6709\u88ab\u7b2c\u4e00\u65f6\u95f4\u5904\u7406\uff0c\u800c\u662f\u7a81\u7136\u5728 800ms \u4e4b\u540e\u7cfb\u7edf\u5904\u7406\u4e86\u6240\u6709\u4e4b\u524d\u53d1\u751f\u56de\u590d\uff0c\u56e0\u6b64\u624d\u4f1a\u4ea7\u751f\u8fd9\u6837\u7684\u73b0\u8c61\u3002\u90a3\u4e48\u6211\u4eec\u6b64\u65f6\u53ef\u4ee5\u6709\u4e00\u4e2a\u5047\u8bbe\uff0c\u5728\u8fd9 800ms \u4e4b\u524d\u7cfb\u7edf\u505c\u6b62\u4e86\u5bf9\u7f51\u7edc\u5305\u7684\u5904\u7406\u3002\u90a3\u4e48\u4ec0\u4e48\u6837\u7684\u60c5\u51b5\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u505c\u6b62\u5bf9\u7f51\u7edc\u5305\u7684\u5904\u7406\u5462\uff1f"}),"\n",(0,i.jsx)(e.p,{children:"\u7b54\u6848\u662f\u4e2d\u65ad\u7981\u7528\uff0c\u786c\u4ef6\u4e2d\u65ad\u662f\u7cfb\u7edf\u5904\u7406\u7f51\u7edc\u5305\u7684\u7b2c\u4e00\u4e5f\u662f\u5fc5\u987b\u6b65\u9aa4\uff0c\u4e2d\u65ad\u7981\u7528\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u7684\u8f6f\u4e2d\u65ad\u548c\u4e2d\u65ad\u90fd\u4e0d\u80fd\u5728 CPU \u4e0a\u53d1\u751f\uff0c\u4ece\u800c\u4f7f\u5f97\u5f53\u524d\u5728 CPU \u4e0a\u8fd0\u884c\u7684\u6307\u4ee4\u662f\u65e0\u6cd5\u88ab\u6253\u65ad\u7684\uff0c\u8fd9\u7ecf\u5e38\u88ab\u7528\u4e8e\u4e00\u4e9b\u53ef\u80fd\u5b58\u5728\u7ade\u4e89\u98ce\u9669\u7684\u5185\u6838\u4ee3\u7801\u7247\u6bb5\u4e0a\uff0c\u8fd9\u4e9b\u4ee3\u7801\u7247\u6bb5\u53ef\u80fd\u4f1a\u56e0\u4e3a\u88ab\u4e2d\u65ad\u6253\u65ad\u800c\u5bfc\u81f4\u6570\u636e\u4e0d\u540c\u6b65\u751a\u81f3\u635f\u574f\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u5728\u5f53\u65f6\u6211\u4eec\u5185\u6838\u56e2\u961f\u751a\u81f3\u901a\u8fc7\u7f16\u5199\u793a\u4f8b\u9a71\u52a8\uff0c\u901a\u8fc7\u8bb0\u5f55 timer \u51fd\u6570\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\u672a\u80fd\u89e6\u53d1\u6765\u9a8c\u8bc1\u4e86\u4e2d\u65ad\u7981\u7528\u7684\u53d1\u751f\u3002\u90a3\u4e48\u5e9e\u5927\u7684\u5185\u6838\u4ee3\u7801\u4e2d\u7a76\u7adf\u662f\u54ea\u4e00\u90e8\u5206\u7684\u4ee3\u7801\u5bfc\u81f4\u4e86\u8fd9\u6837\u7684\u95ee\u9898\u5462\uff1f"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5206\u6790\u4e8c"})}),"\n",(0,i.jsx)(e.p,{children:"\u5728\u8fd9\u6bb5\u5206\u6790\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u505a\u4e86\u5927\u91cf\u5b9e\u9a8c\uff0c\u6bd4\u5982\u901a\u8fc7\u7f16\u5199\u5185\u6838\u9a71\u52a8\u6765\u7981\u7528\u4e2d\u65ad\uff0c\u6d4b\u8bd5\u5404\u7c7b\u5185\u6838\u8ffd\u8e2a\u65b9\u6cd5\u662f\u5426\u80fd\u83b7\u5f97\u66f4\u8fdb\u4e00\u6b65\u7684\u4fe1\u606f\uff0c\u5982\u7981\u7528\u4e2d\u65ad\u7684\u5806\u6808\uff0c\u4f46\u662f\u5f88\u53ef\u60dc\uff0c\u76ee\u524d\u5c1a\u65e0\u5f88\u597d\u7684\u65b9\u6cd5\u5728\u4e0d\u5f71\u54cd\u4e1a\u52a1\u7684\u60c5\u51b5\u4e0b\u8f83\u8f7b\u91cf\u7ea7\u5730\u83b7\u5f97\u7981\u7528\u4e2d\u65ad\u65f6\u7684\u5185\u6838\u5806\u6808\uff0c\u539f\u7406\u4e5f\u5f88\u7b80\u5355\uff0c\u786c\u4ef6\u4e2d\u65ad\u672c\u8eab\u4f18\u5148\u7ea7\u8981\u9ad8\u4e8e\u4e00\u822c\u8fdb\u7a0b\u548c\u8f6f\u4e2d\u65ad\uff0c\u5728\u5176\u88ab\u7981\u7528\u4e4b\u540e\u81ea\u7136\u666e\u901a \u8f6f\u4ef6\u5c42\u9762\u7684\u8ffd\u8e2a\u65b9\u6cd5\u4e5f\u4e0d\u8d77\u4f5c\u7528\u4e86\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u7136\u800c\u95ee\u9898\u5c31\u9690\u85cf\u5728\u4e00\u7c7b\u7cfb\u7edf\u7684\u5185\u5b58\u8d44\u6e90\u4e0a\uff0c\u5373\u7cfb\u7edf\u7684 slab \u5360\u7528\u91cf\u76f8\u6bd4\u6b63\u5e38\u7cfb\u7edf\u8981\u9ad8\u51fa\u4e0d\u5c11\uff1a"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0519.51.44.png",alt:"iShot2020-08-0519.51.44"})}),"\n",(0,i.jsx)(e.p,{children:"\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5176\u4e2d dentry \u5728 slab \u4e2d\u7684\u5360\u7528\u91cf\u8fbe\u5230\u4e86\u975e\u5e38\u9ad8\u7684\u7a0b\u5ea6\uff0cdentry \u662f\u5185\u5b58\u4e2d\u8868\u793a\u76ee\u5f55\u548c\u6587\u4ef6\u7684\u5bf9\u8c61\uff0c\u4f5c\u4e3a\u4e0e inode \u7684\u94fe\u63a5\u5b58\u5728\uff0c\u5728\u4e00\u822c\u60c5\u51b5\u4e0b\u5982\u6b64\u9ad8\u6570\u5b57\u7684 dentry \u9879\u53ef\u80fd\u4ee3\u8868\u8fd9\u7cfb\u7edf\u6709\u5927\u91cf\u88ab\u6253\u5f00\u7684\u6587\u4ef6\u3002 \u7136\u800c\u6b64\u65f6\u6211\u4eec\u9996\u5148\u9700\u8981\u89e3\u91ca\u5927\u91cf\u7684 dentry \u9879\u4e0e\u7981\u7528\u4e2d\u65ad\u7684\u5173\u7cfb\uff0c\u6211\u4eec\u6765\u770b\u770b 2.6 \u5185\u6838\u7684\u8fd9\u4e00\u6bb5\u4ee3\u7801\uff1a"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0519.52.31.png",alt:"iShot2020-08-0519.52.31"})}),"\n",(0,i.jsxs)(e.p,{children:["\u8fd9\u662f\u4e00\u6bb5\u8ba1\u7b97 slab \u603b\u91cf\u7684\u4ee3\u7801\uff0c\u6211\u4eec\u6ce8\u610f\u5230\u5b83\u662f\u4ee5\u904d\u5386\u94fe\u8868\u7684\u65b9\u5f0f\u6765\u7edf\u8ba1 slab \u603b\u91cf\u7684\uff0c\u800c\u5728\u8fdb\u5165\u94fe\u8868\u4e4b\u524d\u8c03\u7528\u4e86 ",(0,i.jsx)(e.code,{children:"spin_lock_irq"})," \u51fd\u6570\uff0c\u6211\u4eec\u6765\u770b\u770b\u5b83\u7684\u5b9e\u73b0\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"static inline void __spin_lock_irq(spinlock_t *lock)\n{\nlocal_irq_disable();\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u786e\u8ba4\u5728\u7edf\u8ba1 slab \u4fe1\u606f\u7684\u65f6\u5019\uff0c\u7cfb\u7edf\u7684\u884c\u4e3a\u662f\u9996\u5148\u7981\u7528\u4e2d\u65ad\uff0c\u7136\u540e\u904d\u5386\u94fe\u8868\u7edf\u8ba1 slab\uff0c\u6700\u540e\u518d\u6b21\u542f\u7528\u4e2d\u65ad\u3002\u90a3\u4e48\u6574\u4e2a\u7981\u7528\u4e2d\u65ad\u7684\u65f6\u95f4\u5c06\u53d6\u51b3\u4e8e\u94fe\u8868\u4e2d\u5bf9\u8c61\u7684 \u4e2a\u6570\uff0c\u5982\u679c\u5176\u5bf9\u8c61\u6570\u91cf\u60ca\u4eba\uff0c\u5f88\u53ef\u80fd\u5c31\u4f1a\u5bfc\u81f4\u7981\u7528\u4e2d\u65ad\u65f6\u95f4\u8fc7\u957f\u3002"}),"\n",(0,i.jsxs)(e.p,{children:["\u9a8c\u8bc1\u95ee\u9898\u4e5f\u975e\u5e38\u7b80\u5355\uff0c\u6211\u4eec\u53ef\u4ee5\u4e3b\u52a8\u8fd0\u884c ",(0,i.jsx)(e.code,{children:"cat /proc/slabinfo"})," \u5728\u83b7\u53d6 slab \u4fe1\u606f\uff0c\u90a3\u4e48 \u4ee5\u4e0a\u51fd\u6570\u4e5f\u5c06\u4f1a\u88ab\u8c03\u7528\uff0c\u540c\u65f6\u89c2\u5bdf ping \u6d4b\u8bd5\u8f93\u51fa\u7b26\u5408\u4ee5\u4e0a\u95ee\u9898\u70b9\u7684\u60c5\u51b5\uff0c\u5373\u53ef\u4ee5\u5927\u81f4\u786e\u8ba4\u95ee\u9898\u539f\u56e0\u4e86\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u6b64\u65f6\u6211\u4eec\u5df2\u7ecf\u6709\u4e86\u53ef\u4ee5\u6682\u65f6\u7f13\u89e3\u95ee\u9898\u7684\u65b9\u6cd5\u4e86\uff0c\u5bf9 dentry \u9879\u662f\u4f5c\u4e3a\u6587\u4ef6\u7cfb\u7edf\u7f13\u5b58\u7684 \u4e00\u90e8\u5206\u5b58\u5728\u7684\uff0c\u4e5f\u5c31\u662f\u771f\u6b63\u7684\u6587\u4ef6\u4fe1\u606f\u662f\u5b58\u653e\u4e8e\u78c1\u76d8\u4e0a\u7684\uff0cdentry \u53ea\u4e0d\u8fc7\u662f\u5728\u7cfb\u7edf\u6253\u5f00\u6587\u4ef6\u7cfb\u7edf\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\u7684\u5bf9\u8c61\u800c\u5df2\uff0c\u5373\u4f7f\u7f13\u5b58\u88ab\u6e05\u7a7a\uff0c\u672a\u6765\u7cfb\u7edf\u4e00\u6837\u53ef\u4ee5\u901a\u8fc7\u8bfb\u53d6\u78c1\u76d8\u6587\u4ef6\u6765\u91cd\u65b0\u751f\u6210 dentry \u4fe1\u606f\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u7c7b\u4f3c ",(0,i.jsx)(e.code,{children:"echo 2 > /proc/sys/vm/ drop_caches && sync"})," \u7684\u65b9\u5f0f\u6765\u91ca\u653e\u7f13\u5b58\uff0c\u7f13\u89e3\u95ee\u9898\u3002"]}),"\n",(0,i.jsx)(e.p,{children:"\u4f46\u662f\u5176\u5b9e\u4e8b\u60c5\u8fdc\u8fdc\u6ca1\u6709\u5c31\u6b64\u7ed3\u675f\uff0c\u6211\u4eec\u9700\u8981\u6ce8\u610f\u4e24\u4e2a\u5173\u952e\u6027\u7684\u95ee\u9898\uff1a"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u662f\u4ec0\u4e48\u7a0b\u5e8f\u5728\u53cd\u590d\u5730\u83b7\u53d6 slab \u4fe1\u606f\uff0c\u4ea7\u751f\u7c7b\u4f3c ",(0,i.jsx)(e.code,{children:"cat /proc/slabinfo"})," \u7684\u6548\u679c\u3002"]}),"\n",(0,i.jsx)(e.li,{children:"\u8fd9\u4e48\u591a dentry \u751f\u6210\u7684\u539f\u56e0\u662f\u4ec0\u4e48\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u5982\u679c\u4e0d\u77e5\u9053\u8fd9\u4e24\u70b9\u8fd9\u4e2a\u95ee\u9898\u968f\u65f6\u53ef\u80fd\u4f1a\u590d\u73b0\u3002\u800c\u5468\u671f\u6027\u5730 drop cache \u5e76\u4e0d\u662f\u4e00\u4e2a\u957f\u4e45\u6839\u6cbb\u7684\u65b9\u6848\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u770b\u5230\u8fd9\u91cc\uff0c\u8fd9\u4e2a\u7f13\u5b58\u95ee\u9898\u7684\u5904\u7406\u662f\u4e0d\u662f\u5728\u54ea\u513f\u89c1\u8fc7\uff1f\u5bf9\u7684\uff0c\u5728\u7cfb\u7edf\u6027\u80fd\u5206\u6790\u90a3\u4e00\u7ae0\u8282\u6211\u4eec\u4e5f\u63d0\u5230\u76f8\u4f3c\u7684\u95ee\u9898\uff0c\u5efa\u8bae\u518d\u5f80\u524d\u56de\u987e\u4e00\u4e0b\u5fc3\u4e2d\u5e94\u8be5\u5c31\u5dee\u4e0d\u591a\u6709\u7b54\u6848\u4e86\u3002"}),"\n",(0,i.jsx)(e.h2,{id:"4linux-\u7cfb\u7edf\u670d\u52a1\u4e0e\u53c2\u6570\u95ee\u9898",children:"4.Linux \u7cfb\u7edf\u670d\u52a1\u4e0e\u53c2\u6570\u95ee\u9898"}),"\n",(0,i.jsx)(e.p,{children:"\u81f3\u6b64\uff0c\u6211\u4eec\u5206\u4eab\u4e86\u5173\u4e8e\u7cfb\u7edf\u542f\u52a8\u767b\u5f55\u3001\u6027\u80fd\u3001\u7f51\u7edc\u7b49\u4e09\u4e2a\u65b9\u9762\u9047\u5230\u7684\u4e00\u4e9b\u7ecf\u5178\u548c\u6709\u8da3\u6848\u4f8b\uff0c\u800c\u8fd9\u4e09\u4e2a\u65b9\u9762\u4e5f\u57fa\u672c\u6db5\u76d6\u4e86\u76ee\u524d\u6211\u4eec\u9047\u5230\u7684\u5927\u90e8\u5206\u7684\u7cfb\u7edf\u6545\u969c\u95ee\u9898\u3002\u6b64\u5916\uff0c\u8fd8\u6709\u4e00\u7c7b\u7cfb\u7edf\u670d\u52a1\u53c2\u6570\u95ee\u9898\u5728\u6211\u4eec\u5904\u7406\u7684\u6848\u4f8b\u4e2d\u4e5f\u5c61\u89c1\u4e0d\u9c9c\u3002\u963f\u91cc\u4e91\u7ed3\u5408\u591a\u5e74\u4e91\u4e0a ECS \u8fd0\u7ef4\u7ecf\u9a8c\u548c\u7528\u6237\u4e1a\u52a1\u53cd\u9988\uff0c\u4e0d\u65ad\u4f18\u5316 ECS \u7cfb\u7edf\u955c\u50cf\u4ee5\u6700\u5927\u5316\u53d1\u6325\u7528\u6237\u4e1a\u52a1\u6548\u76ca\uff0c\u4f46\u5f88\u591a\u65f6\u5019\u7531\u4e8e\u4e1a\u52a1\u589e\u957f\u7f3a\u5c11\u51c6\u786e\u7684\u9884\u4f30\uff0c\u5e94\u7528\u7a0b\u5e8f\u4e0d\u5408\u7406\u8bbe\u8ba1\u7b49\u65b9\u9762\uff0c\u9700\u8981\u8c03\u6574\u7cfb\u7edf\u9ed8\u8ba4\u7684\u53c2\u6570\u914d\u7f6e\u6765\u9002\u5e94\u548c\u6539\u5584\u4e1a\u52a1\u8fd0\u884c\u72b6\u6001\u3002\u4e0b\u9762\u6211\u4eec\u5206\u4eab\u51e0\u4e2a\u6848\u4f8b\u6765\u5e2e\u52a9\u5927\u5bb6\u66f4\u597d\u7684\u7406\u89e3\u4e00\u4e9b\u7cfb\u7edf\u53c2\u6570\u7684\u5b9e\u9645\u53c2\u8003\u548c\u5e94\u7528\u610f\u4e49\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"41-4-\u4e2a-limits-\u751f\u6548\u7684\u95ee\u9898",children:"4.1 4 \u4e2a limits \u751f\u6548\u7684\u95ee\u9898"}),"\n",(0,i.jsx)(e.h4,{id:"411-\u7b2c\u4e00\u4e2a\u95ee\u9898",children:"4.1.1 \u7b2c\u4e00\u4e2a\u95ee\u9898"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"limits.conf \u7684\u9650\u5236\u5728 /proc/pid/limits \u4e2d\u672a\u751f\u6548\u3002"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"# cat /proc/3606/limits\nLimit\t\t\t\t\tSoft Limit\t\tHard Limit\t\tUnits\nMax processes 31202\t\t\t\t\t31202\t\t\t\t\tprocesses\nMax open files\t1024\t\t\t\t4096\t\t\t\t\tfiles\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u5728 CentOS 7 & Ubuntu \u7cfb\u7edf\u4e2d\uff0c\u4f7f\u7528 Systemd \u66ff\u4ee3\u4e86\u4e4b\u524d\u7684 SysV\u3002",(0,i.jsx)(e.code,{children:"/etc/security/ limits.conf"})," \u6587\u4ef6\u7684\u914d\u7f6e\u4f5c\u7528\u57df\u7f29\u5c0f\u4e86\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"/etc/security/limits.conf"})," \u7684\u914d\u7f6e\uff0c \u53ea\u9002\u7528\u4e8e\u901a\u8fc7 PAM \u8ba4\u8bc1\u767b\u5f55\u7528\u6237\u7684\u8d44\u6e90\u9650\u5236\uff0c \u5b83\u5bf9 systemd \u7684 service \u7684\u8d44\u6e90\u9650\u5236\u4e0d\u751f\u6548\u3002 \u56e0\u6b64\u767b\u5f55\u7528\u6237\u7684\u9650\u5236\uff0c \u901a\u8fc7 ",(0,i.jsx)(e.code,{children:"/etc/ security/limits.conf"})," \u4e0e ",(0,i.jsx)(e.code,{children:"/etc/security/limits.d"})," \u4e0b\u7684\u6587\u4ef6\u8bbe\u7f6e\u5373\u53ef\u3002 \u5bf9\u4e8e systemd service \u7684\u8d44\u6e90\u8bbe\u7f6e\uff0c\u5219\u9700\u4fee\u6539\u5168\u5c40\u914d\u7f6e\uff0c \u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u653e\u5728 ",(0,i.jsx)(e.code,{children:"/etc/systemd/system.conf"})," \u548c ",(0,i.jsx)(e.code,{children:"/etc/systemd/user.conf"}),"\uff0c\u540c\u65f6\u4e5f\u4f1a\u52a0\u8f7d\u4e24\u4e2a\u5bf9\u5e94\u76ee\u5f55\u4e2d\u7684\u6240\u6709 .conf \u6587\u4ef6 ",(0,i.jsx)(e.code,{children:"/etc/systemd/system.conf.d/.conf"})," \u548c ",(0,i.jsx)(e.code,{children:"/etc/systemd/user.conf.d/.conf"}),"\u3002 system.conf \u662f\u7cfb\u7edf\u5b9e\u4f8b\u4f7f\u7528\u7684\uff0cuser.conf \u662f\u7528\u6237\u5b9e\u4f8b\u4f7f\u7528\u7684\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"vim /etc/systemd/system.conf\nDefaultLimitNOFILE=100000\nDefaultLimitNPROC=65535\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u4fee\u6539\u5e76\u91cd\u542f\u5373\u53ef\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"# cat /proc/3613/limits\nLimit\t\t\t\t\tSoft Limit\t\tHard Limit\t\tUnits\nMax processes 65535\t\t\t\t\t65535\t\t\t\t\tprocesses\nMax open files\t100000\t\t\t100000\t\t\t\tfiles\n"})}),"\n",(0,i.jsx)(e.h4,{id:"412-\u7b2c\u4e8c\u4e2a\u95ee\u9898",children:"4.1.2 \u7b2c\u4e8c\u4e2a\u95ee\u9898"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5728\u670d\u52a1\u91cc\u9762\u8bbe\u7f6e LimitNOFILE=infinity \u4e3a\u4ec0\u4e48\u4e0d\u662f\u65e0\u7a77\u5927\uff1f"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5728\u670d\u52a1\u91cc\u9762\u8bbe\u7f6e LimitNOFILE=infinity \u540e\uff0c \u901a\u8fc7\u67e5\u770b pid \u7684 limit \u53d1\u73b0 openfile \u662f 65536 \uff0c\u800c\u4e0d\u662f\u65e0\u7a77\u5927\u3002"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u67e5\u770b\u670d\u52a1\u914d\u7f6e"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:'[root@iZwz98aynkjcxvtra0f375Z ~]# cat /etc/systemd/system/multi-user.target.wants/docker.service |grep -vi "^#"|grep -vi "^$"\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nBindsTo=containerd.service\nAfter=network-online.target firewalld.service containerd.service\nWants=network-online.target\nRequires=docker.socket\n[Service]\nType=notify\nExecStart=/usr/bin/dockerd -H fd://\nExecStartPost=/usr/sbin/iptables -P FORWARD ACCEPT\nExecReload=/bin/kill -s HUP $MAINPID\nTimeoutSec=0\nRestartSec=2\nRestart=always\nStartLimitBurst=3\nStartLimitInterval=60s\nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\nTasksMax=infinity\nDelegate=yes\nKillMode=process\n[Install]\nWantedBy=multi-user.target\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u67e5\u770b\u914d\u7f6e\u6548\u679c"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0520.03.33.png",alt:"iShot2020-08-0520.03.33"})}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u4e2a\u662f systemd \u7684 bug\uff0c\u4f4e\u4e8e 240 \u7684\u7248\u672c\u9700\u8981\u624b\u52a8\u8bbe\u7f6e\u624d\u53ef\u4ee5\u751f\u6548\u3002"}),"\n",(0,i.jsx)(e.p,{children:"LimitNOFILE=102400"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"https://github.com/systemd/systemd/issues/6559",children:"github\u4e0a\u7684\u8bf4\u660e"})}),"\n",(0,i.jsx)(e.h4,{id:"413-\u7b2c\u4e09\u4e2a\u95ee\u9898",children:"4.1.3 \u7b2c\u4e09\u4e2a\u95ee\u9898"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4e3a\u4ec0\u4e48 openfile \u4e0d\u80fd\u8bbe\u7f6e\u4e3a unlimited\u3002"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"[root@iZwz98aynkjcxvtra0f375Z ~]# ulimit -n\n65535\n\n[root@iZwz98aynkjcxvtra0f375Z ~]# ulimit -n unlimited\n-bash: ulimit: open files: cannot modify limit: Operation not permitted\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u539f\u56e0\u662f ",(0,i.jsx)(e.strong,{children:(0,i.jsx)("span",{style:{color:"red"},children:"CentOS7\u91cc openfile \u4e0d\u80fd\u5927\u4e8e nr_open"})}),"\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"[root@iZwz98aynkjcxvtra0f375Z ~]# cat /proc/sys/fs/nr_open\n1048576\n\n[root@iZwz98aynkjcxvtra0f375Z ~]# ulimit -n 1048577\n-bash: ulimit: open files: cannot modify limit: Operation not permitted\n\n[root@iZwz98aynkjcxvtra0f375Z ~]# ulimit -n 1048576\n[root@iZwz98aynkjcxvtra0f375Z ~]# ulimit -n\n1048576\n"})}),"\n",(0,i.jsx)(e.h4,{id:"414-\u7b2c\u56db\u4e2a\u95ee\u9898",children:"4.1.4 \u7b2c\u56db\u4e2a\u95ee\u9898"}),"\n",(0,i.jsx)(e.p,{children:"\u4f7f\u7528 supervisor \u7ba1\u7406\u8fdb\u7a0b\uff08\u6d4b\u8bd5\u73af\u5883 Ubuntu 16.04\uff09\u542f\u52a8\u8fdb\u7a0b\u540e\uff0cmaxfile \u662f1024\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u9700\u8981\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"# cat /etc/supervisor/supervisord.conf\n[supervisord]\nlogfile=/var/log/supervisor/supervisord.log ; (main log file;default $CWD/ supervisord.log)\npidfile=/var/run/supervisord.pid ; (supervisord pidfile;default supervisord.pid)\nchildlogdir=/var/log/supervisor\t\t; ('AUTO' child log dir, default $TEMP)\n\n\u4e0b\u9762\u8fd9\u4e24\u884c\nminfds=655350\t\t; min. avail startup file descriptors;default 1024\nminprocs=65535\t; min. avail process descriptors;default 200\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0520.10.02.png",alt:"iShot2020-08-0520.10.02"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"https://www.kernel.org/doc/Documentation/sysctl/fs.txt",children:"\u5173\u4e8e file-max nr_open file_nr \u7684\u89e3\u91ca\u53ef\u53c2\u8003\u6b64\u6587\u7ae0"})}),"\n",(0,i.jsx)(e.p,{children:"\u53c2\u8003\u5916\u90e8\u6587\u6863"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"https://www.cnblogs.com/zengkefu/p/5635153.html",children:"cnblogs"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"https://blog.csdn.net/google0802/article/details/52304776",children:"csdn1"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"http://blog.cloud.360.cn/post/tuning-your-system-for-high-concurrency.html",children:"360\u4e91"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"https://blog.csdn.net/qq_38165374/article/details/104881340",children:"csdn2"})}),"\n",(0,i.jsx)(e.h3,{id:"42-\u516d\u6b65\u6392\u67e5-ss--netstat-\u7edf\u8ba1\u7ed3\u679c\u4e0d\u4e00\u6837\u7684\u539f\u56e0",children:"4.2 \u516d\u6b65\u6392\u67e5 ss & netstat \u7edf\u8ba1\u7ed3\u679c\u4e0d\u4e00\u6837\u7684\u539f\u56e0"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"ss \u7684\u7ed3\u679c\uff0cclosed \u72b6\u6001\u7684\u6709 3w \u591a"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0520.15.45.png",alt:"iShot2020-08-0520.15.45"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"netstat \u7edf\u8ba1\u53ea\u6709\u4e00\u767e\u6765\u4e2a\u8fde\u63a5"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"# netstat -n | awk '/^tcp/ {++S[$NF]} END {for(a in S) print a\uff0cS[a]}'\nESTABLISHED 9\nTIME_WAIT 79\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u901a\u8fc7 strace \u770b\u770b\u4e8c\u8005\u7684\u7edf\u8ba1\u65b9\u5f0f\u5f97\u4e0d\u540c"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:(0,i.jsx)("span",{style:{color:"red"},children:"ss \u76f4\u63a5\u53d6\u81ea /proc/net/sockstat\u3002"})})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0520.16.53.png",alt:"iShot2020-08-0520.16.53"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:(0,i.jsx)("span",{style:{color:"red"},children:"netstat \u662f\u8bfb\u53d6\u7684 /proc/pid/fd \u4e0b\u9762\u5173\u8054 tcp \u7684 socket\u3002"})})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0520.18.53.png",alt:"iShot2020-08-0520.18.53"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"netstat \u4e5f\u6709\u626b\u5230\u4e09\u4e07\u591a\u4e2a socket\uff0c \u4e3a\u4ec0\u4e48\u8f93\u51fa\u7684\u65f6\u5019\u6ca1\u6709\u5c55\u793a\u5462\uff1f"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"By default\uff0cnetstat displays a list of open sockets. If you don\u2019t specify any address families\uff0cthen the active sockets of all configured address families will be printed.\n\n\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cnetstat\u663e\u793a\u6253\u5f00\u7684\u5957\u63a5\u5b57\u5217\u8868\u3002\u5982\u679c\u4e0d\u6307\u5b9a\u4efb\u4f55\u5730\u5740\u7cfb\u5217\uff0c\u5219\u6240\u6709\u5df2\u914d\u7f6e\u5730\u5740\u7cfb\u5217\u7684\u6d3b\u52a8\u5957\u63a5\u5b57\u5c06\u88ab\u6253\u5370\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u627e\u51fa\u6765\u54ea\u4e2a pid \u7684 socket \u6bd4\u8f83\u591a\uff0c \u5bf9 /proc/pid/fd \u76ee\u5f55\u505a\u6279\u91cf\u626b\u63cf"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:'for d in /proc/[0-9]*;do pid=$(basename $d);s=$(ls -l $d/fd | egrep -i socket | wc -l 2>/dev/null); [ -n "$s" ] && echo "$s $pid";done | sort -n | tail -20\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsxs)(e.strong,{children:["\u8fdb\u5165\u5230 ",(0,i.jsx)(e.code,{children:"/proc/7136/"}),"(\u4e0a\u8ff0\u547d\u4ee4\u6253\u5370\u51fa\u7684\u76ee\u5f55) \u76ee\u5f55\u67e5\u770b cmdline \u6216\u8005\u76f4\u63a5 ps -ef |grep pid \u62ff\u5230\u8fdb\u7a0b\uff0c\u540e\u9762\u5c31\u9700\u8981\u5ba2\u6237\u81ea\u67e5\u4e86"]})}),"\n",(0,i.jsx)(e.h3,{id:"43-\u4e3a\u4ec0\u4e48\u660e\u660e\u5185\u5b58\u5f88\u5145\u8db3\u4f46\u662f-java-\u7a0b\u5e8f\u4ecd\u7533\u8bf7\u4e0d\u5230\u5185\u5b58",children:"4.3 \u4e3a\u4ec0\u4e48\u660e\u660e\u5185\u5b58\u5f88\u5145\u8db3\u4f46\u662f java \u7a0b\u5e8f\u4ecd\u7533\u8bf7\u4e0d\u5230\u5185\u5b58"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u80cc\u666f\u4fe1\u606f"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7528\u6237\u6709\u4e00\u53f0 8G \u5185\u5b58\u7684\u5b9e\u4f8b\uff0c\u5269\u4f59\u5185\u5b58\u8fd8\u5f88\u591a\uff087G \u5de6\u53f3\uff09\uff0c\u800c java \u7a0b\u5e8f\u4f7f\u7528\u4e86 4G \u5185 \u5b58\u7533\u8bf7\uff0c\u76f4\u63a5\u629b\u51fa OOM\u3002"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6392\u67e5\u5982\u4e0b"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0520.23.37.png",alt:"iShot2020-08-0520.23.37"})}),"\n",(0,i.jsx)(e.p,{children:"oom \u7684\u8bb0\u5f55\u663e\u793a\u4e3a\u7533\u8bf7 4g \u5185\u5b58\u5931\u8d25\u3002"}),"\n",(0,i.jsx)(e.p,{children:"4294967296 /1024 /1024 = 4096 M"}),"\n",(0,i.jsxs)(e.p,{children:["1.\u7b2c\u4e00\u53cd\u5e94\u662f\u60f3\u8d77\u6765\u4e4b\u524d\u7684 ",(0,i.jsx)(e.code,{children:"vm.min_free_kbytes & nr_hugepage"})," \u5bfc\u81f4\u7684 free \u5927\u4e8e available \u6848\u4f8b\u6709\u5173\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"centos7 memavailable \u5c0f\u4e8e memfree\n\u4e8c\u8005\u7684\u7edf\u8ba1\u65b9\u5f0f\u4e0d\u4e00\u6837\n\nMemFree: The sum of LowFree+HighFree\n\n+MemAvailable: An estimate of how much memory is available for starting new\n+\t\tapplications\uff0cwithout swapping. Calculated from MemFree,\n+\t\tSReclaimable\uff0cthe size of the file LRU lists\uff0cand the low\n+\t\twatermarks in each zone.\n+\t\tThe estimate takes into account that the system needs some\n+\t\tpage cache to function well\uff0cand that not all reclaimable\n+\t\tslab will be reclaimable\uff0cdue to items being in use. The\n+\t\timpact of those factors will vary from system to system.\nhttps://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/ commit/?id=34e431b0ae398fc54ea69ff85ec700722c9da773\n\nmemfree \u7edf\u8ba1\u7684\u662f\u6240\u6709\u5185\u5b58\u7684 free \u5185\u5b58\uff0c\u800c memavailable \u7edf\u8ba1\u7684\u662f\u53ef\u4ee5\u62ff\u6765\u7ed9\u7a0b\u5e8f\u7528\u7684\u5185\u5b58\uff0c\u800c\u5ba2\u6237\u8bbe\u7f6e\u4e86 vm.min_free_kbytes\uff082.5G\uff09\uff0c\u8fd9\u4e2a\u5185\u5b58\u5728 free \u7edf\u8ba1\uff0c\u4f46\u662f\u4e0d\u5728 memavailable \u7edf\u8ba1\n\nnr_hugepage \u4e5f\u4f1a\u6709\u8fd9\u4e2a\u95ee\u9898\n"})}),"\n",(0,i.jsxs)(e.p,{children:["2.\u8ddf\u5ba2\u6237\u8981 ",(0,i.jsx)(e.code,{children:"free -m && sysctl -p && /proc/meminfo"})," \u7b49\u4fe1\u606f\u5206\u6790\u95ee\u9898\u3002"]}),"\n",(0,i.jsx)(e.p,{children:"HugePages_Total \u4e3a 0 \u8bf4\u660e\u6ca1\u6709\u8bbe\u7f6e nr_hugepage\u3002"}),"\n",(0,i.jsx)(e.p,{children:"MemAvailable: 7418172 kB \u8bf4\u660e\u8fd9\u4e48\u591a\u5185\u5b58\u53ef\u7528\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0520.26.48.png",alt:"iShot2020-08-0520.26.48"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"# sysctl -p\nnet.ipv4.ip_forward = 0\nnet.ipv4.conf.default.accept_source_route = 0\nkernel.sysrq = 1\nkernel.core_uses_pid = 1\nnet.ipv4.tcp_syncookies = 1\nkernel.msgmnb = 65536\nkernel.msgmax = 65536\nkernel.shmmax = 500000000\nkernel.shmmni = 4096\nkernel.shmall = 4000000000\nkernel.sem = 250 512000 100 2048\nnet.ipv4.tcp_tw_recycle=1\nnet.ipv4.tcp_max_syn_backlog=4096\nnet.core.netdev_max_backlog=10000\nvm.overcommit_memory=2\nnet.ipv4.conf.all.arp_filter = 1\nnet.ipv4.ip_local_port_range=1025 65535\nkernel.msgmni = 2048\nnet.ipv6.conf.all.disable_ipv6=1\nnet.ipv4.tcp_max_tw_buckets = 5000\nnet.ipv4.tcp_max_syn_backlog = 8192\nnet.ipv4.tcp_keepalive_time = 600\n\n#cat /proc/meminfo\nMemTotal:\t\t8009416 kB\nMemFree:\t\t7347684 kB\nMemAvailable:\t\t7418172 kB\nBuffers:\t\t18924 kB\nCached:\t\t262836 kB\nSwapCached:\t\t0 kB\nActive:\t\t315188 kB\nInactive:\t\t222364 kB\nActive(anon):\t\t256120 kB\nInactive(anon):\t\t552 kB\nActive(file):\t\t59068 kB\nInactive(file):\t\t221812 kB\nUnevictable:\t\t0 kB\nMlocked:\t\t0 kB\nSwapTotal:\t\t0 kB\nSwapFree:\t\t0 kB\nDirty:\t\t176 kB\nWriteback:\t\t0 kB\nAnonPages:\t\t255804 kB\nMapped:\t\t85380 kB\nShmem:\t\t880 kB\nSlab:\t\t40660 kB\nSReclaimable:\t\t22240 kB\nSUnreclaim:\t\t18420 kB\nKernelStack:\t\t4464 kB\nPageTables:\t\t6512 kB\nNFS_Unstable:\t\t0 kB\t\t\nBounce:\t\t0 kB\nWritebackTmp:\t\t0 kB\nCommitLimit:\t\t4004708 kB\nCommitted_AS:\t\t2061568 kB\nVmallocTotal:\t\t34359738367 kB\nVmallocUsed:\t\t21452 kB\nVmallocChunk:\t\t34359707388 kB\nHardwareCorrupted:\t\t0 kB\nAnonHugePages:\t\t126976 kB\nCmaTotal:\t\t0 kB\nCmaFree:\t\t0 kB\nHugePages_Total:\t\t0\nHugePages_Free:\t\t0\nHugePages_Rsvd:\t\t0\nHugePages_Surp:\t\t0\nHugepagesize:\t\t2048 kB\nDirectMap4k:\t\t114560 kB\nDirectMap2M:\t\t4079616 kB\nDirectMap1G:\t\t6291456 kB\n"})}),"\n",(0,i.jsx)(e.p,{children:"3.\u5b9e\u9645\u4e0a\u9762\u7684 meminfo \u5df2\u7ecf\u8bf4\u660e\u4e86\u95ee\u9898\uff0c\u4f46\u662f\u7531\u4e8e\u7ecf\u9a8c\u4e0d\u8db3\uff0c\u4e00\u65f6\u6ca1\u6709\u770b\u660e\u767d\u600e\u4e48\u56de\u4e8b\uff0c\u5c1d\u8bd5\u81ea\u884c\u6d4b\u8bd5\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u4f7f\u7528 java \u547d\u4ee4\uff0c\u53bb\u7533\u8bf7\u8d85\u51fa\u6211\u7684\u6d4b\u8bd5\u673a\u7269\u7406\u5185\u5b58\u5c1d\u8bd5\uff0c\u62ff\u5230\u62a5\u9519\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:'[root@test ~]# java -Xmx8192M -version\nopenjdk version "1.8.0_242"\nOpenJDK Runtime Environment (build 1.8.0_242-b08)\nOpenJDK 64-Bit Server VM (build 25.242-b08\uff0cmixed mode)\n[root@test ~]# java -Xms8192M -version\nOpenJDK 64-Bit Server VM warning: INFO: os::commit_ memory(0x00000005c0000000\uff0c5726797824\uff0c0) failed; error=\'Cannot allocate memory\' (errno=12)\n#\n# There is insufficient memory for the Java Runtime Environment to continue.\n# Native memory allocation (mmap) failed to map 5726797824 bytes for committing reserved memory.\n# An error report file with more information is saved as:\n# /root/hs_err_pid8769.log\n[root@test ~]# java -Xms4096M -version\nopenjdk version "1.8.0_242"\nOpenJDK Runtime Environment (build 1.8.0_242-b08)\nOpenJDK 64-Bit Server VM (build 25.242-b08\uff0cmixed mode)\n[root@test ~]# java -Xms5000M -version\nOpenJDK 64-Bit Server VM warning: INFO: os::commit_ memory(0x0000000687800000\uff0c3495428096\uff0c0) failed; error=\'Cannot allocate memory\' (errno=12)\n......\n--------------- S Y S T E M\n---------------\nOS:CentOS Linux release 7.4.1708 (Core)\nuname:Linux 3.10.0-693.2.2.el7.x86_64 #1 SMP Tue Sep 12 22:26:13 UTC 2017 x86_64\nlibc:glibc 2.17 NPTL 2.17\nrlimit: STACK 8192k\uff0cCORE 0k\uff0cNPROC 15088\uff0cNOFILE 65535\uff0cAS infinity\nload average:0.05 0.05 0.05\n/proc/meminfo:\nMemTotal:\t\t3881692 kB\nMemFree:\t\t2567724 kB\nMemAvailable:\t\t2968640 kB\nBuffers:\t\t69016 kB\nCached:\t\t536116 kB\nSwapCached:\t\t0 kB\nActive:\t\t355280 kB\nInactive:\t\t326020 kB\nActive(anon):\t\t87864 kB\nInactive(anon):\t\t13296 kB\nActive(file):\t\t267416 kB\nInactive(file):\t\t312724 kB\nUnevictable:\t\t0 kB\nMlocked:\t\t0 kB\nSwapTotal:\t\t0 kB\nSwapFree:\t\t0 kB\nDirty:\t\t72 kB\nWriteback:\t\t0 kB\nAnonPages:\t\t72200 kB\nMapped:\t\t31232 kB\nShmem:\t\t24996 kB\nSlab:\t\t63032 kB\nSReclaimable:\t\t51080 kB\nSUnreclaim:\t\t11952 kB\nKernelStack:\t\t1664 kB\nPageTables:\t\t4044 kB\nNFS_Unstable:\t\t0 kB\nBounce:\t\t0 kB\nWritebackTmp:\t\t0 kB\nCommitLimit:\t\t1678700 kB\nCommitted_AS:\t\t2282236 kB\nVmallocTotal:\t\t34359738367 kB\nVmallocUsed:\t\t14280 kB\nVmallocChunk:\t\t34359715580 kB\nHardwareCorrupted:\t\t0 kB\nAnonHugePages:\t\t30720 kB\nHugePages_Total:\t\t256\nHugePages_Free:\t\t256\nHugePages_Rsvd:\t\t0\nHugePages_Surp:\t\t0\nHugepagesize:\t\t2048 kB\nDirectMap4k:\t\t57216 kB\nDirectMap2M:\t\t3088384 kB\nDirectMap1G:\t\t3145728 kB\ncontainer (cgroup) information:\ncontainer_type: cgroupv1\ncpu_cpuset_cpus: 0-1\ncpu_memory_nodes: 0\nactive_processor_count: 2\ncpu_quota: -1\ncpu_period: 100000\ncpu_shares: -1\nmemory_limit_in_bytes: -1\nmemory_and_swap_limit_in_bytes: -1\nmemory_soft_limit_in_bytes: -1\nmemory_usage_in_bytes: 697741312\nmemory_max_usage_in_bytes: 0\nCPU:total 2 (initial active 2) (1 cores per cpu\uff0c2 threads per core) family 6 model 79 stepping 1\uff0ccmov\uff0ccx8\uff0cfxsr\uff0cmmx\uff0csse\uff0csse2\uff0csse3\uff0cssse3\uff0csse4.1\uff0c sse4.2\uff0cpopcnt\uff0cavx\uff0cavx2\n\uff0caes\uff0cclmul\uff0cerms\uff0crtm\uff0c3dnowpref\uff0clzcnt\uff0cht\uff0ctsc\uff0cbmi1\uff0cbmi2\uff0cadx\n/proc/cpuinfo:\nprocessor\t\t: 0\nvendor_id\t\t: GenuineIntel\ncpu family\t\t: 6\nmodel\t\t: 79\nmodel name\t\t: Intel(R) Xeon(R) CPU E5-2682 v4 @ 2.50GHz\nstepping\t\t: 1\nmicrocode\t\t: 0x1\ncpu MHz\t\t: 2500.036\ncache size\t\t: 40960 KB\nphysical id : 0\nsiblings\t\t: 2\ncore id\t\t: 0\ncpu cores\t\t: 1\napicid\t\t: 0\ninitial apicid\t\t: 0\nfpu\t\t: yes\nfpu_exception\t\t: yes\ncpuid level : 13\nwp\t\t: yes\nflags : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl\neagerfpu pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch fsgsbase tsc_adjust\nbmi1 hle avx2 smep bmi2 erms invpcid rtm rdseed adx smap xsaveopt\nbogomips\t\t: 5000.07\nclflush size\t\t: 64\ncache_alignment : 64\naddress sizes\t\t: 46 bits physical\uff0c48 bits virtual\npower management:\nprocessor\t\t: 1\nvendor_id\t\t: GenuineIntel\ncpu family\t\t: 6\nmodel\t\t: 79\nmodel name\t\t: Intel(R) Xeon(R) CPU E5-2682 v4 @ 2.50GHz\nstepping\t\t: 1\nmicrocode\t\t: 0x1\ncpu MHz\t\t: 2500.036\ncache size\t\t: 40960 KB\nphysical id : 0\nsiblings\t\t: 2\ncore id\t\t: 0\ncpu cores\t\t: 1\napicid\t\t: 1\ninitial apicid\t\t: 1\nfpu\t\t: yes\nfpu_exception\t\t: yes\ncpuid level : 13\nwp\t\t: yes\nflags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov\npat pse36 clflush mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl\neagerfpu pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch fsgsbase tsc_adjust\nbmi1 hle avx2 smep bmi2 erms invpcid rtm rdseed adx smap xsaveopt\nbogomips\t\t: 5000.07\nclflush size\t\t: 64\ncache_alignment : 64\naddress sizes\t\t: 46 bits physical\uff0c48 bits virtual\npower management:\nMemory: 4k page\uff0cphysical 3881692k(2567600k free), swap 0k(0k free)\nvm_info: OpenJDK 64-Bit Server VM (25.242-b08) for linux-amd64 JRE (1.8.0_242-b08)\uff0cbuilt on Jan 28 2020 14:28:22 by "mockbuild" with gcc 4.8.5 20150623 (Red Hat 4.8.5-39)\ntime: Thu Feb 20 15:13:30 2020\ntimezone: CST\nelapsed time: 0 seconds (0d 0h 0m 0s)\n'})}),"\n",(0,i.jsx)(e.p,{children:"4.java \u6d4b\u8bd5\u8bc1\u660e\u6b63\u5e38\u7533\u8bf7\u5185\u5b58\u4e0d\u4f1a\u6709\u95ee\u9898\uff0c\u8d85\u989d\u7684\u5185\u5b58\u624d\u4f1a oom\uff0c\u90a3\u4e48\u4e3a\u4ec0\u4e48\u8d85\u989d\u5462\uff0c\u89c6\u7ebf\u56de\u5f52\u5230 sysctl -p \u6709\u6240\u53d1\u73b0\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0520.39.33.png",alt:"iShot2020-08-0520.39.33"})}),"\n",(0,i.jsx)(e.p,{children:"5.\u4e24\u76f8\u5bf9\u7167\uff0c\u8bf4\u660e\u5ba2\u6237\u8bbe\u7f6e\u7684 vm.overcommit_memory \u5728\u751f\u6548\uff0c \u5efa\u8bae\u6539\u56de 0 \u518d\u8bd5\u8bd5\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0520.40.16.png",alt:"iShot2020-08-0520.40.16"})}),"\n",(0,i.jsx)(e.h3,{id:"44-\u8bf7\u4e0d\u8981\u5ffd\u7565-min_free_kbytes-\u7684\u8bbe\u7f6e",children:"4.4 \u8bf7\u4e0d\u8981\u5ffd\u7565 min_free_kbytes \u7684\u8bbe\u7f6e"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u95ee\u9898\u80cc\u666f"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u670d\u52a1\u5668\u5185\u4e3b\u8981\u8fd0\u884c\u7a0b\u5e8f\uff1aJadeos\u3002"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u95ee\u9898\u63cf\u8ff0"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"LINUX tmpfs \u7a7a\u95f4\u4f7f\u7528\u672a\u8fbe\u5230 100%\uff0c\u5185\u5b58\u4e5f\u672a\u5360\u6ee1\u3002 \u6267\u884c\u4efb\u4f55\u547d\u4ee4\u63d0\u793a bash: fork: Cannot allocate memory \u8fc7\u51e0\u79d2\u65f6\u95f4\u7cfb\u7edf\u4f1a\u81ea\u52a8\u91cd\u542f\u3002 \u4f46\u5728\u5ba2\u6237\u672c\u5730\u73af\u5883\u662f\u6ca1\u6709\u8fd9\u79cd\u60c5\u51b5\u7684\uff0c\u5373\u4f7f tmpfs \u4f7f\u7528\u8fbe\u5230 100% \u7cfb\u7edf\u672a\u63d0\u793a Cannot allocate memory\u3002"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0520.42.24.png",alt:"iShot2020-08-0520.42.24"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5904\u7406\u8fc7\u7a0b"})}),"\n",(0,i.jsx)(e.p,{children:"1.\u9996\u5148\u5224\u65ad\u5ba2\u6237\u662f\u5426\u5185\u5b58\u4e0d\u8db3\u5bfc\u81f4\uff0c\u6bcf\u6b21\u6267\u884c\u6d4b\u8bd5\u64cd\u4f5c\u540e\uff0cfree \u7ed3\u679c\u663e\u793a\u53ef\u7528\u5185\u5b58\u662f\u6709\u7684\u3002"}),"\n",(0,i.jsx)(e.p,{children:"2.\u5f53\u8fdb\u7a0b Process \u6bd4\u8f83\u591a\uff0c \u5bfc\u81f4\u65e0\u6cd5\u5206\u914d pid\uff0c \u4e5f\u4f1a\u63d0\u793a Cannot allocate memory\uff0c\u6267\u884c\u547d\u4ee4 pstree -a | wc -l \u7edf\u8ba1\u4e0b\u8fdb\u7a0b\u6570\uff0c\u6392\u9664\u8fdb\u7a0b\u6570\u8fc7\u591a\u5bfc\u81f4\u7684\u5185\u5b58\u65e0\u6cd5\u5206\u914d\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0520.43.42.png",alt:"iShot2020-08-0520.43.42"})}),"\n",(0,i.jsx)(e.p,{children:"3.\u767b\u5f55\u4e3b\u673a\u5185\u90e8\u67e5\u770b\u5ba2\u6237\u5ba2\u6237\u5185\u90e8\u8bbe\u7f6e min_free_kbytes \u503c\u4e3a 1G\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u5373\u5f3a\u5236 Linux \u7cfb\u7edf\u6700\u4f4e\u4fdd\u7559\u591a\u5c11\u7a7a\u95f2\u5185\u5b58\uff08Kbytes\uff09\uff0c\u5982\u679c\u7cfb\u7edf\u53ef\u7528\u5185\u5b58\u4f4e\u4e8e\u8be5\u503c\uff0c\u9ed8\u8ba4\u4f1a\u542f\u7528 oom killer \u6216\u8005\u5f3a\u5236\u91cd\u542f\u3002"}),"\n",(0,i.jsxs)(e.p,{children:["\u5f53\u8017\u5c3d\u5185\u5b58\u76f4\u81f3\u7cfb\u7edf\u6700\u4f4e\u4fdd\u5b58\u5185\u5b58\u65f6\u4f1a\u6709\u4e24\u79cd\u73b0\u8c61\uff0c \u6839\u636e\u5185\u6838\u53c2\u6570 ",(0,i.jsx)(e.code,{children:"vm.panic_ on_oom"})," \u8bbe\u7f6e\u503c\u7684\u4e0d\u540c\u800c\u6709\u4e0d\u540c\u7684\u884c\u4e3a\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"vm.panic_on_oom=0"})," \u7cfb\u7edf\u4f1a\u63d0\u793a oom \uff0c\u5e76\u542f\u52a8 oom-killer \u6740\u6389\u5360\u7528\u6700\u9ad8\u5185\u5b58\u7684\u8fdb\u7a0b\u3002 ",(0,i.jsx)(e.code,{children:"vm.panic_on_oom =1"}),". \u7cfb\u7edf\u5173\u95ed oom, \u4e0d\u4f1a\u542f\u52a8 oom-killer\uff0c\u800c\u662f\u4f1a\u81ea\u52a8\u91cd\u542f\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0520.44.52.png",alt:"iShot2020-08-0520.44.52"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u5efa\u8bae\u5ba2\u6237\u964d\u4f4e ",(0,i.jsx)(e.code,{children:"min_free_kbytes"})," \u503c\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:["\u66f4\u6539\u51cf\u5c0f ",(0,i.jsx)(e.code,{children:"min_free_kbytes"})," \u540e\uff0c\u518d\u6267\u884c\u66f4\u591a\u6b21\u7684\u62f7\u8d1d\uff0c\u6700\u540e\u4e00\u6b21 free \u53ef\u7528\u5185\u5b58\u663e\u793a\u89e3\u51b3\u5230\u8bbe\u7f6e\u503c\u662f\uff0c\u624d\u63d0\u793a\u5185\u5b58\u4e0d\u8db3\u3002 \u8fd9\u4e2a\u662f\u7b26\u5408 linux \u7cfb\u7edf\u5bf9\u5185\u5b58\u7ba1\u7406\u7684\u9884\u671f\u7684\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"5\u6700\u540e\u7684\u5f69\u86cb",children:"5.\u6700\u540e\u7684\u5f69\u86cb"}),"\n",(0,i.jsx)(e.h3,{id:"\u67d0\u5730\u533a\u53e3\u7f69\u9879\u76ee\u67b6\u6784\u6f14\u8fdb\u53ca\u4f18\u5316\u7ecf\u9a8c",children:"\u67d0\u5730\u533a\u53e3\u7f69\u9879\u76ee\u67b6\u6784\u6f14\u8fdb\u53ca\u4f18\u5316\u7ecf\u9a8c"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7b80\u4ecb"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u75ab\u60c5\u521d\u671f\u67d0\u5730\u653f\u5e9c\u51b3\u5b9a\u53d1\u653e\u4e00\u6279\u514d\u8d39\u53e3\u7f69\u9762\u5411\u8be5\u5e02\u5e02\u6c11\uff0c\u8be5\u5e02\u5e02\u6c11\u5747\u53ef\u514d\u8d39\u9884\u7ea6\u9886\u53d6\uff0c\u9884\u7ea6\u65f6\u95f4\u4e3a\u65e9\u4e0a 9\u70b9 -12\u70b9\uff0c\u56e0\u6b64\u8be5\u573a\u666f\u4e3a\u9650\u65f6\u62a2\u8d2d\u7c7b\u578b\u573a\u666f\uff0c \u4f1a\u9762\u4e34\u975e\u5e38\u5927\u7684\u5b9a\u65f6\u8d85\u5927\u6d41\u91cf\u8d85\u5927\u5e76\u53d1\u95ee\u9898\uff0c\u5728\u8be5\u9879\u76ee\u7684\u843d\u5730\u8fc7\u7a0b\u4e2d\uff0c\u6d89\u53ca\u7684\u67b6\u6784\u6f14\u53d8\uff0c\u505a\u4e86\u4e00\u4e9b\u8bb0\u5f55\u548c\u601d\u8003\u3002"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u539f\u59cb\u67b6\u6784\u56fe\u793a & \u5206\u6790\uff082\u67082\u53f7\u665a\u4e0a 22 \u70b9\u5de6\u53f3\u7684\u539f\u59cb\u67b6\u6784\uff09\u3002"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0520.48.57.png",alt:"iShot2020-08-0520.48.57"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u5ba2\u6237\u7aef\u8d70 https \u534f\u8bae\u76f4\u63a5\u8bbf\u95ee ecs\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"ECS \u4e0a\u4f7f\u7528 nginx \u81ea\u5efa https \u76d1\u542c\u3002-"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Nginx \u53cd\u4ee3 tomcat\uff0cNginx \u5904\u7406\u9759\u6001\u6587\u4ef6\uff0ctomcat \u5904\u7406\u52a8\u6001\u8bf7\u6c42\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u7a0b\u5e8f\u5148\u53bb redis \u67e5\u7f13\u5b58\uff0c \u5982\u672a\u547d\u4e2d\u5219\u53bb\u6570\u636e\u5e93\u67e5\u8be2\u6570\u636e\uff0c \u540c\u65f6 redis \u4e0e mysql \u4e4b\u95f4\u7684\u6570\u636e\u540c\u6b65\u9760\u7a0b\u5e8f\u63a7\u5236\u3002"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4f18\u70b9\uff1a\u6613\u7ba1\u7406\uff0c\u6613\u90e8\u7f72\u3002"}),"\n",(0,i.jsx)(e.li,{children:"\u7f3a\u70b9\uff1a\u6027\u80fd\u5dee\uff0c\u65e0\u6269\u5c55\u6027\uff0c\u5b58\u5728\u5355\u70b9\u98ce\u9669\u3002 \u4e8b\u5b9e\u8bc1\u660e\uff1a\u8be5\u5e94\u7528\u4e00\u7ecf\u4e0a\u7ebf\u7acb\u523b\u88ab\u6253\u6302\u4e86\uff08\u672a\u77e5\u539f\u56e0\u9884\u7ea6\u9875\u9762\u6cc4\u9732\uff0c\u5bfc\u81f4\u8fd8\u672a\u5230\u9884\u7ea6\u65f6\u95f4\u5373\u88ab\u6253\u6302\uff09\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6211\u65b9\u4ecb\u5165\u540e\u7684\u4e8c\u4ee3\u67b6\u6784\uff0824\u70b9\u5de6\u53f3\u627e\u7684\u6211\u4eec\uff0c\u65e9\u4e0a9\u70b9\u8981\u5f00\u670d\uff0c\u65f6\u95f4\u592a\u7d27\uff0c\u4efb\u52a1\u592a\u91cd\uff0c \u7a0b\u5e8f\u4e0d\u80fd\u52a8\u7684\u60c5\u51b5\u4e0b\uff0c\u51e0\u5341\u4e07\u7684\u5e76\u53d1\u67b6\u6784\u5982\u4f55\u505a\uff1f 2\u67083\u53f7\u65e9\u4e0a9\u70b9\u5de6\u53f3\u7684\u67b6\u6784\uff0c4\u53f7\u4e5f\u6062\u590d\u4e86\u8fd9\u4e2a\u67b6\u6784\uff09\u3002"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0520.51.16.png",alt:"iShot2020-08-0520.51.16"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u63a5\u5165 slb\uff0c\u901a\u8fc7\u955c\u50cf\u6a2a\u5411\u6269\u5c55\u8d1f\u8f7d\u80fd\u529b\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u63a5\u5165\u8bfb\u5199\u5206\u79bb\u6570\u636e\u5e93\u67b6\u6784\uff0c \u901a\u8fc7\u963f\u91cc\u4e91\u6570\u636e\u5e93\u81ea\u52a8\u8fdb\u884c\u8bfb\u5199\u5206\u79bb\uff0c \u81ea\u52a8\u540c\u6b65\u6570\u636e\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u8c03\u6574 nginx \u534f\u8bae\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u540c\u67b6\u6784\u5907\u96c6\u7fa4\u542f\u7528\uff08\u57df\u540d\u89e3\u6790\u505a\u4e86\u4e24\u4e2a A \u8bb0\u5f55\uff09\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u5206\u6790\u8bbf\u95ee\u65e5\u5fd7\u53d1\u73b0\u5931\u8d25\u539f\u56e0\u5728\u83b7\u53d6\u77ed\u4fe1 & \u767b\u9646\u521d\u59cb\u5316 cookie \u7684\u70b9\u4e0a\u3002"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4f18\u70b9\uff1a\u589e\u52a0\u4e86\u9ad8\u53ef\u7528\u6027\uff0c\u6269\u5c55\u4e86\u8d1f\u8f7d\u80fd\u529b\u3002"}),"\n",(0,i.jsx)(e.li,{children:"\u7f3a\u70b9\uff1a\u5bf9\u6d41\u91cf\u9884\u4f30\u4e0d\u8db3\uff0c \u9759\u6001\u9875\u9762\u4e5f\u5728 ECS \u4e0a\uff0c \u56e0\u6b64 SLB \u7684\u51fa\u5e26\u5bbd\u4e00\u5ea6\u8fbe\u5230\u6700\u5927\u503c 5.xG\uff0c\u5e76\u53d1\u9ad8\u8fbe 22w+\uff0c\u7528\u6237\u4e00\u5ea6\u6253\u4e0d\u5f00\u9875\u9762\uff0c\u540c\u65f6\u7531\u4e8e\u65b0\u7f51\u7684\u9650\u5236\u5ba2\u6237\u65e0\u6cd5\u81ea\u52a9\u6dfb\u52a0\u89e3\u6790\uff0c \u5f53\u665a\u8054\u7cfb\u4e0d\u5230\u65b0\u7f51\u5ba2\u670d\u5bfc\u81f4 CDN \u65b9\u6848\u6401\u6d45\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u77e5\u803b\u800c\u540e\u52c7\u7684\u7b2c\u4e09\u4ee3\u67b6\u6784\uff082\u67084\u53f7 & 2\u67085\u53f7\u7684\u67b6\u6784\uff0c5\u53f7\u5e94\u7528\uff09\u3002"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0520.53.38.png",alt:"iShot2020-08-0520.53.38"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u63a5\u5165 CDN \u5206\u6d41\u8d85\u5927\u5e26\u5bbd\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u53d6\u6d88 nginx \u7684\u4ee3\u7406\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u505a\u4e86\u65b0\u7a0b\u5e8f\u65e0\u6cd5\u51c6\u65f6\u4e0a\u7ebf\u7684\u707e\u5907\u5207\u6362\u65b9\u6848\uff08\u6ca1\u60f3\u5230\u8fd8\u771f\u7528\u5230\u4e86\uff09\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u4f7f\u7528\u865a\u62df\u670d\u52a1\u5668\u7ec4\u505a\u65b0\u8001\u7a0b\u5e8f\u7684\u5207\u6362\uff0c\u4f46\u662f\u7f3a\u70b9\u662f\u4e00\u4e2a\u4e03\u5c42\u76d1\u542c\u7684 slb \u540e\u7aef\u53ea\u80fd\u6302 200 \u4e2a\u673a\u5668\uff0c\u518d\u591a slb \u4e5f\u625b\u4e0d\u4f4f\u4e86\uff0c\u5bfc\u81f4\u8001\u7a0b\u5e8f\u521a\u627f\u63a5\u7684\u65f6\u5019\u518d\u5ea6\u6302\u6389\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"5\u53f7\u4f7f\u7528\u8fd9\u4e2a\u67b6\u6784\u4e0a\u7ebf\uff0c7\u5206\u949f\u5e93\u5b58\u552e\u7f44\uff0c\u4e14\u4f53\u9a8c\u6781\u5ea6\u6d41\u7a0b\uff0c\u4e1d\u822c\u987a\u6ed1\uff0c\u5065\u5eb7\u540c\u5b66\u5f00\u53d1\u7684\u65b0\u7a0b\u5e8f\u771f\u662f\u592a\u723d\u7684\u3002"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4f18\u70b9\uff1aCDN \u8d1f\u62c5\u9759\u6001\u8d44\u6e90\u7684\u6d41\u91cf\u964d\u4f4e\u4e86 SLB \u7684\u51fa\u5e26\u5bbd\uff0c\u538b\u6d4b\u7684\u6548\u679c\u4e5f\u975e\u5e38\u7406\u60f3\u3002"}),"\n",(0,i.jsx)(e.li,{children:"\u7f3a\u70b9\uff1a\u9700\u8981\u591a\u4e00\u4e2a\u72ec\u7acb\u7684\u57df\u540d\u5728\u9875\u9762\u91cc\u9762\uff0c\u6d89\u53ca\u8de8\u57df\uff0c4\u53f7\u4e34\u5f00\u670d\u4e4b\u9645\u6d4b\u8bd5\u53d1\u73b0\u5165\u5e93 & \u9884\u7ea6\u77ed\u4fe1\u4e71\u7801\u8fd4\u56de\uff0c\u7d27\u6025\u5207\u6362\u56de\u4e86\u8001\u7a0b\u5e8f\uff0c\u5373\u4e8c\u4ee3\u67b6\u6784\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7406\u60f3\u67b6\u6784"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-10-14%2015.17.59.png",alt:"iShot2020-10-14 15.17.59"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u4e3b\u57df\u540d\u63a5\u5165 CDN\uff0c"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"CDN \u901a\u8fc7\u8bbe\u7f6e\u56de\u6e90 http\u3001https \u534f\u8bae\u53bb\u8bbf\u95ee SLB \u7684\u4e0d\u540c\u76d1\u542c\u5b9e\u73b0\u65b0\u8001\u7a0b\u5e8f\u4e4b\u95f4\u7684\u5207\u6362\uff0c\u5177\u4f53\u5b9e\u73b0\u4e3a\u56de\u6e90\u534f\u8bae\u5bf9\u5e94\u3002\u4e0d\u540c\u76d1\u542c\uff0c\u76d1\u542c\u5bf9\u5e94\u4e0d\u540c\u7684\u7a0b\u5e8f\u3002"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4f18\u70b9\uff1a\u9759\u6001\u52a0\u901f\u964d\u4f4e SLB \u5e26\u5bbd\uff0c\u52a8\u6001\u56de\u6e90\uff0c\u65e0\u8de8\u57df\u95ee\u9898 \uff0c\u5207\u6362\u65b9\u4fbf\u3002"}),"\n",(0,i.jsx)(e.li,{children:"\u7f3a\u70b9\uff1a\u4ecd\u9700\u624b\u5de5\u8bbe\u7f6e\uff0c\u955c\u50cf\u90e8\u7f72 ecs \u4e0d\u65b9\u4fbf\uff0c\u5982\u679c\u65f6\u95f4\u5145\u8db3\uff0c\u53ef\u4ee5\u76f4\u63a5\u4e0a\u5bb9\u5668\u7684\u67b6\u6784\u8be5\u6709\u591a\u7f8e\u597d\u5462\uff0c\u4e00\u4e2a scale \u53ef\u4ee5\u6269\u51fa\u6765\u51e0\u5341\u4e0a\u767e\u7684 pod\uff0c\u4e5f\u53ef\u4ee5\u505a\u8282\u70b9\u81ea\u52a8\u6269\u5bb9\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u603b\u7ed3"})}),"\n",(0,i.jsx)(e.p,{children:"\u603b\u7ed3\uff1a\u65f6\u95f4\u7d27\u4efb\u52a1\u91cd\uff0c\u9047\u5230\u4e86 N \u591a\u7684\u5751\uff0c\u60f3\u8d77\u6765\u4e00\u4e2a\u8865\u4e00\u4e2a ~"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"vcpu \u8d2d\u4e70\u989d\u5ea6\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"slb \u540e\u7aef\u6302\u8f7d\u989d\u5ea6\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u5ba2\u6237\u4f59\u989d\u4e0d\u8db3\u6b20\u8d39\u505c\u673a\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u65b0\u7f51\u89e3\u6790\u9700\u8981\u8054\u7cfb\u5ba2\u670d\u6dfb\u52a0\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u7b2c\u4e00\u6b21\u8003\u8651 CDN \u67b6\u6784\u7684\u65f6\u5019\u672a\u8003\u8651\u8de8\u57df\u95ee\u9898\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u65b0\u7a0b\u5e8f\u5f00\u53d1\u671f\u95f4\u672a\u8fde\u63a5\u4e3b\u5e93\u6d4b\u8bd5\uff0c\u5bfc\u81f4\u4e0a\u7ebf\u5931\u8d25\uff08\u4e3b\u5e93\u4e71\u7801\uff09\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u7b2c\u4e00\u6b21\uff083 \u53f7\uff09\u88ab\u6253\u6302\u7684\u65f6\u5019\u53ea\u5173\u6ce8\u4e86 slb \u7684\u6d41\u91cf\uff0c\u672a\u8be6\u7ec6\u5206\u6790\u5931\u8d25\u6700\u591a\u7684\u73af\u8282\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u4e0a\u7ebf\u524d\u538b\u6d4b\u7f3a\u5931\uff0c\u7eaf\u9760\u4eba\u5de5\u6d4b\u8bd5\u529f\u80fd\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u538b\u6d4b\u9760\u4eba\u624b\u4e00\u53f0 jmeter\uff084\u53f7\u665a\u4e0a\u52305\u53f7\u65e9\u4e0a\u5f15\u5165\u4e86PTS\u8fdb\u884c\u538b\u6d4b\uff09\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u7a81\u7136\u60f3\u8d77\u6765\u5ba2\u6237\u539f\u59cb\u7684\u7a0b\u5e8f\u662f\u653e\u5728 windows \u4e0a\u7684\uff0c\u5bfc\u81f4\u6027\u80fd\u51fa\u73b0\u4e86\u5927\u5927\u7684\u6298\u6263\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u6700\u540e\u7684\u6210\u679c\u7edf\u8ba1\uff08\u91c7\u6837\u5206\u6790\uff0c\u5b9e\u9645\u6570\u636e\u6bd4\u8fd9\u4e2a\u8fd8\u5927\uff09\uff1a"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-08-0520.57.36.png",alt:"iShot2020-08-0520.57.36"})}),"\n",(0,i.jsx)(e.p,{children:"\u6700\u540e\u4e0a\u7ebf\u7684\u4e09\u4ee3\u67b6\u6784\uff0c\u4e3a\u4e86\u4fdd\u9669\u8d77\u89c1\u4e0a\u4e86 150 \u53f0\u673a\u5668\uff0c\u4f46\u662f\u6839\u636e\u6d3b\u52a8\u671f\u95f4\u7684\u89c2\u5bdf\uff0c\u4ee5\u53ca\u5bf9\u538b\u6d4b\u7ed3\u679c\u7684\u8bc4\u4f30\uff0c\u4e0a50\u53f0\u673a\u5668\u5e94\u8be5\u5c31\u53ef\u4ee5\u6297\u4f4f\u4e86\uff0c\u4ece\u6301\u7eed5\u5c0f\u65f6\u4e00\u76f4\u5d29\u6e83\u88ab\u7ec8\u7aef\u7528\u6237\u9a82\u8857\uff0c\u52307\u5206\u949f\u5e93\u5b58\u552e\u7f44\u7684\u9886\u5bfc\u8d5e\u8d4f\uff0c\u867d\u7136\u7ecf\u5386\u4e863\u4e2a\u901a\u5bb5\u7684\u622e\u6218\uff0c\u4f9d\u7136\u53ef\u4ee5\u9690\u9690\u7ea6\u7ea6\u611f\u89c9\u5230\u8eab\u5fc3\u90fd\u5f97\u5230\u4e86\u5347\u534e ~"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4f18\u5316\u53c2\u6570\u7b14\u8bb0"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1.\u53c2\u6570\u4f18\u5316"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"net.ipv4.tcp_max_tw_buckets = 5000 --\x3e 50000\nnet.ipv4.tcp_max_syn_backlog = 1024 --\x3e 4096\nnet.core.somaxconn = 128 --\x3e 4096\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_timestamps = 1(5 \u548c 6 \u540c\u65f6\u5f00\u542f\u53ef\u80fd\u4f1a\u5bfc\u81f4nat\u4e0a\u7f51\u73af\u5883\u5efa\u8054\u6982\u7387\u5931\u8d25 )\nnet.ipv4.tcp_tw_recycle = 1\n\n\n/etc/security/limits.conf\n* soft nofile 65535\n* hard nofile 65535\n\n\nnginx \u53c2\u6570\u4f18\u5316\nworker_connections\t1024--\x3e10240;\nworker_processes\t1--\x3e16;\uff08\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u8bbe\u7f6e\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u6210 auto\uff09\nworker_rlimit_nofile 1024--\x3e102400;\t\nlisten 80 backlog 511--\x3e65533\uff1b\n\u90e8\u5206\u573a\u666f\u4e5f\u53ef\u4ee5\u8003\u8651 nginx \u5f00\u542f\u957f\u8fde\u63a5\u6765\u4f18\u5316\u77ed\u94fe\u63a5\u5e26\u6765\u7684\u5f00\u9500\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2.\u67b6\u6784\u4f18\u5316"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"\u6269\u5bb9SLB\u540e\u7aefECS\u6570\u91cf\uff0cecs\u914d\u7f6e\u7edf\u4e00\nnginx\u53cd\u4ee3\u540e\u7aefupstream\u65e0\u6548\u7aef\u53e3\u53bb\u9664\n\u4e91\u52a9\u624b\u6279\u91cf\u5904\u7406\u670d\u52a1\uff0c\u53c2\u6570\u4f18\u5316\uff0c\u6dfb\u52a0\u5b9e\u4f8b\u6807\u8bc6\n\u4e91\u76d1\u63a7\u5927\u76d8\u76d1\u63a7\uff0cECS slb dcdn redis\n\u8c03\u6574SLB\u4e3a7\u5c42\u76d1\u542c\u6a21\u5f0f\uff0c\u524d7\u540e4\u5173\u95ed\u4f1a\u8bdd\u4fdd\u6301\u5bfc\u81f4\u767b\u5f55\u72b6\u6001\u5931\u6548\uff0c\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3.\u7a0b\u5e8f\u4f18\u5316"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"\u6dfb\u52a0 gc log\uff0c\u6355\u6349 gc \u5206\u6790\u95ee\u9898\uff0c\u8bbe\u7f6e\u8fdb\u7a0b\u5185\u5b58\n/usr/bin/java -server -Xmx8g -verbose:gc -XX:+PrintGCDetails -Xloggc:/var/ log/9052.gc.log -Dserver.port=9052 -jar /home/app/we.*****.com/serverboot0.0.1-SNAPSHOT.jar\n\n\u4f18\u5316\u77ed\u4fe1\u53d1\u9001\u903b\u8f91\uff0c\u767b\u9646\u5148\u67e5\u8be2 redis \u514d\u767b session\uff0c\u65e0\u514d\u767b session \u518d\u5141\u8bb8\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\uff08\u964d\u77ed\u4fe1\u7684\u91cf\uff0c\u4f18\u5316\u767b\u9646\u4f53\u9a8c\uff09\n\njedis \u8fde\u63a5\u6c60\u4f18\u5316\nmaxTotal 8--\x3e20\nacceptcount \u4f18\u5316\uff08\u5bf9\u6807 somaxconn\uff09\n\nbug\uff1a\nspringboot1.5 \u5e26\u7684 jedis2.9.1 \u7684 redis \u8fde\u63a5\u6cc4\u6f0f\u7684\u95ee\u9898\uff0c\u5bfc\u81f4 tomcat 800 \u8fdb\u7a0b\u7528\u6ee1\u540e\u90fd\u65e0 \u9650\u7b49\u5f85 redis \u8fde\u63a5\n\u540e\u6765\u8fdb\u4e00\u6b65\u8c03\u7814\u53d1\u73b0\u8fd9\u4e2a\u95ee\u9898\u5728 2.10.2 \u5df2\u7ecf\u4fee\u590d\uff0c\u800c\u4e14 2.10.2 \u5411\u540e\u517c\u5bb9 2.9.1\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4.\u6570\u636e\u5e93\u4f18\u5316"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"redis \u516c\u7f51\u5730\u5740\u53d8\u66f4\u4e3a\u5185\u7f51\u5730\u5740\nredis session \u8d85\u65f6\u8bbe\u7f6e\u7f29\u77ed\uff0c\u7528\u4e8e\u91ca\u653e redis \u8fde\u63a5\nserver.servlet.session.timeout=300s\nspring.session.timeout=300s\n\n\u6162 SQL \u4f18\u5316\uff08RDS \u7684 CloudDBA \u975e\u5e38\u597d\u7528\u54df\uff09\n\u6dfb\u52a0\u53ea\u8bfb\u5b9e\u4f8b\uff0c\u81ea\u52a8\u8bfb\u5199\u5206\u79bb\n\u4f18\u5316 backlog\n\u6dfb\u52a0\u8bfb\u5199\u5206\u79bb\u5b9e\u4f8b\u6570\u91cf\n"})})]})}function h(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(o,{...n})}):o(n)}},28453:(n,e,s)=>{s.d(e,{R:()=>r,x:()=>c});var i=s(96540);const t={},l=i.createContext(t);function r(n){const e=i.useContext(l);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:r(n.components),i.createElement(l.Provider,{value:e},n.children)}}}]);