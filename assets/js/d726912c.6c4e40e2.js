"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[1003],{71239:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>c});var i=a(74848),s=a(28453);const l={},t="awk\u6570\u7ec4",r={id:"linux/linux\u547d\u4ee4/awk/awk\u6570\u7ec4",title:"awk\u6570\u7ec4",description:"[toc]",source:"@site/docs/linux/linux\u547d\u4ee4/awk/7.awk\u6570\u7ec4.md",sourceDirName:"linux/linux\u547d\u4ee4/awk",slug:"/linux/linux\u547d\u4ee4/awk/awk\u6570\u7ec4",permalink:"/docs/linux/linux\u547d\u4ee4/awk/awk\u6570\u7ec4",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:7,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"awk\u5faa\u73af",permalink:"/docs/linux/linux\u547d\u4ee4/awk/awk\u5faa\u73af"},next:{title:"awk\u51fd\u6570",permalink:"/docs/linux/linux\u547d\u4ee4/awk/awk\u51fd\u6570"}},o={},c=[{value:"1.awk\u6570\u7ec4\u683c\u5f0f",id:"1awk\u6570\u7ec4\u683c\u5f0f",level:2},{value:"2.\u521b\u5efaawk\u6570\u7ec4",id:"2\u521b\u5efaawk\u6570\u7ec4",level:2},{value:"3.\u5220\u9664\u6570\u7ec4\u5143\u7d20",id:"3\u5220\u9664\u6570\u7ec4\u5143\u7d20",level:2},{value:"4.\u6309\u7167\u7d22\u5f15\u904d\u5386",id:"4\u6309\u7167\u7d22\u5f15\u904d\u5386",level:2},{value:"5.awk\u6570\u7ec4\u793a\u4f8b",id:"5awk\u6570\u7ec4\u793a\u4f8b",level:2},{value:"5.1 \u7b80\u5355\u793a\u4f8b",id:"51-\u7b80\u5355\u793a\u4f8b",level:3},{value:"5.1.1 \u7edf\u8ba1/etc/passwd\u4e2d\u5404\u79cd\u7c7b\u578bshell\u7684\u6570\u91cf",id:"511-\u7edf\u8ba1etcpasswd\u4e2d\u5404\u79cd\u7c7b\u578bshell\u7684\u6570\u91cf",level:4},{value:"5.1.2 80\u7aef\u53e3\u8bbf\u95ee\u72b6\u6001\u7edf\u8ba1",id:"512-80\u7aef\u53e3\u8bbf\u95ee\u72b6\u6001\u7edf\u8ba1",level:4},{value:"5.2  \u7ed3\u5408\u65e5\u5fd7\u6587\u4ef6\u7684\u793a\u4f8b",id:"52--\u7ed3\u5408\u65e5\u5fd7\u6587\u4ef6\u7684\u793a\u4f8b",level:3},{value:"5.2.1 \u7edf\u8ba12019\u5e741\u670825\u65e5\u5f53\u5929\u7684PV\u91cf",id:"521-\u7edf\u8ba12019\u5e741\u670825\u65e5\u5f53\u5929\u7684pv\u91cf",level:4},{value:"5.2.2 \u7edf\u8ba115-19\u70b9\u7684PV\u91cf",id:"522-\u7edf\u8ba115-19\u70b9\u7684pv\u91cf",level:4},{value:"5.2.3 \u7edf\u8ba12019\u5e741\u670825\u65e5\u5f53\u5929\u5185\u8bbf\u95ee\u6700\u591a\u768410\u4e2aIP",id:"523-\u7edf\u8ba12019\u5e741\u670825\u65e5\u5f53\u5929\u5185\u8bbf\u95ee\u6700\u591a\u768410\u4e2aip",level:4},{value:"5.2.4 \u7edf\u8ba12019\u5e741\u670825\u65e515-19\u70b9\u8bbf\u95ee\u6b21\u6570\u6700\u591a\u768410\u4e2aIP",id:"524-\u7edf\u8ba12019\u5e741\u670825\u65e515-19\u70b9\u8bbf\u95ee\u6b21\u6570\u6700\u591a\u768410\u4e2aip",level:4},{value:"5.2.5 \u7edf\u8ba12019\u5e741\u670825\u65e5\u8bbf\u95ee\u6b21\u6570\u5927\u4e8e100\u7684IP",id:"525-\u7edf\u8ba12019\u5e741\u670825\u65e5\u8bbf\u95ee\u6b21\u6570\u5927\u4e8e100\u7684ip",level:4},{value:"5.2.6 \u7edf\u8ba12019\u5e741\u670825\u65e5\u8bbf\u95ee\u6700\u591a\u768410\u4e2a\u9875\u9762($requests top 10)",id:"526-\u7edf\u8ba12019\u5e741\u670825\u65e5\u8bbf\u95ee\u6700\u591a\u768410\u4e2a\u9875\u9762requests-top-10",level:4},{value:"5.2.7 \u7edf\u8ba1\u6bcf\u4e2aIP\u8bbf\u95ee\u72b6\u6001\u7801\u7684\u6570\u91cf",id:"527-\u7edf\u8ba1\u6bcf\u4e2aip\u8bbf\u95ee\u72b6\u6001\u7801\u7684\u6570\u91cf",level:4},{value:"5.2.8 \u7edf\u8ba1\u8bbf\u95ee\u72b6\u6001\u7801\u4e3a404\u53ca\u51fa\u73b0\u7684\u6b21\u6570($status)",id:"528-\u7edf\u8ba1\u8bbf\u95ee\u72b6\u6001\u7801\u4e3a404\u53ca\u51fa\u73b0\u7684\u6b21\u6570status",level:4}];function d(n){const e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.p,{children:"[toc]"}),"\n",(0,i.jsx)(e.h1,{id:"awk\u6570\u7ec4",children:"awk\u6570\u7ec4"}),"\n",(0,i.jsx)(e.h2,{id:"1awk\u6570\u7ec4\u683c\u5f0f",children:"1.awk\u6570\u7ec4\u683c\u5f0f"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"\u6570\u7ec4\u540d[\u7d22\u5f15]=\u503c"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"2\u521b\u5efaawk\u6570\u7ec4",children:"2.\u521b\u5efaawk\u6570\u7ec4"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:'//\u521b\u5efa\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u540d\u662fa\uff0c\u6570\u7ec4\u7684\u7d22\u5f15\u662f"aaa"\u548c"bbb"\n[root@test1 ~]# awk \'BEGIN{a["aaa"]="www.aaa.com";a["bbb"]="www.bbb.com"; print a["aaa"] "\\n" a["bbb"]}\'\nwww.aaa.com\nwww.bbb.com\n'})}),"\n",(0,i.jsx)(e.h2,{id:"3\u5220\u9664\u6570\u7ec4\u5143\u7d20",children:"3.\u5220\u9664\u6570\u7ec4\u5143\u7d20"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:'//\u4f7f\u7528delete \u6570\u7ec4\u540d[\u7d22\u5f15] \u5220\u9664\u6570\u7ec4\u5143\u7d20\n[root@test1 ~]# awk \'BEGIN{a["aaa"]="www.aaa.com";a["bbb"]="www.bbb.com";delete a["aaa"]; print a["aaa"] "\\n" a["bbb"]}\'\n\nwww.bbb.com\n'})}),"\n",(0,i.jsx)(e.h2,{id:"4\u6309\u7167\u7d22\u5f15\u904d\u5386",children:"4.\u6309\u7167\u7d22\u5f15\u904d\u5386"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"//\u4ee5\u4e0b\u793a\u4f8b\u4e86\u4ee5\u7edf\u8ba1\u7684\u5b57\u6bb5\u4e3a\u6570\u7ec4\u7684\u7d22\u5f15\n[root@test1 ~]# awk -F: '{a[++i]=$1} END{print a[1]}' /etc/passwd\nroot\n[root@test1 ~]# awk -F: '{a[i++]=$1} END{print a[1]}' /etc/passwd\nbin\n[root@test1 ~]# head -2 /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/nologin\n"})}),"\n",(0,i.jsx)(e.h2,{id:"5awk\u6570\u7ec4\u793a\u4f8b",children:"5.awk\u6570\u7ec4\u793a\u4f8b"}),"\n",(0,i.jsx)(e.h3,{id:"51-\u7b80\u5355\u793a\u4f8b",children:"5.1 \u7b80\u5355\u793a\u4f8b"}),"\n",(0,i.jsx)(e.h4,{id:"511-\u7edf\u8ba1etcpasswd\u4e2d\u5404\u79cd\u7c7b\u578bshell\u7684\u6570\u91cf",children:"5.1.1 \u7edf\u8ba1/etc/passwd\u4e2d\u5404\u79cd\u7c7b\u578bshell\u7684\u6570\u91cf"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"[root@test1 ~]# awk -F: '{a[$NF]++} END{for(i in a){print i,a[i]}}' /etc/passwd\n/bin/sync 1\n/bin/bash 2\n/sbin/nologin 22\n/sbin/halt 1\n/sbin/shutdown 1\n"})}),"\n",(0,i.jsx)(e.h4,{id:"512-80\u7aef\u53e3\u8bbf\u95ee\u72b6\u6001\u7edf\u8ba1",children:"5.1.2 80\u7aef\u53e3\u8bbf\u95ee\u72b6\u6001\u7edf\u8ba1"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"[root@test1 ~]# ss -an|awk '/:80/{a[$2]++} END{for(i in a){print i,a[i]}}'\nLISTEN 3\n"})}),"\n",(0,i.jsx)(e.h3,{id:"52--\u7ed3\u5408\u65e5\u5fd7\u6587\u4ef6\u7684\u793a\u4f8b",children:"5.2  \u7ed3\u5408\u65e5\u5fd7\u6587\u4ef6\u7684\u793a\u4f8b"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"nginx\u8bbf\u95ee\u65e5\u5fd7\u683c\u5f0f\u5982\u4e0b"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:'82.113.63.230 - - [25/Jan/2019:15:15:56 +0800] "GET / HTTP/1.1" 301 169 "-" "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36" "-"\n'})}),"\n",(0,i.jsx)(e.h4,{id:"521-\u7edf\u8ba12019\u5e741\u670825\u65e5\u5f53\u5929\u7684pv\u91cf",children:"5.2.1 \u7edf\u8ba12019\u5e741\u670825\u65e5\u5f53\u5929\u7684PV\u91cf"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"[root@test1 ~]# awk '/25\\/Jan\\/2019/{i++}END{print i}' /var/log/nginx/access.log\n90\n"})}),"\n",(0,i.jsx)(e.h4,{id:"522-\u7edf\u8ba115-19\u70b9\u7684pv\u91cf",children:"5.2.2 \u7edf\u8ba115-19\u70b9\u7684PV\u91cf"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:'[root@test1 ~]# awk \'$4>="[25/Jan/2019:15:00:00" && $4<="[25/Jan/2019:19:00:00 {print $0}"\' /var/log/nginx/access.log|wc -l\n'})}),"\n",(0,i.jsx)(e.h4,{id:"523-\u7edf\u8ba12019\u5e741\u670825\u65e5\u5f53\u5929\u5185\u8bbf\u95ee\u6700\u591a\u768410\u4e2aip",children:"5.2.3 \u7edf\u8ba12019\u5e741\u670825\u65e5\u5f53\u5929\u5185\u8bbf\u95ee\u6700\u591a\u768410\u4e2aIP"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"[root@test1 ~]# awk '/25\\/Jan\\/2019/ {a[$1]++} END {for(i in a){print i,a[i]}}' /var/log/nginx/access.log |sort -rn|head\n"})}),"\n",(0,i.jsx)(e.h4,{id:"524-\u7edf\u8ba12019\u5e741\u670825\u65e515-19\u70b9\u8bbf\u95ee\u6b21\u6570\u6700\u591a\u768410\u4e2aip",children:"5.2.4 \u7edf\u8ba12019\u5e741\u670825\u65e515-19\u70b9\u8bbf\u95ee\u6b21\u6570\u6700\u591a\u768410\u4e2aIP"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"[root@test1 ~]# awk '$4>=\"[25/Jan/2019:15:00:00\" && $4<=\"[25/Jan/2019:19:00:00\"' /var/log/nginx/access.log |awk '{ips[$1]++} END {for(i in ips){print ips[i],i}}'|sort -rn|head\n"})}),"\n",(0,i.jsx)(e.h4,{id:"525-\u7edf\u8ba12019\u5e741\u670825\u65e5\u8bbf\u95ee\u6b21\u6570\u5927\u4e8e100\u7684ip",children:"5.2.5 \u7edf\u8ba12019\u5e741\u670825\u65e5\u8bbf\u95ee\u6b21\u6570\u5927\u4e8e100\u7684IP"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"[root@test1 ~]# awk '/25\\/Jan\\/2019/ {a[$1]++} END {for(i in a){if(a[i]>10){print i,a[i]}}}' /var/log/nginx/access.log\n"})}),"\n",(0,i.jsx)(e.h4,{id:"526-\u7edf\u8ba12019\u5e741\u670825\u65e5\u8bbf\u95ee\u6700\u591a\u768410\u4e2a\u9875\u9762requests-top-10",children:"5.2.6 \u7edf\u8ba12019\u5e741\u670825\u65e5\u8bbf\u95ee\u6700\u591a\u768410\u4e2a\u9875\u9762($requests top 10)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"//nginx\u8bbf\u95ee\u65e5\u5fd7\u4e2d\u7b2c7\u5217\u662f\u8bbf\u95eeurl\n[root@test1 ~]# awk '/25\\/Jan\\/2019/ {a[$7]++} END {for(i in a){print a[i],i}}' /var/log/nginx/access.log |sort -rn|head\n"})}),"\n",(0,i.jsx)(e.h4,{id:"527-\u7edf\u8ba1\u6bcf\u4e2aip\u8bbf\u95ee\u72b6\u6001\u7801\u7684\u6570\u91cf",children:"5.2.7 \u7edf\u8ba1\u6bcf\u4e2aIP\u8bbf\u95ee\u72b6\u6001\u7801\u7684\u6570\u91cf"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"[root@test1 ~]# awk '{a[$1 \" \" $9]++} END {for(i in a){print a[i],i}}' /var/log/nginx/access.log|sort -rn|head\n10 101.227.27.188 301\n9 113.193.226.3 301\n3 59.36.132.240 301\n3 182.254.52.17 301\n2 80.82.70.187 301\n2 64.246.161.190 302\n2 14.18.182.223 302\n2 14.18.182.223 301\n2 124.161.103.251 301\n1 83.97.20.33 301\n"})}),"\n",(0,i.jsx)(e.h4,{id:"528-\u7edf\u8ba1\u8bbf\u95ee\u72b6\u6001\u7801\u4e3a404\u53ca\u51fa\u73b0\u7684\u6b21\u6570status",children:"5.2.8 \u7edf\u8ba1\u8bbf\u95ee\u72b6\u6001\u7801\u4e3a404\u53ca\u51fa\u73b0\u7684\u6b21\u6570($status)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:'//\u7edf\u8ba1\u67d0\u4e00\u5929\u7684\n[root@test1 ~]# awk \'{if($9=="404") a[$9]++} END {for(i in a){print i,a[i]}}\' /var/log/nginx/access.log\n\n\n//\u7edf\u8ba1\u67d0\u4e00\u5929\u67d0\u4e00\u65f6\u523b\u7684\n[root@test1 ~]# awk \'$4>="[25/Jan/2019:15:00:00" && $4<="[25/Jan/2019:19:00:00" && $9=="404" {a[$9]++} END {for(i in a){print i,a[i]}}\' /var/log/nginx/access.log\n'})})]})}function h(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}},28453:(n,e,a)=>{a.d(e,{R:()=>t,x:()=>r});var i=a(96540);const s={},l=i.createContext(s);function t(n){const e=i.useContext(l);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:t(n.components),i.createElement(l.Provider,{value:e},n.children)}}}]);