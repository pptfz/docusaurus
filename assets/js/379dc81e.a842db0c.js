"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[8957],{23440:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var s=t(74848),r=t(28453);const i={},o="CentOS7\u4e00\u952e\u5b89\u88c5OpenVPN",a={id:"linux/linux\u670d\u52a1/VPN/CentOS7\u4e00\u952e\u5b89\u88c5OpenVPN",title:"CentOS7\u4e00\u952e\u5b89\u88c5OpenVPN",description:"[toc]",source:"@site/docs/linux/linux\u670d\u52a1/VPN/CentOS7\u4e00\u952e\u5b89\u88c5OpenVPN.md",sourceDirName:"linux/linux\u670d\u52a1/VPN",slug:"/linux/linux\u670d\u52a1/VPN/CentOS7\u4e00\u952e\u5b89\u88c5OpenVPN",permalink:"/docs/linux/linux\u670d\u52a1/VPN/CentOS7\u4e00\u952e\u5b89\u88c5OpenVPN",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"grc",permalink:"/docs/linux/linux\u5b9e\u7528\u5f00\u6e90\u5c0f\u5de5\u5177/grc"},next:{title:"CentOS7\u624b\u52a8\u5b89\u88c5OpenVPN",permalink:"/docs/linux/linux\u670d\u52a1/VPN/CentOS7\u624b\u52a8\u5b89\u88c5OpenVPN"}},l={},c=[{value:"1.\u5b89\u88c5OpenVPN",id:"1\u5b89\u88c5openvpn",level:2},{value:"1.1 \u514b\u9686\u9879\u76ee",id:"11-\u514b\u9686\u9879\u76ee",level:3},{value:"1.2 \u6267\u884c\u5b89\u88c5\u811a\u672c",id:"12-\u6267\u884c\u5b89\u88c5\u811a\u672c",level:3},{value:"\u7b2c\u4e00\u6b65\u3001\u8f93\u5165\u672c\u673a\u79c1\u7f51IP\u5730\u5740",id:"\u7b2c\u4e00\u6b65\u8f93\u5165\u672c\u673a\u79c1\u7f51ip\u5730\u5740",level:4},{value:"\u7b2c\u4e8c\u6b65\u3001\u8f93\u5165\u672c\u673a\u516c\u7f51IP",id:"\u7b2c\u4e8c\u6b65\u8f93\u5165\u672c\u673a\u516c\u7f51ip",level:4},{value:"\u7b2c\u4e09\u6b65\u3001\u9009\u62e9OpenVPN\u534f\u8bae\uff0c\u63a8\u8350\u4f7f\u7528UDP",id:"\u7b2c\u4e09\u6b65\u9009\u62e9openvpn\u534f\u8bae\u63a8\u8350\u4f7f\u7528udp",level:4},{value:"\u7b2c\u56db\u6b65\u3001\u8f93\u5165OpenVPN\u76d1\u542c\u7684\u7aef\u53e3",id:"\u7b2c\u56db\u6b65\u8f93\u5165openvpn\u76d1\u542c\u7684\u7aef\u53e3",level:4},{value:"\u7b2c\u4e94\u6b65\u3001\u4e3a\u5ba2\u6237\u7aef\u9009\u62e9\u4e00\u4e2aDNS\u670d\u52a1\u5668",id:"\u7b2c\u4e94\u6b65\u4e3a\u5ba2\u6237\u7aef\u9009\u62e9\u4e00\u4e2adns\u670d\u52a1\u5668",level:4},{value:"\u7b2c\u516d\u6b65\u3001\u4e3a\u7b2c\u4e00\u4e2a\u5ba2\u6237\u7aef\u8f93\u5165\u4e00\u4e2a\u540d\u79f0",id:"\u7b2c\u516d\u6b65\u4e3a\u7b2c\u4e00\u4e2a\u5ba2\u6237\u7aef\u8f93\u5165\u4e00\u4e2a\u540d\u79f0",level:4},{value:"\u7b2c\u4e03\u6b65\u3001\u6309\u4efb\u610f\u952e\u5f00\u59cb\u5b89\u88c5",id:"\u7b2c\u4e03\u6b65\u6309\u4efb\u610f\u952e\u5f00\u59cb\u5b89\u88c5",level:4},{value:"1.3 \u67e5\u770bOpenVPN\u76f8\u5173\u4fe1\u606f",id:"13-\u67e5\u770bopenvpn\u76f8\u5173\u4fe1\u606f",level:3},{value:"1.3.1 \u67e5\u770bOpenVPN\u8fdb\u7a0b",id:"131-\u67e5\u770bopenvpn\u8fdb\u7a0b",level:4},{value:"1.3.2 OpenVPN\u9ed8\u8ba4\u76d1\u542c <code>udp 1194</code> \u7aef\u53e3",id:"132-openvpn\u9ed8\u8ba4\u76d1\u542c-udp-1194-\u7aef\u53e3",level:4},{value:"1.3.3 \u67e5\u770b\u7248\u672c",id:"133-\u67e5\u770b\u7248\u672c",level:4},{value:"2.\u914d\u7f6eOnenVPN\u4f7f\u7528\u8d26\u53f7\u5bc6\u7801\u8ba4\u8bc1",id:"2\u914d\u7f6eonenvpn\u4f7f\u7528\u8d26\u53f7\u5bc6\u7801\u8ba4\u8bc1",level:2},{value:"2.1 \u7f16\u8f91\u811a\u672c",id:"21-\u7f16\u8f91\u811a\u672c",level:3},{value:"2.2 \u4fee\u6539openvpn\u914d\u7f6e\u6587\u4ef6 <code>/etc/openvpn/server/server.conf</code>",id:"22-\u4fee\u6539openvpn\u914d\u7f6e\u6587\u4ef6-etcopenvpnserverserverconf",level:3},{value:"2.2.1 \u8ffd\u52a0\u4ee5\u4e0b\u5185\u5bb9",id:"221-\u8ffd\u52a0\u4ee5\u4e0b\u5185\u5bb9",level:4},{value:"2.2.2 \u4fee\u6539 server.conf",id:"222-\u4fee\u6539-serverconf",level:4},{value:"2.3 \u91cd\u542f\u670d\u52a1",id:"23-\u91cd\u542f\u670d\u52a1",level:3},{value:"2.4 \u6dfb\u52a0\u8d26\u53f7",id:"24-\u6dfb\u52a0\u8d26\u53f7",level:3},{value:"2.5 \u4fee\u6539\u5ba2\u6237\u7aef\u6587\u4ef6",id:"25-\u4fee\u6539\u5ba2\u6237\u7aef\u6587\u4ef6",level:3},{value:"3.\u5ba2\u6237\u7aef\u5b89\u88c5\u914d\u7f6e",id:"3\u5ba2\u6237\u7aef\u5b89\u88c5\u914d\u7f6e",level:2},{value:"3.1 mac\u8fde\u63a5\u793a\u4f8b",id:"31-mac\u8fde\u63a5\u793a\u4f8b",level:3},{value:"3.2 windows\u8fde\u63a5\u793a\u4f8b",id:"32-windows\u8fde\u63a5\u793a\u4f8b",level:3},{value:"4.\u4e91\u4e3b\u673a\u5b89\u5168\u7ec4\u914d\u7f6e\u8bf4\u660e",id:"4\u4e91\u4e3b\u673a\u5b89\u5168\u7ec4\u914d\u7f6e\u8bf4\u660e",level:2},{value:"5.\u811a\u672c\u5185\u5bb9",id:"5\u811a\u672c\u5185\u5bb9",level:2}];function p(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"[toc]"}),"\n",(0,s.jsx)(n.h1,{id:"centos7\u4e00\u952e\u5b89\u88c5openvpn",children:"CentOS7\u4e00\u952e\u5b89\u88c5OpenVPN"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/Nyr/openvpn-install",children:"openvpn github\u5730\u5740"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://openvpn.net/",children:"openvpn\u5b98\u7f51"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u9700\u6c42\u53ca\u4f7f\u7528\u573a\u666f"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["\u516c\u53f8\u7684\u4e00\u4e9b\u8d44\u6e90\u4e0d\u60f3\u5bf9\u5916\u5f00\u653e\u8bbf\u95ee\uff0c\u4f8b\u5982gitlab\u3001jenkins\u7b49\u7b49\uff0c\u73b0\u5728\u60f3\u8981\u7684\u6548\u679c\u662f\u90e8\u5206\u8d44\u6e90\u53ea\u5141\u8bb8\u516c\u53f8\u516c\u7f51IP\u4ee5\u53ca\u7279\u5b9aIP\u8bbf\u95ee\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u7528\u5230VPN\u4e86\uff0c\u4f46\u662f\u516c\u53f8",(0,s.jsx)(n.strong,{children:"\u82b1\u94b1\u4e70VPN\u662f\u4e0d\u53ef\u80fd\u7684"}),"\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u4e00\u6b3e\u514d\u8d39\u597d\u7528\u7684VPN\uff0cOpenVPN\u514d\u8d39\u5f00\u6e90\u53c8\u597d\u7528\uff0c\u914d\u7f6e\u5b8cOpenVPN\u540e\u518d\u52a0\u4e0a\u4e91\u4e3b\u673a\u7684\u5b89\u5168\u7ec4\u5c31\u5b8c\u7f8e\u89e3\u51b3\u95ee\u9898\u4e86\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u8bf4\u660e"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u7cfb\u7edf"}),(0,s.jsx)(n.th,{children:"openvpn\u7248\u672c"}),(0,s.jsx)(n.th,{children:"\u5185\u7f51IP"}),(0,s.jsx)(n.th,{children:"openvpn\u5206\u914d\u5ba2\u6237\u7aef\u7f51\u6bb5"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"CentOS7.9"}),(0,s.jsx)(n.td,{children:"2.4.11"}),(0,s.jsx)(n.td,{children:"10.206.0.9"}),(0,s.jsx)(n.td,{children:"10.8.0.0"})]})})]}),"\n",(0,s.jsx)(n.h2,{id:"1\u5b89\u88c5openvpn",children:"1.\u5b89\u88c5OpenVPN"}),"\n",(0,s.jsx)(n.h3,{id:"11-\u514b\u9686\u9879\u76ee",children:"1.1 \u514b\u9686\u9879\u76ee"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"git clone https://github.com/Nyr/openvpn-install.git\n"})}),"\n",(0,s.jsx)(n.h3,{id:"12-\u6267\u884c\u5b89\u88c5\u811a\u672c",children:"1.2 \u6267\u884c\u5b89\u88c5\u811a\u672c"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"cd openvpn-install && sh openvpn-install.sh\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5b89\u88c5\u5b8c\u6210\u540e\u518d\u6b21\u6267\u884c\u811a\u672c\u4f1a\u63d0\u793a\u5982\u4e0b"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"OpenVPN is already installed.\n\nSelect an option:\n   # \u6dfb\u52a0\u65b0\u7684\u5ba2\u6237\u7aef\n   1) Add a new client\n   \n   # \u79fb\u9664\u5df2\u5b58\u5728\u7684\u5ba2\u6237\u7aef\n   2) Revoke an existing client\n   \n   # \u79fb\u9664OpenVPN\n   3) Remove OpenVPN\n   \n   # \u9000\u51fa\n   4) Exit\nOption: \n"})}),"\n",(0,s.jsx)(n.h4,{id:"\u7b2c\u4e00\u6b65\u8f93\u5165\u672c\u673a\u79c1\u7f51ip\u5730\u5740",children:"\u7b2c\u4e00\u6b65\u3001\u8f93\u5165\u672c\u673a\u79c1\u7f51IP\u5730\u5740"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"Welcome to this OpenVPN road warrior installer!\n\nWhich IPv4 address should be used?\n     1) 10.9.95.147\n     2) 172.17.0.1\n     3) 172.20.0.1\nIPv4 address [1]: 1\n"})}),"\n",(0,s.jsx)(n.h4,{id:"\u7b2c\u4e8c\u6b65\u8f93\u5165\u672c\u673a\u516c\u7f51ip",children:"\u7b2c\u4e8c\u6b65\u3001\u8f93\u5165\u672c\u673a\u516c\u7f51IP"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"This server is behind NAT. What is the public IPv4 address or hostname?\nPublic IPv4 address / hostname [8.8.8.8]: 8.8.8.8\n"})}),"\n",(0,s.jsx)(n.h4,{id:"\u7b2c\u4e09\u6b65\u9009\u62e9openvpn\u534f\u8bae\u63a8\u8350\u4f7f\u7528udp",children:"\u7b2c\u4e09\u6b65\u3001\u9009\u62e9OpenVPN\u534f\u8bae\uff0c\u63a8\u8350\u4f7f\u7528UDP"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"Which protocol should OpenVPN use?\n   1) UDP (recommended)\n   2) TCP\nProtocol [1]: 1\n"})}),"\n",(0,s.jsx)(n.h4,{id:"\u7b2c\u56db\u6b65\u8f93\u5165openvpn\u76d1\u542c\u7684\u7aef\u53e3",children:"\u7b2c\u56db\u6b65\u3001\u8f93\u5165OpenVPN\u76d1\u542c\u7684\u7aef\u53e3"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"What port should OpenVPN listen to?\nPort [1194]:\n"})}),"\n",(0,s.jsx)(n.h4,{id:"\u7b2c\u4e94\u6b65\u4e3a\u5ba2\u6237\u7aef\u9009\u62e9\u4e00\u4e2adns\u670d\u52a1\u5668",children:"\u7b2c\u4e94\u6b65\u3001\u4e3a\u5ba2\u6237\u7aef\u9009\u62e9\u4e00\u4e2aDNS\u670d\u52a1\u5668"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"Select a DNS server for the clients:\n   1) Current system resolvers\n   2) Google\n   3) 1.1.1.1\n   4) OpenDNS\n   5) Quad9\n   6) AdGuard\nDNS server [1]: 1\n"})}),"\n",(0,s.jsx)(n.h4,{id:"\u7b2c\u516d\u6b65\u4e3a\u7b2c\u4e00\u4e2a\u5ba2\u6237\u7aef\u8f93\u5165\u4e00\u4e2a\u540d\u79f0",children:"\u7b2c\u516d\u6b65\u3001\u4e3a\u7b2c\u4e00\u4e2a\u5ba2\u6237\u7aef\u8f93\u5165\u4e00\u4e2a\u540d\u79f0"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"Enter a name for the first client:\nName [client]:\n"})}),"\n",(0,s.jsx)(n.h4,{id:"\u7b2c\u4e03\u6b65\u6309\u4efb\u610f\u952e\u5f00\u59cb\u5b89\u88c5",children:"\u7b2c\u4e03\u6b65\u3001\u6309\u4efb\u610f\u952e\u5f00\u59cb\u5b89\u88c5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"OpenVPN installation is ready to begin.\nPress any key to continue...\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5b8c\u6574\u8f93\u51fa"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"OpenVPN installation is ready to begin.\nPress any key to continue...\nLoaded plugins: fastestmirror\nDetermining fastest mirrors\n10gen                                                                                                                            | 1.2 kB  00:00:00     \nbase                                                                                                                             | 3.6 kB  00:00:00     \ncentosplus                                                                                                                       | 2.9 kB  00:00:00     \ndocker-ce-stable                                                                                                                 | 3.5 kB  00:00:00     \nepel                                                                                                                             | 4.7 kB  00:00:00     \nextras                                                                                                                           | 2.9 kB  00:00:00     \nnginx-stable                                                                                                                     | 2.9 kB  00:00:00     \nupdates                                                                                                                          | 2.9 kB  00:00:00     \nzabbix                                                                                                                           | 2.9 kB  00:00:00     \nzabbix-non-supported                                                                                                             |  951 B  00:00:00     \n(1/7): 10gen/primary                                                                                                             |  32 kB  00:00:00     \n(2/7): extras/7/x86_64/primary_db                                                                                                | 222 kB  00:00:00     \n(3/7): epel/x86_64/updateinfo                                                                                                    | 1.0 MB  00:00:00     \n(4/7): centosplus/7/x86_64/primary_db                                                                                            | 1.6 MB  00:00:01     \n(5/7): base/7/x86_64/primary_db                                                                                                  | 6.1 MB  00:00:01     \n(6/7): updates/7/x86_64/primary_db                                                                                               | 3.7 MB  00:00:01     \n(7/7): epel/x86_64/primary_db                                                                                                    | 6.9 MB  00:00:01     \n10gen                                                                                                                                           279/279\nResolving Dependencies\n--\x3e Running transaction check\n---\x3e Package epel-release.noarch 0:7-13 will be installed\n--\x3e Finished Dependency Resolution\n\nDependencies Resolved\n\n========================================================================================================================================================\n Package                                  Arch                               Version                             Repository                        Size\n========================================================================================================================================================\nInstalling:\n epel-release                             noarch                             7-13                                epel                              15 k\n\nTransaction Summary\n========================================================================================================================================================\nInstall  1 Package\n\nTotal download size: 15 k\nInstalled size: 25 k\nDownloading packages:\nepel-release-7-13.noarch.rpm                                                                                                     |  15 kB  00:00:00     \nRunning transaction check\nRunning transaction test\nTransaction test succeeded\nRunning transaction\n  Installing : epel-release-7-13.noarch                                                                                                             1/1 \nwarning: /etc/yum.repos.d/epel.repo created as /etc/yum.repos.d/epel.repo.rpmnew\n  Verifying  : epel-release-7-13.noarch                                                                                                             1/1 \n\nInstalled:\n  epel-release.noarch 0:7-13                                                                                                                            \n\nComplete!\nLoaded plugins: fastestmirror\nLoading mirror speeds from cached hostfile\nPackage 1:openssl-1.0.2k-19.el7.x86_64 already installed and latest version\nPackage 2:tar-1.26-35.el7.x86_64 already installed and latest version\nResolving Dependencies\n--\x3e Running transaction check\n---\x3e Package ca-certificates.noarch 0:2019.2.32-76.el7_7 will be updated\n---\x3e Package ca-certificates.noarch 0:2020.2.41-70.0.el7_8 will be an update\n---\x3e Package openvpn.x86_64 0:2.4.9-1.el7 will be installed\n--\x3e Processing Dependency: libpkcs11-helper.so.1()(64bit) for package: openvpn-2.4.9-1.el7.x86_64\n--\x3e Running transaction check\n---\x3e Package pkcs11-helper.x86_64 0:1.11-3.el7 will be installed\n--\x3e Finished Dependency Resolution\n\nDependencies Resolved\n\n========================================================================================================================================================\n Package                                 Arch                           Version                                      Repository                    Size\n========================================================================================================================================================\nInstalling:\n openvpn                                 x86_64                         2.4.9-1.el7                                  epel                         524 k\nUpdating:\n ca-certificates                         noarch                         2020.2.41-70.0.el7_8                         base                         382 k\nInstalling for dependencies:\n pkcs11-helper                           x86_64                         1.11-3.el7                                   epel                          56 k\n\nTransaction Summary\n========================================================================================================================================================\nInstall  1 Package (+1 Dependent package)\nUpgrade  1 Package\n\nTotal download size: 962 k\nDownloading packages:\nDelta RPMs disabled because /usr/bin/applydeltarpm not installed.\n(1/3): ca-certificates-2020.2.41-70.0.el7_8.noarch.rpm                                                                           | 382 kB  00:00:00     \n(2/3): pkcs11-helper-1.11-3.el7.x86_64.rpm                                                                                       |  56 kB  00:00:00     \n(3/3): openvpn-2.4.9-1.el7.x86_64.rpm                                                                                            | 524 kB  00:00:00     \n--------------------------------------------------------------------------------------------------------------------------------------------------------\nTotal                                                                                                                   3.4 MB/s | 962 kB  00:00:00     \nRunning transaction check\nRunning transaction test\nTransaction test succeeded\nRunning transaction\n  Installing : pkcs11-helper-1.11-3.el7.x86_64                                                                                                      1/4 \n  Installing : openvpn-2.4.9-1.el7.x86_64                                                                                                           2/4 \n  Updating   : ca-certificates-2020.2.41-70.0.el7_8.noarch                                                                                          3/4 \n  Cleanup    : ca-certificates-2019.2.32-76.el7_7.noarch                                                                                            4/4 \n  Verifying  : ca-certificates-2020.2.41-70.0.el7_8.noarch                                                                                          1/4 \n  Verifying  : openvpn-2.4.9-1.el7.x86_64                                                                                                           2/4 \n  Verifying  : pkcs11-helper-1.11-3.el7.x86_64                                                                                                      3/4 \n  Verifying  : ca-certificates-2019.2.32-76.el7_7.noarch                                                                                            4/4 \n\nInstalled:\n  openvpn.x86_64 0:2.4.9-1.el7                                                                                                                          \n\nDependency Installed:\n  pkcs11-helper.x86_64 0:1.11-3.el7                                                                                                                     \n\nUpdated:\n  ca-certificates.noarch 0:2020.2.41-70.0.el7_8                                                                                                         \n\nComplete!\n\ninit-pki complete; you may now create a CA or requests.\nYour newly created PKI dir is: /etc/openvpn/server/easy-rsa/pki\n\n\nUsing SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017\nGenerating RSA private key, 2048 bit long modulus\n....+++\n...................................+++\ne is 65537 (0x10001)\n\nUsing SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017\nGenerating a 2048 bit RSA private key\n.................................................................+++\n....+++\nwriting new private key to '/etc/openvpn/server/easy-rsa/pki/easy-rsa-2726385.U7ScUb/tmp.FTK8rI'\n-----\nUsing configuration from /etc/openvpn/server/easy-rsa/pki/easy-rsa-2726385.U7ScUb/tmp.9FN60w\nCheck that the request matches the signature\nSignature ok\nThe Subject's Distinguished Name is as follows\ncommonName            :ASN.1 12:'server'\nCertificate is to be certified until Nov 28 02:24:33 2030 GMT (3650 days)\n\nWrite out database with 1 new entries\nData Base Updated\n\nUsing SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017\nGenerating a 2048 bit RSA private key\n.....+++\n........................................................................................+++\nwriting new private key to '/etc/openvpn/server/easy-rsa/pki/easy-rsa-2726473.aJtBJi/tmp.bmyQVL'\n-----\nUsing configuration from /etc/openvpn/server/easy-rsa/pki/easy-rsa-2726473.aJtBJi/tmp.zwz1tQ\nCheck that the request matches the signature\nSignature ok\nThe Subject's Distinguished Name is as follows\ncommonName            :ASN.1 12:'pptfz'\nCertificate is to be certified until Nov 28 02:24:34 2030 GMT (3650 days)\n\nWrite out database with 1 new entries\nData Base Updated\n\nUsing SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017\nUsing configuration from /etc/openvpn/server/easy-rsa/pki/easy-rsa-2726540.Fvyapy/tmp.eJmfVQ\n\nAn updated CRL has been created.\nCRL file: /etc/openvpn/server/easy-rsa/pki/crl.pem\n\n\nCreated symlink from /etc/systemd/system/multi-user.target.wants/openvpn-iptables.service to /etc/systemd/system/openvpn-iptables.service.\nCreated symlink from /etc/systemd/system/multi-user.target.wants/openvpn-server@server.service to /usr/lib/systemd/system/openvpn-server@.service.\n\nFinished!\n\nThe client configuration is available in: /root/pptfz.ovpn\nNew clients can be added by running this script again.\n"})}),"\n",(0,s.jsx)(n.p,{children:":::tip\u8bf4\u660e"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["\u5ba2\u6237\u7aef\u6587\u4ef6\u662f ",(0,s.jsx)(n.code,{children:"/root/pptfz.ovpn"})," \uff0c\u5728\u6700\u540e\u7684\u8f93\u51fa\u4e2d\u6709\u63d0\u793a\uff0c\u8fd9\u91cc\u7684\u5ba2\u6237\u7aef\u6587\u4ef6\u540d\u79f0\u662f\u81ea\u5b9a\u4e49\u7684\uff0c\u7136\u540e\u628a\u8fd9\u4e2a\u6587\u4ef6\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u540e\u7eed\u914d\u7f6eVPN\u8ba4\u8bc1\u7684\u65f6\u5019\u9700\u8981\u7528\u5230\u8fd9\u4e2a\u5ba2\u6237\u7aef\u6587\u4ef6"]})}),"\n",(0,s.jsx)(n.p,{children:":::"}),"\n",(0,s.jsx)(n.h3,{id:"13-\u67e5\u770bopenvpn\u76f8\u5173\u4fe1\u606f",children:"1.3 \u67e5\u770bOpenVPN\u76f8\u5173\u4fe1\u606f"}),"\n",(0,s.jsx)(n.h4,{id:"131-\u67e5\u770bopenvpn\u8fdb\u7a0b",children:"1.3.1 \u67e5\u770bOpenVPN\u8fdb\u7a0b"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["\u9ed8\u8ba4\u662f\u4ee5 ",(0,s.jsx)(n.code,{children:"nobody"})," \u7528\u6237\u8fd0\u884c\uff0c\u5728 ",(0,s.jsx)(n.code,{children:"/etc/openvpn/server/server.conf "})," \u4e2d\u53ef\u4ee5\u81ea\u5b9a\u4e49"]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"$ ps aux|grep [o]penvpn\nnobody   2726623  0.0  0.2  77168  4040 ?        Ss   10:24   0:00 /usr/sbin/openvpn --status /run/openvpn-server/status-server.log --status-version 2 --suppress-timestamps --config server.conf\n"})}),"\n",(0,s.jsxs)(n.h4,{id:"132-openvpn\u9ed8\u8ba4\u76d1\u542c-udp-1194-\u7aef\u53e3",children:["1.3.2 OpenVPN\u9ed8\u8ba4\u76d1\u542c ",(0,s.jsx)(n.code,{children:"udp 1194"})," \u7aef\u53e3"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"$ netstat -nupl|grep 1194\nudp        0      0 10.9.95.147:1194        0.0.0.0:*                           2726623/openvpn     \n"})}),"\n",(0,s.jsx)(n.h4,{id:"133-\u67e5\u770b\u7248\u672c",children:"1.3.3 \u67e5\u770b\u7248\u672c"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"$ openvpn --version\nOpenVPN 2.4.11 x86_64-redhat-linux-gnu [Fedora EPEL patched] [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [PKCS11] [MH/PKTINFO] [AEAD] built on Apr 21 2021\nlibrary versions: OpenSSL 1.0.2k-fips  26 Jan 2017, LZO 2.06\nOriginally developed by James Yonan\nCopyright (C) 2002-2018 OpenVPN Inc <sales@openvpn.net>\nCompile time defines: enable_async_push=no enable_comp_stub=no enable_crypto=yes enable_crypto_ofb_cfb=yes enable_debug=yes enable_def_auth=yes enable_dependency_tracking=no enable_dlopen=unknown enable_dlopen_self=unknown enable_dlopen_self_static=unknown enable_fast_install=yes enable_fragment=yes enable_iproute2=yes enable_libtool_lock=yes enable_lz4=yes enable_lzo=yes enable_management=yes enable_multihome=yes enable_pam_dlopen=no enable_pedantic=no enable_pf=yes enable_pkcs11=yes enable_plugin_auth_pam=yes enable_plugin_down_root=yes enable_plugins=yes enable_port_share=yes enable_selinux=yes enable_server=yes enable_shared=yes enable_shared_with_static_runtimes=no enable_small=no enable_static=yes enable_strict=no enable_strict_options=no enable_systemd=yes enable_werror=no enable_win32_dll=yes enable_x509_alt_username=yes with_aix_soname=aix with_crypto_library=openssl with_gnu_ld=yes with_mem_check=no with_sysroot=no\n"})}),"\n",(0,s.jsx)(n.h2,{id:"2\u914d\u7f6eonenvpn\u4f7f\u7528\u8d26\u53f7\u5bc6\u7801\u8ba4\u8bc1",children:"2.\u914d\u7f6eOnenVPN\u4f7f\u7528\u8d26\u53f7\u5bc6\u7801\u8ba4\u8bc1"}),"\n",(0,s.jsx)(n.h3,{id:"21-\u7f16\u8f91\u811a\u672c",children:"2.1 \u7f16\u8f91\u811a\u672c"}),"\n",(0,s.jsx)(n.p,{children:":::tip\u8bf4\u660e"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["\u8fd9\u4e2a\u662f\u73b0\u5728\u516c\u53f8\u7ebf\u4e0a\u7528\u5230\u7684\u6587\u4ef6\uff0c\u76ee\u524d\u6ca1\u6709\u627e\u5230\u51fa\u5904\uff0c\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\uff0c\u603b\u4e4b\u5c31\u662f\u5229\u7528\u4e00\u4e2a\u5b58\u653e\u7528\u6237\u540d\u5bc6\u7801\u7684\u81ea\u5b9a\u4e49\u6587\u4ef6 ",(0,s.jsx)(n.code,{children:"/etc/openvpn/psw-file"})," \u6765\u4f5c\u4e3a\u8ba4\u8bc1\u6587\u4ef6"]})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["\u7f16\u8f91\u5982\u4e0b\u811a\u672c\uff0c\u540e\u7eedopenvpn\u7684\u914d\u7f6e\u6587\u4ef6 ",(0,s.jsx)(n.code,{children:"/etc/openvpn/server/server.conf"})," \u4e2d\u4f1a\u5f15\u7528\u8fd9\u4e2a\u811a\u672c"]})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"openvpn\u8fd0\u884c\u7528\u6237\u5bf9\u4e8e\u8fd9\u4e2a\u811a\u672c\u81f3\u5c11\u6709rx\u6743\u9650\uff0c\u5426\u5219\u8ba4\u8bc1\u4f1a\u5931\u8d25"})}),"\n",(0,s.jsx)(n.p,{children:":::"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'cat >> /etc/openvpn/checkpsw.sh <<\'EOF\'\n#!/bin/sh\n###########################################################\n# checkpsw.sh (C) 2004 Mathias Sundman <mathias@openvpn.se>\n#\n# This script will authenticate OpenVPN users against\n# a plain text file. The passfile should simply contain\n# one row per user with the username first followed by\n# one or more space(s) or tab(s) and then the password.\n\nPASSFILE="/etc/openvpn/psw-file"\nLOG_FILE="/etc/openvpn/openvpn-password.log"\nTIME_STAMP=`date "+%Y-%m-%d %T"`\n\n###########################################################\n\nif [ ! -r "${PASSFILE}" ]; then\n  echo "${TIME_STAMP}: Could not open password file \\"${PASSFILE}\\" for reading." >> ${LOG_FILE}\n  exit 1\nfi\n\nCORRECT_PASSWORD=`awk \'!/^;/&&!/^#/&&$1=="\'${username}\'"{print $2;exit}\' ${PASSFILE}`\n\nif [ "${CORRECT_PASSWORD}" = "" ]; then \n  echo "${TIME_STAMP}: User does not exist: username=\\"${username}\\", password=\\"${password}\\"." >> ${LOG_FILE}\n  exit 1\nfi\n\nif [ "${password}" = "${CORRECT_PASSWORD}" ]; then \n  echo "${TIME_STAMP}: Successful authentication: username=\\"${username}\\"." >> ${LOG_FILE}\n  exit 0\nfi\n\necho "${TIME_STAMP}: Incorrect password: username=\\"${username}\\", password=\\"${password}\\"." >> ${LOG_FILE}\nexit 1\nEOF\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u8d4b\u4e88\u811a\u672c\u6267\u884c\u6743\u9650"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"chmod +x /etc/openvpn/checkpsw.sh\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"22-\u4fee\u6539openvpn\u914d\u7f6e\u6587\u4ef6-etcopenvpnserverserverconf",children:["2.2 \u4fee\u6539openvpn\u914d\u7f6e\u6587\u4ef6 ",(0,s.jsx)(n.code,{children:"/etc/openvpn/server/server.conf"})]}),"\n",(0,s.jsx)(n.h4,{id:"221-\u8ffd\u52a0\u4ee5\u4e0b\u5185\u5bb9",children:"2.2.1 \u8ffd\u52a0\u4ee5\u4e0b\u5185\u5bb9"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["\u5176\u4e2d ",(0,s.jsx)(n.code,{children:"auth-user-pass-verify"})," \u5bf9\u5e94\u7684\u6587\u4ef6\u4e00\u5b9a\u8981\u4e0e\u4e0a\u4e00\u6b65\u521b\u5efa\u7684\u811a\u672c\u540d\u76f8\u540c"]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"cat >> /etc/openvpn/server/server.conf << EOF\nauth-user-pass-verify /etc/openvpn/checkpsw.sh via-env\nverify-client-cert\nusername-as-common-name\nscript-security 3\nEOF\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"/etc/openvpn/server/server.conf "})," \u6587\u4ef6\u9ed8\u8ba4\u5185\u5bb9"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'local 10.206.0.9\nport 1194\nproto udp\ndev tun\nca ca.crt\ncert server.crt\nkey server.key\ndh dh.pem\nauth SHA512\ntls-crypt tc.key\ntopology subnet\nserver 10.8.0.0 255.255.255.0\npush "redirect-gateway def1 bypass-dhcp"\nifconfig-pool-persist ipp.txt\npush "dhcp-option DNS 183.60.83.19"\npush "dhcp-option DNS 183.60.82.98"\nkeepalive 10 120\ncipher AES-256-CBC\nuser nobody\ngroup nobody\npersist-key\npersist-tun\nverb 3\ncrl-verify crl.pem\nexplicit-exit-notify\n'})}),"\n",(0,s.jsx)(n.h4,{id:"222-\u4fee\u6539-serverconf",children:"2.2.2 \u4fee\u6539 server.conf"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5220\u9664\u5f00\u5934\u7684 local \u4e00\u884c"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"sed -i.bak '1d' /etc/openvpn/server/server.conf \n"})}),"\n",(0,s.jsx)(n.h3,{id:"23-\u91cd\u542f\u670d\u52a1",children:"2.3 \u91cd\u542f\u670d\u52a1"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"systemctl enable openvpn@server.service\nsystemctl restart openvpn-server@server\n"})}),"\n",(0,s.jsx)(n.h3,{id:"24-\u6dfb\u52a0\u8d26\u53f7",children:"2.4 \u6dfb\u52a0\u8d26\u53f7"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["\u540e\u7eed\u7684\u8d26\u53f7\u90fd\u5728\u8fd9\u4e2a\u6587\u4ef6 ",(0,s.jsx)(n.code,{children:"/etc/openvpn/psw-file"})," \u4e2d\u6dfb\u52a0\uff0c\u7528\u6237\u540d\u548c\u5bc6\u7801\u4ee5\u7a7a\u683c\u9694\u5f00\uff0c\u6bcf\u884c\u4e00\u4e2a"]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u7528\u6237\u540d\u5bc6\u7801\u6587\u4ef6\ncat > /etc/openvpn/psw-file << EOF\ntest test123\nEOF\n\n# \u6587\u4ef6\u6240\u6709\u8005\u4e00\u5b9a\u8981\u662fopenvpn\u8fd0\u884c\u7684\u7528\u6237\uff0c\u8fd9\u91ccopenvpn\u9ed8\u8ba4\u8fd0\u884c\u7528\u6237\u4e3anobody\nchown nobody.nobody /etc/openvpn/psw-file && chmod 600 /etc/openvpn/psw-file\n"})}),"\n",(0,s.jsx)(n.h3,{id:"25-\u4fee\u6539\u5ba2\u6237\u7aef\u6587\u4ef6",children:"2.5 \u4fee\u6539\u5ba2\u6237\u7aef\u6587\u4ef6"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u6267\u884c\u5b8c\u4e00\u952e\u5b89\u88c5\u811a\u672c\u540e\u4f1a\u63d0\u793a\u5ba2\u6237\u7aef\u6587\u4ef6\u4f4d\u7f6e"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"The client configuration is available in: /root/pptfz.ovpn\nNew clients can be added by running this script again.\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["\u5ba2\u6237\u7aef\u6587\u4ef6\u9700\u8981\u8ffd\u52a0\u4e00\u884c ",(0,s.jsx)(n.code,{children:"auth-user-pass"})," \u5185\u5bb9\uff0c\u5f00\u542f\u7528\u6237\u540d\u5bc6\u7801\u8ba4\u8bc1\uff0c\u7136\u540e\u4e0b\u8f7d\u5230\u672c\u5730"]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"sed -i '14aauth-user-pass' /root/pptfz.ovpn \n"})}),"\n",(0,s.jsx)(n.h2,{id:"3\u5ba2\u6237\u7aef\u5b89\u88c5\u914d\u7f6e",children:"3.\u5ba2\u6237\u7aef\u5b89\u88c5\u914d\u7f6e"}),"\n",(0,s.jsx)(n.h3,{id:"31-mac\u8fde\u63a5\u793a\u4f8b",children:"3.1 mac\u8fde\u63a5\u793a\u4f8b"}),"\n",(0,s.jsxs)(n.p,{children:["\u8fd9\u91cc\u4ee5mac\u4e3a\u4f8b\uff0c\u6211\u4e0b\u8f7d\u7684\u662f ",(0,s.jsx)(n.code,{children:"Tunnelblick"})," ",(0,s.jsx)(n.a,{href:"https://github.com/Tunnelblick/Tunnelblick",children:"Tunnelblick github\u5730\u5740"})]}),"\n",(0,s.jsxs)(n.p,{children:["\u5b89\u88c5\u5b8c\u6210\u540e\u628a\u5ba2\u6237\u7aef\u6587\u4ef6 ",(0,s.jsx)(n.code,{children:"pptfz.ovpn(\u6587\u4ef6\u540d\u662f\u81ea\u5b9a\u4e49\u7684)"})," \u62d6\u5165\u5230 ",(0,s.jsx)(n.code,{children:"Tunnelblick"})]}),"\n",(0,s.jsx)(n.p,{children:"\u9009\u62e9\u5b89\u88c5\u7684\u7528\u6237"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-11-30%2020.20.36.png",alt:"iShot2020-11-30 20.20.36"})}),"\n",(0,s.jsx)(n.p,{children:"\u8f93\u5165\u672c\u673a\u5bc6\u7801"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-11-30%2020.21.56.png",alt:"iShot2020-11-30 20.21.56"})}),"\n",(0,s.jsx)(n.p,{children:"\u8f93\u5165\u5b8c\u6210\u540e\u4f1a\u63d0\u793a\u5982\u4e0b"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-11-30%2020.22.21.png",alt:"iShot2020-11-30 20.22.21"})}),"\n",(0,s.jsx)(n.p,{children:"\u627e\u5230\u76f8\u5e94\u56fe\u6807\uff0c\u70b9\u51fb\u8981\u8fde\u63a5\u7684VPN"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-12-01%2011.43.18.png",alt:"iShot2020-12-01 11.43.18"})}),"\n",(0,s.jsx)(n.p,{children:"\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-12-01%2011.44.37.png",alt:"iShot2020-12-01 11.44.37"})}),"\n",(0,s.jsx)(n.p,{children:"\u8fde\u63a5\u6210\u529f"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-12-01%2014.16.11.png",alt:"iShot2020-12-01 14.16.11"})}),"\n",(0,s.jsxs)(n.p,{children:["\u8fde\u63a5\u6210\u529f\u540e\uff0c\u5c31\u4f1a\u5728\u672c\u673a\u751f\u6210\u4e00\u4e2a ",(0,s.jsx)(n.code,{children:"utun1"})," \u7684\u865a\u62df\u7f51\u5361\uff0c\u5e76\u83b7\u53d6openvpn ",(0,s.jsx)(n.code,{children:"server.conf"})," \u4e2d\u8bbe\u7f6e\u7684  ",(0,s.jsx)(n.code,{children:"server 10.8.0.0 255.255.255.0"})," \u7ed9\u5ba2\u6237\u7aef\u5206\u914d\u7684\u7f51\u6bb5\uff0cIP\u5730\u5740\u4ece 10.8.0.2 \u5f00\u59cb\u5206\u914d"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"utun1: flags=8051<UP,POINTOPOINT,RUNNING,MULTICAST> mtu 1500\n\tinet 10.8.0.2 --\x3e 10.8.0.2 netmask 0xffffff00 \n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6b64\u65f6mac\u672c\u673a\u662f\u80fd\u4e0e\u670d\u52a1\u5668\u5185\u7f51\u76f8\u4e92ping\u901a\u7684"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"mac\u672c\u673aping\u670d\u52a1\u5668\u5185\u7f51"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"$ ping -c2 10.206.0.9\nPING 10.206.0.9 (10.206.0.9): 56 data bytes\n64 bytes from 10.206.0.9: icmp_seq=0 ttl=64 time=90.547 ms\n64 bytes from 10.206.0.9: icmp_seq=1 ttl=64 time=63.691 ms\n\n--- 10.206.0.9 ping statistics ---\n2 packets transmitted, 2 packets received, 0.0% packet loss\nround-trip min/avg/max/stddev = 63.691/77.119/90.547/13.428 ms\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u670d\u52a1\u5668ping mac\u672c\u673a"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"$ ping -c2 10.8.0.2\nPING 10.8.0.2 (10.8.0.2) 56(84) bytes of data.\n64 bytes from 10.8.0.2: icmp_seq=1 ttl=64 time=85.3 ms\n64 bytes from 10.8.0.2: icmp_seq=2 ttl=64 time=90.3 ms\n\n--- 10.8.0.2 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1000ms\nrtt min/avg/max/mdev = 85.362/87.876/90.390/2.514 ms\n"})}),"\n",(0,s.jsx)(n.h3,{id:"32-windows\u8fde\u63a5\u793a\u4f8b",children:"3.2 windows\u8fde\u63a5\u793a\u4f8b"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://openvpn.net/downloads/openvpn-connect-v3-windows.msi",children:"\u4e0b\u8f7dwindows\u7248\u5b89\u88c5\u5305"})}),"\n",(0,s.jsx)(n.p,{children:"windows\u5b89\u88c5\u5c31\u662f\u4e00\u8def\u4e0b\u4e00\u6b65"}),"\n",(0,s.jsx)(n.p,{children:"\u5bfc\u5165\u5ba2\u6237\u7aef\u6587\u4ef6"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-12-01%2015.00.29.png",alt:"iShot2020-12-01 15.00.29"})}),"\n",(0,s.jsx)(n.p,{children:"\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-12-01%2015.11.36.png",alt:"iShot2020-12-01 15.11.36"})}),"\n",(0,s.jsx)(n.p,{children:"\u8fde\u63a5\u6210\u529f"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-12-01%2015.12.14.png",alt:"iShot2020-12-01 15.12.14"})}),"\n",(0,s.jsx)(n.h2,{id:"4\u4e91\u4e3b\u673a\u5b89\u5168\u7ec4\u914d\u7f6e\u8bf4\u660e",children:"4.\u4e91\u4e3b\u673a\u5b89\u5168\u7ec4\u914d\u7f6e\u8bf4\u660e"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u4f7f\u7528\u793a\u4f8b"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5047\u8bbe\u516c\u53f8\u4ee3\u7801\u5e93gitlab\u3001\u4e0a\u7ebf\u5de5\u5177jenkins\u7b49\u7b49\u90e8\u7f72\u5728\u4e91\u4e3b\u673a\u4e2d\uff0c\u73b0\u5728\u53ea\u5141\u8bb8\u516c\u53f8IP\u548copenvpn IP\u8bbf\u95ee"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5219\u53ea\u9700\u8981\u5728\u5b89\u5168\u7ec4\u4e2d\u52a0\u5165\u4ee5\u4e0b\u4e24\u6761\u89c4\u5219\u5373\u53ef"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1.\u5141\u8bb8\u516c\u53f8IP\u8bbf\u95ee"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"2.\u5141\u8bb8OpenVPN\u6240\u5728\u673a\u5668\u516c\u7f51IP\u8bbf\u95ee"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5728\u4e91\u4e3b\u673a\u4e2d\u8fd8\u53ef\u4ee5\u6839\u636e\u5177\u4f53\u60c5\u51b5\u8bbe\u7f6e\u76f8\u5173\u5b89\u5168\u7b56\u7565\uff0c\u5305\u62ec\u7f51\u7edcACL\u8bbf\u95ee\u63a7\u5236\uff0c\u5b89\u5168\u7ec4\u7b49\u7b49"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"openvpn+\u4e91\u4e3b\u673a\u5b89\u5168\u7ec4\u7684\u5e94\u7528\u573a\u666f"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u5982\u679c\u670d\u52a1\u6240\u5728\u673a\u5668\u662f\u7ecf\u5178\u7f51\u7edc(\u6709\u516c\u7f51IP)\uff0c\u5219\u5185\u7f51\u548c\u516c\u7f51\u90fd\u53ef\u4ee5\u8bbf\u95ee"}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u679c\u670d\u52a1\u6240\u5728\u673a\u5668\u662fVPC\u7f51\u7edc(\u65e0\u516c\u7f51IP)\uff0c\u5219\u53ea\u5141\u8bb8\u5185\u7f51\u8bbf\u95ee"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"5\u811a\u672c\u5185\u5bb9",children:"5.\u811a\u672c\u5185\u5bb9"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'#!/bin/bash\n#\n# https://github.com/Nyr/openvpn-install\n#\n# Copyright (c) 2013 Nyr. Released under the MIT License.\n\n\n# Detect Debian users running the script with "sh" instead of bash\nif readlink /proc/$$/exe | grep -q "dash"; then\n\techo \'This installer needs to be run with "bash", not "sh".\'\n\texit\nfi\n\n# Discard stdin. Needed when running from an one-liner which includes a newline\nread -N 999999 -t 0.001\n\n# Detect OpenVZ 6\nif [[ $(uname -r | cut -d "." -f 1) -eq 2 ]]; then\n\techo "The system is running an old kernel, which is incompatible with this installer."\n\texit\nfi\n\n# Detect OS\n# $os_version variables aren\'t always in use, but are kept here for convenience\nif grep -qs "ubuntu" /etc/os-release; then\n\tos="ubuntu"\n\tos_version=$(grep \'VERSION_ID\' /etc/os-release | cut -d \'"\' -f 2 | tr -d \'.\')\n\tgroup_name="nogroup"\nelif [[ -e /etc/debian_version ]]; then\n\tos="debian"\n\tos_version=$(grep -oE \'[0-9]+\' /etc/debian_version | head -1)\n\tgroup_name="nogroup"\nelif [[ -e /etc/almalinux-release || -e /etc/rocky-release || -e /etc/centos-release ]]; then\n\tos="centos"\n\tos_version=$(grep -shoE \'[0-9]+\' /etc/almalinux-release /etc/rocky-release /etc/centos-release | head -1)\n\tgroup_name="nobody"\nelif [[ -e /etc/fedora-release ]]; then\n\tos="fedora"\n\tos_version=$(grep -oE \'[0-9]+\' /etc/fedora-release | head -1)\n\tgroup_name="nobody"\nelse\n\techo "This installer seems to be running on an unsupported distribution.\nSupported distros are Ubuntu, Debian, AlmaLinux, Rocky Linux, CentOS and Fedora."\n\texit\nfi\n\nif [[ "$os" == "ubuntu" && "$os_version" -lt 1804 ]]; then\n\techo "Ubuntu 18.04 or higher is required to use this installer.\nThis version of Ubuntu is too old and unsupported."\n\texit\nfi\n\nif [[ "$os" == "debian" && "$os_version" -lt 9 ]]; then\n\techo "Debian 9 or higher is required to use this installer.\nThis version of Debian is too old and unsupported."\n\texit\nfi\n\nif [[ "$os" == "centos" && "$os_version" -lt 7 ]]; then\n\techo "CentOS 7 or higher is required to use this installer.\nThis version of CentOS is too old and unsupported."\n\texit\nfi\n\n# Detect environments where $PATH does not include the sbin directories\nif ! grep -q sbin <<< "$PATH"; then\n\techo \'$PATH does not include sbin. Try using "su -" instead of "su".\'\n\texit\nfi\n\nif [[ "$EUID" -ne 0 ]]; then\n\techo "This installer needs to be run with superuser privileges."\n\texit\nfi\n\nif [[ ! -e /dev/net/tun ]] || ! ( exec 7<>/dev/net/tun ) 2>/dev/null; then\n\techo "The system does not have the TUN device available.\nTUN needs to be enabled before running this installer."\n\texit\nfi\n\nnew_client () {\n\t# Generates the custom client.ovpn\n\t{\n\tcat /etc/openvpn/server/client-common.txt\n\techo "<ca>"\n\tcat /etc/openvpn/server/easy-rsa/pki/ca.crt\n\techo "</ca>"\n\techo "<cert>"\n\tsed -ne \'/BEGIN CERTIFICATE/,$ p\' /etc/openvpn/server/easy-rsa/pki/issued/"$client".crt\n\techo "</cert>"\n\techo "<key>"\n\tcat /etc/openvpn/server/easy-rsa/pki/private/"$client".key\n\techo "</key>"\n\techo "<tls-crypt>"\n\tsed -ne \'/BEGIN OpenVPN Static key/,$ p\' /etc/openvpn/server/tc.key\n\techo "</tls-crypt>"\n\t} > ~/"$client".ovpn\n}\n\nif [[ ! -e /etc/openvpn/server/server.conf ]]; then\n\t# Detect some Debian minimal setups where neither wget nor curl are installed\n\tif ! hash wget 2>/dev/null && ! hash curl 2>/dev/null; then\n\t\techo "Wget is required to use this installer."\n\t\tread -n1 -r -p "Press any key to install Wget and continue..."\n\t\tapt-get update\n\t\tapt-get install -y wget\n\tfi\n\tclear\n\techo \'Welcome to this OpenVPN road warrior installer!\'\n\t# If system has a single IPv4, it is selected automatically. Else, ask the user\n\tif [[ $(ip -4 addr | grep inet | grep -vEc \'127(\\.[0-9]{1,3}){3}\') -eq 1 ]]; then\n\t\tip=$(ip -4 addr | grep inet | grep -vE \'127(\\.[0-9]{1,3}){3}\' | cut -d \'/\' -f 1 | grep -oE \'[0-9]{1,3}(\\.[0-9]{1,3}){3}\')\n\telse\n\t\tnumber_of_ip=$(ip -4 addr | grep inet | grep -vEc \'127(\\.[0-9]{1,3}){3}\')\n\t\techo\n\t\techo "Which IPv4 address should be used?"\n\t\tip -4 addr | grep inet | grep -vE \'127(\\.[0-9]{1,3}){3}\' | cut -d \'/\' -f 1 | grep -oE \'[0-9]{1,3}(\\.[0-9]{1,3}){3}\' | nl -s \') \'\n\t\tread -p "IPv4 address [1]: " ip_number\n\t\tuntil [[ -z "$ip_number" || "$ip_number" =~ ^[0-9]+$ && "$ip_number" -le "$number_of_ip" ]]; do\n\t\t\techo "$ip_number: invalid selection."\n\t\t\tread -p "IPv4 address [1]: " ip_number\n\t\tdone\n\t\t[[ -z "$ip_number" ]] && ip_number="1"\n\t\tip=$(ip -4 addr | grep inet | grep -vE \'127(\\.[0-9]{1,3}){3}\' | cut -d \'/\' -f 1 | grep -oE \'[0-9]{1,3}(\\.[0-9]{1,3}){3}\' | sed -n "$ip_number"p)\n\tfi\n\t#\xa0If $ip is a private IP address, the server must be behind NAT\n\tif echo "$ip" | grep -qE \'^(10\\.|172\\.1[6789]\\.|172\\.2[0-9]\\.|172\\.3[01]\\.|192\\.168)\'; then\n\t\techo\n\t\techo "This server is behind NAT. What is the public IPv4 address or hostname?"\n\t\t# Get public IP and sanitize with grep\n\t\tget_public_ip=$(grep -m 1 -oE \'^[0-9]{1,3}(\\.[0-9]{1,3}){3}$\' <<< "$(wget -T 10 -t 1 -4qO- "http://ip1.dynupdate.no-ip.com/" || curl -m 10 -4Ls "http://ip1.dynupdate.no-ip.com/")")\n\t\tread -p "Public IPv4 address / hostname [$get_public_ip]: " public_ip\n\t\t# If the checkip service is unavailable and user didn\'t provide input, ask again\n\t\tuntil [[ -n "$get_public_ip" || -n "$public_ip" ]]; do\n\t\t\techo "Invalid input."\n\t\t\tread -p "Public IPv4 address / hostname: " public_ip\n\t\tdone\n\t\t[[ -z "$public_ip" ]] && public_ip="$get_public_ip"\n\tfi\n\t# If system has a single IPv6, it is selected automatically\n\tif [[ $(ip -6 addr | grep -c \'inet6 [23]\') -eq 1 ]]; then\n\t\tip6=$(ip -6 addr | grep \'inet6 [23]\' | cut -d \'/\' -f 1 | grep -oE \'([0-9a-fA-F]{0,4}:){1,7}[0-9a-fA-F]{0,4}\')\n\tfi\n\t# If system has multiple IPv6, ask the user to select one\n\tif [[ $(ip -6 addr | grep -c \'inet6 [23]\') -gt 1 ]]; then\n\t\tnumber_of_ip6=$(ip -6 addr | grep -c \'inet6 [23]\')\n\t\techo\n\t\techo "Which IPv6 address should be used?"\n\t\tip -6 addr | grep \'inet6 [23]\' | cut -d \'/\' -f 1 | grep -oE \'([0-9a-fA-F]{0,4}:){1,7}[0-9a-fA-F]{0,4}\' | nl -s \') \'\n\t\tread -p "IPv6 address [1]: " ip6_number\n\t\tuntil [[ -z "$ip6_number" || "$ip6_number" =~ ^[0-9]+$ && "$ip6_number" -le "$number_of_ip6" ]]; do\n\t\t\techo "$ip6_number: invalid selection."\n\t\t\tread -p "IPv6 address [1]: " ip6_number\n\t\tdone\n\t\t[[ -z "$ip6_number" ]] && ip6_number="1"\n\t\tip6=$(ip -6 addr | grep \'inet6 [23]\' | cut -d \'/\' -f 1 | grep -oE \'([0-9a-fA-F]{0,4}:){1,7}[0-9a-fA-F]{0,4}\' | sed -n "$ip6_number"p)\n\tfi\n\techo\n\techo "Which protocol should OpenVPN use?"\n\techo "   1) UDP (recommended)"\n\techo "   2) TCP"\n\tread -p "Protocol [1]: " protocol\n\tuntil [[ -z "$protocol" || "$protocol" =~ ^[12]$ ]]; do\n\t\techo "$protocol: invalid selection."\n\t\tread -p "Protocol [1]: " protocol\n\tdone\n\tcase "$protocol" in\n\t\t1|"") \n\t\tprotocol=udp\n\t\t;;\n\t\t2) \n\t\tprotocol=tcp\n\t\t;;\n\tesac\n\techo\n\techo "What port should OpenVPN listen to?"\n\tread -p "Port [1194]: " port\n\tuntil [[ -z "$port" || "$port" =~ ^[0-9]+$ && "$port" -le 65535 ]]; do\n\t\techo "$port: invalid port."\n\t\tread -p "Port [1194]: " port\n\tdone\n\t[[ -z "$port" ]] && port="1194"\n\techo\n\techo "Select a DNS server for the clients:"\n\techo "   1) Current system resolvers"\n\techo "   2) Google"\n\techo "   3) 1.1.1.1"\n\techo "   4) OpenDNS"\n\techo "   5) Quad9"\n\techo "   6) AdGuard"\n\tread -p "DNS server [1]: " dns\n\tuntil [[ -z "$dns" || "$dns" =~ ^[1-6]$ ]]; do\n\t\techo "$dns: invalid selection."\n\t\tread -p "DNS server [1]: " dns\n\tdone\n\techo\n\techo "Enter a name for the first client:"\n\tread -p "Name [client]: " unsanitized_client\n\t# Allow a limited set of characters to avoid conflicts\n\tclient=$(sed \'s/[^0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-]/_/g\' <<< "$unsanitized_client")\n\t[[ -z "$client" ]] && client="client"\n\techo\n\techo "OpenVPN installation is ready to begin."\n\t# Install a firewall if firewalld or iptables are not already available\n\tif ! systemctl is-active --quiet firewalld.service && ! hash iptables 2>/dev/null; then\n\t\tif [[ "$os" == "centos" || "$os" == "fedora" ]]; then\n\t\t\tfirewall="firewalld"\n\t\t\t# We don\'t want to silently enable firewalld, so we give a subtle warning\n\t\t\t# If the user continues, firewalld will be installed and enabled during setup\n\t\t\techo "firewalld, which is required to manage routing tables, will also be installed."\n\t\telif [[ "$os" == "debian" || "$os" == "ubuntu" ]]; then\n\t\t\t# iptables is way less invasive than firewalld so no warning is given\n\t\t\tfirewall="iptables"\n\t\tfi\n\tfi\n\tread -n1 -r -p "Press any key to continue..."\n\t# If running inside a container, disable LimitNPROC to prevent conflicts\n\tif systemd-detect-virt -cq; then\n\t\tmkdir /etc/systemd/system/openvpn-server@server.service.d/ 2>/dev/null\n\t\techo "[Service]\nLimitNPROC=infinity" > /etc/systemd/system/openvpn-server@server.service.d/disable-limitnproc.conf\n\tfi\n\tif [[ "$os" = "debian" || "$os" = "ubuntu" ]]; then\n\t\tapt-get update\n\t\tapt-get install -y openvpn openssl ca-certificates $firewall\n\telif [[ "$os" = "centos" ]]; then\n\t\tyum install -y epel-release\n\t\tyum install -y openvpn openssl ca-certificates tar $firewall\n\telse\n\t\t# Else, OS must be Fedora\n\t\tdnf install -y openvpn openssl ca-certificates tar $firewall\n\tfi\n\t# If firewalld was just installed, enable it\n\tif [[ "$firewall" == "firewalld" ]]; then\n\t\tsystemctl enable --now firewalld.service\n\tfi\n\t# Get easy-rsa\n\teasy_rsa_url=\'https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.8/EasyRSA-3.0.8.tgz\'\n\tmkdir -p /etc/openvpn/server/easy-rsa/\n\t{ wget -qO- "$easy_rsa_url" 2>/dev/null || curl -sL "$easy_rsa_url" ; } | tar xz -C /etc/openvpn/server/easy-rsa/ --strip-components 1\n\tchown -R root:root /etc/openvpn/server/easy-rsa/\n\tcd /etc/openvpn/server/easy-rsa/\n\t# Create the PKI, set up the CA and the server and client certificates\n\t./easyrsa init-pki\n\t./easyrsa --batch build-ca nopass\n\tEASYRSA_CERT_EXPIRE=3650 ./easyrsa build-server-full server nopass\n\tEASYRSA_CERT_EXPIRE=3650 ./easyrsa build-client-full "$client" nopass\n\tEASYRSA_CRL_DAYS=3650 ./easyrsa gen-crl\n\t# Move the stuff we need\n\tcp pki/ca.crt pki/private/ca.key pki/issued/server.crt pki/private/server.key pki/crl.pem /etc/openvpn/server\n\t# CRL is read with each client connection, while OpenVPN is dropped to nobody\n\tchown nobody:"$group_name" /etc/openvpn/server/crl.pem\n\t# Without +x in the directory, OpenVPN can\'t run a stat() on the CRL file\n\tchmod o+x /etc/openvpn/server/\n\t# Generate key for tls-crypt\n\topenvpn --genkey --secret /etc/openvpn/server/tc.key\n\t# Create the DH parameters file using the predefined ffdhe2048 group\n\techo \'-----BEGIN DH PARAMETERS-----\nMIIBCAKCAQEA//////////+t+FRYortKmq/cViAnPTzx2LnFg84tNpWp4TZBFGQz\n+8yTnc4kmz75fS/jY2MMddj2gbICrsRhetPfHtXV/WVhJDP1H18GbtCFY2VVPe0a\n87VXE15/V8k1mE8McODmi3fipona8+/och3xWKE2rec1MKzKT0g6eXq8CrGCsyT7\nYdEIqUuyyOP7uWrat2DX9GgdT0Kj3jlN9K5W7edjcrsZCwenyO4KbXCeAvzhzffi\n7MA0BM0oNC9hkXL+nOmFg/+OTxIy7vKBg8P+OxtMb61zO7X8vC7CIAXFjvGDfRaD\nssbzSibBsu/6iGtCOGEoXJf//////////wIBAg==\n-----END DH PARAMETERS-----\' > /etc/openvpn/server/dh.pem\n\t# Generate server.conf\n\techo "local $ip\nport $port\nproto $protocol\ndev tun\nca ca.crt\ncert server.crt\nkey server.key\ndh dh.pem\nauth SHA512\ntls-crypt tc.key\ntopology subnet\nserver 10.8.0.0 255.255.255.0" > /etc/openvpn/server/server.conf\n\t# IPv6\n\tif [[ -z "$ip6" ]]; then\n\t\techo \'push "redirect-gateway def1 bypass-dhcp"\' >> /etc/openvpn/server/server.conf\n\telse\n\t\techo \'server-ipv6 fddd:1194:1194:1194::/64\' >> /etc/openvpn/server/server.conf\n\t\techo \'push "redirect-gateway def1 ipv6 bypass-dhcp"\' >> /etc/openvpn/server/server.conf\n\tfi\n\techo \'ifconfig-pool-persist ipp.txt\' >> /etc/openvpn/server/server.conf\n\t# DNS\n\tcase "$dns" in\n\t\t1|"")\n\t\t\t# Locate the proper resolv.conf\n\t\t\t# Needed for systems running systemd-resolved\n\t\t\tif grep -q \'^nameserver 127.0.0.53\' "/etc/resolv.conf"; then\n\t\t\t\tresolv_conf="/run/systemd/resolve/resolv.conf"\n\t\t\telse\n\t\t\t\tresolv_conf="/etc/resolv.conf"\n\t\t\tfi\n\t\t\t# Obtain the resolvers from resolv.conf and use them for OpenVPN\n\t\t\tgrep -v \'^#\\|^;\' "$resolv_conf" | grep \'^nameserver\' | grep -oE \'[0-9]{1,3}(\\.[0-9]{1,3}){3}\' | while read line; do\n\t\t\t\techo "push \\"dhcp-option DNS $line\\"" >> /etc/openvpn/server/server.conf\n\t\t\tdone\n\t\t;;\n\t\t2)\n\t\t\techo \'push "dhcp-option DNS 8.8.8.8"\' >> /etc/openvpn/server/server.conf\n\t\t\techo \'push "dhcp-option DNS 8.8.4.4"\' >> /etc/openvpn/server/server.conf\n\t\t;;\n\t\t3)\n\t\t\techo \'push "dhcp-option DNS 1.1.1.1"\' >> /etc/openvpn/server/server.conf\n\t\t\techo \'push "dhcp-option DNS 1.0.0.1"\' >> /etc/openvpn/server/server.conf\n\t\t;;\n\t\t4)\n\t\t\techo \'push "dhcp-option DNS 208.67.222.222"\' >> /etc/openvpn/server/server.conf\n\t\t\techo \'push "dhcp-option DNS 208.67.220.220"\' >> /etc/openvpn/server/server.conf\n\t\t;;\n\t\t5)\n\t\t\techo \'push "dhcp-option DNS 9.9.9.9"\' >> /etc/openvpn/server/server.conf\n\t\t\techo \'push "dhcp-option DNS 149.112.112.112"\' >> /etc/openvpn/server/server.conf\n\t\t;;\n\t\t6)\n\t\t\techo \'push "dhcp-option DNS 94.140.14.14"\' >> /etc/openvpn/server/server.conf\n\t\t\techo \'push "dhcp-option DNS 94.140.15.15"\' >> /etc/openvpn/server/server.conf\n\t\t;;\n\tesac\n\techo "keepalive 10 120\ncipher AES-256-CBC\nuser nobody\ngroup $group_name\npersist-key\npersist-tun\nverb 3\ncrl-verify crl.pem" >> /etc/openvpn/server/server.conf\n\tif [[ "$protocol" = "udp" ]]; then\n\t\techo "explicit-exit-notify" >> /etc/openvpn/server/server.conf\n\tfi\n\t# Enable net.ipv4.ip_forward for the system\n\techo \'net.ipv4.ip_forward=1\' > /etc/sysctl.d/99-openvpn-forward.conf\n\t# Enable without waiting for a reboot or service restart\n\techo 1 > /proc/sys/net/ipv4/ip_forward\n\tif [[ -n "$ip6" ]]; then\n\t\t# Enable net.ipv6.conf.all.forwarding for the system\n\t\techo "net.ipv6.conf.all.forwarding=1" >> /etc/sysctl.d/99-openvpn-forward.conf\n\t\t# Enable without waiting for a reboot or service restart\n\t\techo 1 > /proc/sys/net/ipv6/conf/all/forwarding\n\tfi\n\tif systemctl is-active --quiet firewalld.service; then\n\t\t# Using both permanent and not permanent rules to avoid a firewalld\n\t\t# reload.\n\t\t# We don\'t use --add-service=openvpn because that would only work with\n\t\t# the default port and protocol.\n\t\tfirewall-cmd --add-port="$port"/"$protocol"\n\t\tfirewall-cmd --zone=trusted --add-source=10.8.0.0/24\n\t\tfirewall-cmd --permanent --add-port="$port"/"$protocol"\n\t\tfirewall-cmd --permanent --zone=trusted --add-source=10.8.0.0/24\n\t\t# Set NAT for the VPN subnet\n\t\tfirewall-cmd --direct --add-rule ipv4 nat POSTROUTING 0 -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to "$ip"\n\t\tfirewall-cmd --permanent --direct --add-rule ipv4 nat POSTROUTING 0 -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to "$ip"\n\t\tif [[ -n "$ip6" ]]; then\n\t\t\tfirewall-cmd --zone=trusted --add-source=fddd:1194:1194:1194::/64\n\t\t\tfirewall-cmd --permanent --zone=trusted --add-source=fddd:1194:1194:1194::/64\n\t\t\tfirewall-cmd --direct --add-rule ipv6 nat POSTROUTING 0 -s fddd:1194:1194:1194::/64 ! -d fddd:1194:1194:1194::/64 -j SNAT --to "$ip6"\n\t\t\tfirewall-cmd --permanent --direct --add-rule ipv6 nat POSTROUTING 0 -s fddd:1194:1194:1194::/64 ! -d fddd:1194:1194:1194::/64 -j SNAT --to "$ip6"\n\t\tfi\n\telse\n\t\t# Create a service to set up persistent iptables rules\n\t\tiptables_path=$(command -v iptables)\n\t\tip6tables_path=$(command -v ip6tables)\n\t\t# nf_tables is not available as standard in OVZ kernels. So use iptables-legacy\n\t\t# if we are in OVZ, with a nf_tables backend and iptables-legacy is available.\n\t\tif [[ $(systemd-detect-virt) == "openvz" ]] && readlink -f "$(command -v iptables)" | grep -q "nft" && hash iptables-legacy 2>/dev/null; then\n\t\t\tiptables_path=$(command -v iptables-legacy)\n\t\t\tip6tables_path=$(command -v ip6tables-legacy)\n\t\tfi\n\t\techo "[Unit]\nBefore=network.target\n[Service]\nType=oneshot\nExecStart=$iptables_path -t nat -A POSTROUTING -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to $ip\nExecStart=$iptables_path -I INPUT -p $protocol --dport $port -j ACCEPT\nExecStart=$iptables_path -I FORWARD -s 10.8.0.0/24 -j ACCEPT\nExecStart=$iptables_path -I FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT\nExecStop=$iptables_path -t nat -D POSTROUTING -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to $ip\nExecStop=$iptables_path -D INPUT -p $protocol --dport $port -j ACCEPT\nExecStop=$iptables_path -D FORWARD -s 10.8.0.0/24 -j ACCEPT\nExecStop=$iptables_path -D FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT" > /etc/systemd/system/openvpn-iptables.service\n\t\tif [[ -n "$ip6" ]]; then\n\t\t\techo "ExecStart=$ip6tables_path -t nat -A POSTROUTING -s fddd:1194:1194:1194::/64 ! -d fddd:1194:1194:1194::/64 -j SNAT --to $ip6\nExecStart=$ip6tables_path -I FORWARD -s fddd:1194:1194:1194::/64 -j ACCEPT\nExecStart=$ip6tables_path -I FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT\nExecStop=$ip6tables_path -t nat -D POSTROUTING -s fddd:1194:1194:1194::/64 ! -d fddd:1194:1194:1194::/64 -j SNAT --to $ip6\nExecStop=$ip6tables_path -D FORWARD -s fddd:1194:1194:1194::/64 -j ACCEPT\nExecStop=$ip6tables_path -D FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT" >> /etc/systemd/system/openvpn-iptables.service\n\t\tfi\n\t\techo "RemainAfterExit=yes\n[Install]\nWantedBy=multi-user.target" >> /etc/systemd/system/openvpn-iptables.service\n\t\tsystemctl enable --now openvpn-iptables.service\n\tfi\n\t# If SELinux is enabled and a custom port was selected, we need this\n\tif sestatus 2>/dev/null | grep "Current mode" | grep -q "enforcing" && [[ "$port" != 1194 ]]; then\n\t\t# Install semanage if not already present\n\t\tif ! hash semanage 2>/dev/null; then\n\t\t\tif [[ "$os_version" -eq 7 ]]; then\n\t\t\t\t# Centos 7\n\t\t\t\tyum install -y policycoreutils-python\n\t\t\telse\n\t\t\t\t# CentOS 8 or Fedora\n\t\t\t\tdnf install -y policycoreutils-python-utils\n\t\t\tfi\n\t\tfi\n\t\tsemanage port -a -t openvpn_port_t -p "$protocol" "$port"\n\tfi\n\t# If the server is behind NAT, use the correct IP address\n\t[[ -n "$public_ip" ]] && ip="$public_ip"\n\t# client-common.txt is created so we have a template to add further users later\n\techo "client\ndev tun\nproto $protocol\nremote $ip $port\nresolv-retry infinite\nnobind\npersist-key\npersist-tun\nremote-cert-tls server\nauth SHA512\ncipher AES-256-CBC\nignore-unknown-option block-outside-dns\nblock-outside-dns\nverb 3" > /etc/openvpn/server/client-common.txt\n\t# Enable and start the OpenVPN service\n\tsystemctl enable --now openvpn-server@server.service\n\t# Generates the custom client.ovpn\n\tnew_client\n\techo\n\techo "Finished!"\n\techo\n\techo "The client configuration is available in:" ~/"$client.ovpn"\n\techo "New clients can be added by running this script again."\nelse\n\tclear\n\techo "OpenVPN is already installed."\n\techo\n\techo "Select an option:"\n\techo "   1) Add a new client"\n\techo "   2) Revoke an existing client"\n\techo "   3) Remove OpenVPN"\n\techo "   4) Exit"\n\tread -p "Option: " option\n\tuntil [[ "$option" =~ ^[1-4]$ ]]; do\n\t\techo "$option: invalid selection."\n\t\tread -p "Option: " option\n\tdone\n\tcase "$option" in\n\t\t1)\n\t\t\techo\n\t\t\techo "Provide a name for the client:"\n\t\t\tread -p "Name: " unsanitized_client\n\t\t\tclient=$(sed \'s/[^0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-]/_/g\' <<< "$unsanitized_client")\n\t\t\twhile [[ -z "$client" || -e /etc/openvpn/server/easy-rsa/pki/issued/"$client".crt ]]; do\n\t\t\t\techo "$client: invalid name."\n\t\t\t\tread -p "Name: " unsanitized_client\n\t\t\t\tclient=$(sed \'s/[^0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-]/_/g\' <<< "$unsanitized_client")\n\t\t\tdone\n\t\t\tcd /etc/openvpn/server/easy-rsa/\n\t\t\tEASYRSA_CERT_EXPIRE=3650 ./easyrsa build-client-full "$client" nopass\n\t\t\t# Generates the custom client.ovpn\n\t\t\tnew_client\n\t\t\techo\n\t\t\techo "$client added. Configuration available in:" ~/"$client.ovpn"\n\t\t\texit\n\t\t;;\n\t\t2)\n\t\t\t# This option could be documented a bit better and maybe even be simplified\n\t\t\t# ...but what can I say, I want some sleep too\n\t\t\tnumber_of_clients=$(tail -n +2 /etc/openvpn/server/easy-rsa/pki/index.txt | grep -c "^V")\n\t\t\tif [[ "$number_of_clients" = 0 ]]; then\n\t\t\t\techo\n\t\t\t\techo "There are no existing clients!"\n\t\t\t\texit\n\t\t\tfi\n\t\t\techo\n\t\t\techo "Select the client to revoke:"\n\t\t\ttail -n +2 /etc/openvpn/server/easy-rsa/pki/index.txt | grep "^V" | cut -d \'=\' -f 2 | nl -s \') \'\n\t\t\tread -p "Client: " client_number\n\t\t\tuntil [[ "$client_number" =~ ^[0-9]+$ && "$client_number" -le "$number_of_clients" ]]; do\n\t\t\t\techo "$client_number: invalid selection."\n\t\t\t\tread -p "Client: " client_number\n\t\t\tdone\n\t\t\tclient=$(tail -n +2 /etc/openvpn/server/easy-rsa/pki/index.txt | grep "^V" | cut -d \'=\' -f 2 | sed -n "$client_number"p)\n\t\t\techo\n\t\t\tread -p "Confirm $client revocation? [y/N]: " revoke\n\t\t\tuntil [[ "$revoke" =~ ^[yYnN]*$ ]]; do\n\t\t\t\techo "$revoke: invalid selection."\n\t\t\t\tread -p "Confirm $client revocation? [y/N]: " revoke\n\t\t\tdone\n\t\t\tif [[ "$revoke" =~ ^[yY]$ ]]; then\n\t\t\t\tcd /etc/openvpn/server/easy-rsa/\n\t\t\t\t./easyrsa --batch revoke "$client"\n\t\t\t\tEASYRSA_CRL_DAYS=3650 ./easyrsa gen-crl\n\t\t\t\trm -f /etc/openvpn/server/crl.pem\n\t\t\t\tcp /etc/openvpn/server/easy-rsa/pki/crl.pem /etc/openvpn/server/crl.pem\n\t\t\t\t# CRL is read with each client connection, when OpenVPN is dropped to nobody\n\t\t\t\tchown nobody:"$group_name" /etc/openvpn/server/crl.pem\n\t\t\t\techo\n\t\t\t\techo "$client revoked!"\n\t\t\telse\n\t\t\t\techo\n\t\t\t\techo "$client revocation aborted!"\n\t\t\tfi\n\t\t\texit\n\t\t;;\n\t\t3)\n\t\t\techo\n\t\t\tread -p "Confirm OpenVPN removal? [y/N]: " remove\n\t\t\tuntil [[ "$remove" =~ ^[yYnN]*$ ]]; do\n\t\t\t\techo "$remove: invalid selection."\n\t\t\t\tread -p "Confirm OpenVPN removal? [y/N]: " remove\n\t\t\tdone\n\t\t\tif [[ "$remove" =~ ^[yY]$ ]]; then\n\t\t\t\tport=$(grep \'^port \' /etc/openvpn/server/server.conf | cut -d " " -f 2)\n\t\t\t\tprotocol=$(grep \'^proto \' /etc/openvpn/server/server.conf | cut -d " " -f 2)\n\t\t\t\tif systemctl is-active --quiet firewalld.service; then\n\t\t\t\t\tip=$(firewall-cmd --direct --get-rules ipv4 nat POSTROUTING | grep \'\\-s 10.8.0.0/24 \'"\'"\'!\'"\'"\' -d 10.8.0.0/24\' | grep -oE \'[^ ]+$\')\n\t\t\t\t\t# Using both permanent and not permanent rules to avoid a firewalld reload.\n\t\t\t\t\tfirewall-cmd --remove-port="$port"/"$protocol"\n\t\t\t\t\tfirewall-cmd --zone=trusted --remove-source=10.8.0.0/24\n\t\t\t\t\tfirewall-cmd --permanent --remove-port="$port"/"$protocol"\n\t\t\t\t\tfirewall-cmd --permanent --zone=trusted --remove-source=10.8.0.0/24\n\t\t\t\t\tfirewall-cmd --direct --remove-rule ipv4 nat POSTROUTING 0 -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to "$ip"\n\t\t\t\t\tfirewall-cmd --permanent --direct --remove-rule ipv4 nat POSTROUTING 0 -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to "$ip"\n\t\t\t\t\tif grep -qs "server-ipv6" /etc/openvpn/server/server.conf; then\n\t\t\t\t\t\tip6=$(firewall-cmd --direct --get-rules ipv6 nat POSTROUTING | grep \'\\-s fddd:1194:1194:1194::/64 \'"\'"\'!\'"\'"\' -d fddd:1194:1194:1194::/64\' | grep -oE \'[^ ]+$\')\n\t\t\t\t\t\tfirewall-cmd --zone=trusted --remove-source=fddd:1194:1194:1194::/64\n\t\t\t\t\t\tfirewall-cmd --permanent --zone=trusted --remove-source=fddd:1194:1194:1194::/64\n\t\t\t\t\t\tfirewall-cmd --direct --remove-rule ipv6 nat POSTROUTING 0 -s fddd:1194:1194:1194::/64 ! -d fddd:1194:1194:1194::/64 -j SNAT --to "$ip6"\n\t\t\t\t\t\tfirewall-cmd --permanent --direct --remove-rule ipv6 nat POSTROUTING 0 -s fddd:1194:1194:1194::/64 ! -d fddd:1194:1194:1194::/64 -j SNAT --to "$ip6"\n\t\t\t\t\tfi\n\t\t\t\telse\n\t\t\t\t\tsystemctl disable --now openvpn-iptables.service\n\t\t\t\t\trm -f /etc/systemd/system/openvpn-iptables.service\n\t\t\t\tfi\n\t\t\t\tif sestatus 2>/dev/null | grep "Current mode" | grep -q "enforcing" && [[ "$port" != 1194 ]]; then\n\t\t\t\t\tsemanage port -d -t openvpn_port_t -p "$protocol" "$port"\n\t\t\t\tfi\n\t\t\t\tsystemctl disable --now openvpn-server@server.service\n\t\t\t\trm -f /etc/systemd/system/openvpn-server@server.service.d/disable-limitnproc.conf\n\t\t\t\trm -f /etc/sysctl.d/99-openvpn-forward.conf\n\t\t\t\tif [[ "$os" = "debian" || "$os" = "ubuntu" ]]; then\n\t\t\t\t\trm -rf /etc/openvpn/server\n\t\t\t\t\tapt-get remove --purge -y openvpn\n\t\t\t\telse\n\t\t\t\t\t# Else, OS must be CentOS or Fedora\n\t\t\t\t\tyum remove -y openvpn\n\t\t\t\t\trm -rf /etc/openvpn/server\n\t\t\t\tfi\n\t\t\t\techo\n\t\t\t\techo "OpenVPN removed!"\n\t\t\telse\n\t\t\t\techo\n\t\t\t\techo "OpenVPN removal aborted!"\n\t\t\tfi\n\t\t\texit\n\t\t;;\n\t\t4)\n\t\t\texit\n\t\t;;\n\tesac\nfi\n'})})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var s=t(96540);const r={},i=s.createContext(r);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);