"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[2092],{93119:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>t,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>o,toc:()=>i});var s=r(74848),a=r(28453);const d={},c="ansible\u4efb\u52a1\u63a7\u5236-\u9519\u8bef\u5904\u7406changed_when",o={id:"linux/\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0/ansible/ansible\u4efb\u52a1\u63a7\u5236/ansible\u4efb\u52a1\u63a7\u5236-\u9519\u8bef\u5904\u7406changed_when",title:"ansible\u4efb\u52a1\u63a7\u5236-\u9519\u8bef\u5904\u7406changed_when",description:"force_handlers:yes \u5f3a\u5236\u6267\u884chandlers",source:"@site/docs/linux/\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0/ansible/ansible\u4efb\u52a1\u63a7\u5236/ansible\u4efb\u52a1\u63a7\u5236-\u9519\u8bef\u5904\u7406changed_when.md",sourceDirName:"linux/\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0/ansible/ansible\u4efb\u52a1\u63a7\u5236",slug:"/linux/\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0/ansible/ansible\u4efb\u52a1\u63a7\u5236/ansible\u4efb\u52a1\u63a7\u5236-\u9519\u8bef\u5904\u7406changed_when",permalink:"/docs/linux/\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0/ansible/ansible\u4efb\u52a1\u63a7\u5236/ansible\u4efb\u52a1\u63a7\u5236-\u9519\u8bef\u5904\u7406changed_when",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"ansible\u4efb\u52a1\u63a7\u5236-\u6807\u7b7etags",permalink:"/docs/linux/\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0/ansible/ansible\u4efb\u52a1\u63a7\u5236/ansible\u4efb\u52a1\u63a7\u5236-\u6807\u7b7etags"},next:{title:"ansible Facts\u53d8\u91cf",permalink:"/docs/linux/\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0/ansible/ansible\u53d8\u91cf/ansible Facts\u53d8\u91cf"}},t={},i=[{value:"<code>force_handlers:yes</code> \u5f3a\u5236\u6267\u884chandlers",id:"force_handlersyes-\u5f3a\u5236\u6267\u884chandlers",level:2},{value:"\u4f7f\u7528 <code>changed_when</code> \u68c0\u67e5\u4efb\u52a1\u8fd4\u56de\u7684\u7ed3\u679c",id:"\u4f7f\u7528-changed_when-\u68c0\u67e5\u4efb\u52a1\u8fd4\u56de\u7684\u7ed3\u679c",level:2}];function l(n){const e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,a.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h1,{id:"ansible\u4efb\u52a1\u63a7\u5236-\u9519\u8bef\u5904\u7406changed_when",children:"ansible\u4efb\u52a1\u63a7\u5236-\u9519\u8bef\u5904\u7406changed_when"}),"\n",(0,s.jsxs)(e.h2,{id:"force_handlersyes-\u5f3a\u5236\u6267\u884chandlers",children:[(0,s.jsx)(e.code,{children:"force_handlers:yes"})," \u5f3a\u5236\u6267\u884chandlers"]}),"\n",(0,s.jsxs)(e.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f53task\u5931\u8d25\u540e\uff0cplay\u4f1a\u7ec8\u6b62\uff0c\u540e\u7eed\u7684handlers\u5c31\u4e0d\u4f1a\u88ab\u6267\u884c\uff0c\u53ef\u662f\u4f7f\u7528\u53c2\u6570 ",(0,s.jsx)(e.code,{children:"force_handlers:yes"})," \u5f3a\u5236\u6267\u884chandlers"]}),"\n",(0,s.jsx)(e.p,{children:"\u7f16\u8f91yml\u6587\u4ef6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"cat >tasks_changed_when.yml << EOF\r\n- hosts: all\r\n  tasks:\r\n    - name: touch test file\r\n      file:\r\n        path: /tmp/test.txt\r\n        state: touch\r\n      notify: restart httpd   \r\n    \r\n    - name: exec error command\r\n      shell: abc\r\n      \r\n  handlers:\r\n    - name: restart httpd\r\n      service:\r\n        name: httpd\r\n        state: restarted\r\nEOF\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u6267\u884cyml\u6587\u4ef6"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u53ef\u4ee5\u770b\u5230\uff0c\u5f53\u6211\u4eec\u6267\u884c\u4e00\u4e2a\u9519\u8bef\u7684\u547d\u4ee4abc\u540e\uff0c\u540e\u8fb9\u91cd\u542fhttpd\u7684handlers\u6ca1\u6709\u88ab\u6267\u884c"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:'$ ansible-playbook tasks_changed_when.yml \r\n\r\nPLAY [all] **************************************************************************************************************************\r\n\r\nTASK [Gathering Facts] **************************************************************************************************************\r\nok: [devops02]\r\nok: [devops01]\r\n\r\nTASK [touch test file] **************************************************************************************************************\r\nchanged: [devops02]\r\nchanged: [devops01]\r\n\r\nTASK [exec error command] ***********************************************************************************************************\r\nfatal: [devops02]: FAILED! => {"changed": true, "cmd": "abc", "delta": "0:00:00.087827", "end": "2021-09-25 15:28:19.873285", "msg": "non-zero return code", "rc": 127, "start": "2021-09-25 15:28:19.785458", "stderr": "/bin/sh: abc: command not found", "stderr_lines": ["/bin/sh: abc: command not found"], "stdout": "", "stdout_lines": []}\r\nfatal: [devops01]: FAILED! => {"changed": true, "cmd": "abc", "delta": "0:00:00.087584", "end": "2021-09-25 15:28:19.941478", "msg": "non-zero return code", "rc": 127, "start": "2021-09-25 15:28:19.853894", "stderr": "/bin/sh: abc: command not found", "stderr_lines": ["/bin/sh: abc: command not found"], "stdout": "", "stdout_lines": []}\r\n\r\nRUNNING HANDLER [restart httpd] *****************************************************************************************************\r\n\r\nPLAY RECAP **************************************************************************************************************************\r\ndevops01                   : ok=2    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   \r\ndevops02                   : ok=2    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0 \n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u5728yml\u6587\u4ef6\u4e2d\u6dfb\u52a0\u53c2\u6570 ",(0,s.jsx)(e.code,{children:" force_handlers: yes"})," \u5f3a\u5236\u6267\u884chandlers"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"cat >tasks_changed_when.yml << EOF\r\n- hosts: all\r\n  force_handlers: yes\r\n  tasks:\r\n    - name: touch test file\r\n      file:\r\n        path: /tmp/test.txt\r\n        state: touch\r\n      notify: restart httpd   \r\n    \r\n    - name: exec error command\r\n      shell: abc\r\n      \r\n  handlers:\r\n    - name: restart httpd\r\n      service:\r\n        name: httpd\r\n        state: restarted\r\nEOF\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u518d\u6b21\u6267\u884cyml\u6587\u4ef6\uff0c\u53ef\u4ee5\u770b\u5230handlers\u88ab\u5f3a\u5236\u6267\u884c\u4e86"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:'$ ansible-playbook tasks_changed_when.yml \r\n\r\nPLAY [all] **************************************************************************************************************************\r\n\r\nTASK [Gathering Facts] **************************************************************************************************************\r\nok: [devops01]\r\nok: [devops02]\r\n\r\nTASK [touch test file] **************************************************************************************************************\r\nchanged: [devops02]\r\nchanged: [devops01]\r\n\r\nTASK [exec error command] ***********************************************************************************************************\r\nfatal: [devops01]: FAILED! => {"changed": true, "cmd": "abc", "delta": "0:00:00.080787", "end": "2021-09-25 15:34:15.667841", "msg": "non-zero return code", "rc": 127, "start": "2021-09-25 15:34:15.587054", "stderr": "/bin/sh: abc: command not found", "stderr_lines": ["/bin/sh: abc: command not found"], "stdout": "", "stdout_lines": []}\r\nfatal: [devops02]: FAILED! => {"changed": true, "cmd": "abc", "delta": "0:00:00.078859", "end": "2021-09-25 15:34:15.747691", "msg": "non-zero return code", "rc": 127, "start": "2021-09-25 15:34:15.668832", "stderr": "/bin/sh: abc: command not found", "stderr_lines": ["/bin/sh: abc: command not found"], "stdout": "", "stdout_lines": []}\r\n\r\nRUNNING HANDLER [restart httpd] *****************************************************************************************************\r\nchanged: [devops01]\r\nchanged: [devops02]\r\n\r\nPLAY RECAP **************************************************************************************************************************\r\ndevops01                   : ok=3    changed=2    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   \r\ndevops02                   : ok=3    changed=2    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0  \n'})}),"\n",(0,s.jsxs)(e.h2,{id:"\u4f7f\u7528-changed_when-\u68c0\u67e5\u4efb\u52a1\u8fd4\u56de\u7684\u7ed3\u679c",children:["\u4f7f\u7528 ",(0,s.jsx)(e.code,{children:"changed_when"})," \u68c0\u67e5\u4efb\u52a1\u8fd4\u56de\u7684\u7ed3\u679c"]}),"\n",(0,s.jsxs)(e.p,{children:["\u4f8b\u5982\uff0c\u6211\u4eec\u4fee\u6539\u4e86\u67d0\u4e00\u4e2a\u670d\u52a1\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5728\u91cd\u542f\u670d\u52a1\u4e4b\u524d\u505a\u4e00\u4e0b\u76f8\u5e94\u7684\u68c0\u6d4b(\u4f8b\u5982nginx\u670d\u52a1\u7684 ",(0,s.jsx)(e.code,{children:"nginx -t"})," \u547d\u4ee4)\uff0c\u5982\u679c\u68c0\u6d4b\u6210\u529f\u6211\u4eec\u5c31\u91cd\u542f\u670d\u52a1\uff0c\u5426\u5219\u5c31\u4e0d\u91cd\u542f\u670d\u52a1\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u7528\u5230",(0,s.jsx)(e.code,{children:"changed_when"})," \u68c0\u67e5\u4efb\u52a1\u8fd4\u56de\u7ed3\u679c"]}),"\n",(0,s.jsx)(e.p,{children:"\u7f16\u8f91yml\u6587\u4ef6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"cat > tasks_changed_when.yml << EOF\r\n- hosts: devops\r\n  tasks:\r\n  \r\n    - name: install nginx\r\n      yum:\r\n        name: nginx\r\n        state: present\r\n        \r\n    - name: copy nginx conf\r\n      copy:\r\n        src: ./file/nginx.conf\r\n        dest: /etc/nginx\r\n      notify: restart nginx  \r\n        \r\n  handlers:\r\n    - name: restart nginx\r\n      service:\r\n        name: nginx\r\n        state: restarted\r\nEOF\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u6267\u884cyml\u6587\u4ef6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"$ ansible-playbook tasks_changed_when.yml \r\n\r\nPLAY [devops] ***********************************************************************************************************************\r\n\r\nTASK [Gathering Facts] **************************************************************************************************************\r\nok: [devops01]\r\nok: [devops02]\r\n\r\nTASK [install nginx] ****************************************************************************************************************\r\nok: [devops02]\r\nok: [devops01]\r\n\r\nTASK [copy nginx conf] **************************************************************************************************************\r\nchanged: [devops01]\r\nchanged: [devops02]\r\n\r\nRUNNING HANDLER [restart nginx] *****************************************************************************************************\r\nchanged: [devops01]\r\nchanged: [devops02]\r\n\r\nPLAY RECAP **************************************************************************************************************************\r\ndevops01                   : ok=4    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \r\ndevops02                   : ok=4    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0  \n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e0a\u8fb9\u7684yml\u6587\u4ef6\u662f\u6ca1\u6709\u505a\u914d\u7f6e\u6587\u4ef6\u662f\u5426\u6b63\u786e\u6821\u9a8c\u7684\uff0c\u5982\u679c\u6211\u4eec\u4e0d\u505a\u914d\u7f6e\u6587\u4ef6\u8bed\u6cd5\u6821\u9a8c\uff0c\u5219\u63a8\u9001\u9519\u8bef\u6587\u4ef6\u540e\u91cd\u542f\u670d\u52a1\u4f1a\u5bfc\u81f4\u670d\u52a1\u91cd\u542f\u5931\u8d25\uff0c\u6b64\u65f6\u6211\u4eec\u5c31\u9700\u8981\u5bf9\u914d\u7f6e\u6587\u4ef6\u505a\u4e00\u4e0b\u6821\u9a8c\uff0c\u5982\u679c\u6b63\u786e\u5c31\u91cd\u542f\u670d\u52a1"}),"\n",(0,s.jsx)(e.p,{children:"\u6545\u610f\u628anginx\u914d\u7f6e\u6587\u4ef6\u6539\u9519\uff0c\u7136\u540e\u518d\u6267\u884cyml\u6587\u4ef6\uff0c\u53ef\u4ee5\u770b\u5230\u91cd\u542fnginx\u670d\u52a1\u4f1a\u5931\u8d25\uff0c\u6b64\u65f6nginx\u670d\u52a1\u662f\u6302\u6389\u7684"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:'$ ansible-playbook tasks_changed_when.yml \r\n\r\nPLAY [devops] ***********************************************************************************************************************\r\n\r\nTASK [Gathering Facts] **************************************************************************************************************\r\nok: [devops01]\r\nok: [devops02]\r\n\r\nTASK [install nginx] ****************************************************************************************************************\r\nok: [devops01]\r\nok: [devops02]\r\n\r\nTASK [copy nginx conf] **************************************************************************************************************\r\nchanged: [devops01]\r\nchanged: [devops02]\r\n\r\nRUNNING HANDLER [restart nginx] *****************************************************************************************************\r\nfatal: [devops01]: FAILED! => {"changed": false, "msg": "Unable to restart service nginx: Job for nginx.service failed because the control process exited with error code. See \\"systemctl status nginx.service\\" and \\"journalctl -xe\\" for details.\\n"}\r\nfatal: [devops02]: FAILED! => {"changed": false, "msg": "Unable to restart service nginx: Job for nginx.service failed because the control process exited with error code. See \\"systemctl status nginx.service\\" and \\"journalctl -xe\\" for details.\\n"}\r\n\r\nNO MORE HOSTS LEFT ******************************************************************************************************************\r\n\r\nPLAY RECAP **************************************************************************************************************************\r\ndevops01                   : ok=3    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   \r\ndevops02                   : ok=3    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   \r\n\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u60f3\u907f\u514d\u56e0\u4e3a\u914d\u7f6e\u6587\u4ef6\u62f7\u8d1d\u9519\u8bef\u5bfc\u81f4\u670d\u52a1\u91cd\u542f\u5931\u8d25\u7684\u95ee\u9898\uff0c\u5219\u9700\u8981\u5bf9\u914d\u7f6e\u6587\u4ef6\u505a\u8bed\u6cd5\u6821\u9a8c"}),"\n",(0,s.jsx)(e.p,{children:"\u518d\u6b21\u7f16\u8f91yml\u6587\u4ef6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"cat > tasks_changed_when.yml << EOF\r\n- hosts: devops\r\n  tasks:\r\n  \r\n    - name: install nginx\r\n      yum:\r\n        name: nginx\r\n        state: present\r\n        \r\n    - name: copy nginx conf\r\n      copy:\r\n        src: ./file/nginx.conf\r\n        dest: /etc/nginx\r\n      notify: restart nginx  \r\n     \r\n    - name: check nginx conf\r\n      shell: /usr/sbin/nginx -t\r\n      register: check_nginx_conf\r\n      changed_when: ( check_nginx_conf.stdout.find('successful'))\r\n     \r\n  handlers:\r\n    - name: restart nginx\r\n      service:\r\n        name: nginx\r\n        state: restarted\r\nEOF\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8fd8\u662f\u62f7\u8d1d\u9519\u8bef\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u53ef\u4ee5\u770b\u5230\u7531\u4e8e\u68c0\u6d4b\u5931\u8d25\u5e76\u6ca1\u6709\u6267\u884c\u91cd\u542f\u670d\u52a1\u7684\u64cd\u4f5c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:'$ ansible-playbook tasks_changed_when.yml \r\n\r\nPLAY [devops] ***********************************************************************************************************************\r\n\r\nTASK [Gathering Facts] **************************************************************************************************************\r\nok: [devops01]\r\nok: [devops02]\r\n\r\nTASK [install nginx] ****************************************************************************************************************\r\nok: [devops01]\r\nok: [devops02]\r\n\r\nTASK [copy nginx conf] **************************************************************************************************************\r\nok: [devops02]\r\nok: [devops01]\r\n\r\nTASK [check nginx conf] *************************************************************************************************************\r\nfatal: [devops01]: FAILED! => {"changed": true, "cmd": "/usr/sbin/nginx -t", "delta": "0:00:00.099378", "end": "2021-09-25 16:06:50.395384", "msg": "non-zero return code", "rc": 1, "start": "2021-09-25 16:06:50.296006", "stderr": "nginx: [emerg] unknown directive \\"ser\\" in /etc/nginx/nginx.conf:5\\nnginx: configuration file /etc/nginx/nginx.conf test failed", "stderr_lines": ["nginx: [emerg] unknown directive \\"ser\\" in /etc/nginx/nginx.conf:5", "nginx: configuration file /etc/nginx/nginx.conf test failed"], "stdout": "", "stdout_lines": []}\r\nfatal: [devops02]: FAILED! => {"changed": true, "cmd": "/usr/sbin/nginx -t", "delta": "0:00:00.101067", "end": "2021-09-25 16:06:50.474854", "msg": "non-zero return code", "rc": 1, "start": "2021-09-25 16:06:50.373787", "stderr": "nginx: [emerg] unknown directive \\"ser\\" in /etc/nginx/nginx.conf:5\\nnginx: configuration file /etc/nginx/nginx.conf test failed", "stderr_lines": ["nginx: [emerg] unknown directive \\"ser\\" in /etc/nginx/nginx.conf:5", "nginx: configuration file /etc/nginx/nginx.conf test failed"], "stdout": "", "stdout_lines": []}\r\n\r\nPLAY RECAP **************************************************************************************************************************\r\ndevops01                   : ok=3    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   \r\ndevops02                   : ok=3    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0 \n'})}),"\n",(0,s.jsx)(e.p,{children:"\u6211\u4eec\u628a\u914d\u7f6e\u6587\u4ef6\u6539\u4e3a\u6b63\u786e\u7684\u518d\u6b21\u6267\u884c\uff0c\u53ef\u4ee5\u770b\u5230\u5f53\u68c0\u6d4b\u5230\u914d\u7f6e\u6587\u4ef6\u6b63\u786e\u540e\u624d\u89e6\u53d1\u91cd\u542f\u670d\u52a1\u64cd\u4f5c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"$ ansible-playbook tasks_changed_when.yml \r\n\r\nPLAY [devops] ***********************************************************************************************************************\r\n\r\nTASK [Gathering Facts] **************************************************************************************************************\r\nok: [devops01]\r\nok: [devops02]\r\n\r\nTASK [install nginx] ****************************************************************************************************************\r\nok: [devops02]\r\nok: [devops01]\r\n\r\nTASK [copy nginx conf] **************************************************************************************************************\r\nchanged: [devops02]\r\nchanged: [devops01]\r\n\r\nTASK [check nginx conf] *************************************************************************************************************\r\nchanged: [devops01]\r\nchanged: [devops02]\r\n\r\nRUNNING HANDLER [restart nginx] *****************************************************************************************************\r\nchanged: [devops02]\r\nchanged: [devops01]\r\n\r\nPLAY RECAP **************************************************************************************************************************\r\ndevops01                   : ok=5    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \r\ndevops02                   : ok=5    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n"})}),"\n",(0,s.jsxs)(e.p,{children:["ansible\u6bcf\u6b21\u68c0\u6d4b\u914d\u7f6e\u6587\u4ef6\u90fd\u4f1a\u63d0\u793achanged\uff0c\u5982\u679c\u60f3\u8981\u5173\u95ed\u663e\u793a\u53ef\u4ee5\u4f7f\u7528\u53c2\u6570 ",(0,s.jsx)(e.code,{children:"chenged_when: false"})," \uff0c\u4f7f\u7528\u8fd9\u4e2a\u53c2\u6570\u7684\u524d\u63d0\u662f\u5f53\u524d\u64cd\u4f5c\u5e76\u6ca1\u6709\u4ea7\u751f\u5b9e\u9645\u7684\u64cd\u4f5c(\u8fd9\u91cc\u6267\u884c\u7684 ",(0,s.jsx)(e.code,{children:"nginx -t "}),"\u53ea\u662f\u68c0\u6d4bnginx\u914d\u7f6e\u6587\u4ef6\u8bed\u6cd5\u5e76\u6ca1\u6709\u771f\u6b63\u7684\u505a\u64cd\u4f5c)"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"- name: check nginx conf\r\n      shell: /usr/sbin/nginx -t\r\n      register: check_nginx_conf\r\n      changed_when: ( check_nginx_conf.stdout.find('successful'))\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4fee\u6539yml\u6587\u4ef6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"cat > tasks_changed_when.yml << EOF\r\n- hosts: devops\r\n  tasks:\r\n  \r\n    - name: install nginx\r\n      yum:\r\n        name: nginx\r\n        state: present\r\n        \r\n    - name: copy nginx conf\r\n      copy:\r\n        src: ./file/nginx.conf\r\n        dest: /etc/nginx\r\n      notify: restart nginx  \r\n     \r\n    - name: check nginx conf\r\n      shell: /usr/sbin/nginx -t\r\n      register: check_nginx_conf\r\n      changed_when: \r\n        - ( check_nginx_conf.stdout.find('successful'))\r\n        - false\r\n     \r\n  handlers:\r\n    - name: restart nginx\r\n      service:\r\n        name: nginx\r\n        state: restarted\r\nEOF\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u518d\u6b21\u6267\u884cyml\u6587\u4ef6\u5c31\u4f1a\u770b\u5230 ",(0,s.jsx)(e.code,{children:"TASK [check nginx conf] "})," \u5904\u663e\u793a\u7684\u4e0d\u662f ",(0,s.jsx)(e.code,{children:"changed "}),"\u72b6\u6001\u4e86"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"$ ansible-playbook tasks_changed_when.yml \r\n\r\nPLAY [devops] ***********************************************************************************************************************\r\n\r\nTASK [Gathering Facts] **************************************************************************************************************\r\nok: [devops02]\r\nok: [devops01]\r\n\r\nTASK [install nginx] ****************************************************************************************************************\r\nok: [devops02]\r\nok: [devops01]\r\n\r\nTASK [copy nginx conf] **************************************************************************************************************\r\nchanged: [devops02]\r\nchanged: [devops01]\r\n\r\nTASK [check nginx conf] *************************************************************************************************************\r\nok: [devops01]\r\nok: [devops02]\r\n\r\nRUNNING HANDLER [restart nginx] *****************************************************************************************************\r\nchanged: [devops01]\r\nchanged: [devops02]\r\n\r\nPLAY RECAP **************************************************************************************************************************\r\ndevops01                   : ok=5    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \r\ndevops02                   : ok=5    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n"})})]})}function h(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(l,{...n})}):l(n)}},28453:(n,e,r)=>{r.d(e,{R:()=>c,x:()=>o});var s=r(96540);const a={},d=s.createContext(a);function c(n){const e=s.useContext(d);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:c(n.components),s.createElement(d.Provider,{value:e},n.children)}}}]);