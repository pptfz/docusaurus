"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[7188],{84856:(e,a,s)=>{s.r(a),s.d(a,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>n,metadata:()=>i,toc:()=>o});var t=s(74848),c=s(28453);const n={},r="elasticsearch\u5b89\u88c5",i={id:"linux/linux\u670d\u52a1/elk/elasticsearch/elasticsearch\u5b89\u88c5",title:"elasticsearch\u5b89\u88c5",description:"elasticsearch\u5b98\u7f51",source:"@site/docs/linux/linux\u670d\u52a1/elk/elasticsearch/elasticsearch\u5b89\u88c5.md",sourceDirName:"linux/linux\u670d\u52a1/elk/elasticsearch",slug:"/linux/linux\u670d\u52a1/elk/elasticsearch/elasticsearch\u5b89\u88c5",permalink:"/docs/linux/linux\u670d\u52a1/elk/elasticsearch/elasticsearch\u5b89\u88c5",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"openvpn\u5bf9\u63a5ldap",permalink:"/docs/linux/linux\u670d\u52a1/VPN/openvpn\u5bf9\u63a5ldap"},next:{title:"kibana\u5b89\u88c5",permalink:"/docs/linux/linux\u670d\u52a1/elk/kibana/kibana\u5b89\u88c5"}},l={},o=[{value:"\u4e0b\u8f7d\u5b89\u88c5\u5305",id:"\u4e0b\u8f7d\u5b89\u88c5\u5305",level:3},{value:"\u89e3\u538b\u7f29\u5305",id:"\u89e3\u538b\u7f29\u5305",level:3},{value:"\u65b0\u5efaes\u7528\u6237",id:"\u65b0\u5efaes\u7528\u6237",level:3},{value:"\u4fee\u6539elasticsearch\u76ee\u5f55\u6240\u6709\u8005",id:"\u4fee\u6539elasticsearch\u76ee\u5f55\u6240\u6709\u8005",level:3},{value:"\u542f\u52a8elasticsearch",id:"\u542f\u52a8elasticsearch",level:3},{value:"\u67e5\u770b\u542f\u52a8",id:"\u67e5\u770b\u542f\u52a8",level:3},{value:"\u5f00\u542felasticsearch\u8fdc\u7a0b\u8bbf\u95ee",id:"\u5f00\u542felasticsearch\u8fdc\u7a0b\u8bbf\u95ee",level:3},{value:"\u9a8c\u8bc1elsticsearch\u542f\u52a8",id:"\u9a8c\u8bc1elsticsearch\u542f\u52a8",level:3},{value:"elasticsearch\u542f\u52a8\u65f6\u9519\u8bef\u89e3\u51b3\u65b9\u6848",id:"elasticsearch\u542f\u52a8\u65f6\u9519\u8bef\u89e3\u51b3\u65b9\u6848",level:3},{value:"\u9519\u8bef1",id:"\u9519\u8bef1",level:4},{value:"\u9519\u8bef2",id:"\u9519\u8bef2",level:4},{value:"\u9519\u8bef3",id:"\u9519\u8bef3",level:4},{value:"\u9519\u8bef4",id:"\u9519\u8bef4",level:4}];function h(e){const a={a:"a",admonition:"admonition",code:"code",h1:"h1",h3:"h3",h4:"h4",p:"p",pre:"pre",strong:"strong",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.h1,{id:"elasticsearch\u5b89\u88c5",children:"elasticsearch\u5b89\u88c5"}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.a,{href:"https://www.elastic.co/",children:"elasticsearch\u5b98\u7f51"})}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.a,{href:"https://www.elastic.co/cn/downloads/elasticsearch",children:"elasticsearch\u5b98\u65b9\u4e0b\u8f7d\u5730\u5740"})}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.a,{href:"https://www.elastic.co/cn/downloads/past-releases#elasticsearch",children:"elasticsearch\u5404\u7248\u672c\u5b98\u65b9\u4e0b\u8f7d\u5730\u5740"})}),"\n",(0,t.jsx)(a.p,{children:"elasticsearch\u4f9d\u8d56java\u73af\u5883\uff0c\u5b89\u88c5\u524d\u9700\u8981\u914d\u7f6e\u597djdk\u73af\u5883"}),"\n",(0,t.jsx)(a.h3,{id:"\u4e0b\u8f7d\u5b89\u88c5\u5305",children:"\u4e0b\u8f7d\u5b89\u88c5\u5305"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sh",children:"wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.12.1-linux-x86_64.tar.gz\n"})}),"\n",(0,t.jsx)(a.h3,{id:"\u89e3\u538b\u7f29\u5305",children:"\u89e3\u538b\u7f29\u5305"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sh",children:"tar xf elasticsearch-7.12.1-linux-x86_64.tar.gz -C /usr/local/\n"})}),"\n",(0,t.jsx)(a.h3,{id:"\u65b0\u5efaes\u7528\u6237",children:"\u65b0\u5efaes\u7528\u6237"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sh",children:"useradd es\n"})}),"\n",(0,t.jsx)(a.h3,{id:"\u4fee\u6539elasticsearch\u76ee\u5f55\u6240\u6709\u8005",children:"\u4fee\u6539elasticsearch\u76ee\u5f55\u6240\u6709\u8005"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sh",children:"chown -R es.es /usr/local/elasticsearch-7.12.1/\n"})}),"\n",(0,t.jsx)(a.h3,{id:"\u542f\u52a8elasticsearch",children:"\u542f\u52a8elasticsearch"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sh",children:"cd /usr/local/elasticsearch-7.12.1\nsu es -c './bin/elasticsearch'\n"})}),"\n",(0,t.jsx)(a.admonition,{type:"caution",children:(0,t.jsx)(a.p,{children:(0,t.jsxs)(a.strong,{children:["\u4f7f\u7528root\u7528\u6237\u542f\u52a8\u4f1a\u62a5\u9519 ",(0,t.jsx)(a.code,{children:"java.lang.RuntimeException: can not run elasticsearch as root"})]})})}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sh",children:"Future versions of Elasticsearch will require Java 11; your Java version from [/usr/local/jdk1.8.0_251/jre] does not meet this requirement. Consider switching to a distribution of Elasticsearch with a bundled JDK. If you are already using a distribution with a bundled JDK, ensure the JAVA_HOME environment variable is not set.\n[2021-05-23T23:25:34,933][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [test1] uncaught exception in thread [main]\norg.elasticsearch.bootstrap.StartupException: java.lang.RuntimeException: can not run elasticsearch as root\n\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:163) ~[elasticsearch-7.12.1.jar:7.12.1]\n\tat org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:150) ~[elasticsearch-7.12.1.jar:7.12.1]\n\tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:75) ~[elasticsearch-7.12.1.jar:7.12.1]\n\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:116) ~[elasticsearch-cli-7.12.1.jar:7.12.1]\n\tat org.elasticsearch.cli.Command.main(Command.java:79) ~[elasticsearch-cli-7.12.1.jar:7.12.1]\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:115) ~[elasticsearch-7.12.1.jar:7.12.1]\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:81) ~[elasticsearch-7.12.1.jar:7.12.1]\nCaused by: java.lang.RuntimeException: can not run elasticsearch as root\n\tat org.elasticsearch.bootstrap.Bootstrap.initializeNatives(Bootstrap.java:101) ~[elasticsearch-7.12.1.jar:7.12.1]\n\tat org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:168) ~[elasticsearch-7.12.1.jar:7.12.1]\n\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:397) ~[elasticsearch-7.12.1.jar:7.12.1]\n\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:159) ~[elasticsearch-7.12.1.jar:7.12.1]\n\t... 6 more\nuncaught exception in thread [main]\njava.lang.RuntimeException: can not run elasticsearch as root\n\tat org.elasticsearch.bootstrap.Bootstrap.initializeNatives(Bootstrap.java:101)\n\tat org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:168)\n\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:397)\n\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:159)\n\tat org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:150)\n\tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:75)\n\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:116)\n\tat org.elasticsearch.cli.Command.main(Command.java:79)\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:115)\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:81)\nFor complete error details, refer to the log at /usr/local/elasticsearch-7.12.1/logs/elasticsearch.log\n"})}),"\n",(0,t.jsx)(a.h3,{id:"\u67e5\u770b\u542f\u52a8",children:"\u67e5\u770b\u542f\u52a8"}),"\n",(0,t.jsx)(a.p,{children:"elasticsearch\u76d1\u542ctcp 9200\u548c9300\uff0c\u5176\u4e2d9300\u4e3a\u96c6\u7fa4\u5185\u8282\u70b9\u901a\u4fe1\u63a5\u53e3\uff0c9200\u4e3aelasticsearch\u5f00\u653e\u7684REST\u63a5\u53e3"}),"\n",(0,t.jsx)(a.p,{children:"jps\u67e5\u770b"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sh",children:"$ jps|grep Elasticsearch\n2407 Elasticsearch\n"})}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sh",children:"$ ps aux|grep 2407\nes        2407 31.3 32.6 3691292 1320184 ?     Ssl  23:37   0:25 /usr/local/jdk1.8.0_251/bin/java -Xshare:auto -Des.networkaddress.cache.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Djna.nosys=true -XX:-OmitStackTraceInFastThrow -Dio.netty.noUnsafe=true -Dio.netty.noKeySetOptimization=true -Dio.netty.recycler.maxCapacityPerThread=0 -Dio.netty.allocator.numDirectArenas=0 -Dlog4j.shutdownHookEnabled=false -Dlog4j2.disable.jmx=true -Djava.locale.providers=SPI,JRE -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -Djava.io.tmpdir=/tmp/elasticsearch-4825559070521700706 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=data -XX:ErrorFile=logs/hs_err_pid%p.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:logs/gc.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=32 -XX:GCLogFileSize=64m -Xms1024m -Xmx1024m -XX:MaxDirectMemorySize=536870912 -Des.path.home=/usr/local/elasticsearch-7.12.1 -Des.path.conf=/usr/local/elasticsearch-7.12.1/config -Des.distribution.flavor=default -Des.distribution.type=tar -Des.bundled_jdk=true -cp /usr/local/elasticsearch-7.12.1/lib/* org.elasticsearch.bootstrap.Elasticsearch\n"})}),"\n",(0,t.jsx)(a.h3,{id:"\u5f00\u542felasticsearch\u8fdc\u7a0b\u8bbf\u95ee",children:"\u5f00\u542felasticsearch\u8fdc\u7a0b\u8bbf\u95ee"}),"\n",(0,t.jsxs)(a.p,{children:["elasticsearch\u9ed8\u8ba4\u76d1\u542c127.0.0.1\uff0c\u5982\u679c\u60f3\u8981\u5f00\u542f\u8fdc\u7a0b\u8bbf\u95ee\uff0c\u9700\u8981\u4fee\u6539 ",(0,t.jsx)(a.code,{children:"config/elasticsearch.yml"}),"\uff0c\u5c06 ",(0,t.jsx)(a.code,{children:"network.host"})," \u4e00\u884c\u4fee\u6539\u4e3a\u5982\u4e0b"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sh",children:"network.host: 0.0.0.0\n"})}),"\n",(0,t.jsx)(a.h3,{id:"\u9a8c\u8bc1elsticsearch\u542f\u52a8",children:"\u9a8c\u8bc1elsticsearch\u542f\u52a8"}),"\n",(0,t.jsxs)(a.p,{children:["\u6d4f\u89c8\u5668\u8bbf\u95ee ",(0,t.jsx)(a.code,{children:"IP:9200"}),"\uff0c\u8fd4\u56de\u5982\u4e0b\u7ed3\u679c\u5373\u4e3a\u6210\u529f"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-json",children:'{\n  "name" : "test1",\n  "cluster_name" : "elasticsearch",\n  "cluster_uuid" : "bnOFYR5fRFmF7pPaXxLuDA",\n  "version" : {\n    "number" : "7.12.1",\n    "build_flavor" : "default",\n    "build_type" : "tar",\n    "build_hash" : "3186837139b9c6b6d23c3200870651f10d3343b7",\n    "build_date" : "2021-04-20T20:56:39.040728659Z",\n    "build_snapshot" : false,\n    "lucene_version" : "8.8.0",\n    "minimum_wire_compatibility_version" : "6.8.0",\n    "minimum_index_compatibility_version" : "6.0.0-beta1"\n  },\n  "tagline" : "You Know, for Search"\n}\n'})}),"\n",(0,t.jsx)(a.p,{children:"\u6216\u8005\u4f7f\u7528curl\u547d\u4ee4"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-json",children:'curl 127.0.0.1:9200\n{\n  "name" : "test1",\n  "cluster_name" : "elasticsearch",\n  "cluster_uuid" : "bnOFYR5fRFmF7pPaXxLuDA",\n  "version" : {\n    "number" : "7.12.1",\n    "build_flavor" : "default",\n    "build_type" : "tar",\n    "build_hash" : "3186837139b9c6b6d23c3200870651f10d3343b7",\n    "build_date" : "2021-04-20T20:56:39.040728659Z",\n    "build_snapshot" : false,\n    "lucene_version" : "8.8.0",\n    "minimum_wire_compatibility_version" : "6.8.0",\n    "minimum_index_compatibility_version" : "6.0.0-beta1"\n  },\n  "tagline" : "You Know, for Search"\n}\n'})}),"\n",(0,t.jsx)(a.p,{children:"\u68c0\u67e5elasticsearch\u5065\u5eb7\u72b6\u6001"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sh",children:"$ curl 127.0.0.1:9200/_cat/health\n1621785784 16:03:04 elasticsearch green 1 1 0 0 0 0 0 0 - 100.0%\n"})}),"\n",(0,t.jsx)(a.p,{children:"elasticsearch\u542f\u52a8\u62a5\u9519"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sh",children:"ERROR: [2] bootstrap checks failed. You must address the points described in the following [2] lines before starting Elasticsearch.\nbootstrap check failure [1] of [2]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]\nbootstrap check failure [2] of [2]: the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured\nERROR: Elasticsearch did not exit normally - check the logs at /usr/local/elasticsearch-7.12.1/logs/elasticsearch.log\n"})}),"\n",(0,t.jsx)(a.h3,{id:"elasticsearch\u542f\u52a8\u65f6\u9519\u8bef\u89e3\u51b3\u65b9\u6848",children:"elasticsearch\u542f\u52a8\u65f6\u9519\u8bef\u89e3\u51b3\u65b9\u6848"}),"\n",(0,t.jsx)(a.h4,{id:"\u9519\u8bef1",children:"\u9519\u8bef1"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{children:"**ERROR: bootstrap checks failed[1]: max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]**\n"})}),"\n",(0,t.jsx)(a.p,{children:"\u89e3\u51b3\u65b9\u6cd5"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sh",children:"# \u5207\u6362\u5230root\u7528\u6237\u4fee\u6539 /etc/security/limits.conf \u6587\u4ef6\uff0c\u5728\u6700\u540e\u9762\u8ffd\u52a0\u4e0b\u9762\u5185\u5bb9\n*               soft    nofile          65536\n*               hard    nofile          65536\n*               soft    nproc           4096\n*               hard    nproc           4096\n   \n# \u9000\u51fa\u91cd\u65b0\u767b\u5f55\u68c0\u6d4b\u914d\u7f6e\u662f\u5426\u751f\u6548:\nulimit -Hn\nulimit -Sn\nulimit -Hu\nulimit -Su\n"})}),"\n",(0,t.jsx)(a.h4,{id:"\u9519\u8bef2",children:"\u9519\u8bef2"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sh",children:"**ERROR: max number of threads [3802] for user [chenyn] is too low,increase to at least [4096]**\n"})}),"\n",(0,t.jsx)(a.p,{children:"\u89e3\u51b3\u65b9\u6cd5"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sh",children:"# \u8fdb\u5165limits.d\u76ee\u5f55\u4e0b\u4fee\u6539 /etc/security/limits.d/20-nproc.conf \u914d\u7f6e\u6587\u4ef6\n\n\u542f\u52a8ES\u7528\u6237\u540d soft nproc 4096\n"})}),"\n",(0,t.jsx)(a.h4,{id:"\u9519\u8bef3",children:"\u9519\u8bef3"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sh",children:"**ERROR: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]**\n"})}),"\n",(0,t.jsx)(a.p,{children:"\u89e3\u51b3\u65b9\u6cd5"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sh",children:"# \u7f16\u8f91\u6587\u4ef6 /etc/sysctl.conf \u589e\u52a0\u4e0b\u4e00\u884c\nvm.max_map_count=655360\n\n# \u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u751f\u6548\nsysctl -p\n"})}),"\n",(0,t.jsx)(a.h4,{id:"\u9519\u8bef4",children:"\u9519\u8bef4"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sh",children:"ERROR: [1] bootstrap checks failed. You must address the points described in the following [1] lines before starting Elasticsearch.\nbootstrap check failure [1] of [1]: the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured\n"})}),"\n",(0,t.jsx)(a.p,{children:"\u89e3\u51b3\u65b9\u6cd5"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sh",children:'# \u7f16\u8f91elasticsearch\u914d\u7f6e\u6587\u4ef6 config/elasticsearch.yml \u7f16\u8f91\u5982\u4e0b\u5185\u5bb9\uff0c\u5355\u8282\u70b9\u5c31\u534f\u8bae\u4e3b\u673a\u540d\uff0c\u591a\u8282\u70b9\u5199\u591a\u4e2a\u4e3b\u673a\u540d\ncluster.initial_master_nodes: ["test1"]\n'})})]})}function d(e={}){const{wrapper:a}={...(0,c.R)(),...e.components};return a?(0,t.jsx)(a,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},28453:(e,a,s)=>{s.d(a,{R:()=>r,x:()=>i});var t=s(96540);const c={},n=t.createContext(c);function r(e){const a=t.useContext(n);return t.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function i(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:r(e.components),t.createElement(n.Provider,{value:a},e.children)}}}]);