<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-云原生/k8s/k8s知识点/工作负载/Deployment/Deployment简介" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">Deployment | 我的站点</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://pptfz.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://pptfz.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://pptfz.github.io/docs/云原生/k8s/k8s知识点/工作负载/Deployment/Deployment简介"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Deployment | 我的站点"><meta data-rh="true" name="description" content="deployment简介"><meta data-rh="true" property="og:description" content="deployment简介"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pptfz.github.io/docs/云原生/k8s/k8s知识点/工作负载/Deployment/Deployment简介"><link data-rh="true" rel="alternate" href="https://pptfz.github.io/docs/云原生/k8s/k8s知识点/工作负载/Deployment/Deployment简介" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://pptfz.github.io/docs/云原生/k8s/k8s知识点/工作负载/Deployment/Deployment简介" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://SICNXLSDBZ-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="我的站点" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.061a1b25.css">
<script src="/assets/js/runtime~main.3599ad11.js" defer="defer"></script>
<script src="/assets/js/main.21de94ca.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="announcementBar_mb4j" style="background-color:pink;color:@091E42" role="banner"><div class="content_knG7 announcementBarContent_xLdY">一名运维，两台电脑，三餐不定，只为设备工作四平八稳，拼得五脏俱损，六神无主，仍然七点起床，八点出发，晚上九点不返，十分辛苦！<br> 十年运维，九转功成，八面张罗，忙得七窍流血，换得六神不宁，五体欠安，仍然四处奔波，三更不眠，只为两个铜板，一生拼搏！</div></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">我的站点</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">笔记</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">😂 😂  😂</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/github/github下载加速">github</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/go/go功能脚本/k8s/获取k8s集群资源配置">go</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/idea/vscode/vscode好用的插件">idea</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/linux/big-data/Ambari/CentOS7中用Ambari快速搭建大数据平台">linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/mac专区/brew安装">mac专区</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/python/python-other/nginx+django+uwsgi部署项目">python</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/web/css/css基础知识">web</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/云原生/k8s/helm/helm3安装">云原生</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/云原生/k8s/helm/helm3安装">k8s</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/helm/helm3安装">helm</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/k8s下载/下载k8s二进制包">k8s下载</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/k8s命令/kubectl top命令解析">k8s命令</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/k8s安装/CentOS7.9二进制安装k8s-v1.20.15">k8s安装</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/云原生/k8s/k8s常用命令速查">k8s常用命令速查</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/k8s故障/使用config文件连接k8s集群遇到的问题">k8s故障</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/云原生/k8s/k8s知识点/k8s基础操作">k8s知识点</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/云原生/k8s/k8s知识点/k8s基础操作">k8s基础操作</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/k8s知识点/kubeconfig/使用kubecm管理多集群kubeconfig">kubeconfig</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/k8s知识点/pod/Downward API">pod</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/k8s知识点/存储/OpenEBS">存储</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/云原生/k8s/k8s知识点/工作负载/CronJob/CronJob简介">工作负载</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/k8s知识点/工作负载/CronJob/CronJob简介">CronJob</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/k8s知识点/工作负载/DaemonSet/DaemonSet滚动更新和回滚">DaemonSet</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/云原生/k8s/k8s知识点/工作负载/Deployment/Deployment简介">Deployment</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/云原生/k8s/k8s知识点/工作负载/Deployment/Deployment简介">Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/云原生/k8s/k8s知识点/工作负载/Deployment/使用 Deployment 运行一个无状态应用">使用 Deployment 运行一个无状态应用</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/k8s知识点/工作负载/HorizontalPodAutoscaler/HorizontalPodAutoscaler使用示例">HorizontalPodAutoscaler</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/k8s知识点/工作负载/Job/Job简介">Job</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/k8s知识点/工作负载/ReplicaSet/ReplicaSet简介">ReplicaSet</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/k8s知识点/工作负载/StatefulSet/StatefulSet简介">StatefulSet</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/k8s知识点/文章/k8s强制删除namespace">文章</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/k8s知识点/服务、负载均衡和联网/ingress/ingress-nginx/ingress-nginx安装">服务、负载均衡和联网</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/k8s知识点/调度、抢占和驱逐/将Pod调度到指定节点">调度、抢占和驱逐</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/k8s知识点/配置/ConfigMap/ConfigMap简介">配置</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/k8s证书/kubeam安装k8s生成的证书">k8s证书</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/学习工具/kind/kind问题">学习工具</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/k8s/监控/metrics-server/metrics server">监控</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/云原生工具/harbor/harbor安装">云原生工具</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/容器/containerd/containerd 高级命令行工具 nerdctl">容器</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/云原生/监控/prometheus/prometheus安装">监控</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/其他/wps/wps冻结窗口">其他</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/博客工具/Docusaurus/Docusaurus 安装">博客工具</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/操作小技巧/linux/linux一些骚操作">操作小技巧</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/数据库/mongodb/centos7安装mongodb">数据库</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/翻车问 题合集/翻车问题-ssh密钥问题">翻车问题合集</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">云原生</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">k8s</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">k8s知识点</span><meta itemprop="position" content="3"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">工作负载</span><meta itemprop="position" content="4"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Deployment</span><meta itemprop="position" content="5"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Deployment</span><meta itemprop="position" content="6"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>Deployment</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deployment简介">deployment简介<a href="#deployment简介" class="hash-link" aria-label="deployment简介的直接链接" title="deployment简介的直接链接">​</a></h2>
<p>一个 Deployment 为 <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/" target="_blank" rel="noopener noreferrer">Pod</a> 和 <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/replicaset/" target="_blank" rel="noopener noreferrer">ReplicaSet</a> 提供声明式的更新能力。</p>
<p>你负责描述 Deployment 中的 <strong>目标状态</strong>，而 Deployment <a href="https://kubernetes.io/zh-cn/docs/concepts/architecture/controller/" target="_blank" rel="noopener noreferrer">控制器（Controller）</a> 以受控速率更改实际状态， 使其变为期望状态。你可以定义 Deployment 以创建新的 ReplicaSet，或删除现有 Deployment， 并通过新的 Deployment 收养其资源。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="用例">用例<a href="#用例" class="hash-link" aria-label="用例的直接链接" title="用例的直接链接">​</a></h2>
<p>以下是 Deployments 的典型用例：</p>
<ul>
<li>
<p><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#creating-a-deployment" target="_blank" rel="noopener noreferrer">创建 Deployment 以将 ReplicaSet 上线</a>。ReplicaSet 在后台创建 Pod。 检查 ReplicaSet 的上线状态，查看其是否成功。</p>
</li>
<li>
<p>通过更新 Deployment 的 PodTemplateSpec，<a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#updating-a-deployment" target="_blank" rel="noopener noreferrer">声明 Pod 的新状态</a> 。 新的 ReplicaSet 会被创建，Deployment 以受控速率将 Pod 从旧 ReplicaSet 迁移到新 ReplicaSet。 每个新的 ReplicaSet 都会更新 Deployment 的修订版本。</p>
</li>
<li>
<p>如果 Deployment 的当前状态不稳定，<a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#rolling-back-a-deployment" target="_blank" rel="noopener noreferrer">  回滚到较早的 Deployment 版本</a>。 每次回滚都会更新 Deployment 的修订版本。</p>
</li>
<li>
<p><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#scaling-a-deployment" target="_blank" rel="noopener noreferrer">扩大 Deployment 规模以承担更多负载</a>。</p>
</li>
<li>
<p><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#pausing-and-resuming-a-deployment" target="_blank" rel="noopener noreferrer">暂停 Deployment</a> 以应用对 PodTemplateSpec 所作的多项修改， 然后恢复其执行以启动新的上线版本。</p>
</li>
<li>
<p><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#deployment-status" target="_blank" rel="noopener noreferrer">使用 Deployment 状态</a>来判定上线过程是否出现停滞。</p>
</li>
<li>
<p><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#clean-up-policy" target="_blank" rel="noopener noreferrer">清理较旧的不再需要的 ReplicaSet</a> 。</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建-deployment">创建 Deployment<a href="#创建-deployment" class="hash-link" aria-label="创建 Deployment的直接链接" title="创建 Deployment的直接链接">​</a></h2>
<p>下面是一个 Deployment 示例。其中创建了一个 ReplicaSet，负责启动三个 <code>nginx</code> Pod：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cat </span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">deployment.yaml &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">1.14.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在该例中：</p>
<ul>
<li>
<p>创建名为 <code>nginx-deployment</code>（由 <code>.metadata.name</code> 字段标明）的 Deployment。</p>
</li>
<li>
<p>该 Deployment 创建三个（由 <code>.spec.replicas</code> 字段标明）Pod 副本。</p>
</li>
<li>
<p><code>.spec.selector</code> 字段定义了 Deployment 如何查找要管理的 Pod。</p>
</li>
<li>
<p><code>selector</code> 字段定义 Deployment 如何查找要管理的 Pod。 在这里，你选择在 Pod 模板中定义的标签（<code>app: nginx</code>）。 不过，更复杂的选择规则是也可能的，只要 Pod 模板本身满足所给规则即可。</p>
</li>
</ul>
<p>:::tip说明</p>
<p><code>spec.selector.matchLabels</code> 字段是 <code>{key,value}</code> 键值对映射。 在 <code>matchLabels</code> 映射中的每个 <code>{key,value}</code> 映射等效于 <code>matchExpressions</code> 中的一个元素， 即其 <code>key</code> 字段是 “key”，<code>operator</code> 为 “In”，<code>values</code> 数组仅包含 “value”。 在 <code>matchLabels</code> 和 <code>matchExpressions</code> 中给出的所有条件都必须满足才能匹配。</p>
<p>:::</p>
<ul>
<li><code>template</code>字段包含以下子字段：<!-- -->
<ul>
<li>Pod 被使用 <code>.metadata.labels</code> 字段打上 <code>app: nginx</code> 标签。</li>
<li>Pod 模板规约（即 <code>.template.spec</code> 字段）指示 Pod 运行一个 <code>nginx</code> 容器， 该容器运行版本为 1.14.2 的 <code>nginx</code> <a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">Docker Hub</a> 镜像。</li>
<li>创建一个容器并使用 <code>.spec.template.spec.containers[0].name</code> 字段将其命名为 <code>nginx</code>。</li>
</ul>
</li>
</ul>
<p>创建deployment</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f nginx-deployment.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查看deployment</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME               READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment   3/3     3            3           22s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在检查集群中的 Deployment 时，所显示的字段有：</p>
<ul>
<li><code>NAME</code> 列出了名字空间中 Deployment 的名称。</li>
<li><code>READY</code> 显示应用程序的可用的“副本”数。显示的模式是“就绪个数/期望个数”。</li>
<li><code>UP-TO-DATE</code> 显示为了达到期望状态已经更新的副本数。</li>
<li><code>AVAILABLE</code> 显示应用可供用户使用的副本数。</li>
<li><code>AGE</code> 显示应用程序运行的时间。</li>
</ul>
<p>请注意期望副本数是根据 <code>.spec.replicas</code> 字段设置 3。</p>
<p>要查看 Deployment 创建的 ReplicaSet（<code>rs</code>）</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                          DESIRED   CURRENT   READY   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-66b6c48dd5   3         3         3       55s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ReplicaSet 输出中包含以下字段：</p>
<ul>
<li><code>NAME</code> 列出名字空间中 ReplicaSet 的名称；</li>
<li><code>DESIRED</code> 显示应用的期望副本个数，即在创建 Deployment 时所定义的值。 此为期望状态；</li>
<li><code>CURRENT</code> 显示当前运行状态中的副本个数；</li>
<li><code>READY</code> 显示应用中有多少副本可以为用户提供服务；</li>
<li><code>AGE</code> 显示应用已经运行的时间长度。</li>
</ul>
<p>注意 ReplicaSet 的名称始终被格式化为<code>[Deployment名称]-[哈希]</code>。 其中的<code>哈希</code>字符串与 ReplicaSet 上的 <code>pod-template-hash</code> 标签一致。</p>
<p>查看每个 Pod 自动生成的标签</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get pods --show-labels</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                                READY   STATUS    RESTARTS   AGE     LABELS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-66b6c48dd5-4gll8   1/1     Running   0          2m12s   app=nginx,pod-template-hash=66b6c48dd5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-66b6c48dd5-hhgfs   1/1     Running   0          2m12s   app=nginx,pod-template-hash=66b6c48dd5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-66b6c48dd5-xcsx4   1/1     Running   0          2m12s   app=nginx,pod-template-hash=66b6c48dd5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>所创建的 ReplicaSet 确保总是存在三个 <code>nginx</code> Pod。</p>
<p>:::tip说明</p>
<p>你必须在 Deployment 中指定适当的选择算符和 Pod 模板标签（在本例中为 <code>app: nginx</code>）。 标签或者选择算符不要与其他控制器（包括其他 Deployment 和 StatefulSet）重叠。 Kubernetes 不会阻止你这样做，但是如果多个控制器具有重叠的选择算符， 它们可能会发生冲突执行难以预料的操作。</p>
<p>:::</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pod-template-hash-标签">Pod-template-hash 标签<a href="#pod-template-hash-标签" class="hash-link" aria-label="Pod-template-hash 标签的直接链接" title="Pod-template-hash 标签的直接链接">​</a></h3>
<p>:::caution注意</p>
<p>不要更改此标签。</p>
<p>:::</p>
<p>Deployment 控制器将 <code>pod-template-hash</code> 标签添加到 Deployment 所创建或收留的每个 ReplicaSet 。</p>
<p>此标签可确保 Deployment 的子 ReplicaSets 不重叠。 标签是通过对 ReplicaSet 的 <code>PodTemplate</code> 进行哈希处理。 所生成的哈希值被添加到 ReplicaSet 选择算符、Pod 模板标签，并存在于在 ReplicaSet 可能拥有的任何现有 Pod 中。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="更新-deployment">更新 Deployment<a href="#更新-deployment" class="hash-link" aria-label="更新 Deployment的直接链接" title="更新 Deployment的直接链接">​</a></h2>
<p>:::tip说明</p>
<p>仅当 Deployment Pod 模板（即 <code>.spec.template</code>）发生改变时，例如模板的标签或容器镜像被更新， 才会触发 Deployment 上线。其他更新（如对 Deployment 执行扩缩容的操作）不会触发上线动作。</p>
<p>:::</p>
<p>1.先来更新 nginx Pod 以使用 <code>nginx:1.16.1</code> 镜像，而不是 <code>nginx:1.14.2</code> 镜像</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl set image deployment.v1.apps/nginx-deployment nginx=nginx:1.16.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>或</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl set image deployment/nginx-deployment nginx=nginx:1.16.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>或者，可以对 Deployment 执行 <code>edit</code> 操作并将 <code>.spec.template.spec.containers[0].image</code> 从 <code>nginx:1.14.2</code> 更改至 <code>nginx:1.16.1</code>。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl edit deployment/nginx-deployment</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>2.查看上线状态</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl rollout status deployment/nginx-deployment</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>输出类似于：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Waiting for rollout to finish: 2 out of 3 new replicas have been updated...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>或者</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">deployment &quot;nginx-deployment&quot; successfully rolled out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<p>获取关于已更新的 Deployment 的更多信息：</p>
<p>在上线成功后，可以通过运行 <code>kubectl get deployments</code> 来查看 Deployment</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME               READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment   3/3     3            3           20m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>运行 <code>kubectl get rs</code> 以查看 Deployment 通过创建新的 ReplicaSet 并将其扩容到 3 个副本并将旧 ReplicaSet 缩容到 0 个副本完成了 Pod 的更新操作：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                          DESIRED   CURRENT   READY   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74   3         3         3       2m51s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-66b6c48dd5   0         0         0       20m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>现在运行 <code>get pods</code> 应仅显示新的 Pod</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get pod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                                READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74-5k8gp   1/1     Running   0          3m15s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74-t9lnw   1/1     Running   0          3m7s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74-vtw7t   1/1     Running   0          3m8s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>下次要更新这些 Pod 时，只需再次更新 Deployment Pod 模板即可。</p>
<p>Deployment 可确保在更新时仅关闭一定数量的 Pod。默认情况下，它确保至少所需 Pod 的 75% 处于运行状态（最大不可用比例为 25%）。</p>
<p>Deployment 还确保仅所创建 Pod 数量只可能比期望 Pod 数高一点点。 默认情况下，它可确保启动的 Pod 个数比期望个数最多多出 125%（最大峰值 25%）。</p>
<p>例如，如果仔细查看上述 Deployment ，将看到它首先创建了一个新的 Pod，然后删除旧的 Pod， 并创建了新的 Pod。它不会杀死旧 Pod，直到有足够数量的新 Pod 已经出现。 在足够数量的旧 Pod 被杀死前并没有创建新 Pod。它确保至少 3 个 Pod 可用， 同时最多总共 4 个 Pod 可用。 当 Deployment 设置为 4 个副本时，Pod 的个数会介于 3 和 5 之间。</p>
<p>获取 Deployment 的更多信息</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl describe deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Name:                   nginx-deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Namespace:              test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CreationTimestamp:      Tue, 01 Nov 2022 21:31:23 +0800</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Labels:                 app=nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Annotations:            deployment.kubernetes.io/revision: 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Selector:               app=nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Replicas:               3 desired | 3 updated | 3 total | 3 available | 0 unavailable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">StrategyType:           RollingUpdate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">MinReadySeconds:        0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RollingUpdateStrategy:  25% max unavailable, 25% max surge</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Pod Template:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Labels:  app=nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Containers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   nginx:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Image:        nginx:1.16.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Port:         80/TCP</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Host Port:    0/TCP</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Environment:  &lt;none&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Mounts:       &lt;none&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Volumes:        &lt;none&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Conditions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Type           Status  Reason</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ----           ------  ------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Available      True    MinimumReplicasAvailable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Progressing    True    NewReplicaSetAvailable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">OldReplicaSets:  &lt;none&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NewReplicaSet:   nginx-deployment-559d658b74 (3/3 replicas created)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Events:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Type    Reason             Age    From                   Message</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ----    ------             ----   ----                   -------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  23m    deployment-controller  Scaled up replica set nginx-deployment-66b6c48dd5 to 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  5m2s   deployment-controller  Scaled up replica set nginx-deployment-559d658b74 to 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  4m55s  deployment-controller  Scaled down replica set nginx-deployment-66b6c48dd5 to 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  4m55s  deployment-controller  Scaled up replica set nginx-deployment-559d658b74 to 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  4m54s  deployment-controller  Scaled down replica set nginx-deployment-66b6c48dd5 to 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  4m54s  deployment-controller  Scaled up replica set nginx-deployment-559d658b74 to 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  4m52s  deployment-controller  Scaled down replica set nginx-deployment-66b6c48dd5 to 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以看到，当第一次创建 Deployment 时，它创建了一个 ReplicaSet（<code>nginx-deployment-66b6c48dd5</code>） 并将其直接扩容至 3 个副本。更新 Deployment 时，它创建了一个新的 ReplicaSet （<code>nginx-deployment-559d658b74</code>），并将其扩容为 1，等待其就绪；然后将旧 ReplicaSet 缩容到 2， 将新的 ReplicaSet 扩容到 2 以便至少有 3 个 Pod 可用且最多创建 4 个 Pod。 然后，它使用相同的滚动更新策略继续对新的 ReplicaSet 扩容并对旧的 ReplicaSet 缩容。 最后，你将有 3 个可用的副本在新的 ReplicaSet 中，旧 ReplicaSet 将缩容到 0。</p>
<p>:::tip说明</p>
<p><strong>Kubernetes 在计算 <code>availableReplicas</code> 数值时不考虑终止过程中的 Pod</strong>， <code>availableReplicas</code> 的值一定介于 <code>replicas - maxUnavailable</code> 和 <code>replicas + maxSurge</code> 之间。 因此，你可能在上线期间看到 Pod 个数比预期的多，Deployment 所消耗的总的资源也大于 <code>replicas + maxSurge</code> 个 Pod 所用的资源，直到被终止的 Pod 所设置的 <code>terminationGracePeriodSeconds</code> 到期为止。</p>
<p>:::</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="翻转多-deployment-动态更新">翻转（多 Deployment 动态更新）<a href="#翻转多-deployment-动态更新" class="hash-link" aria-label="翻转（多 Deployment 动态更新）的直接链接" title="翻转（多 Deployment 动态更新）的直接链接">​</a></h3>
<p>Deployment 控制器每次注意到新的 Deployment 时，都会创建一个 ReplicaSet 以启动所需的 Pod。 如果更新了 Deployment，则控制标签匹配 <code>.spec.selector</code> 但模板不匹配 <code>.spec.template</code> 的 Pod 的现有 ReplicaSet 被缩容。 最终，新的 ReplicaSet 缩放为 <code>.spec.replicas</code> 个副本， 所有旧 ReplicaSets 缩放为 0 个副本。</p>
<p>当 Deployment 正在上线时被更新，Deployment 会针对更新创建一个新的 ReplicaSet 并开始对其扩容，之前正在被扩容的 ReplicaSet 会被翻转，添加到旧 ReplicaSets 列表 并开始缩容。</p>
<p>例如，假定你在创建一个 Deployment 以生成 <code>nginx:1.14.2</code> 的 5 个副本，但接下来 更新 Deployment 以创建 5 个 <code>nginx:1.16.1</code> 的副本，而此时只有 3 个 <code>nginx:1.14.2</code> 副本已创建。在这种情况下，Deployment 会立  即开始杀死 3 个 <code>nginx:1.14.2</code> Pod， 并开始创建 <code>nginx:1.16.1</code> Pod。它不会等待 <code>nginx:1.14.2</code> 的 5 个副本都创建完成后才开始执行变更动作。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="更改标签选择算符">更改标签选择算符<a href="#更改标签选择算符" class="hash-link" aria-label="更改标签选择算符的直接链接" title="更改标签选择算符的直接链接">​</a></h3>
<p>通常不鼓励更新标签选择算符。建议你提前规划选择算符。 在任何情况下，如果需要更新标签选择算符，请格外小心， 并确保自己了解这背后可能发生的所有事情。</p>
<p>:::tip说明</p>
<p>在 API 版本 <code>apps/v1</code> 中，Deployment 标签选择算符在创建后是不可变的。</p>
<p>:::</p>
<ul>
<li>添加选择算符时要求使用新标签更新 Deployment 规约中的 Pod 模板标签，否则将返回验证错误。 此更改是非重叠的，也就是说新的选择算符不会选择使用旧选择算符所创建的 ReplicaSet 和 Pod， 这会导致创建新的 ReplicaSet 时所有旧 ReplicaSet 都会被孤立。</li>
<li>选择算符的更新如果更改了某个算符的键名，这会导致与添加算符时相同的行为。</li>
<li>删除选择算符的操作会删除从 Deployment 选择算符中删除现有算符。 此操作不需要更改 Pod 模板标签。现有 ReplicaSet 不会被孤立，也不会因此创建新的 ReplicaSet， 但请注意已删除的标签仍然存在于现有的 Pod 和 ReplicaSet 中。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="回滚-deployment">回滚 Deployment<a href="#回滚-deployment" class="hash-link" aria-label="回滚 Deployment的直接链接" title="回滚 Deployment的直接链接">​</a></h2>
<p>有时，你可能想要回滚 Deployment；例如，当 Deployment 不稳定时（例如进入反复崩溃状态）。 默认情况下，Deployment 的所有上线记录都保留在系统中，以 便可以随时回滚 （你可以通过修改修订历史记录限制来更改这一约束）。</p>
<p>:::tip说明</p>
<p>Deployment 被触发上线时，系统就会创建 Deployment 的新的修订版本。 这意味着仅当 Deployment 的 Pod 模板（<code>.spec.template</code>）发生更改时，才会创建新修订版本 -- 例如，模板的标签或容器镜像发生变化。 其他更新，如 Deployment 的扩缩容操作不会创建 Deployment 修订版本。 这是为了方便同时执行手动缩放或自动缩放。 换言之，当你回滚到较早的修订版本时，只有 Deployment 的 Pod 模板部分会被回滚。</p>
<p>:::</p>
<p>假设你在更新 Deployment 时犯了一个拼写错误，将镜像名称命名设置为 <code>nginx:1.161</code> 而不是 <code>nginx:1.16.1</code>：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl set image deployment/nginx-deployment nginx=nginx:1.161 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>此时更新会卡住</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl rollout status deployment/nginx-deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Waiting for deployment &quot;nginx-deployment&quot; rollout to finish: 1 out of 3 new replicas have been updated...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>按 <code>Ctrl-C</code> 停止上述上线状态观测。有关上线停滞的详细信息，<a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#deployment-status" target="_blank" rel="noopener noreferrer">参考这里</a>。</p>
<p>查看rs，可以看到旧的副本有两个（<code>nginx-deployment-559d658b74</code> 和 <code>nginx-deployment-66b6c48dd5</code>）， 新的副本有 1 个（<code>nginx-deployment-66bc5d6c8</code>）</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                          DESIRED   CURRENT   READY   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74   3         3         3       39m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-66b6c48dd5   0         0         0       58m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-66bc5d6c8    1         1         0       55s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查看所创建的 Pod，你会注意到新 ReplicaSet 所创建的 1 个 Pod 卡顿在镜像拉取循环中</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get pod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                                READY   STATUS             RESTARTS   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74-5k8gp   1/1     Running            0          41m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74-t9lnw   1/1     Running            0          40m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74-vtw7t   1/1     Running            0          41m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-66bc5d6c8-jmrtq    0/1     ImagePullBackOff   0          2m5s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>:::tip说明</p>
<p>Deployment 控制器自动停止有问题的上线过程，并停止对新的 ReplicaSet 扩容。 这行为取决于所指定的 rollingUpdate 参数（具体为 <code>maxUnavailable</code>）。 默认情况下，Kubernetes 将此值设置为 25%。</p>
<p>:::</p>
<p>查看deployment</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl describe deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Name:                   nginx-deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Namespace:              test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CreationTimestamp:      Tue, 01 Nov 2022 21:31:23 +0800</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Labels:                 app=nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Annotations:            deployment.kubernetes.io/revision: 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Selector:               app=nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Replicas:               3 desired | 1 updated | 4 total | 3 available | 1 unavailable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">StrategyType:           RollingUpdate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">MinReadySeconds:        0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RollingUpdateStrategy:  25% max unavailable, 25% max surge</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Pod Template:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Labels:  app=nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Containers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   nginx:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Image:        nginx:1.161</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Port:         80/TCP</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Host Port:    0/TCP</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Environment:  &lt;none&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Mounts:       &lt;none&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Volumes:        &lt;none&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Conditions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Type           Status  Reason</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ----           ------  ------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Available      True    MinimumReplicasAvailable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Progressing    True    ReplicaSetUpdated</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">OldReplicaSets:  nginx-deployment-559d658b74 (3/3 replicas created)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NewReplicaSet:   nginx-deployment-66bc5d6c8 (1/1 replicas created)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Events:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Type    Reason             Age   From                   Message</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ----    ------             ----  ----                   -------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  60m   deployment-controller  Scaled up replica set nginx-deployment-66b6c48dd5 to 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  42m   deployment-controller  Scaled up replica set nginx-deployment-559d658b74 to 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  42m   deployment-controller  Scaled down replica set nginx-deployment-66b6c48dd5 to 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  42m   deployment-controller  Scaled up replica set nginx-deployment-559d658b74 to 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  42m   deployment-controller  Scaled down replica set nginx-deployment-66b6c48dd5 to 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  42m   deployment-controller  Scaled up replica set nginx-deployment-559d658b74 to 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  41m   deployment-controller  Scaled down replica set nginx-deployment-66b6c48dd5 to 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  3m7s  deployment-controller  Scaled up replica set nginx-deployment-66bc5d6c8 to 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>要解决此问题，需要回滚到以前稳定的 Deployment 版本。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="检查-deployment-上线历史">检查 Deployment 上线历史<a href="#检查-deployment-上线历史" class="hash-link" aria-label="检查 Deployment 上线历史的直接链接" title="检查 Deployment 上线历史的直接链接">​</a></h3>
<p>:::tip说明</p>
<p>在1.23版本之前，要想查看deployment修改历史，在创建或更新deployment时需要添加 <code>--record</code> 选项，否则查看历史记录会显示 <code>none</code></p>
<p>在初次创建时不加 <code>--record</code> 选项</p>
<p><img decoding="async" loading="lazy" src="https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot_2022-11-01_23.12.32.png" alt="iShot_2022-11-01_23.12.32" class="img_ev3q"></p>
<p>在更新时加 <code>--record</code> 选项，可以看到<code>--record</code> 选项在将来版本将移除警告 <code>Flag --record has been deprecated, --record will be removed in the future</code> (本文k8s版本1.22)</p>
<p><img decoding="async" loading="lazy" src="https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot_2022-11-01_23.14.14.png" alt="iShot_2022-11-01_23.14.14" class="img_ev3q"></p>
<p><a href="https://v1-22.docs.kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener noreferrer">1.22版本官方文档</a> 还有这一块的说明</p>
<p><img decoding="async" loading="lazy" src="https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot_2022-11-01_23.09.58.png" alt="iShot_2022-11-01_23.09.58" class="img_ev3q"></p>
<p>:::</p>
<p>按照如下步骤检查回滚历史</p>
<p>1.首先，检查 Deployment 修订历史</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl rollout history deployment/nginx-deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">deployment.apps/nginx-deployment </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">REVISION  CHANGE-CAUSE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1         kubectl apply --filename=nginx-deployment.yaml --record=true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2         kubectl set image deployment/nginx-deployment nginx=nginx:1.16.1 --record=true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3         kubectl set image deployment/nginx-deployment nginx=nginx:1.161 --record=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>CHANGE-CAUSE</code> 的内容是从 Deployment 的 <code>kubernetes.io/change-cause</code> 注解复制过来的。 复制动作发生在修订版本创建时。你可以通过以下方式设置 <code>CHANGE-CAUSE</code> 消息：</p>
<ul>
<li>使用 <code>kubectl annotate deployment/nginx-deployment kubernetes.io/change-cause=&quot;image updated to 1.16.1&quot;</code> 为 Deployment 添加注解。</li>
<li>手动编辑资源的清单。</li>
</ul>
<p>2.要查看修订历史的详细信息，运行：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl rollout history deployment/nginx-deployment --revision=2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">deployment.apps/nginx-deployment with revision #2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Pod Template:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Labels:	app=nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	pod-template-hash=559d658b74</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Annotations:	kubernetes.io/change-cause: kubectl set image deployment/nginx-deployment nginx=nginx:1.16.1 --record=true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Containers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   nginx:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Image:	nginx:1.16.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Port:	80/TCP</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Host Port:	0/TCP</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Environment:	&lt;none&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Mounts:	&lt;none&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Volumes:	&lt;none&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="回滚到之前的修订版本">回滚到之前的修订版本<a href="#回滚到之前的修订版本" class="hash-link" aria-label="回滚到之前的修订版本的直接链接" title="回滚到之前的修订版本的直接链接">​</a></h3>
<p>按照下面给出的步骤将 Deployment 从当前版本回滚到以前的版本（即版本 2）。</p>
<p>1.假定现在你已决定撤消当前上线并回滚到以前的修订版本：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl rollout undo deployment/nginx-deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">deployment.apps/nginx-deployment rolled back</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>或者，你也可以通过使用 <code>--to-revision</code> 来回滚到特定修订版本：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl rollout undo deployment/nginx-deployment --to-revision=2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>与回滚相关的指令的更详细信息，请参考 <a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#rollout" target="_blank" rel="noopener noreferrer"><code>kubectl rollout</code></a>。</p>
<p>现在，Deployment 正在回滚到以前的稳定版本。正如你所看到的，Deployment 控制器生成了回滚到修订版本 2 的 <code>DeploymentRollback</code> 事件。</p>
<p>2.检查回滚是否成功以及 Deployment 是否正在运行，运行：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get deploy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME               READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment   3/3     3            3           3m13s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>3.获取 Deployment 描述信息：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl describe deployment nginx-deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Name:                   nginx-deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Namespace:              test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CreationTimestamp:      Wed, 02 Nov 2022 21:28:32 +0800</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Labels:                 app=nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Annotations:            deployment.kubernetes.io/revision: 4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        kubernetes.io/change-cause: kubectl set image deployment/nginx-deployment nginx=nginx:1.16.1 --record=true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Selector:               app=nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Replicas:               3 desired | 3 updated | 3 total | 3 available | 0 unavailable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">StrategyType:           RollingUpdate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">MinReadySeconds:        0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RollingUpdateStrategy:  25% max unavailable, 25% max surge</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Pod Template:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Labels:  app=nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Containers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   nginx:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Image:        nginx:1.16.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Port:         80/TCP</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Host Port:    0/TCP</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Environment:  &lt;none&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Mounts:       &lt;none&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Volumes:        &lt;none&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Conditions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Type           Status  Reason</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ----           ------  ------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Available      True    MinimumReplicasAvailable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Progressing    True    NewReplicaSetAvailable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">OldReplicaSets:  &lt;none&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NewReplicaSet:   nginx-deployment-559d658b74 (3/3 replicas created)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Events:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Type    Reason             Age    From                   Message</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ----    ------             ----   ----                   -------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  3m29s  deployment-controller  Scaled up replica set nginx-deployment-66b6c48dd5 to 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  3m9s   deployment-controller  Scaled up replica set nginx-deployment-559d658b74 to 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  3m7s   deployment-controller  Scaled down replica set nginx-deployment-66b6c48dd5 to 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  3m7s   deployment-controller  Scaled up replica set nginx-deployment-559d658b74 to 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  3m6s   deployment-controller  Scaled down replica set nginx-deployment-66b6c48dd5 to 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  3m6s   deployment-controller  Scaled up replica set nginx-deployment-559d658b74 to 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  3m5s   deployment-controller  Scaled down replica set nginx-deployment-66b6c48dd5 to 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  3m     deployment-controller  Scaled up replica set nginx-deployment-66bc5d6c8 to 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ScalingReplicaSet  75s    deployment-controller  Scaled down replica set nginx-deployment-66bc5d6c8 to 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="缩放-deployment">缩放 Deployment<a href="#缩放-deployment" class="hash-link" aria-label="缩放 Deployment的直接链接" title="缩放 Deployment的直接链接">​</a></h2>
<p>你可以使用如下指令缩放 Deployment：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl scale deployment/nginx-deployment --replicas=10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查看当前deployment</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get deploy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME               READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment   3/3     3            3           8m29s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>执行上述扩容命令后再次查看</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get deploy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME               READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment   10/10   10           10          8m54s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get pod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                                READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74-2shwh   1/1     Running   0          40s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74-4krnm   1/1     Running   0          8m59s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74-6xdpt   1/1     Running   0          40s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74-9vdr6   1/1     Running   0          9m2s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74-bx2ct   1/1     Running   0          40s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74-cb9z4   1/1     Running   0          40s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74-k6q5v   1/1     Running   0          40s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74-n4lq9   1/1     Running   0          9m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74-spgtn   1/1     Running   0          40s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74-z45q9   1/1     Running   0          40s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>假设集群启用了<a href="https://kubernetes.io/zh-cn/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/" target="_blank" rel="noopener noreferrer">Pod 的水平自动缩放</a>， 你可以为 Deployment 设置自动缩放器，并基于现有 Pod 的 CPU 利用率选择要运行的 Pod 个数下限和上限。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl autoscale deployment/nginx-deployment --min=10 --max=15 --cpu-percent=80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="比例缩放">比例缩放<a href="#比例缩放" class="hash-link" aria-label="比例缩放的直接链接" title="比例缩放的直接链接">​</a></h3>
<p>RollingUpdate 的 Deployment 支持同时运行应用程序的多个版本。 当自动缩放器缩放处于上线进程（仍在进行中或暂停）中的 RollingUpdate Deployment 时， Deployment 控制器会平衡现有的活跃状态的 ReplicaSets（含 Pod 的 ReplicaSets）中的额外副本， 以降低风险。这称为 <em>比例缩放（Proportional Scaling）</em>。</p>
<p>例如，你正在运行一个 10 个副本的 Deployment，其 <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#max-surge" target="_blank" rel="noopener noreferrer">maxSurge</a>=3，<a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#max-unavailable" target="_blank" rel="noopener noreferrer">maxUnavailable</a>=2。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get deploy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME               READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment   10/10   10           10          8m54s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>更新 Deployment 使用新镜像，碰巧该镜像无法从集群内部解析(即更新一个不存在的镜像)。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl set image deployment/nginx-deployment nginx=nginx:sometag</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>镜像更新使用新rs启动新的上线过程， 但由于上面提到的 <code>maxUnavailable</code> 要求，该进程被阻塞了。检查上线状态：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                          DESIRED   CURRENT   READY   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-559d658b74   8         8         8       28m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-5cdd86fbf7   5         5         0       2m8s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后，出现了新的 Deployment 扩缩请求。自动缩放器将 Deployment 副本增加到 15。 Deployment 控制器需要决定在何处添加 5 个新副本。如果未使用比例缩放，所有 5 个副本 都将添加到新的 ReplicaSet 中。使用比例缩放时，可以将额外的副本分布到所有 ReplicaSet。 较大比例的副本会被添加到拥有最多副本的 ReplicaSet，而较低比例的副本会进入到 副本较少的 ReplicaSet。所有剩下的副本都会添加到副本最多的 ReplicaSet。 具有零副本的 ReplicaSets 不会被扩容。</p>
<p>在上面的示例中，3 个副本被添加到旧 ReplicaSet 中，2 个副本被添加到新 ReplicaSet。 假定新的副本都很健康，上线过程最终应将所有副本迁移到新的 ReplicaSet 中。 要确认这一点，请运行：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl get deploy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="暂停恢复-deployment-的上线过程">暂停、恢复 Deployment 的上线过程<a href="#暂停恢复-deployment-的上线过程" class="hash-link" aria-label="暂停、恢复 Deployment 的上线过程的直接链接" title="暂停、恢复 Deployment 的上线过程的直接链接">​</a></h2>
<p>在你更新一个 Deployment 的时候，或者计划更新它的时候， 你可以在触发一个或多个更新之前暂停 Deployment 的上线过程。 当你准备应用这些变更时，你可以重新恢复 Deployment 上线过程。 这样做使得你能够在暂停和恢复执行之间应用多个修补程序，而不会触发不必要的上线操作。</p>
<p>查看deployment</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get deploy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME               READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment   3/3     3            3           6s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查看rs</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                          DESIRED   CURRENT   READY   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-66b6c48dd5   3         3         3       28s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使用如下指令暂停上线：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl rollout pause deployment/nginx-deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">deployment.apps/nginx-deployment paused</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>接下来更新 Deployment 镜像：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl set image deployment/nginx-deployment nginx=nginx:1.16.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意没有新的上线被触发：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl rollout history deployment/nginx-deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">deployment.apps/nginx-deployment </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">REVISION  CHANGE-CAUSE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1         &lt;none&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查看rs也没有更改</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                          DESIRED   CURRENT   READY   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-66b6c48dd5   3         3         3       10m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>你可以根据需要执行很多更新操作，例如，可以要使用的资源：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl set resources deployment/nginx-deployment -c=nginx --limits=cpu=200m,memory=512Mi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>暂停 Deployment 上线之前的初始状态将继续发挥作用，但新的更新在 Deployment 上线被暂停期间不会产生任何效果。</p>
<p>恢复 Deployment 上线并观察新的 ReplicaSet 的创建过程，其中包含了所应用的所有更新</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl rollout resume deployment/nginx-deployment</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查看rs</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get rs -w</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                          DESIRED   CURRENT   READY   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-66b6c48dd5   2         2         2       13m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-84864d5954   2         2         1       3s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-84864d5954   2         2         2       4s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-66b6c48dd5   1         2         2       13m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-84864d5954   3         2         2       4s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-66b6c48dd5   1         2         2       13m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-66b6c48dd5   1         1         1       13m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-84864d5954   3         2         2       4s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-84864d5954   3         3         2       4s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-84864d5954   3         3         3       5s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-66b6c48dd5   0         1         1       13m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-66b6c48dd5   0         1         1       13m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-deployment-66b6c48dd5   0         0         0       13m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>:::tip说明</p>
<p>你不可以回滚处于暂停状态的 Deployment，除非先恢复其执行状态。</p>
<p>:::</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deployment-状态">Deployment 状态<a href="#deployment-状态" class="hash-link" aria-label="Deployment 状态的直接链接" title="Deployment 状态的直接链接">​</a></h2>
<p>Deployment 的生命周期中会有许多状态。上线新的 ReplicaSet 期间可能处于 <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#progressing-deployment" target="_blank" rel="noopener noreferrer">Progressing（进行中）</a>，可能是 <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#complete-deployment" target="_blank" rel="noopener noreferrer">Complete（已完成）</a>，也可能是 <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#failed-deployment" target="_blank" rel="noopener noreferrer">Failed（失败）</a>以至于无法继续进行。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="进行中的-deployment">进行中的 Deployment<a href="#进行中的-deployment" class="hash-link" aria-label="进行中的 Deployment的直接链接" title="进行中的 Deployment的直接链接">​</a></h3>
<p>执行下面的任务期间，Kubernetes 标记 Deployment 为<strong>进行中</strong>（Progressing）_：</p>
<ul>
<li>Deployment 创建新的 ReplicaSet</li>
<li>Deployment 正在为其最新的 ReplicaSet 扩容</li>
<li>Deployment 正在为其旧有的 ReplicaSet(s) 缩容</li>
<li>新的 Pod 已经就绪或者可用（就绪至少持续了 <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#min-ready-seconds" target="_blank" rel="noopener noreferrer">MinReadySeconds</a> 秒）。</li>
</ul>
<p>当上线过程进入“Progressing”状态时，Deployment 控制器会向 Deployment 的 <code>.status.conditions</code> 中添加包含下面属性的状况条目：</p>
<ul>
<li><code>type: Progressing</code></li>
<li><code>status: &quot;True&quot;</code></li>
<li><code>reason: NewReplicaSetCreated</code> | <code>reason: FoundNewReplicaSet</code> | <code>reason: ReplicaSetUpdated</code></li>
</ul>
<p>你可以使用 <code>kubectl rollout status</code> 监视 Deployment 的进度。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="完成的-deployment">完成的 Deployment<a href="#完成的-deployment" class="hash-link" aria-label="完成的 Deployment的直接链接" title="完成的 Deployment的直接链接">​</a></h3>
<p>当 Deployment 具有以下特征时，Kubernetes 将其标记为<strong>完成（Complete）</strong>;</p>
<ul>
<li>与 Deployment 关联的所有副本都已更新到指定的最新版本，这意味着之前 请求的所有更新都已完成。</li>
<li>与 Deployment 关联的所有副本都可用。</li>
<li>未运行 Deployment 的旧副本。</li>
</ul>
<p>当上线过程进入“Complete”状态时，Deployment 控制器会向 Deployment 的 <code>.status.conditions</code> 中添加包含下面属性的状况条目：</p>
<ul>
<li><code>type: Progressing</code></li>
<li><code>status: &quot;True&quot;</code></li>
<li><code>reason: NewReplicaSetAvailable</code></li>
</ul>
<p>这一 <code>Progressing</code> 状况的状态值会持续为 <code>&quot;True&quot;</code>，直至新的上线动作被触发。 即使副本的可用状态发生变化（进而影响 <code>Available</code> 状况），<code>Progressing</code> 状况的值也不会变化。</p>
<p>你可以使用 <code>kubectl rollout status</code> 检查 Deployment 是否已完成。 如果上线成功完成，<code>kubectl rollout status</code> 返回退出代码 0。</p>
<p>对deployment进行扩容</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl scale deployment/nginx-deployment --replicas=10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查看deployment状态</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl rollout status deployment nginx-deployment </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Waiting for deployment &quot;nginx-deployment&quot; rollout to finish: 3 of 10 updated replicas are available...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Waiting for deployment &quot;nginx-deployment&quot; rollout to finish: 4 of 10 updated replicas are available...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Waiting for deployment &quot;nginx-deployment&quot; rollout to finish: 5 of 10 updated replicas are available...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Waiting for deployment &quot;nginx-deployment&quot; rollout to finish: 6 of 10 updated replicas are available...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Waiting for deployment &quot;nginx-deployment&quot; rollout to finish: 7 of 10 updated replicas are available...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Waiting for deployment &quot;nginx-deployment&quot; rollout to finish: 8 of 10 updated replicas are available...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Waiting for deployment &quot;nginx-deployment&quot; rollout to finish: 9 of 10 updated replicas are available...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="失败的-deployment">失败的 Deployment<a href="#失败的-deployment" class="hash-link" aria-label="失败的 Deployment的直接链接" title="失败的 Deployment的直接链接">​</a></h3>
<p>你的 Deployment 可能会在尝试部署其最新的 ReplicaSet 受挫，一直处于未完成状态。 造成此情况一些可能因素如下：</p>
<ul>
<li>配额（Quota）不足</li>
<li>就绪探测（Readiness Probe）失败</li>
<li>镜像拉取错误</li>
<li>权限不足</li>
<li>限制范围（Limit Ranges）问题</li>
<li>应用程序运行时的配置错误</li>
</ul>
<p>检测此状况的一种方法是在 Deployment 规约中指定截止时间参数： （<a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#progress-deadline-seconds" target="_blank" rel="noopener noreferrer"><code>.spec.progressDeadlineSeconds</code></a>）。 <code>.spec.progressDeadlineSeconds</code> 给出的是一个秒数值，Deployment 控制器在（通过 Deployment 状态） 标示 Deployment 进展停滞之前，需要等待所给的时长。</p>
<p>以下 <code>kubectl</code> 命令设置规约中的 <code>progressDeadlineSeconds</code>，从而告知控制器 在 10 分钟后报告 Deployment 没有进展：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl patch deployment/nginx-deployment -p &#x27;{&quot;spec&quot;:{&quot;progressDeadlineSeconds&quot;:600}}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>超过截止时间后，Deployment 控制器将添加具有以下属性的 Deployment 状况到 Deployment 的 <code>.status.conditions</code> 中：</p>
<ul>
<li><code>type: Progressing</code></li>
<li><code>status: &quot;False&quot;</code></li>
<li><code>reason: ProgressDeadlineExceeded</code></li>
</ul>
<p>这一状况也可能会比较早地失败，因而其状态值被设置为 <code>&quot;False&quot;</code>， 其原因为 <code>ReplicaSetCreateError</code>。 一旦 Deployment 上线完成，就不再考虑其期限。</p>
<p>参考 <a href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#typical-status-properties" target="_blank" rel="noopener noreferrer">Kubernetes API Conventions</a> 获取更多状态状况相关的信息。</p>
<p>:::tip说明</p>
<p>除了报告 <code>Reason=ProgressDeadlineExceeded</code> 状态之外，Kubernetes 对已停止的 Deployment 不执行任何操作。更高级别的编排器可以利用这一设计并相应地采取行动。 例如，将 Deployment 回滚到其以前的版本。</p>
<p>如果你暂停了某个 Deployment 上线，Kubernetes 不 再根据指定的截止时间检查 Deployment 进展。 你可以在上线过程中间安全地暂停 Deployment 再恢复其执行，这样做不会导致超出最后时限的问题。</p>
<p>:::</p>
<p>Deployment 可能会出现瞬时性的错误，可能因为设置的超时时间过短， 也可能因为其他可认为是临时性的问题。例如，假定所遇到的问题是配额不足。 如果描述 Deployment，你将会注意到以下部分：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl describe deployment nginx-deployment</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>输出类似于：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;...&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Conditions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Type            Status  Reason</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ----            ------  ------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Available       True    MinimumReplicasAvailable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Progressing     True    ReplicaSetUpdated</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ReplicaFailure  True    FailedCreate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;...&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果运行 <code>kubectl get deployment nginx-deployment -o yaml</code>，Deployment 状态输出 将类似于这样：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">status:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  availableReplicas: 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  conditions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - lastTransitionTime: 2016-10-04T12:25:39Z</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    lastUpdateTime: 2016-10-04T12:25:39Z</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    message: Replica set &quot;nginx-deployment-4262182780&quot; is progressing.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    reason: ReplicaSetUpdated</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    status: &quot;True&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    type: Progressing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - lastTransitionTime: 2016-10-04T12:25:42Z</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    lastUpdateTime: 2016-10-04T12:25:42Z</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    message: Deployment has minimum availability.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    reason: MinimumReplicasAvailable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    status: &quot;True&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    type: Available</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - lastTransitionTime: 2016-10-04T12:25:39Z</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    lastUpdateTime: 2016-10-04T12:25:39Z</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    message: &#x27;Error creating: pods &quot;nginx-deployment-4262182780-&quot; is forbidden: exceeded quota:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      object-counts, requested: pods=1, used: pods=3, limited: pods=2&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    reason: FailedCreate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    status: &quot;True&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    type: ReplicaFailure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  observedGeneration: 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  replicas: 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  unavailableReplicas: 2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>最终，一旦超过 Deployment 进度限期，Kubernetes 将更新状态和进度状况的原因：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Conditions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Type            Status  Reason</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ----            ------  ------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Available       True    MinimumReplicasAvailable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Progressing     False   ProgressDeadlineExceeded</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ReplicaFailure  True    FailedCreate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以通过缩容 Deployment 或者缩容其他运行状态的控制器，或者直接在命名空间中增加配额 来解决配额不足的问题。如果配额条件满足，Deployment 控制器完成了 Deployment 上线操作， Deployment 状态会更新为成功状况（<code>Status=True</code> 和 <code>Reason=NewReplicaSetAvailable</code>）。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Conditions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Type          Status  Reason</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ----          ------  ------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Available     True    MinimumReplicasAvailable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Progressing   True    NewReplicaSetAvailable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>type: Available</code> 加上 <code>status: True</code> 意味着 Deployment 具有最低可用性。 最低可用性由 Deployment 策略中的参数指定。 <code>type: Progressing</code> 加上 <code>status: True</code> 表示 Deployment 处于上线过程中，并且正在运行， 或者已成功完成进度，最小所需新副本处于可用。 请参阅对应状况的 Reason 了解相关细节。 在我们的案例中 <code>reason: NewReplicaSetAvailable</code> 表示 Deployment 已完成。</p>
<p>你可以使用 <code>kubectl rollout status</code> 检查 Deployment 是否未能取得进展。 如果 Deployment 已超过进度限期，<code>kubectl rollout status</code> 返回非零退出代码。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl rollout status deployment/nginx-deployment</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>输出类似于：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Waiting for rollout to finish: 2 out of 3 new replicas have been updated...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">error: deployment &quot;nginx&quot; exceeded its progress deadline</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>kubectl rollout</code> 命令的退出状态为 1（表明发生了错误）：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ echo $?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="对失败-deployment-的操作">对失败 Deployment 的操作<a href="#对失败-deployment-的操作" class="hash-link" aria-label="对失败 Deployment 的操作的直接链接" title="对失败 Deployment 的操作的直接链接">​</a></h3>
<p>可应用于已完成的 Deployment 的所有操作也适用于失败的 Deployment。 你可以对其执行扩缩容、回滚到以前的修订版本等操作，或者在需要对 Deployment 的 Pod 模板应用多项调整时，将 Deployment 暂停。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="清理策略">清理策略<a href="#清理策略" class="hash-link" aria-label="清理策略的直接链接" title="清理策略的直接链接">​</a></h2>
<p>你可以在 Deployment 中设置 <code>.spec.revisionHistoryLimit</code> 字段以指定保留此 Deployment 有多少个旧的 ReplicaSet。其余的 ReplicaSet 将在后台被垃圾回收。 默认情况下，此值为 10。</p>
<p>:::tip说明</p>
<p>显式将此字段设置为 0 将导致 Deployment 的所有历史记录被清空，因此 Deployment 将无法回滚。</p>
<p>:::</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="金丝雀部署">金丝雀部署<a href="#金丝雀部署" class="hash-link" aria-label="金丝雀部署的直接链接" title="金丝雀部署的直接链接">​</a></h2>
<p>如果要使用 Deployment 向用户子集或服务器子集上线版本， 则可以遵循<a href="https://kubernetes.io/zh-cn/docs/concepts/cluster-administration/manage-deployment/#canary-deployments" target="_blank" rel="noopener noreferrer">资源管理</a>所描述的金丝雀模式， 创建多个 Deployment，每个版本一个。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="编写-deployment-规约">编写 Deployment 规约<a href="#编写-deployment-规约" class="hash-link" aria-label="编写 Deployment 规约的直接链接" title="编写 Deployment 规约的直接链接">​</a></h2>
<p>同其他 Kubernetes 配置一样， Deployment 需要 <code>.apiVersion</code>，<code>.kind</code> 和 <code>.metadata</code> 字段。 有关配置文件的其他信息，请参考<a href="https://kubernetes.io/zh-cn/docs/tasks/run-application/run-stateless-application-deployment/" target="_blank" rel="noopener noreferrer">部署 Deployment</a>、 配置容器和<a href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/object-management/" target="_blank" rel="noopener noreferrer">使用 kubectl 管理资源</a>等相关文档。</p>
<p>Deployment 对象的名称必须是合法的 <a href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/names#dns-subdomain-names" target="_blank" rel="noopener noreferrer">DNS 子域名</a>。 Deployment 还需要 <a href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status" target="_blank" rel="noopener noreferrer"><code>.spec</code> 部分</a>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pod-模板">Pod 模板<a href="#pod-模板" class="hash-link" aria-label="Pod 模板的直接链接" title="Pod 模板的直接链接">​</a></h3>
<p><code>.spec</code> 中只有 <code>.spec.template</code> 和 <code>.spec.selector</code> 是必需的字段。</p>
<p><code>.spec.template</code> 是一个 <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/#pod-templates" target="_blank" rel="noopener noreferrer">Pod 模板</a>。 它和 <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/" target="_blank" rel="noopener noreferrer">Pod</a> 的语法规则完全相同。 只是这里它是嵌套的，因此不需要 <code>apiVersion</code> 或 <code>kind</code>。</p>
<p>除了 Pod 的必填字段外，Deployment 中的 Pod 模板必须指定适当的标签和适当的重新启动策略。 对于标签，请确保不要与其他控制器重叠。请参考<a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#selector" target="_blank" rel="noopener noreferrer">选择算符</a>。</p>
<p>只有 <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/pod-lifecycle/#restart-policy" target="_blank" rel="noopener noreferrer"><code>.spec.template.spec.restartPolicy</code></a> 等于 <code>Always</code> 才是被允许的，这也是在没有指定时的默认设置。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="副本">副本<a href="#副本" class="hash-link" aria-label="副本的直接链接" title="副本的直接链接">​</a></h3>
<p><code>.spec.replicas</code> 是指定所需 Pod 的可选字段。它的默认值是1。</p>
<p>如果你对某个 Deployment 执行了手动扩缩操作（例如，通过 <code>kubectl scale deployment deployment --replicas=X</code>）， 之后基于清单对 Deployment 执行了更新操作（例如通过运行 <code>kubectl apply -f deployment.yaml</code>），那么通过应用清单而完成的更新会覆盖之前手动扩缩所作的变更。</p>
<p>如果一个 <a href="https://kubernetes.io/zh-cn/docs/tasks/run-application/horizontal-pod-autoscale/" target="_blank" rel="noopener noreferrer">HorizontalPodAutoscaler</a> （或者其他执行水平扩缩操作的类似 API）在管理 Deployment 的扩缩， 则不要设置 <code>.spec.replicas</code>。</p>
<p>恰恰相反，应该允许 Kubernetes <a href="https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-control-plane" target="_blank" rel="noopener noreferrer">控制面</a>来自动管理 <code>.spec.replicas</code> 字段。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="选择算符">选择算符<a href="#选择算符" class="hash-link" aria-label="选择算符的直接链接" title="选择算符的直接链接">​</a></h3>
<p><code>.spec.selector</code> 是指定本 Deployment 的 Pod <a href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/labels/" target="_blank" rel="noopener noreferrer">标签选择算符</a>的必需字段。</p>
<p><code>.spec.selector</code> 必须匹配 <code>.spec.template.metadata.labels</code>，否则请求会被 API 拒绝。</p>
<p>在 API <code>apps/v1</code>版本中，<code>.spec.selector</code> 和 <code>.metadata.labels</code> 如果没有设置的话， 不会被默认设置为 <code>.spec.template.metadata.labels</code>，所以需要明确进行设置。 同时在 <code>apps/v1</code>版本中，Deployment 创建后 <code>.spec.selector</code> 是不可变的。</p>
<p>当 Pod 的标签和选择算符匹配，但其模板和 <code>.spec.template</code> 不同时，或者此类 Pod 的总数超过 <code>.spec.replicas</code> 的设置时，Deployment 会终结之。 如果 Pod 总数未达到期望值，Deployment 会基于 <code>.spec.template</code> 创建新的 Pod 。</p>
<p>:::tip说明</p>
<p>你不应直接创建与此选择算符匹配的 Pod，也不应通过创建另一个 Deployment 或者类似于 ReplicaSet 或 ReplicationController 这类控制器来创建标签与此选择算符匹配的 Pod。 如果这样做，第一个 Deployment 会认为它创建了这些 Pod。 Kubernetes 不会阻止你这么做。</p>
<p>:::</p>
<p>如果有多个控制器的选择算符发生重叠，则控制器之间会因冲突而无法正常工作。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="策略">策略<a href="#策略" class="hash-link" aria-label="策略的直接链接" title="策略的直接链接">​</a></h3>
<p><code>.spec.strategy</code> 策略指定用于用新 Pod 替换旧 Pod 的策略。 <code>.spec.strategy.type</code> 可以是 “Recreate” 或 “RollingUpdate”。“RollingUpdate” 是默认值。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="重新创建-deployment">重新创建 Deployment<a href="#重新创建-deployment" class="hash-link" aria-label="重新创建 Deployment的直接链接" title="重新创建 Deployment的直接链接">​</a></h4>
<p>如果 <code>.spec.strategy.type==Recreate</code>，在创建新 Pod 之前，所有现有的 Pod 会被杀死。</p>
<p>:::tip说明</p>
<p>这只会确保为了升级而创建新 Pod 之前其他 Pod 都已终止。如果你升级一个 Deployment， 所有旧版本的 Pod 都会立即被终止。控制器等待这些 Pod 被成功移除之后， 才会创建新版本的 Pod。如果你手动删除一个 Pod，其生命周期是由 ReplicaSet 来控制的， 后者会立即创建一个替换 Pod（即使旧的 Pod 仍然处于 Terminating 状态）。 如果你需要一种“最多 n 个”的 Pod 个数保证，你需要考虑使用 <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/statefulset/" target="_blank" rel="noopener noreferrer">StatefulSet</a>。</p>
<p>:::</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="滚动更新-deployment">滚动更新 Deployment<a href="#滚动更新-deployment" class="hash-link" aria-label="滚动更新 Deployment的直接链接" title="滚动更新 Deployment的直接链接">​</a></h4>
<p>Deployment 会在 <code>.spec.strategy.type==RollingUpdate</code>时，采取 滚动更新的方式更新 Pod。你可以指定 <code>maxUnavailable</code> 和 <code>maxSurge</code> 来控制滚动更新 过程。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="最大不可用-maxunavailable">最大不可用 maxUnavailable<a href="#最大不可用-maxunavailable" class="hash-link" aria-label="最大不可用 maxUnavailable的直接链接" title="最大不可用 maxUnavailable的直接链接">​</a></h5>
<p><code>.spec.strategy.rollingUpdate.maxUnavailable</code> 是一个可选字段，用来指定 更新过程中不可用的 Pod 的个数上限。该值可以是绝对数字（例如，5），也可以是所需 Pod 的百分比（例如，10%）。百分比值会转换成绝对数并去除小数部分。 如果 <code>.spec.strategy.rollingUpdate.maxSurge</code> 为 0，则此值不能为 0。 默认值为 25%。</p>
<p>例如，当此值设置为 30% 时，滚动更新开始时会立即将旧 ReplicaSet 缩容到期望 Pod 个数的70%。 新 Pod 准备就绪后，可以继续缩容旧有的 ReplicaSet，然后对新的 ReplicaSet 扩容， 确保在更新期间可用的 Pod 总数在任何时候都至少为所需的 Pod 个数的 70%。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="最大峰值-maxsurge">最大峰值 maxSurge<a href="#最大峰值-maxsurge" class="hash-link" aria-label="最大峰值 maxSurge的直接链接" title="最大峰值 maxSurge的直接链接">​</a></h5>
<p><code>.spec.strategy.rollingUpdate.maxSurge</code> 是一个可选字段，用来指定可以创建的超出期望 Pod 个数的 Pod 数量。此值可以是绝对数（例如，5）或所需 Pod 的百分比（例如，10%）。 如果 <code>MaxUnavailable</code> 为 0，则此值不能为 0。百分比值会通过向上取整转换为绝对数 。 此字段的默认值为 25%。</p>
<p>例如，当此值为 30% 时，启动滚动更新后，会立即对新的 ReplicaSet 扩容，同时保证新旧 Pod 的总数不超过所需 Pod 总数的 130%。一旦旧 Pod 被杀死，新的 ReplicaSet 可以进一步扩容， 同时确保更新期间的任何时候运行中的 Pod 总数最多为所需 Pod 总数的 130%。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="进度期限秒数">进度期限秒数<a href="#进度期限秒数" class="hash-link" aria-label="进度期限秒数的直接链接" title="进度期限秒数的直接链接">​</a></h3>
<p><code>.spec.progressDeadlineSeconds</code> 是一个可选字段，用于指定系统在报告 Deployment <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#failed-deployment" target="_blank" rel="noopener noreferrer">进展失败</a> 之前等待 Deployment 取得进展的秒数。 这类报告会在资源状态中体现为 <code>type: Progressing</code>、<code>status: False</code>、 <code>reason: ProgressDeadlineExceeded</code>。Deployment 控制器将在默认 600 毫秒内持续重试 Deployment。 将来，一旦实现了自动回滚，Deployment 控制器将在探测到这样的条件时立即回滚 Deployment。</p>
<p>如果指定，则此字段值需要大于 <code>.spec.minReadySeconds</code> 取值。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="最短就绪时间">最短就绪时间<a href="#最短就绪时间" class="hash-link" aria-label="最短就绪时间的直接链接" title="最短就绪时间的直接链接">​</a></h3>
<p><code>.spec.minReadySeconds</code> 是一个可选字段，用于指定新创建的 Pod 在没有任意容器崩溃情况下的最小就绪时间， 只有超出这个时间 Pod 才被视为可用。默认值为 0（Pod 在准备就绪后立即将被视为可用）。 要了解何时 Pod 被视为就绪， 可参考<a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/pod-lifecycle/#container-probes" target="_blank" rel="noopener noreferrer">容器探针</a>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="修订历史限制">修订历史限制<a href="#修订历史限制" class="hash-link" aria-label="修订历史限制的直接链接" title="修订历史限制的直接链接">​</a></h3>
<p>Deployment 的修订历史记录存储在它所控制的 ReplicaSets 中。</p>
<p><code>.spec.revisionHistoryLimit</code> 是一个可选字段，用来设定出于回滚目的所要保留的旧 ReplicaSet 数量。 这些旧 ReplicaSet 会消耗 etcd 中的资源，并占用 <code>kubectl get rs</code> 的输出。 每个 Deployment 修订版本的配置都存储在其 ReplicaSets 中；因此，一旦删除了旧的 ReplicaSet， 将失去回滚到 Deployment 的对应修订版本的能力。 默认情况下，系统保留 10 个旧 ReplicaSet，但其理想值取决于新 Deployment 的频率和稳定性。</p>
<p>更具体地说，将此字段设置为 0 意味着将清理所有具有 0 个副本的旧 ReplicaSet。 在这种情况下，无法撤消新的 Deployment 上线，因为它的修订历史被清除了。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="paused暂停的">paused（暂停的）<a href="#paused暂停的" class="hash-link" aria-label="paused（暂停的）的直接链接" title="paused（暂停的）的直接链接">​</a></h3>
<p><code>.spec.paused</code> 是用于暂停和恢复 Deployment 的可选布尔字段。 暂停的 Deployment 和未暂停的 Deployment 的唯一区别是，Deployment 处于暂停状态时， PodTemplateSpec 的任何修改都不会触发新的上线。 Deployment 在创建时是默认不会处于暂停状态。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/云原生/k8s/k8s知识点/工作负载/DaemonSet/DaemonSet简介"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">DaemonSet简介</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/云原生/k8s/k8s知识点/工作负载/Deployment/使用 Deployment 运行一个无状态应用"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">使用 Deployment 运行一个无状态应用</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#deployment简介" class="table-of-contents__link toc-highlight">deployment简介</a></li><li><a href="#用例" class="table-of-contents__link toc-highlight">用例</a></li><li><a href="#创建-deployment" class="table-of-contents__link toc-highlight">创建 Deployment</a><ul><li><a href="#pod-template-hash-标签" class="table-of-contents__link toc-highlight">Pod-template-hash 标签</a></li></ul></li><li><a href="#更新-deployment" class="table-of-contents__link toc-highlight">更新 Deployment</a><ul><li><a href="#翻转多-deployment-动态更新" class="table-of-contents__link toc-highlight">翻转（多 Deployment 动态更新）</a></li><li><a href="#更改标签选择算符" class="table-of-contents__link toc-highlight">更改标签选择算符</a></li></ul></li><li><a href="#回滚-deployment" class="table-of-contents__link toc-highlight">回滚 Deployment</a><ul><li><a href="#检查-deployment-上线历史" class="table-of-contents__link toc-highlight">检查 Deployment 上线历史</a></li><li><a href="#回滚到之前的修订版本" class="table-of-contents__link toc-highlight">回滚到之前的修订版本</a></li></ul></li><li><a href="#缩放-deployment" class="table-of-contents__link toc-highlight">缩放 Deployment</a><ul><li><a href="#比例缩放" class="table-of-contents__link toc-highlight">比例缩放</a></li></ul></li><li><a href="#暂停恢复-deployment-的上线过程" class="table-of-contents__link toc-highlight">暂停、恢复 Deployment 的上线过程</a></li><li><a href="#deployment-状态" class="table-of-contents__link toc-highlight">Deployment 状态</a><ul><li><a href="#进行中的-deployment" class="table-of-contents__link toc-highlight">进行中的 Deployment</a></li><li><a href="#完成的-deployment" class="table-of-contents__link toc-highlight">完成的 Deployment</a></li><li><a href="#失败的-deployment" class="table-of-contents__link toc-highlight">失败的 Deployment</a></li><li><a href="#对失败-deployment-的操作" class="table-of-contents__link toc-highlight">对失败 Deployment 的操作</a></li></ul></li><li><a href="#清理策略" class="table-of-contents__link toc-highlight">清理策略</a></li><li><a href="#金丝雀部署" class="table-of-contents__link toc-highlight">金丝雀部署</a></li><li><a href="#编写-deployment-规约" class="table-of-contents__link toc-highlight">编写 Deployment 规约</a><ul><li><a href="#pod-模板" class="table-of-contents__link toc-highlight">Pod 模板</a></li><li><a href="#副本" class="table-of-contents__link toc-highlight">副本</a></li><li><a href="#选择算符" class="table-of-contents__link toc-highlight">选择算符</a></li><li><a href="#策略" class="table-of-contents__link toc-highlight">策略</a><ul><li><a href="#重新创建-deployment" class="table-of-contents__link toc-highlight">重新创建 Deployment</a></li><li><a href="#滚动更新-deployment" class="table-of-contents__link toc-highlight">滚动更新 Deployment</a><ul><li><a href="#最大不可用-maxunavailable" class="table-of-contents__link toc-highlight">最大不可用 maxUnavailable</a></li><li><a href="#最大峰值-maxsurge" class="table-of-contents__link toc-highlight">最大峰值 maxSurge</a></li></ul></li></ul></li><li><a href="#进度期限秒数" class="table-of-contents__link toc-highlight">进度期限秒数</a></li><li><a href="#最短就绪时间" class="table-of-contents__link toc-highlight">最短就绪时间</a></li><li><a href="#修订历史限制" class="table-of-contents__link toc-highlight">修订历史限制</a></li><li><a href="#paused暂停的" class="table-of-contents__link toc-highlight">paused（暂停的）</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">笔记</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 泡泡吐肥皂o</div></div></div></footer></div>
</body>
</html>