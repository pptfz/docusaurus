<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-linux/linux服务/VPN/CentOS7一键安装OpenVPN" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">CentOS7一键安装OpenVPN | 我的站点</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://pptfz.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://pptfz.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://pptfz.github.io/docs/linux/linux服务/VPN/CentOS7一键安装OpenVPN"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="CentOS7一键安装OpenVPN | 我的站点"><meta data-rh="true" name="description" content="[toc]"><meta data-rh="true" property="og:description" content="[toc]"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pptfz.github.io/docs/linux/linux服务/VPN/CentOS7一键安装OpenVPN"><link data-rh="true" rel="alternate" href="https://pptfz.github.io/docs/linux/linux服务/VPN/CentOS7一键安装OpenVPN" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://pptfz.github.io/docs/linux/linux服务/VPN/CentOS7一键安装OpenVPN" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://SICNXLSDBZ-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="我的站点" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.061a1b25.css">
<script src="/assets/js/runtime~main.11d7a557.js" defer="defer"></script>
<script src="/assets/js/main.21de94ca.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="announcementBar_mb4j" style="background-color:pink;color:@091E42" role="banner"><div class="content_knG7 announcementBarContent_xLdY">一名运维，两台电脑，三餐不定，只为设备工作四平八稳，拼得五脏俱损，六神无主，仍然七点起床，八点出发，晚上九点不返，十分辛苦！<br> 十年运维，九转功成，八面张罗，忙得七窍流血，换得六神不宁，五体欠安，仍然四处奔波，三更不眠，只为两个铜板，一生拼搏！</div></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">我的站点</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">笔记</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">😂 😂  😂</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/github/github下载加速">github</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/go/go功能脚本/k8s/获取k8s集群资源配置">go</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/idea/vscode/vscode好用的插件">idea</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/linux/big-data/Ambari/CentOS7中用Ambari快速搭建大数据平台">linux</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/big-data/Ambari/CentOS7中用Ambari快速搭建大数据平台">big-data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/git/CentOS7编译安装git">git</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/kvm/安装/kvm安装">kvm</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/linux其他/CentOS7安装字体">linux其他</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/linux内核/Linux升级内核">linux内核</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/linux命令/Linux权限总结">linux命令</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/linux实用开源小工具/bat">linux实用开源小工具</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/linux/linux服务/VPN/CentOS7一键安装OpenVPN">linux服务</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/linux/linux服务/VPN/CentOS7一键安装OpenVPN">VPN</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/linux/linux服务/VPN/CentOS7一键安装OpenVPN">CentOS7一键安装OpenVPN</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux/linux服务/VPN/CentOS7手动安装OpenVPN">CentOS7手动安装OpenVPN</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux/linux服务/VPN/openvpn对接ldap">openvpn对接ldap</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/linux服务/elk/elasticsearch/elasticsearch安装">elk</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/linux服务/ldap/CentOS7搭建OpenLDAP服务端">ldap</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/linux服务/nfs/centos7搭建NFS">nfs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/linux服务/nginx/nginx安装">nginx</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/linux服务/php/安装/php编译报错">php</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/linux服务/ssh/ssh config">ssh</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/linux服务/supervisor/supervisor安装">supervisor</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/linux服务/tomcat/centos7二进制安装tomcat8">tomcat</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/linux服务/同步服务/centos7.7搭建lsyncd">同步服务</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/linux服务/邮件服务/linux使用命令发送邮件">邮件服务</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/linux系统/deepin/deepin15.11使用记录">linux系统</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/monitor/grafana/安装/grafana安装">monitor</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/openstack/mitaka/centos7.8搭建openstack Mitaka 版">openstack</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/shell/expect自动化交互式程序">shell</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/包管理工具/gvm/gvm安装">包管理工具</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/性能测试/文件删除效率测试/测试Linux下删除大量文件的效率">性能测试</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/日志/Linux 日志切割神器 Logrotate 原理和配置详解">日志</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/生产环境开源项目/bi工具/superset/superset安装">生产环境开源项目</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/生产问题总结/ssh/记录一次诡异的ssh连接问题">生产问题总结</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/linux/科学上网">科学上网</a><button aria-label="展开侧边栏分类 &#x27;科学上网&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/网络协议/http/HTTP 协议">网络协议</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/自动化运维平台/ansible/ansible playbook">自动化运维平台</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux/阿里云开发者社区优秀文章/shell脚本/shell脚本速查手册">阿里云开发者社区优秀文章</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/mac专区/brew安装">mac专区</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/python/python-other/nginx+django+uwsgi部署项目">python</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/web/css/css基础知识">web</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/云原生/k8s/helm/helm3安装">云原生</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/其他/wps/wps冻结窗口">其他</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/博客工具/Docusaurus/Docusaurus 安装">博客工具</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/操作小技巧/linux/linux一些骚操作">操作小技巧</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/数据库/mongodb/centos7安装mongodb">数据库</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/翻车问题合集/翻车问题-ssh密钥问题">翻车问题合集</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">linux</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">linux服务</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">VPN</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">CentOS7一键安装OpenVPN</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><p>[toc]</p>
<h1>CentOS7一键安装OpenVPN</h1>
<p><a href="https://github.com/Nyr/openvpn-install" target="_blank" rel="noopener noreferrer">openvpn github地址</a></p>
<p><a href="https://openvpn.net/" target="_blank" rel="noopener noreferrer">openvpn官网</a></p>
<p><strong>需求及使用场景</strong></p>
<blockquote>
<p>公司的一些资源不想对外开放访问，例如gitlab、jenkins等等，现在想要的效果是部分资源只允许公司公网IP以及特定IP访问，这个时候就需要用到VPN了，但是公司<strong>花钱买VPN是不可能的</strong>，那么就需要一款免费好用的VPN，OpenVPN免费开源又好用，配置完OpenVPN后再加上云主机的安全组就完美解决问题了。</p>
</blockquote>
<p><strong>说明</strong></p>
<table><thead><tr><th>系统</th><th>openvpn版本</th><th>内网IP</th><th>openvpn分配客户端网段</th></tr></thead><tbody><tr><td>CentOS7.9</td><td>2.4.11</td><td>10.206.0.9</td><td>10.8.0.0</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1安装openvpn">1.安装OpenVPN<a href="#1安装openvpn" class="hash-link" aria-label="1.安装OpenVPN的直接链接" title="1.安装OpenVPN的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-克隆项目">1.1 克隆项目<a href="#11-克隆项目" class="hash-link" aria-label="1.1 克隆项目的直接链接" title="1.1 克隆项目的直接链接">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/Nyr/openvpn-install.git</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-执行安装脚本">1.2 执行安装脚本<a href="#12-执行安装脚本" class="hash-link" aria-label="1.2 执行安装脚本的直接链接" title="1.2 执行安装脚本的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd openvpn-install &amp;&amp; sh openvpn-install.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>安装完成后再次执行脚本会提示如下</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">OpenVPN is already installed.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Select an option:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   # 添加新的客户端</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   1) Add a new client</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   # 移除已存在的客户端</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   2) Revoke an existing client</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   # 移除OpenVPN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   3) Remove OpenVPN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   # 退出</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   4) Exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Option: </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="第一步输入本机私网ip地址">第一步、输入本机私网IP地址<a href="#第一步输入本机私网ip地址" class="hash-link" aria-label="第一步、输入本机私网IP地址的直接链接" title="第一步、输入本机私网IP地址的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Welcome to this OpenVPN road warrior installer!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Which IPv4 address should be used?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     1) 10.9.95.147</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     2) 172.17.0.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     3) 172.20.0.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IPv4 address [1]: 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="第二步输入本机公网ip">第二步、输入本机公网IP<a href="#第二步输入本机公网ip" class="hash-link" aria-label="第二步、输入本机公网IP的直接链接" title="第二步、输入本机公网IP的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">This server is behind NAT. What is the public IPv4 address or hostname?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Public IPv4 address / hostname [8.8.8.8]: 8.8.8.8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="第三步选择openvpn协议推荐使用udp">第三步、选择OpenVPN协议，推荐使用UDP<a href="#第三步选择openvpn协议推荐使用udp" class="hash-link" aria-label="第三步、选择OpenVPN协议，推荐使用UDP的直接链接" title="第三步、选择OpenVPN协议，推荐使用UDP的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Which protocol should OpenVPN use?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   1) UDP (recommended)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   2) TCP</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Protocol [1]: 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="第四步输入openvpn监听的端口">第四步、输入OpenVPN监听的端口<a href="#第四步输入openvpn监听的端口" class="hash-link" aria-label="第四步、输入OpenVPN监听的端口的直接链接" title="第四步、输入OpenVPN监听的端口的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">What port should OpenVPN listen to?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Port [1194]:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="第五步为客户端选择一个dns服务器">第五步、为客户端选择一个DNS服务器<a href="#第五步为客户端选择一个dns服务器" class="hash-link" aria-label="第五步、为客户端选择一个DNS服务器的直接链接" title="第五步、为客户端选择一个DNS服务器的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Select a DNS server for the clients:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   1) Current system resolvers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   2) Google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   3) 1.1.1.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   4) OpenDNS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   5) Quad9</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   6) AdGuard</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DNS server [1]: 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="第六步为第一个客户端输入一个名称">第六步、为第一个客户端输入一个名称<a href="#第六步为第一个客户端输入一个名称" class="hash-link" aria-label="第六步、为第一个客户端输入一个 名称的直接链接" title="第六步、为第一个客户端输入一个名称的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Enter a name for the first client:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Name [client]:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="第七步按任意键开始安装">第七步、按任意键开始安装<a href="#第七步按任意键开始安装" class="hash-link" aria-label="第七步、按任意键开始安装的直接链接" title="第七步、按任意键开始安装的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">OpenVPN installation is ready to begin.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Press any key to continue...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>完整输出</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">OpenVPN installation is ready to begin.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Press any key to continue...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Loaded plugins: fastestmirror</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Determining fastest mirrors</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">10gen                                                                                                                            | 1.2 kB  00:00:00     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">base                                                                                                                             | 3.6 kB  00:00:00     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">centosplus                                                                                                                       | 2.9 kB  00:00:00     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker-ce-stable                                                                                                                 | 3.5 kB  00:00:00     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">epel                                                                                                                             | 4.7 kB  00:00:00     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">extras                                                                                                                           | 2.9 kB  00:00:00     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nginx-stable                                                                                                                     | 2.9 kB  00:00:00     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">updates                                                                                                                          | 2.9 kB  00:00:00     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">zabbix                                                                                                                           | 2.9 kB  00:00:00     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">zabbix-non-supported                                                                                                             |  951 B  00:00:00     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(1/7): 10gen/primary                                                                                                             |  32 kB  00:00:00     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(2/7): extras/7/x86_64/primary_db                                                                                                | 222 kB  00:00:00     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(3/7): epel/x86_64/updateinfo                                                                                                    | 1.0 MB  00:00:00     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(4/7): centosplus/7/x86_64/primary_db                                                                                            | 1.6 MB  00:00:01     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(5/7): base/7/x86_64/primary_db                                                                                                  | 6.1 MB  00:00:01     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(6/7): updates/7/x86_64/primary_db                                                                                               | 3.7 MB  00:00:01     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(7/7): epel/x86_64/primary_db                                                                                                    | 6.9 MB  00:00:01     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">10gen                                                                                                                                           279/279</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Resolving Dependencies</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--&gt; Running transaction check</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---&gt; Package epel-release.noarch 0:7-13 will be installed</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--&gt; Finished Dependency Resolution</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Dependencies Resolved</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">========================================================================================================================================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Package                                  Arch                               Version                             Repository                        Size</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">========================================================================================================================================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Installing:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> epel-release                             noarch                             7-13                                epel                              15 k</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Transaction Summary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">========================================================================================================================================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Install  1 Package</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Total download size: 15 k</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Installed size: 25 k</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Downloading packages:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">epel-release-7-13.noarch.rpm                                                                                                     |  15 kB  00:00:00     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Running transaction check</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Running transaction test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Transaction test succeeded</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Running transaction</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Installing : epel-release-7-13.noarch                                                                                                             1/1 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">warning: /etc/yum.repos.d/epel.repo created as /etc/yum.repos.d/epel.repo.rpmnew</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Verifying  : epel-release-7-13.noarch                                                                                                             1/1 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Installed:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  epel-release.noarch 0:7-13                                                                                                                            </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Complete!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Loaded plugins: fastestmirror</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Loading mirror speeds from cached hostfile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Package 1:openssl-1.0.2k-19.el7.x86_64 already installed and latest version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Package 2:tar-1.26-35.el7.x86_64 already installed and latest version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Resolving Dependencies</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--&gt; Running transaction check</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---&gt; Package ca-certificates.noarch 0:2019.2.32-76.el7_7 will be updated</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---&gt; Package ca-certificates.noarch 0:2020.2.41-70.0.el7_8 will be an update</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---&gt; Package openvpn.x86_64 0:2.4.9-1.el7 will be installed</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--&gt; Processing Dependency: libpkcs11-helper.so.1()(64bit) for package: openvpn-2.4.9-1.el7.x86_64</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--&gt; Running transaction check</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---&gt; Package pkcs11-helper.x86_64 0:1.11-3.el7 will be installed</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--&gt; Finished Dependency Resolution</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Dependencies Resolved</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">========================================================================================================================================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Package                                 Arch                           Version                                      Repository                    Size</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">========================================================================================================================================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Installing:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> openvpn                                 x86_64                         2.4.9-1.el7                                  epel                         524 k</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Updating:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> ca-certificates                         noarch                         2020.2.41-70.0.el7_8                         base                         382 k</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Installing for dependencies:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> pkcs11-helper                           x86_64                         1.11-3.el7                                   epel                          56 k</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Transaction Summary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">========================================================================================================================================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Install  1 Package (+1 Dependent package)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Upgrade  1 Package</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Total download size: 962 k</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Downloading packages:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Delta RPMs disabled because /usr/bin/applydeltarpm not installed.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(1/3): ca-certificates-2020.2.41-70.0.el7_8.noarch.rpm                                                                           | 382 kB  00:00:00     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(2/3): pkcs11-helper-1.11-3.el7.x86_64.rpm                                                                                       |  56 kB  00:00:00     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(3/3): openvpn-2.4.9-1.el7.x86_64.rpm                                                                                            | 524 kB  00:00:00     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--------------------------------------------------------------------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Total                                                                                                                   3.4 MB/s | 962 kB  00:00:00     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Running transaction check</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Running transaction test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Transaction test succeeded</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Running transaction</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Installing : pkcs11-helper-1.11-3.el7.x86_64                                                                                                      1/4 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Installing : openvpn-2.4.9-1.el7.x86_64                                                                                                           2/4 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Updating   : ca-certificates-2020.2.41-70.0.el7_8.noarch                                                                                          3/4 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Cleanup    : ca-certificates-2019.2.32-76.el7_7.noarch                                                                                            4/4 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Verifying  : ca-certificates-2020.2.41-70.0.el7_8.noarch                                                                                          1/4 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Verifying  : openvpn-2.4.9-1.el7.x86_64                                                                                                           2/4 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Verifying  : pkcs11-helper-1.11-3.el7.x86_64                                                                                                      3/4 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Verifying  : ca-certificates-2019.2.32-76.el7_7.noarch                                                                                            4/4 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Installed:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  openvpn.x86_64 0:2.4.9-1.el7                                                                                                                          </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Dependency Installed:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pkcs11-helper.x86_64 0:1.11-3.el7                                                                                                                     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Updated:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ca-certificates.noarch 0:2020.2.41-70.0.el7_8                                                                                                         </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Complete!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">init-pki complete; you may now create a CA or requests.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Your newly created PKI dir is: /etc/openvpn/server/easy-rsa/pki</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Using SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Generating RSA private key, 2048 bit long modulus</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">....+++</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...................................+++</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">e is 65537 (0x10001)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Using SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Generating a 2048 bit RSA private key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">.................................................................+++</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">....+++</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">writing new private key to &#x27;/etc/openvpn/server/easy-rsa/pki/easy-rsa-2726385.U7ScUb/tmp.FTK8rI&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-----</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Using configuration from /etc/openvpn/server/easy-rsa/pki/easy-rsa-2726385.U7ScUb/tmp.9FN60w</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Check that the request matches the signature</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature ok</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">The Subject&#x27;s Distinguished Name is as follows</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">commonName            :ASN.1 12:&#x27;server&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Certificate is to be certified until Nov 28 02:24:33 2030 GMT (3650 days)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Write out database with 1 new entries</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Data Base Updated</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Using SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Generating a 2048 bit RSA private key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">.....+++</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">........................................................................................+++</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">writing new private key to &#x27;/etc/openvpn/server/easy-rsa/pki/easy-rsa-2726473.aJtBJi/tmp.bmyQVL&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-----</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Using configuration from /etc/openvpn/server/easy-rsa/pki/easy-rsa-2726473.aJtBJi/tmp.zwz1tQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Check that the request matches the signature</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature ok</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">The Subject&#x27;s Distinguished Name is as follows</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">commonName            :ASN.1 12:&#x27;pptfz&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Certificate is to be certified until Nov 28 02:24:34 2030 GMT (3650 days)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Write out database with 1 new entries</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Data Base Updated</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Using SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Using configuration from /etc/openvpn/server/easy-rsa/pki/easy-rsa-2726540.Fvyapy/tmp.eJmfVQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">An updated CRL has been created.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CRL file: /etc/openvpn/server/easy-rsa/pki/crl.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Created symlink from /etc/systemd/system/multi-user.target.wants/openvpn-iptables.service to /etc/systemd/system/openvpn-iptables.service.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Created symlink from /etc/systemd/system/multi-user.target.wants/openvpn-server@server.service to /usr/lib/systemd/system/openvpn-server@.service.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Finished!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">The client configuration is available in: /root/pptfz.ovpn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">New clients can be added by running this script again.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>:::tip说明</p>
<p><strong>客户端文件是 <code>/root/pptfz.ovpn</code> ，在最后的输出中有提示，这里的客户端文件名称是自定义的，然后把这个文件下载到本地，后续配置VPN认证的时候需要用到这个客户端文件</strong></p>
<p>:::</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-查看openvpn相关信息">1.3 查看OpenVPN相关信息<a href="#13-查看openvpn相关信息" class="hash-link" aria-label="1.3 查看OpenVPN相关信息的直接链接" title="1.3 查看OpenVPN相关信息的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="131-查看openvpn进程">1.3.1 查看OpenVPN进程<a href="#131-查看openvpn进程" class="hash-link" aria-label="1.3.1 查看OpenVPN进程的直接链接" title="1.3.1 查看OpenVPN进程的直接链接">​</a></h4>
<p><strong>默认是以 <code>nobody</code> 用户运行，在 <code>/etc/openvpn/server/server.conf </code> 中可以自定义</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ ps aux|grep [o]penvpn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nobody   2726623  0.0  0.2  77168  4040 ?        Ss   10:24   0:00 /usr/sbin/openvpn --status /run/openvpn-server/status-server.log --status-version 2 --suppress-timestamps --config server.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="132-openvpn默认监听-udp-1194-端口">1.3.2 OpenVPN默认监听 <code>udp 1194</code> 端口<a href="#132-openvpn默认监听-udp-1194-端口" class="hash-link" aria-label="132-openvpn默认监听-udp-1194-端口的直接链接" title="132-openvpn默认监听-udp-1194-端口的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ netstat -nupl|grep 1194</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">udp        0      0 10.9.95.147:1194        0.0.0.0:*                           2726623/openvpn     </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="133-查看版本">1.3.3 查看版本<a href="#133-查看版本" class="hash-link" aria-label="1.3.3 查看版本的直接链接" title="1.3.3 查看版本的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ openvpn --version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">OpenVPN 2.4.11 x86_64-redhat-linux-gnu [Fedora EPEL patched] [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [PKCS11] [MH/PKTINFO] [AEAD] built on Apr 21 2021</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">library versions: OpenSSL 1.0.2k-fips  26 Jan 2017, LZO 2.06</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Originally developed by James Yonan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Copyright (C) 2002-2018 OpenVPN Inc &lt;sales@openvpn.net&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Compile time defines: enable_async_push=no enable_comp_stub=no enable_crypto=yes enable_crypto_ofb_cfb=yes enable_debug=yes enable_def_auth=yes enable_dependency_tracking=no enable_dlopen=unknown enable_dlopen_self=unknown enable_dlopen_self_static=unknown enable_fast_install=yes enable_fragment=yes enable_iproute2=yes enable_libtool_lock=yes enable_lz4=yes enable_lzo=yes enable_management=yes enable_multihome=yes enable_pam_dlopen=no enable_pedantic=no enable_pf=yes enable_pkcs11=yes enable_plugin_auth_pam=yes enable_plugin_down_root=yes enable_plugins=yes enable_port_share=yes enable_selinux=yes enable_server=yes enable_shared=yes enable_shared_with_static_runtimes=no enable_small=no enable_static=yes enable_strict=no enable_strict_options=no enable_systemd=yes enable_werror=no enable_win32_dll=yes enable_x509_alt_username=yes with_aix_soname=aix with_crypto_library=openssl with_gnu_ld=yes with_mem_check=no with_sysroot=no</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2配置onenvpn使用账号密码认证">2.配置OnenVPN使用账号密码认证<a href="#2配置onenvpn使用账号密码认证" class="hash-link" aria-label="2.配置OnenVPN使用账号密码认证的直接链接" title="2.配置OnenVPN使用账号密码认证的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-编辑脚本">2.1 编辑脚本<a href="#21-编辑脚本" class="hash-link" aria-label="2.1 编辑脚本的直接链接" title="2.1 编辑脚本的直接链接">​</a></h3>
<p>:::tip说明</p>
<p><strong>这个是现在公司线上用到的文件，目前没有找到出处，不知道为什么，总之就是利用一个存放用户名密码的自定义文件 <code>/etc/openvpn/psw-file</code> 来作为认证文件</strong></p>
<p><strong>编辑如下脚本，后续openvpn的配置文件 <code>/etc/openvpn/server/server.conf</code> 中会引用这个脚本</strong></p>
<p><strong>openvpn运行用户对于这个脚本至少有rx权限，否则认证会失败</strong></p>
<p>:::</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cat &gt;&gt; /etc/openvpn/checkpsw.sh &lt;&lt;&#x27;EOF&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#!/bin/sh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">###########################################################</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># checkpsw.sh (C) 2004 Mathias Sundman &lt;mathias@openvpn.se&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># This script will authenticate OpenVPN users against</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># a plain text file. The passfile should simply contain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># one row per user with the username first followed by</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># one or more space(s) or tab(s) and then the password.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PASSFILE=&quot;/etc/openvpn/psw-file&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LOG_FILE=&quot;/etc/openvpn/openvpn-password.log&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">TIME_STAMP=`date &quot;+%Y-%m-%d %T&quot;`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">###########################################################</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if [ ! -r &quot;${PASSFILE}&quot; ]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  echo &quot;${TIME_STAMP}: Could not open password file \&quot;${PASSFILE}\&quot; for reading.&quot; &gt;&gt; ${LOG_FILE}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  exit 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CORRECT_PASSWORD=`awk &#x27;!/^;/&amp;&amp;!/^#/&amp;&amp;$1==&quot;&#x27;${username}&#x27;&quot;{print $2;exit}&#x27; ${PASSFILE}`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if [ &quot;${CORRECT_PASSWORD}&quot; = &quot;&quot; ]; then </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  echo &quot;${TIME_STAMP}: User does not exist: username=\&quot;${username}\&quot;, password=\&quot;${password}\&quot;.&quot; &gt;&gt; ${LOG_FILE}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  exit 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if [ &quot;${password}&quot; = &quot;${CORRECT_PASSWORD}&quot; ]; then </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  echo &quot;${TIME_STAMP}: Successful authentication: username=\&quot;${username}\&quot;.&quot; &gt;&gt; ${LOG_FILE}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  exit 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;${TIME_STAMP}: Incorrect password: username=\&quot;${username}\&quot;, password=\&quot;${password}\&quot;.&quot; &gt;&gt; ${LOG_FILE}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>赋予脚本执行权限</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">chmod +x /etc/openvpn/checkpsw.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-修改openvpn配置文件-etcopenvpnserverserverconf">2.2 修改openvpn配置文件 <code>/etc/openvpn/server/server.conf</code><a href="#22-修改openvpn配置文件-etcopenvpnserverserverconf" class="hash-link" aria-label="22-修改openvpn配置文件-etcopenvpnserverserverconf的直接链接" title="22-修改openvpn配置文件-etcopenvpnserverserverconf的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="221-追加以下内容">2.2.1 追加以下内容<a href="#221-追加以下内容" class="hash-link" aria-label="2.2.1 追加以下内容的直接链接" title="2.2.1 追加以下内容的直接链接">​</a></h4>
<p><strong>其中 <code>auth-user-pass-verify</code> 对应的文件一定要与上一步创建的脚本名相同</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cat &gt;&gt; /etc/openvpn/server/server.conf &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">auth-user-pass-verify /etc/openvpn/checkpsw.sh via-env</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">verify-client-cert</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">username-as-common-name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">script-security 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>/etc/openvpn/server/server.conf </code> 文件默认内容</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">local 10.206.0.9</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">port 1194</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">proto udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dev tun</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ca ca.crt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cert server.crt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">key server.key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dh dh.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">auth SHA512</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tls-crypt tc.key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">topology subnet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">server 10.8.0.0 255.255.255.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">push &quot;redirect-gateway def1 bypass-dhcp&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ifconfig-pool-persist ipp.txt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">push &quot;dhcp-option DNS 183.60.83.19&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">push &quot;dhcp-option DNS 183.60.82.98&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">keepalive 10 120</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cipher AES-256-CBC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">user nobody</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">group nobody</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">persist-key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">persist-tun</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">verb 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">crl-verify crl.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">explicit-exit-notify</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="222-修改-serverconf">2.2.2 修改 server.conf<a href="#222-修改-serverconf" class="hash-link" aria-label="2.2.2 修改 server.conf的直接链接" title="2.2.2 修改 server.conf的直接链接">​</a></h4>
<p><strong>删除开头的 local 一行</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sed -i.bak &#x27;1d&#x27; /etc/openvpn/server/server.conf </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-重启服务">2.3 重启服务<a href="#23-重启服务" class="hash-link" aria-label="2.3 重启服务的直接链接" title="2.3 重启服务的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl enable openvpn@server.service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl restart openvpn-server@server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="24-添加账号">2.4 添加账号<a href="#24-添加账号" class="hash-link" aria-label="2.4 添加账号的直接链接" title="2.4 添加账号的直接链接">​</a></h3>
<p><strong>后续的账号都在这个文件 <code>/etc/openvpn/psw-file</code> 中添加，用户名和密码以空格隔开，每行一个</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 用户名密码文件</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cat &gt; /etc/openvpn/psw-file &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">test test123</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 文件所有者一定要是openvpn运行的用户，这里openvpn默认运行用户为nobody</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chown nobody.nobody /etc/openvpn/psw-file &amp;&amp; chmod 600 /etc/openvpn/psw-file</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="25-修改客户端文件">2.5 修改客户端文件<a href="#25-修改客户端文件" class="hash-link" aria-label="2.5 修改客户端文件的直接链接" title="2.5 修改客户端文件的直接链接">​</a></h3>
<p><strong>执行完一键安装脚本后会提示客户端文件位置</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">The client configuration is available in: /root/pptfz.ovpn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">New clients can be added by running this script again.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>客户端文件需要追加一行 <code>auth-user-pass</code> 内容，开启用户名密码认证，然后下载到本地</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sed -i &#x27;14aauth-user-pass&#x27; /root/pptfz.ovpn </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3客户端安装配置">3.客户端安装配置<a href="#3客户端安装配置" class="hash-link" aria-label="3.客户端安装配置的直接链接" title="3.客户端安装配置的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-mac连接示例">3.1 mac连接示例<a href="#31-mac连接示例" class="hash-link" aria-label="3.1 mac连接示例的直接链接" title="3.1 mac连接示例的直接链接">​</a></h3>
<p>这里以mac为例，我下载的是 <code>Tunnelblick</code> <a href="https://github.com/Tunnelblick/Tunnelblick" target="_blank" rel="noopener noreferrer">Tunnelblick github地址</a></p>
<p>安装完成后把客户端文件 <code>pptfz.ovpn(文件名是自定义的)</code> 拖入到 <code>Tunnelblick</code></p>
<p>选择安装的用户</p>
<p><img decoding="async" loading="lazy" src="https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-11-30%2020.20.36.png" alt="iShot2020-11-30 20.20.36" class="img_ev3q"></p>
<p>输入本机密码</p>
<p><img decoding="async" loading="lazy" src="https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-11-30%2020.21.56.png" alt="iShot2020-11-30 20.21.56" class="img_ev3q"></p>
<p>输入完成后会提示如下</p>
<p><img decoding="async" loading="lazy" src="https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-11-30%2020.22.21.png" alt="iShot2020-11-30 20.22.21" class="img_ev3q"></p>
<p>找到相应图标，点击要连接的VPN</p>
<p><img decoding="async" loading="lazy" src="https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-12-01%2011.43.18.png" alt="iShot2020-12-01 11.43.18" class="img_ev3q"></p>
<p>输入用户名和密码</p>
<p><img decoding="async" loading="lazy" src="https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-12-01%2011.44.37.png" alt="iShot2020-12-01 11.44.37" class="img_ev3q"></p>
<p>连接成功</p>
<p><img decoding="async" loading="lazy" src="https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-12-01%2014.16.11.png" alt="iShot2020-12-01 14.16.11" class="img_ev3q"></p>
<p>连接成功后，就会在本机生成一个 <code>utun1</code> 的虚拟网卡，并获取openvpn <code>server.conf</code> 中设置的  <code>server 10.8.0.0 255.255.255.0</code> 给客户端分配的网段，IP地址从 10.8.0.2 开始分配</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">utun1: flags=8051&lt;UP,POINTOPOINT,RUNNING,MULTICAST&gt; mtu 1500</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	inet 10.8.0.2 --&gt; 10.8.0.2 netmask 0xffffff00 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>此时mac本机是能与服务器内网相互ping通的</p>
<blockquote>
<p>mac本机ping服 务器内网</p>
</blockquote>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ ping -c2 10.206.0.9</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PING 10.206.0.9 (10.206.0.9): 56 data bytes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">64 bytes from 10.206.0.9: icmp_seq=0 ttl=64 time=90.547 ms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">64 bytes from 10.206.0.9: icmp_seq=1 ttl=64 time=63.691 ms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--- 10.206.0.9 ping statistics ---</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2 packets transmitted, 2 packets received, 0.0% packet loss</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">round-trip min/avg/max/stddev = 63.691/77.119/90.547/13.428 ms</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>服务器ping mac本机</p>
</blockquote>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ ping -c2 10.8.0.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PING 10.8.0.2 (10.8.0.2) 56(84) bytes of data.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">64 bytes from 10.8.0.2: icmp_seq=1 ttl=64 time=85.3 ms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">64 bytes from 10.8.0.2: icmp_seq=2 ttl=64 time=90.3 ms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--- 10.8.0.2 ping statistics ---</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2 packets transmitted, 2 received, 0% packet loss, time 1000ms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rtt min/avg/max/mdev = 85.362/87.876/90.390/2.514 ms</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-windows连接示例">3.2 windows连接示例<a href="#32-windows连接示例" class="hash-link" aria-label="3.2 windows连接示例的直接链接" title="3.2 windows连接示例的直接链接">​</a></h3>
<p><a href="https://openvpn.net/downloads/openvpn-connect-v3-windows.msi" target="_blank" rel="noopener noreferrer">下载windows版安装包</a></p>
<p>windows安装就是一路下一步</p>
<p>导入客户端文件</p>
<p><img decoding="async" loading="lazy" src="https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-12-01%2015.00.29.png" alt="iShot2020-12-01 15.00.29" class="img_ev3q"></p>
<p>输入用户名和密码</p>
<p><img decoding="async" loading="lazy" src="https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-12-01%2015.11.36.png" alt="iShot2020-12-01 15.11.36" class="img_ev3q"></p>
<p>连接成功</p>
<p><img decoding="async" loading="lazy" src="https://gitea.pptfz.cn/pptfz/picgo-images/raw/branch/master/img/iShot2020-12-01%2015.12.14.png" alt="iShot2020-12-01 15.12.14" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4云主机安全组配置说明">4.云主机安全组配置说明<a href="#4云主机安全组配置说明" class="hash-link" aria-label="4.云主机安全组配置说明的直接链接" title="4.云主机安全组配置说明的直接链接">​</a></h2>
<p><strong>使用示例</strong></p>
<p><strong>假设公司代码库gitlab、上线工具jenkins等等部署在云主机中，现在只允许公司IP和openvpn IP访问</strong></p>
<p><strong>则只需要在安全组中加入以下两条规则即可</strong></p>
<blockquote>
<p><strong>1.允许公司IP访问</strong></p>
<p><strong>2.允许OpenVPN所在机器公网IP访问</strong></p>
</blockquote>
<p><strong>在云主机中还可以根据具体情况设置相关安全策略，包括网络ACL访问控制，安全组等等</strong></p>
<p><strong>openvpn+云主机安全组的应用场景</strong></p>
<blockquote>
<p>如果服务所在机器是经典网络(有公网IP)，则内网和公网都可以访问</p>
<p>如果服务所在机器是VPC网络(无公网IP)，则只允许内网访问</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5脚本内容">5.脚本内容<a href="#5脚本内容" class="hash-link" aria-label="5.脚本内容的直接链接" title="5.脚本内容的直接链接">​</a></h2>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/Nyr/openvpn-install</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Copyright (c) 2013 Nyr. Released under the MIT License.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Detect Debian users running the script with &quot;sh&quot; instead of bash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if readlink /proc/$$/exe | grep -q &quot;dash&quot;; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &#x27;This installer needs to be run with &quot;bash&quot;, not &quot;sh&quot;.&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Discard stdin. Needed when running from an one-liner which includes a newline</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">read -N 999999 -t 0.001</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Detect OpenVZ 6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if [[ $(uname -r | cut -d &quot;.&quot; -f 1) -eq 2 ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;The system is running an old kernel, which is incompatible with this installer.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Detect OS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># $os_version variables aren&#x27;t always in use, but are kept here for convenience</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if grep -qs &quot;ubuntu&quot; /etc/os-release; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	os=&quot;ubuntu&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	os_version=$(grep &#x27;VERSION_ID&#x27; /etc/os-release | cut -d &#x27;&quot;&#x27; -f 2 | tr -d &#x27;.&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	group_name=&quot;nogroup&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">elif [[ -e /etc/debian_version ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	os=&quot;debian&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	os_version=$(grep -oE &#x27;[0-9]+&#x27; /etc/debian_version | head -1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	group_name=&quot;nogroup&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">elif [[ -e /etc/almalinux-release || -e /etc/rocky-release || -e /etc/centos-release ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	os=&quot;centos&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	os_version=$(grep -shoE &#x27;[0-9]+&#x27; /etc/almalinux-release /etc/rocky-release /etc/centos-release | head -1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	group_name=&quot;nobody&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">elif [[ -e /etc/fedora-release ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	os=&quot;fedora&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	os_version=$(grep -oE &#x27;[0-9]+&#x27; /etc/fedora-release | head -1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	group_name=&quot;nobody&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;This installer seems to be running on an unsupported distribution.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Supported distros are Ubuntu, Debian, AlmaLinux, Rocky Linux, CentOS and Fedora.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if [[ &quot;$os&quot; == &quot;ubuntu&quot; &amp;&amp; &quot;$os_version&quot; -lt 1804 ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;Ubuntu 18.04 or higher is required to use this installer.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">This version of Ubuntu is too old and unsupported.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if [[ &quot;$os&quot; == &quot;debian&quot; &amp;&amp; &quot;$os_version&quot; -lt 9 ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;Debian 9 or higher is required to use this installer.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">This version of Debian is too old and unsupported.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if [[ &quot;$os&quot; == &quot;centos&quot; &amp;&amp; &quot;$os_version&quot; -lt 7 ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;CentOS 7 or higher is required to use this installer.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">This version of CentOS is too old and unsupported.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Detect environments where $PATH does not include the sbin directories</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if ! grep -q sbin &lt;&lt;&lt; &quot;$PATH&quot;; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &#x27;$PATH does not include sbin. Try using &quot;su -&quot; instead of &quot;su&quot;.&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if [[ &quot;$EUID&quot; -ne 0 ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;This installer needs to be run with superuser privileges.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if [[ ! -e /dev/net/tun ]] || ! ( exec 7&lt;&gt;/dev/net/tun ) 2&gt;/dev/null; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;The system does not have the TUN device available.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">TUN needs to be enabled before running this installer.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">new_client () {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# Generates the custom client.ovpn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	cat /etc/openvpn/server/client-common.txt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;&lt;ca&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	cat /etc/openvpn/server/easy-rsa/pki/ca.crt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;&lt;/ca&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;&lt;cert&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	sed -ne &#x27;/BEGIN CERTIFICATE/,$ p&#x27; /etc/openvpn/server/easy-rsa/pki/issued/&quot;$client&quot;.crt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;&lt;/cert&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;&lt;key&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	cat /etc/openvpn/server/easy-rsa/pki/private/&quot;$client&quot;.key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;&lt;/key&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;&lt;tls-crypt&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	sed -ne &#x27;/BEGIN OpenVPN Static key/,$ p&#x27; /etc/openvpn/server/tc.key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;&lt;/tls-crypt&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	} &gt; ~/&quot;$client&quot;.ovpn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if [[ ! -e /etc/openvpn/server/server.conf ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# Detect some Debian minimal setups where neither wget nor curl are installed</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	if ! hash wget 2&gt;/dev/null &amp;&amp; ! hash curl 2&gt;/dev/null; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo &quot;Wget is required to use this installer.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		read -n1 -r -p &quot;Press any key to install Wget and continue...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		apt-get update</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		apt-get install -y wget</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	clear</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &#x27;Welcome to this OpenVPN road warrior installer!&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# If system has a single IPv4, it is selected automatically. Else, ask the user</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	if [[ $(ip -4 addr | grep inet | grep -vEc &#x27;127(\.[0-9]{1,3}){3}&#x27;) -eq 1 ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		ip=$(ip -4 addr | grep inet | grep -vE &#x27;127(\.[0-9]{1,3}){3}&#x27; | cut -d &#x27;/&#x27; -f 1 | grep -oE &#x27;[0-9]{1,3}(\.[0-9]{1,3}){3}&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		number_of_ip=$(ip -4 addr | grep inet | grep -vEc &#x27;127(\.[0-9]{1,3}){3}&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo &quot;Which IPv4 address should be used?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		ip -4 addr | grep inet | grep -vE &#x27;127(\.[0-9]{1,3}){3}&#x27; | cut -d &#x27;/&#x27; -f 1 | grep -oE &#x27;[0-9]{1,3}(\.[0-9]{1,3}){3}&#x27; | nl -s &#x27;) &#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		read -p &quot;IPv4 address [1]: &quot; ip_number</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		until [[ -z &quot;$ip_number&quot; || &quot;$ip_number&quot; =~ ^[0-9]+$ &amp;&amp; &quot;$ip_number&quot; -le &quot;$number_of_ip&quot; ]]; do</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo &quot;$ip_number: invalid selection.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			read -p &quot;IPv4 address [1]: &quot; ip_number</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		done</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		[[ -z &quot;$ip_number&quot; ]] &amp;&amp; ip_number=&quot;1&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		ip=$(ip -4 addr | grep inet | grep -vE &#x27;127(\.[0-9]{1,3}){3}&#x27; | cut -d &#x27;/&#x27; -f 1 | grep -oE &#x27;[0-9]{1,3}(\.[0-9]{1,3}){3}&#x27; | sed -n &quot;$ip_number&quot;p)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# If $ip is a private IP address, the server must be behind NAT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	if echo &quot;$ip&quot; | grep -qE &#x27;^(10\.|172\.1[6789]\.|172\.2[0-9]\.|172\.3[01]\.|192\.168)&#x27;; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo &quot;This server is behind NAT. What is the public IPv4 address or hostname?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		# Get public IP and sanitize with grep</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		get_public_ip=$(grep -m 1 -oE &#x27;^[0-9]{1,3}(\.[0-9]{1,3}){3}$&#x27; &lt;&lt;&lt; &quot;$(wget -T 10 -t 1 -4qO- &quot;http://ip1.dynupdate.no-ip.com/&quot; || curl -m 10 -4Ls &quot;http://ip1.dynupdate.no-ip.com/&quot;)&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		read -p &quot;Public IPv4 address / hostname [$get_public_ip]: &quot; public_ip</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		# If the checkip service is unavailable and user didn&#x27;t provide input, ask again</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		until [[ -n &quot;$get_public_ip&quot; || -n &quot;$public_ip&quot; ]]; do</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo &quot;Invalid input.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			read -p &quot;Public IPv4 address / hostname: &quot; public_ip</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		done</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		[[ -z &quot;$public_ip&quot; ]] &amp;&amp; public_ip=&quot;$get_public_ip&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# If system has a single IPv6, it is selected automatically</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	if [[ $(ip -6 addr | grep -c &#x27;inet6 [23]&#x27;) -eq 1 ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		ip6=$(ip -6 addr | grep &#x27;inet6 [23]&#x27; | cut -d &#x27;/&#x27; -f 1 | grep -oE &#x27;([0-9a-fA-F]{0,4}:){1,7}[0-9a-fA-F]{0,4}&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# If system has multiple IPv6, ask the user to select one</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	if [[ $(ip -6 addr | grep -c &#x27;inet6 [23]&#x27;) -gt 1 ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		number_of_ip6=$(ip -6 addr | grep -c &#x27;inet6 [23]&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo &quot;Which IPv6 address should be used?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		ip -6 addr | grep &#x27;inet6 [23]&#x27; | cut -d &#x27;/&#x27; -f 1 | grep -oE &#x27;([0-9a-fA-F]{0,4}:){1,7}[0-9a-fA-F]{0,4}&#x27; | nl -s &#x27;) &#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		read -p &quot;IPv6 address [1]: &quot; ip6_number</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		until [[ -z &quot;$ip6_number&quot; || &quot;$ip6_number&quot; =~ ^[0-9]+$ &amp;&amp; &quot;$ip6_number&quot; -le &quot;$number_of_ip6&quot; ]]; do</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo &quot;$ip6_number: invalid selection.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			read -p &quot;IPv6 address [1]: &quot; ip6_number</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		done</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		[[ -z &quot;$ip6_number&quot; ]] &amp;&amp; ip6_number=&quot;1&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		ip6=$(ip -6 addr | grep &#x27;inet6 [23]&#x27; | cut -d &#x27;/&#x27; -f 1 | grep -oE &#x27;([0-9a-fA-F]{0,4}:){1,7}[0-9a-fA-F]{0,4}&#x27; | sed -n &quot;$ip6_number&quot;p)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;Which protocol should OpenVPN use?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;   1) UDP (recommended)&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;   2) TCP&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	read -p &quot;Protocol [1]: &quot; protocol</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	until [[ -z &quot;$protocol&quot; || &quot;$protocol&quot; =~ ^[12]$ ]]; do</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo &quot;$protocol: invalid selection.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		read -p &quot;Protocol [1]: &quot; protocol</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	done</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	case &quot;$protocol&quot; in</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		1|&quot;&quot;) </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		protocol=udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		2) </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		protocol=tcp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	esac</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;What port should OpenVPN listen to?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	read -p &quot;Port [1194]: &quot; port</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	until [[ -z &quot;$port&quot; || &quot;$port&quot; =~ ^[0-9]+$ &amp;&amp; &quot;$port&quot; -le 65535 ]]; do</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo &quot;$port: invalid port.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		read -p &quot;Port [1194]: &quot; port</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	done</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	[[ -z &quot;$port&quot; ]] &amp;&amp; port=&quot;1194&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;Select a DNS server for the clients:&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;   1) Current system resolvers&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;   2) Google&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;   3) 1.1.1.1&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;   4) OpenDNS&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;   5) Quad9&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;   6) AdGuard&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	read -p &quot;DNS server [1]: &quot; dns</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	until [[ -z &quot;$dns&quot; || &quot;$dns&quot; =~ ^[1-6]$ ]]; do</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo &quot;$dns: invalid selection.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		read -p &quot;DNS server [1]: &quot; dns</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	done</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;Enter a name for the first client:&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	read -p &quot;Name [client]: &quot; unsanitized_client</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# Allow a limited set of characters to avoid conflicts</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	client=$(sed &#x27;s/[^0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-]/_/g&#x27; &lt;&lt;&lt; &quot;$unsanitized_client&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	[[ -z &quot;$client&quot; ]] &amp;&amp; client=&quot;client&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;OpenVPN installation is ready to begin.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# Install a firewall if firewalld or iptables are not already available</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	if ! systemctl is-active --quiet firewalld.service &amp;&amp; ! hash iptables 2&gt;/dev/null; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		if [[ &quot;$os&quot; == &quot;centos&quot; || &quot;$os&quot; == &quot;fedora&quot; ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			firewall=&quot;firewalld&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			# We don&#x27;t want to silently enable firewalld, so we give a subtle warning</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			# If the user continues, firewalld will be installed and enabled during setup</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo &quot;firewalld, which is required to manage routing tables, will also be installed.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		elif [[ &quot;$os&quot; == &quot;debian&quot; || &quot;$os&quot; == &quot;ubuntu&quot; ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			# iptables is way less invasive than firewalld so no warning is given</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			firewall=&quot;iptables&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	read -n1 -r -p &quot;Press any key to continue...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# If running inside a container, disable LimitNPROC to prevent conflicts</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	if systemd-detect-virt -cq; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		mkdir /etc/systemd/system/openvpn-server@server.service.d/ 2&gt;/dev/null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo &quot;[Service]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LimitNPROC=infinity&quot; &gt; /etc/systemd/system/openvpn-server@server.service.d/disable-limitnproc.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	if [[ &quot;$os&quot; = &quot;debian&quot; || &quot;$os&quot; = &quot;ubuntu&quot; ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		apt-get update</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		apt-get install -y openvpn openssl ca-certificates $firewall</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	elif [[ &quot;$os&quot; = &quot;centos&quot; ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		yum install -y epel-release</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		yum install -y openvpn openssl ca-certificates tar $firewall</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		# Else, OS must be Fedora</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		dnf install -y openvpn openssl ca-certificates tar $firewall</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# If firewalld was just installed, enable it</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	if [[ &quot;$firewall&quot; == &quot;firewalld&quot; ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		systemctl enable --now firewalld.service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# Get easy-rsa</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	easy_rsa_url=&#x27;https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.8/EasyRSA-3.0.8.tgz&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	mkdir -p /etc/openvpn/server/easy-rsa/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	{ wget -qO- &quot;$easy_rsa_url&quot; 2&gt;/dev/null || curl -sL &quot;$easy_rsa_url&quot; ; } | tar xz -C /etc/openvpn/server/easy-rsa/ --strip-components 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	chown -R root:root /etc/openvpn/server/easy-rsa/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	cd /etc/openvpn/server/easy-rsa/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# Create the PKI, set up the CA and the server and client certificates</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	./easyrsa init-pki</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	./easyrsa --batch build-ca nopass</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	EASYRSA_CERT_EXPIRE=3650 ./easyrsa build-server-full server nopass</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	EASYRSA_CERT_EXPIRE=3650 ./easyrsa build-client-full &quot;$client&quot; nopass</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	EASYRSA_CRL_DAYS=3650 ./easyrsa gen-crl</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# Move the stuff we need</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	cp pki/ca.crt pki/private/ca.key pki/issued/server.crt pki/private/server.key pki/crl.pem /etc/openvpn/server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# CRL is read with each client connection, while OpenVPN is dropped to nobody</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	chown nobody:&quot;$group_name&quot; /etc/openvpn/server/crl.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# Without +x in the directory, OpenVPN can&#x27;t run a stat() on the CRL file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	chmod o+x /etc/openvpn/server/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# Generate key for tls-crypt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	openvpn --genkey --secret /etc/openvpn/server/tc.key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# Create the DH parameters file using the predefined ffdhe2048 group</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &#x27;-----BEGIN DH PARAMETERS-----</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">MIIBCAKCAQEA//////////+t+FRYortKmq/cViAnPTzx2LnFg84tNpWp4TZBFGQz</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+8yTnc4kmz75fS/jY2MMddj2gbICrsRhetPfHtXV/WVhJDP1H18GbtCFY2VVPe0a</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">87VXE15/V8k1mE8McODmi3fipona8+/och3xWKE2rec1MKzKT0g6eXq8CrGCsyT7</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">YdEIqUuyyOP7uWrat2DX9GgdT0Kj3jlN9K5W7edjcrsZCwenyO4KbXCeAvzhzffi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">7MA0BM0oNC9hkXL+nOmFg/+OTxIy7vKBg8P+OxtMb61zO7X8vC7CIAXFjvGDfRaD</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ssbzSibBsu/6iGtCOGEoXJf//////////wIBAg==</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-----END DH PARAMETERS-----&#x27; &gt; /etc/openvpn/server/dh.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# Generate server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;local $ip</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">port $port</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">proto $protocol</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dev tun</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ca ca.crt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cert server.crt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">key server.key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dh dh.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">auth SHA512</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tls-crypt tc.key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">topology subnet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">server 10.8.0.0 255.255.255.0&quot; &gt; /etc/openvpn/server/server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# IPv6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	if [[ -z &quot;$ip6&quot; ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo &#x27;push &quot;redirect-gateway def1 bypass-dhcp&quot;&#x27; &gt;&gt; /etc/openvpn/server/server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo &#x27;server-ipv6 fddd:1194:1194:1194::/64&#x27; &gt;&gt; /etc/openvpn/server/server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo &#x27;push &quot;redirect-gateway def1 ipv6 bypass-dhcp&quot;&#x27; &gt;&gt; /etc/openvpn/server/server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &#x27;ifconfig-pool-persist ipp.txt&#x27; &gt;&gt; /etc/openvpn/server/server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# DNS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	case &quot;$dns&quot; in</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		1|&quot;&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			# Locate the proper resolv.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			# Needed for systems running systemd-resolved</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			if grep -q &#x27;^nameserver 127.0.0.53&#x27; &quot;/etc/resolv.conf&quot;; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				resolv_conf=&quot;/run/systemd/resolve/resolv.conf&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				resolv_conf=&quot;/etc/resolv.conf&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			# Obtain the resolvers from resolv.conf and use them for OpenVPN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			grep -v &#x27;^#\|^;&#x27; &quot;$resolv_conf&quot; | grep &#x27;^nameserver&#x27; | grep -oE &#x27;[0-9]{1,3}(\.[0-9]{1,3}){3}&#x27; | while read line; do</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				echo &quot;push \&quot;dhcp-option DNS $line\&quot;&quot; &gt;&gt; /etc/openvpn/server/server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			done</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		2)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo &#x27;push &quot;dhcp-option DNS 8.8.8.8&quot;&#x27; &gt;&gt; /etc/openvpn/server/server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo &#x27;push &quot;dhcp-option DNS 8.8.4.4&quot;&#x27; &gt;&gt; /etc/openvpn/server/server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		3)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo &#x27;push &quot;dhcp-option DNS 1.1.1.1&quot;&#x27; &gt;&gt; /etc/openvpn/server/server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo &#x27;push &quot;dhcp-option DNS 1.0.0.1&quot;&#x27; &gt;&gt; /etc/openvpn/server/server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		4)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo &#x27;push &quot;dhcp-option DNS 208.67.222.222&quot;&#x27; &gt;&gt; /etc/openvpn/server/server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo &#x27;push &quot;dhcp-option DNS 208.67.220.220&quot;&#x27; &gt;&gt; /etc/openvpn/server/server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		5)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo &#x27;push &quot;dhcp-option DNS 9.9.9.9&quot;&#x27; &gt;&gt; /etc/openvpn/server/server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo &#x27;push &quot;dhcp-option DNS 149.112.112.112&quot;&#x27; &gt;&gt; /etc/openvpn/server/server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		6)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo &#x27;push &quot;dhcp-option DNS 94.140.14.14&quot;&#x27; &gt;&gt; /etc/openvpn/server/server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo &#x27;push &quot;dhcp-option DNS 94.140.15.15&quot;&#x27; &gt;&gt; /etc/openvpn/server/server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	esac</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;keepalive 10 120</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cipher AES-256-CBC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">user nobody</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">group $group_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">persist-key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">persist-tun</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">verb 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">crl-verify crl.pem&quot; &gt;&gt; /etc/openvpn/server/server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	if [[ &quot;$protocol&quot; = &quot;udp&quot; ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo &quot;explicit-exit-notify&quot; &gt;&gt; /etc/openvpn/server/server.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# Enable net.ipv4.ip_forward for the system</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &#x27;net.ipv4.ip_forward=1&#x27; &gt; /etc/sysctl.d/99-openvpn-forward.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# Enable without waiting for a reboot or service restart</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	if [[ -n &quot;$ip6&quot; ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		# Enable net.ipv6.conf.all.forwarding for the system</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo &quot;net.ipv6.conf.all.forwarding=1&quot; &gt;&gt; /etc/sysctl.d/99-openvpn-forward.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		# Enable without waiting for a reboot or service restart</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo 1 &gt; /proc/sys/net/ipv6/conf/all/forwarding</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	if systemctl is-active --quiet firewalld.service; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		# Using both permanent and not permanent rules to avoid a firewalld</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		# reload.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		# We don&#x27;t use --add-service=openvpn because that would only work with</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		# the default port and protocol.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		firewall-cmd --add-port=&quot;$port&quot;/&quot;$protocol&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		firewall-cmd --zone=trusted --add-source=10.8.0.0/24</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		firewall-cmd --permanent --add-port=&quot;$port&quot;/&quot;$protocol&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		firewall-cmd --permanent --zone=trusted --add-source=10.8.0.0/24</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		# Set NAT for the VPN subnet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		firewall-cmd --direct --add-rule ipv4 nat POSTROUTING 0 -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to &quot;$ip&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		firewall-cmd --permanent --direct --add-rule ipv4 nat POSTROUTING 0 -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to &quot;$ip&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		if [[ -n &quot;$ip6&quot; ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			firewall-cmd --zone=trusted --add-source=fddd:1194:1194:1194::/64</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			firewall-cmd --permanent --zone=trusted --add-source=fddd:1194:1194:1194::/64</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			firewall-cmd --direct --add-rule ipv6 nat POSTROUTING 0 -s fddd:1194:1194:1194::/64 ! -d fddd:1194:1194:1194::/64 -j SNAT --to &quot;$ip6&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			firewall-cmd --permanent --direct --add-rule ipv6 nat POSTROUTING 0 -s fddd:1194:1194:1194::/64 ! -d fddd:1194:1194:1194::/64 -j SNAT --to &quot;$ip6&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		# Create a service to set up persistent iptables rules</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		iptables_path=$(command -v iptables)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		ip6tables_path=$(command -v ip6tables)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		# nf_tables is not available as standard in OVZ kernels. So use iptables-legacy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		# if we are in OVZ, with a nf_tables backend and iptables-legacy is available.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		if [[ $(systemd-detect-virt) == &quot;openvz&quot; ]] &amp;&amp; readlink -f &quot;$(command -v iptables)&quot; | grep -q &quot;nft&quot; &amp;&amp; hash iptables-legacy 2&gt;/dev/null; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			iptables_path=$(command -v iptables-legacy)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			ip6tables_path=$(command -v ip6tables-legacy)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo &quot;[Unit]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Before=network.target</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Type=oneshot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ExecStart=$iptables_path -t nat -A POSTROUTING -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to $ip</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ExecStart=$iptables_path -I INPUT -p $protocol --dport $port -j ACCEPT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ExecStart=$iptables_path -I FORWARD -s 10.8.0.0/24 -j ACCEPT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ExecStart=$iptables_path -I FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ExecStop=$iptables_path -t nat -D POSTROUTING -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to $ip</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ExecStop=$iptables_path -D INPUT -p $protocol --dport $port -j ACCEPT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ExecStop=$iptables_path -D FORWARD -s 10.8.0.0/24 -j ACCEPT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ExecStop=$iptables_path -D FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT&quot; &gt; /etc/systemd/system/openvpn-iptables.service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		if [[ -n &quot;$ip6&quot; ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo &quot;ExecStart=$ip6tables_path -t nat -A POSTROUTING -s fddd:1194:1194:1194::/64 ! -d fddd:1194:1194:1194::/64 -j SNAT --to $ip6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ExecStart=$ip6tables_path -I FORWARD -s fddd:1194:1194:1194::/64 -j ACCEPT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ExecStart=$ip6tables_path -I FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ExecStop=$ip6tables_path -t nat -D POSTROUTING -s fddd:1194:1194:1194::/64 ! -d fddd:1194:1194:1194::/64 -j SNAT --to $ip6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ExecStop=$ip6tables_path -D FORWARD -s fddd:1194:1194:1194::/64 -j ACCEPT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ExecStop=$ip6tables_path -D FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT&quot; &gt;&gt; /etc/systemd/system/openvpn-iptables.service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo &quot;RemainAfterExit=yes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[Install]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">WantedBy=multi-user.target&quot; &gt;&gt; /etc/systemd/system/openvpn-iptables.service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		systemctl enable --now openvpn-iptables.service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# If SELinux is enabled and a custom port was selected, we need this</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	if sestatus 2&gt;/dev/null | grep &quot;Current mode&quot; | grep -q &quot;enforcing&quot; &amp;&amp; [[ &quot;$port&quot; != 1194 ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		# Install semanage if not already present</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		if ! hash semanage 2&gt;/dev/null; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			if [[ &quot;$os_version&quot; -eq 7 ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				# Centos 7</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				yum install -y policycoreutils-python</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				# CentOS 8 or Fedora</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				dnf install -y policycoreutils-python-utils</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		semanage port -a -t openvpn_port_t -p &quot;$protocol&quot; &quot;$port&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# If the server is behind NAT, use the correct IP address</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	[[ -n &quot;$public_ip&quot; ]] &amp;&amp; ip=&quot;$public_ip&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# client-common.txt is created so we have a template to add further users later</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;client</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dev tun</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">proto $protocol</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">remote $ip $port</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">resolv-retry infinite</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nobind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">persist-key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">persist-tun</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">remote-cert-tls server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">auth SHA512</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cipher AES-256-CBC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ignore-unknown-option block-outside-dns</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">block-outside-dns</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">verb 3&quot; &gt; /etc/openvpn/server/client-common.txt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# Enable and start the OpenVPN service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	systemctl enable --now openvpn-server@server.service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	# Generates the custom client.ovpn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	new_client</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;Finished!&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;The client configuration is available in:&quot; ~/&quot;$client.ovpn&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;New clients can be added by running this script again.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	clear</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;OpenVPN is already installed.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;Select an option:&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;   1) Add a new client&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;   2) Revoke an existing client&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;   3) Remove OpenVPN&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	echo &quot;   4) Exit&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	read -p &quot;Option: &quot; option</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	until [[ &quot;$option&quot; =~ ^[1-4]$ ]]; do</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		echo &quot;$option: invalid selection.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		read -p &quot;Option: &quot; option</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	done</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	case &quot;$option&quot; in</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo &quot;Provide a name for the client:&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			read -p &quot;Name: &quot; unsanitized_client</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			client=$(sed &#x27;s/[^0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-]/_/g&#x27; &lt;&lt;&lt; &quot;$unsanitized_client&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			while [[ -z &quot;$client&quot; || -e /etc/openvpn/server/easy-rsa/pki/issued/&quot;$client&quot;.crt ]]; do</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				echo &quot;$client: invalid name.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				read -p &quot;Name: &quot; unsanitized_client</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				client=$(sed &#x27;s/[^0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-]/_/g&#x27; &lt;&lt;&lt; &quot;$unsanitized_client&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			done</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			cd /etc/openvpn/server/easy-rsa/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			EASYRSA_CERT_EXPIRE=3650 ./easyrsa build-client-full &quot;$client&quot; nopass</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			# Generates the custom client.ovpn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			new_client</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo &quot;$client added. Configuration available in:&quot; ~/&quot;$client.ovpn&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		2)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			# This option could be documented a bit better and maybe even be simplified</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			# ...but what can I say, I want some sleep too</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			number_of_clients=$(tail -n +2 /etc/openvpn/server/easy-rsa/pki/index.txt | grep -c &quot;^V&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			if [[ &quot;$number_of_clients&quot; = 0 ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				echo &quot;There are no existing clients!&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo &quot;Select the client to revoke:&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			tail -n +2 /etc/openvpn/server/easy-rsa/pki/index.txt | grep &quot;^V&quot; | cut -d &#x27;=&#x27; -f 2 | nl -s &#x27;) &#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			read -p &quot;Client: &quot; client_number</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			until [[ &quot;$client_number&quot; =~ ^[0-9]+$ &amp;&amp; &quot;$client_number&quot; -le &quot;$number_of_clients&quot; ]]; do</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				echo &quot;$client_number: invalid selection.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				read -p &quot;Client: &quot; client_number</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			done</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			client=$(tail -n +2 /etc/openvpn/server/easy-rsa/pki/index.txt | grep &quot;^V&quot; | cut -d &#x27;=&#x27; -f 2 | sed -n &quot;$client_number&quot;p)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			read -p &quot;Confirm $client revocation? [y/N]: &quot; revoke</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			until [[ &quot;$revoke&quot; =~ ^[yYnN]*$ ]]; do</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				echo &quot;$revoke: invalid selection.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				read -p &quot;Confirm $client revocation? [y/N]: &quot; revoke</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			done</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			if [[ &quot;$revoke&quot; =~ ^[yY]$ ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				cd /etc/openvpn/server/easy-rsa/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				./easyrsa --batch revoke &quot;$client&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				EASYRSA_CRL_DAYS=3650 ./easyrsa gen-crl</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				rm -f /etc/openvpn/server/crl.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				cp /etc/openvpn/server/easy-rsa/pki/crl.pem /etc/openvpn/server/crl.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				# CRL is read with each client connection, when OpenVPN is dropped to nobody</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				chown nobody:&quot;$group_name&quot; /etc/openvpn/server/crl.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				echo &quot;$client revoked!&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				echo &quot;$client revocation aborted!&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		3)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			read -p &quot;Confirm OpenVPN removal? [y/N]: &quot; remove</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			until [[ &quot;$remove&quot; =~ ^[yYnN]*$ ]]; do</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				echo &quot;$remove: invalid selection.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				read -p &quot;Confirm OpenVPN removal? [y/N]: &quot; remove</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			done</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			if [[ &quot;$remove&quot; =~ ^[yY]$ ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				port=$(grep &#x27;^port &#x27; /etc/openvpn/server/server.conf | cut -d &quot; &quot; -f 2)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				protocol=$(grep &#x27;^proto &#x27; /etc/openvpn/server/server.conf | cut -d &quot; &quot; -f 2)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				if systemctl is-active --quiet firewalld.service; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					ip=$(firewall-cmd --direct --get-rules ipv4 nat POSTROUTING | grep &#x27;\-s 10.8.0.0/24 &#x27;&quot;&#x27;&quot;&#x27;!&#x27;&quot;&#x27;&quot;&#x27; -d 10.8.0.0/24&#x27; | grep -oE &#x27;[^ ]+$&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					# Using both permanent and not permanent rules to avoid a firewalld reload.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					firewall-cmd --remove-port=&quot;$port&quot;/&quot;$protocol&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					firewall-cmd --zone=trusted --remove-source=10.8.0.0/24</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					firewall-cmd --permanent --remove-port=&quot;$port&quot;/&quot;$protocol&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					firewall-cmd --permanent --zone=trusted --remove-source=10.8.0.0/24</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					firewall-cmd --direct --remove-rule ipv4 nat POSTROUTING 0 -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to &quot;$ip&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					firewall-cmd --permanent --direct --remove-rule ipv4 nat POSTROUTING 0 -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to &quot;$ip&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					if grep -qs &quot;server-ipv6&quot; /etc/openvpn/server/server.conf; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						ip6=$(firewall-cmd --direct --get-rules ipv6 nat POSTROUTING | grep &#x27;\-s fddd:1194:1194:1194::/64 &#x27;&quot;&#x27;&quot;&#x27;!&#x27;&quot;&#x27;&quot;&#x27; -d fddd:1194:1194:1194::/64&#x27; | grep -oE &#x27;[^ ]+$&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						firewall-cmd --zone=trusted --remove-source=fddd:1194:1194:1194::/64</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						firewall-cmd --permanent --zone=trusted --remove-source=fddd:1194:1194:1194::/64</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						firewall-cmd --direct --remove-rule ipv6 nat POSTROUTING 0 -s fddd:1194:1194:1194::/64 ! -d fddd:1194:1194:1194::/64 -j SNAT --to &quot;$ip6&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						firewall-cmd --permanent --direct --remove-rule ipv6 nat POSTROUTING 0 -s fddd:1194:1194:1194::/64 ! -d fddd:1194:1194:1194::/64 -j SNAT --to &quot;$ip6&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					systemctl disable --now openvpn-iptables.service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					rm -f /etc/systemd/system/openvpn-iptables.service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				if sestatus 2&gt;/dev/null | grep &quot;Current mode&quot; | grep -q &quot;enforcing&quot; &amp;&amp; [[ &quot;$port&quot; != 1194 ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					semanage port -d -t openvpn_port_t -p &quot;$protocol&quot; &quot;$port&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				systemctl disable --now openvpn-server@server.service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				rm -f /etc/systemd/system/openvpn-server@server.service.d/disable-limitnproc.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				rm -f /etc/sysctl.d/99-openvpn-forward.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				if [[ &quot;$os&quot; = &quot;debian&quot; || &quot;$os&quot; = &quot;ubuntu&quot; ]]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					rm -rf /etc/openvpn/server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					apt-get remove --purge -y openvpn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					# Else, OS must be CentOS or Fedora</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					yum remove -y openvpn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					rm -rf /etc/openvpn/server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				echo &quot;OpenVPN removed!&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				echo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				echo &quot;OpenVPN removal aborted!&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		4)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	esac</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/linux/linux实用开源小工具/grc"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">grc</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/linux/linux服务/VPN/CentOS7手动安装OpenVPN"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">CentOS7手动安装OpenVPN</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1安装openvpn" class="table-of-contents__link toc-highlight">1.安装OpenVPN</a><ul><li><a href="#11-克隆项目" class="table-of-contents__link toc-highlight">1.1 克隆项目</a></li><li><a href="#12-执行安装脚本" class="table-of-contents__link toc-highlight">1.2 执行安装脚本</a><ul><li><a href="#第一步输入本机私网ip地址" class="table-of-contents__link toc-highlight">第一步、输入本机私网IP地址</a></li><li><a href="#第二步输入本机公网ip" class="table-of-contents__link toc-highlight">第二步、输入本机公网IP</a></li><li><a href="#第三步选择openvpn协议推荐使用udp" class="table-of-contents__link toc-highlight">第三步、选择OpenVPN协议，推荐使用UDP</a></li><li><a href="#第四步输入openvpn监听的端口" class="table-of-contents__link toc-highlight">第四步、输入OpenVPN监听的端口</a></li><li><a href="#第五步为客户端选择一个dns服务器" class="table-of-contents__link toc-highlight">第五步、为客户端选择一个DNS服务器</a></li><li><a href="#第六步为第一个客户端输入一个名称" class="table-of-contents__link toc-highlight">第六步、为第一个客户端输入一个名称</a></li><li><a href="#第七步按任意键开始安装" class="table-of-contents__link toc-highlight">第七步、按任意键开始安装</a></li></ul></li><li><a href="#13-查看openvpn相关信息" class="table-of-contents__link toc-highlight">1.3 查看OpenVPN相关信息</a><ul><li><a href="#131-查看openvpn进程" class="table-of-contents__link toc-highlight">1.3.1 查看OpenVPN进程</a></li><li><a href="#132-openvpn默认监听-udp-1194-端口" class="table-of-contents__link toc-highlight">1.3.2 OpenVPN默认监听 <code>udp 1194</code> 端口</a></li><li><a href="#133-查看版本" class="table-of-contents__link toc-highlight">1.3.3 查看版本</a></li></ul></li></ul></li><li><a href="#2配置onenvpn使用账号密码认证" class="table-of-contents__link toc-highlight">2.配置OnenVPN使用账号密码认证</a><ul><li><a href="#21-编辑脚本" class="table-of-contents__link toc-highlight">2.1 编辑脚本</a></li><li><a href="#22-修改openvpn配置文件-etcopenvpnserverserverconf" class="table-of-contents__link toc-highlight">2.2 修改openvpn配置文件 <code>/etc/openvpn/server/server.conf</code></a><ul><li><a href="#221-追加以下内容" class="table-of-contents__link toc-highlight">2.2.1 追加以下内容</a></li><li><a href="#222-修改-serverconf" class="table-of-contents__link toc-highlight">2.2.2 修改 server.conf</a></li></ul></li><li><a href="#23-重启服务" class="table-of-contents__link toc-highlight">2.3 重启服务</a></li><li><a href="#24-添加账号" class="table-of-contents__link toc-highlight">2.4 添加账号</a></li><li><a href="#25-修改客户端文件" class="table-of-contents__link toc-highlight">2.5 修改客户端文件</a></li></ul></li><li><a href="#3客户端安装配置" class="table-of-contents__link toc-highlight">3.客户端安装配置</a><ul><li><a href="#31-mac连接示例" class="table-of-contents__link toc-highlight">3.1 mac连接示例</a></li><li><a href="#32-windows连接示例" class="table-of-contents__link toc-highlight">3.2 windows连接示例</a></li></ul></li><li><a href="#4云主机安全组配置说明" class="table-of-contents__link toc-highlight">4.云主机安全组配置说明</a></li><li><a href="#5脚本内容" class="table-of-contents__link toc-highlight">5.脚本内容</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">笔记</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 泡泡吐肥皂o</div></div></div></footer></div>
</body>
</html>